<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of exportModel</title>
  <meta name="keywords" content="exportModel">
  <meta name="description" content="exportModel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">io</a> &gt; exportModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for io&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>exportModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>exportModel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> exportModel
   Exports a constraint-based model to an SBML file (L3V1 FBCv2)

 Input:
   model               a model structure
   fileName            filename to export the model to. A dialog window
                       will open if no file name is specified.
   COBRAstyle          true if COBRA-style prefixes should be added to all
                       identifiers: R_ for reactions, M_ for metabolites,
                       G_ for genes and C_ for compartments. If all
                       identifiers of a particular field already have the
                       prefix, then no additional prefixes are added.
                       (optional, default false)
   supressWarnings     true if warnings should be supressed (optional, default
                       false)
   sortIds             logical whether metabolites, reactions and genes
                       should be sorted alphabetically by their
                       identifiers (optional, default false)

 Usage: exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="checkFileExistence.html" class="code" title="function files=checkFileExistence(files,fullOrTemp,allowSpace,checkExist)">checkFileExistence</a>	checkFileExistence</li><li><a href="sortIdentifiers.html" class="code" title="function newModel = sortIdentifiers(model)">sortIdentifiers</a>	exportModel</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="SBMLFromExcel.html" class="code" title="function SBMLFromExcel(fileName, outputFileName,toCOBRA,printWarnings)">SBMLFromExcel</a>	SBMLFromExcel</li><li><a href="exportForGit.html" class="code" title="function out=exportForGit(model,prefix,path,formats,mainBranchFlag,subDirs,cobraText)">exportForGit</a>	exportForGit</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)</a></li><li><a href="#_sub2" class="code">function miriamString=getMiriam(miriamStruct)</a></li><li><a href="#_sub3" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a></li><li><a href="#_sub4" class="code">function vecT = columnVector(vec)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)</a>
0002 <span class="comment">% exportModel</span>
0003 <span class="comment">%   Exports a constraint-based model to an SBML file (L3V1 FBCv2)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%   model               a model structure</span>
0007 <span class="comment">%   fileName            filename to export the model to. A dialog window</span>
0008 <span class="comment">%                       will open if no file name is specified.</span>
0009 <span class="comment">%   COBRAstyle          true if COBRA-style prefixes should be added to all</span>
0010 <span class="comment">%                       identifiers: R_ for reactions, M_ for metabolites,</span>
0011 <span class="comment">%                       G_ for genes and C_ for compartments. If all</span>
0012 <span class="comment">%                       identifiers of a particular field already have the</span>
0013 <span class="comment">%                       prefix, then no additional prefixes are added.</span>
0014 <span class="comment">%                       (optional, default false)</span>
0015 <span class="comment">%   supressWarnings     true if warnings should be supressed (optional, default</span>
0016 <span class="comment">%                       false)</span>
0017 <span class="comment">%   sortIds             logical whether metabolites, reactions and genes</span>
0018 <span class="comment">%                       should be sorted alphabetically by their</span>
0019 <span class="comment">%                       identifiers (optional, default false)</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% Usage: exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)</span>
0022 
0023 <span class="keyword">if</span> nargin&lt;2 || isempty(fileName)
0024     [fileName, pathName] = uiputfile({<span class="string">'*.xml;*.sbml'</span>}, <span class="string">'Select file for model export'</span>,[model.id <span class="string">'.xml'</span>]);
0025     <span class="keyword">if</span> fileName == 0
0026         error(<span class="string">'You should provide a file location'</span>)
0027     <span class="keyword">else</span>
0028         fileName = fullfile(pathName,fileName);
0029     <span class="keyword">end</span>
0030 <span class="keyword">end</span>
0031 fileName=char(fileName);
0032 <span class="keyword">if</span> nargin&lt;3
0033     COBRAstyle=false;
0034 <span class="keyword">end</span>
0035 <span class="keyword">if</span> nargin&lt;4
0036     supressWarnings=false;
0037 <span class="keyword">end</span>
0038 <span class="keyword">if</span> nargin&lt;5
0039     sortIds=false;
0040 <span class="keyword">end</span>
0041 <span class="keyword">if</span> sortIds==true
0042     model=<a href="sortIdentifiers.html" class="code" title="function newModel = sortIdentifiers(model)">sortIdentifiers</a>(model);
0043 <span class="keyword">end</span>
0044 
0045 <span class="comment">%If no subSystems are defined, then no need to use groups package</span>
0046 <span class="keyword">if</span> isfield(model,<span class="string">'subSystems'</span>)
0047     modelHasSubsystems=true;
0048 <span class="keyword">else</span>
0049     modelHasSubsystems=false;
0050 <span class="keyword">end</span>
0051 
0052 <span class="comment">%The default SBML format settings, which are used as input for appropriate</span>
0053 <span class="comment">%libSBML functions to generate the blank SBML model structure before using</span>
0054 <span class="comment">%exporting in with OutputSBML to xml file</span>
0055 sbmlLevel=3;
0056 sbmlVersion=1;
0057 sbmlPackages={<span class="string">'fbc'</span>};
0058 sbmlPackageVersions=2;
0059 <span class="keyword">if</span> modelHasSubsystems
0060     sbmlPackages={sbmlPackages,<span class="string">'groups'</span>};
0061     sbmlPackageVersions=[sbmlPackageVersions,1];
0062 <span class="keyword">end</span>
0063 
0064 <span class="comment">%Check if the &quot;unconstrained&quot; field is still present. This shows if</span>
0065 <span class="comment">%exchange metabolites have been removed</span>
0066 <span class="keyword">if</span> ~isfield(model,<span class="string">'unconstrained'</span>)
0067     model.unconstrained=zeros(numel(model.mets),1);
0068 <span class="keyword">end</span>
0069 
0070 <span class="comment">%If model id and name do not exist, make sure that default</span>
0071 <span class="comment">%strings are included</span>
0072 <span class="keyword">if</span> ~isfield(model,<span class="string">'id'</span>)
0073     fprintf(<span class="string">'WARNING: The model is missing the &quot;id&quot; field. Uses &quot;blankID&quot;. \n'</span>);
0074     model.id=<span class="string">'blankID'</span>;
0075 <span class="keyword">end</span>
0076 <span class="keyword">if</span> ~isfield(model,<span class="string">'name'</span>)
0077     fprintf(<span class="string">'WARNING: The model is missing the &quot;name&quot; field. Uses &quot;blankName&quot;. \n'</span>);
0078     model.name=<span class="string">'blankName'</span>;
0079 <span class="keyword">end</span>
0080 
0081 <span class="comment">%Check the model structure</span>
0082 <span class="keyword">if</span> supressWarnings==false
0083     checkModelStruct(model);
0084 <span class="keyword">end</span>
0085 
0086 <span class="comment">%Add several blank fields, if they do not exist already. This is to reduce</span>
0087 <span class="comment">%the number of conditions below</span>
0088 <span class="keyword">if</span> ~isfield(model,<span class="string">'compMiriams'</span>)
0089     model.compMiriams=cell(numel(model.comps),1);
0090 <span class="keyword">end</span>
0091 <span class="keyword">if</span> ~isfield(model,<span class="string">'inchis'</span>)
0092     model.inchis=cell(numel(model.mets),1);
0093 <span class="keyword">end</span>
0094 <span class="keyword">if</span> ~isfield(model,<span class="string">'metFormulas'</span>)
0095     model.metFormulas=cell(numel(model.mets),1);
0096 <span class="keyword">end</span>
0097 <span class="keyword">if</span> ~isfield(model,<span class="string">'metMiriams'</span>)
0098     model.metMiriams=cell(numel(model.mets),1);
0099 <span class="keyword">end</span>
0100 <span class="keyword">if</span> ~isfield(model,<span class="string">'geneMiriams'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0101     model.geneMiriams=cell(numel(model.genes),1);
0102 <span class="keyword">end</span>
0103 <span class="keyword">if</span> ~isfield(model,<span class="string">'geneShortNames'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0104     model.geneShortNames=cell(numel(model.genes),1);
0105 <span class="keyword">end</span>
0106 <span class="keyword">if</span> ~isfield(model,<span class="string">'subSystems'</span>)
0107     model.subSystems=cell(numel(model.rxns),1);
0108 <span class="keyword">end</span>
0109 <span class="keyword">if</span> ~isfield(model,<span class="string">'eccodes'</span>)
0110     model.eccodes=cell(numel(model.rxns),1);
0111 <span class="keyword">end</span>
0112 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnReferences'</span>)
0113     model.rxnReferences=cell(numel(model.rxns),1);
0114 <span class="keyword">end</span>
0115 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnConfidenceScores'</span>)
0116     model.rxnConfidenceScores=NaN(numel(model.rxns),1);
0117 <span class="keyword">end</span>
0118 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnNotes'</span>)
0119     model.rxnNotes=cell(numel(model.rxns),1);
0120 <span class="keyword">end</span>
0121 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnMiriams'</span>)
0122     model.rxnMiriams=cell(numel(model.rxns),1);
0123 <span class="keyword">end</span>
0124 
0125 <span class="keyword">if</span> sbmlLevel&lt;3
0126     <span class="comment">%Check if genes have associated compartments</span>
0127     <span class="keyword">if</span> ~isfield(model,<span class="string">'geneComps'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0128         <span class="keyword">if</span> supressWarnings==false
0129             EM=<span class="string">'There are no compartments specified for genes. All genes will be assigned to the first compartment. This is because the SBML structure requires all elements to be assigned to a compartment'</span>;
0130             dispEM(EM,false);
0131         <span class="keyword">end</span>
0132         model.geneComps=ones(numel(model.genes),1);
0133     <span class="keyword">end</span>
0134 <span class="keyword">end</span>
0135 
0136 <span class="comment">%Convert ids to SBML-convenient format. This is to avoid the data loss when</span>
0137 <span class="comment">%unsupported characters are included in ids. Here we are using part from</span>
0138 <span class="comment">%convertSBMLID, originating from the COBRA Toolbox</span>
0139 model.rxns=regexprep(model.rxns,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0140 model.mets=regexprep(model.mets,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0141 model.comps=regexprep(model.comps,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0142 <span class="keyword">if</span> COBRAstyle
0143     <span class="keyword">if</span> isfield(model,<span class="string">'ec'</span>)
0144         error(<span class="string">'ecModels cannot be exported with COBRAstyle flag, manually correct any non-compliant identifiers if needed.'</span>)
0145     <span class="keyword">end</span>
0146     <span class="keyword">if</span> ~all(startsWith(model.rxns,<span class="string">'R_'</span>))
0147         model.rxns  = strcat(<span class="string">'R_'</span>,model.rxns);
0148     <span class="keyword">end</span>
0149     <span class="keyword">if</span> ~all(startsWith(model.mets,<span class="string">'M_'</span>))
0150         model.mets  = strcat(<span class="string">'M_'</span>,model.mets);
0151     <span class="keyword">end</span>
0152     <span class="keyword">if</span> ~all(startsWith(model.comps,<span class="string">'C_'</span>))
0153         model.comps  = strcat(<span class="string">'C_'</span>,model.comps);
0154     <span class="keyword">end</span>
0155 <span class="keyword">end</span>
0156 <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>)
0157     problemGenes=find(~cellfun(<span class="string">'isempty'</span>,regexp(model.genes,<span class="string">'([^0-9_a-zA-Z])'</span>)));
0158     originalGenes=model.genes(problemGenes);
0159     replacedGenes=regexprep(model.genes(problemGenes),<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0160     model.genes(problemGenes)=replacedGenes;
0161     <span class="keyword">for</span> i=1:numel(problemGenes)
0162         model.grRules = regexprep(model.grRules, [<span class="string">'(^|\s|\()'</span> originalGenes{i} <span class="string">'($|\s|\))'</span>], [<span class="string">'$1'</span> replacedGenes{i} <span class="string">'$2'</span>]);
0163     <span class="keyword">end</span>
0164     <span class="keyword">if</span> COBRAstyle
0165         model.genes = strcat(<span class="string">'G_'</span>,model.genes);
0166         model.grRules = regexprep(model.grRules, <span class="string">'(\&lt;[0-9_a-zA-Z])'</span>, <span class="string">'G_$1'</span>);
0167         model.grRules = regexprep(model.grRules, <span class="string">' G_or '</span>, <span class="string">' or '</span>);
0168         model.grRules = regexprep(model.grRules, <span class="string">' G_and '</span>, <span class="string">' and '</span>);
0169     <span class="keyword">end</span>
0170 <span class="keyword">end</span>
0171 
0172 <span class="comment">%Generate an empty SBML structure</span>
0173 modelSBML=<a href="#_sub1" class="code" title="subfunction modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)">getSBMLStructure</a>(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0174 modelSBML.metaid=model.id;
0175 modelSBML.id=regexprep(model.id,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0176 modelSBML.name=model.name;
0177 
0178 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0179     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'note'</span>)
0180         modelSBML.notes=[<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;'</span>,regexprep(model.annotation.note,<span class="string">'&lt;p&gt;|&lt;/p&gt;'</span>,<span class="string">''</span>),<span class="string">'&lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>];
0181     <span class="keyword">end</span>
0182 <span class="keyword">else</span>
0183     modelSBML.notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;This file was generated using the exportModel function in RAVEN Toolbox 2 and OutputSBML in libSBML &lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>;
0184 <span class="keyword">end</span>
0185 
0186 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0187     nameString=<span class="string">''</span>;
0188     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'familyName'</span>)
0189         <span class="keyword">if</span> ~isempty(model.annotation.familyName)
0190             nameString=[<span class="string">'&lt;vCard:Family&gt;'</span> model.annotation.familyName <span class="string">'&lt;/vCard:Family&gt;'</span>];
0191         <span class="keyword">end</span>
0192     <span class="keyword">end</span>
0193     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'givenName'</span>)
0194         <span class="keyword">if</span> ~isempty(model.annotation.givenName)
0195             nameString=[nameString <span class="string">'&lt;vCard:Given&gt;'</span> model.annotation.givenName <span class="string">'&lt;/vCard:Given&gt;'</span>];
0196         <span class="keyword">end</span>
0197     <span class="keyword">end</span>
0198     email=<span class="string">''</span>;
0199     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'email'</span>)
0200         <span class="keyword">if</span> ~isempty(model.annotation.email)
0201             email=[<span class="string">'&lt;vCard:EMAIL&gt;'</span> model.annotation.email <span class="string">'&lt;/vCard:EMAIL&gt;'</span>];
0202         <span class="keyword">end</span>
0203     <span class="keyword">end</span>
0204     org=<span class="string">''</span>;
0205     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'organization'</span>)
0206         <span class="keyword">if</span> ~isempty(model.annotation.organization)
0207             org=[<span class="string">'&lt;vCard:ORG rdf:parseType=&quot;Resource&quot;&gt;&lt;vCard:Orgname&gt;'</span> model.annotation.organization <span class="string">'&lt;/vCard:Orgname&gt;&lt;/vCard:ORG&gt;'</span>];
0208         <span class="keyword">end</span>
0209     <span class="keyword">end</span>
0210     <span class="keyword">if</span> ~isempty(nameString) || ~isempty(email) || ~isempty(org) <span class="comment">% Only fill .annotation if ownership data is provided</span>
0211         modelSBML.annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.id <span class="string">'&quot;&gt;'</span>];
0212         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dc:creator&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;'</span>];
0213         <span class="keyword">if</span> ~isempty(nameString)
0214             modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;vCard:N rdf:parseType=&quot;Resource&quot;&gt;'</span> nameString <span class="string">'&lt;/vCard:N&gt;'</span>];
0215         <span class="keyword">end</span>
0216         modelSBML.annotation=[modelSBML.annotation email org <span class="string">'&lt;/rdf:li&gt;&lt;/rdf:Bag&gt;&lt;/dc:creator&gt;'</span>];
0217         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dcterms:created rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0218             <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;&lt;/dcterms:created&gt;&lt;dcterms:modified rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0219             <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;&lt;/dcterms:modified&gt;'</span>];
0220         <span class="keyword">if</span> isfield(model.annotation,<span class="string">'taxonomy'</span>)
0221             modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:resource=&quot;https://identifiers.org/taxonomy/'</span> regexprep(model.annotation.taxonomy,<span class="string">'taxonomy/'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;'</span>];
0222         <span class="keyword">end</span>
0223         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0224     <span class="keyword">end</span>
0225 <span class="keyword">end</span>
0226 
0227 <span class="comment">%Prepare compartments</span>
0228 <span class="keyword">for</span> i=1:numel(model.comps)
0229     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0230     <span class="keyword">if</span> i==1
0231         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'sboTerm'</span>)
0232             modelSBML.compartment(i).sboTerm=290;
0233         <span class="keyword">end</span>
0234         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'spatialDimensions'</span>)
0235             modelSBML.compartment(i).spatialDimensions=3;
0236         <span class="keyword">end</span>
0237         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'size'</span>)
0238             modelSBML.compartment(i).size=1;
0239         <span class="keyword">end</span>
0240         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'constant'</span>)
0241             modelSBML.compartment(i).constant=1;
0242         <span class="keyword">end</span>
0243         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSize'</span>)
0244             modelSBML.compartment(i).isSetSize=1;
0245         <span class="keyword">end</span>
0246         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSpatialDimensions'</span>)
0247             modelSBML.compartment(i).isSetSpatialDimensions=1;
0248         <span class="keyword">end</span>
0249     <span class="keyword">end</span>
0250     <span class="comment">%Copy the default values to the next entry as long as it is not the</span>
0251     <span class="comment">%last one</span>
0252     <span class="keyword">if</span> i&lt;numel(model.comps)
0253         modelSBML.compartment(i+1)=modelSBML.compartment(i);
0254     <span class="keyword">end</span>
0255     
0256     <span class="keyword">if</span> isfield(modelSBML.compartment,<span class="string">'metaid'</span>)
0257         modelSBML.compartment(i).metaid=model.comps{i};
0258     <span class="keyword">end</span>
0259     <span class="comment">%Prepare Miriam strings</span>
0260     <span class="keyword">if</span> ~isempty(model.compMiriams{i})
0261         [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.compMiriams{i}.name);
0262         <span class="keyword">if</span> sbo_ind &gt; 0
0263             modelSBML.compartment(i).sboTerm=str2double(regexprep(model.compMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0264             <span class="comment">% remove the SBO term from compMiriams so the information is</span>
0265             <span class="comment">% not duplicated in the &quot;annotation&quot; field later on</span>
0266             model.compMiriams{i}.name(sbo_ind) = [];
0267             model.compMiriams{i}.value(sbo_ind) = [];
0268         <span class="keyword">end</span>
0269     <span class="keyword">end</span>
0270     <span class="keyword">if</span> ~isempty(model.compMiriams{i}) &amp;&amp; isfield(modelSBML.compartment(i),<span class="string">'annotation'</span>)
0271         modelSBML.compartment(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.comps{i} <span class="string">'&quot;&gt;'</span>];
0272         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0273         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.compMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0274     <span class="keyword">end</span>
0275     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'name'</span>)
0276         modelSBML.compartment(i).name=model.compNames{i};
0277     <span class="keyword">end</span>
0278     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'id'</span>)
0279         modelSBML.compartment(i).id=model.comps{i};
0280     <span class="keyword">end</span>
0281     
0282 <span class="keyword">end</span>
0283 
0284 <span class="comment">%Begin writing species</span>
0285 <span class="keyword">for</span> i=1:numel(model.mets)
0286     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0287     <span class="keyword">if</span> i==1
0288         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'sboTerm'</span>)
0289             modelSBML.species(i).sboTerm=247;
0290         <span class="keyword">end</span>
0291         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialAmount'</span>)
0292             modelSBML.species(i).initialAmount=1;
0293         <span class="keyword">end</span>
0294         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialConcentration'</span>)
0295             modelSBML.species(i).initialConcentration=0;
0296         <span class="keyword">end</span>
0297         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialAmount'</span>)
0298             modelSBML.species(i).isSetInitialAmount=1;
0299         <span class="keyword">end</span>
0300         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialConcentration'</span>)
0301             modelSBML.species(i).isSetInitialConcentration=1;
0302         <span class="keyword">end</span>
0303     <span class="keyword">end</span>
0304     <span class="comment">%Copy the default values to the next entry as long as it is not the</span>
0305     <span class="comment">%last one</span>
0306     <span class="keyword">if</span> i&lt;numel(model.mets)
0307         modelSBML.species(i+1)=modelSBML.species(i);
0308     <span class="keyword">end</span>
0309     
0310     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'metaid'</span>)
0311         modelSBML.species(i).metaid=model.mets{i};
0312     <span class="keyword">end</span>
0313     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'name'</span>)
0314         modelSBML.species(i).name=model.metNames{i};
0315     <span class="keyword">end</span>
0316     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'id'</span>)
0317         modelSBML.species(i).id=model.mets{i};
0318     <span class="keyword">end</span>
0319     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'compartment'</span>)
0320         modelSBML.species(i).compartment=model.comps{model.metComps(i)};
0321     <span class="keyword">end</span>
0322     <span class="keyword">if</span> isfield(model,<span class="string">'unconstrained'</span>)
0323         <span class="keyword">if</span> model.unconstrained(i)
0324             modelSBML.species(i).boundaryCondition=1;
0325         <span class="keyword">end</span>
0326     <span class="keyword">end</span>
0327     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'fbc_charge'</span>) &amp;&amp; isfield(model,<span class="string">'metCharges'</span>)
0328         <span class="keyword">if</span> ~isnan(model.metCharges(i))
0329             modelSBML.species(i).fbc_charge=model.metCharges(i);
0330             modelSBML.species(i).isSetfbc_charge=1;
0331         <span class="keyword">else</span>
0332             modelSBML.species(i).isSetfbc_charge=0;
0333         <span class="keyword">end</span>
0334     <span class="keyword">end</span>
0335     <span class="keyword">if</span> ~isempty(model.metMiriams{i})
0336         [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.metMiriams{i}.name);
0337         <span class="keyword">if</span> sbo_ind &gt; 0
0338             modelSBML.species(i).sboTerm=str2double(regexprep(model.metMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0339             <span class="comment">% remove the SBO term from metMiriams so the information is</span>
0340             <span class="comment">% not duplicated in the &quot;annotation&quot; field later on</span>
0341             model.metMiriams{i}.name(sbo_ind) = [];
0342             model.metMiriams{i}.value(sbo_ind) = [];
0343         <span class="keyword">end</span>
0344     <span class="keyword">end</span>
0345     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'annotation'</span>)
0346         <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || ~isempty(model.metFormulas{i})
0347             hasInchi=false;
0348             <span class="keyword">if</span> ~isempty(model.metFormulas{i})
0349                 <span class="comment">%Only export formula if there is no InChI. This is because</span>
0350                 <span class="comment">%the metFormulas field is populated by InChIs if available</span>
0351                 <span class="keyword">if</span> ~isempty(model.inchis{i})
0352                     hasInchi=true;
0353                 <span class="keyword">end</span>
0354                 <span class="keyword">if</span> hasInchi==false
0355                     modelSBML.species(i).fbc_chemicalFormula=model.metFormulas{i};
0356                 <span class="keyword">end</span>
0357             <span class="keyword">end</span>
0358             <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || hasInchi==true
0359                 modelSBML.species(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.mets{i} <span class="string">'&quot;&gt;'</span>];
0360                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0361                 <span class="keyword">if</span> ~isempty(model.metMiriams{i})
0362                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.metMiriams{i})];
0363                 <span class="keyword">end</span>
0364                 <span class="keyword">if</span> hasInchi==true
0365                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;rdf:li rdf:resource=&quot;https://identifiers.org/inchi/InChI='</span> regexprep(model.inchis{i},<span class="string">'^InChI='</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;'</span>];
0366                     modelSBML.species(i).fbc_chemicalFormula=char(regexp(model.inchis{i}, <span class="string">'/(\w+)/'</span>, <span class="string">'tokens'</span>, <span class="string">'once'</span>));
0367                 <span class="keyword">end</span>
0368                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0369             <span class="keyword">end</span>
0370         <span class="keyword">end</span>
0371     <span class="keyword">end</span>
0372 <span class="keyword">end</span>
0373 
0374 <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>)
0375     <span class="keyword">for</span> i=1:numel(model.genes)
0376         <span class="comment">%Add the default values, as these will be the same in all entries</span>
0377         <span class="keyword">if</span> i==1
0378             <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'sboTerm'</span>)
0379                 modelSBML.fbc_geneProduct(i).sboTerm=243;
0380             <span class="keyword">end</span>
0381         <span class="keyword">end</span>
0382         <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0383         <span class="comment">%last one</span>
0384         <span class="keyword">if</span> i&lt;numel(model.genes)
0385             modelSBML.fbc_geneProduct(i+1)=modelSBML.fbc_geneProduct(i);
0386         <span class="keyword">end</span>
0387         
0388         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'metaid'</span>)
0389             modelSBML.fbc_geneProduct(i).metaid=model.genes{i};
0390         <span class="keyword">end</span>
0391         <span class="keyword">if</span> ~isempty(model.geneMiriams{i})
0392             [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.geneMiriams{i}.name);
0393             <span class="keyword">if</span> sbo_ind &gt; 0
0394                 modelSBML.fbc_geneProduct(i).sboTerm=str2double(regexprep(model.geneMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0395                 <span class="comment">% remove the SBO term from compMiriams so the information is</span>
0396                 <span class="comment">% not duplicated in the &quot;annotation&quot; field later on</span>
0397                 model.geneMiriams{i}.name(sbo_ind) = [];
0398                 model.geneMiriams{i}.value(sbo_ind) = [];
0399             <span class="keyword">end</span>
0400         <span class="keyword">end</span>
0401         <span class="keyword">if</span> ~isempty(model.geneMiriams{i}) &amp;&amp; isfield(modelSBML.fbc_geneProduct(i),<span class="string">'annotation'</span>)
0402             modelSBML.fbc_geneProduct(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.genes{i} <span class="string">'&quot;&gt;'</span>];
0403             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0404             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.geneMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0405         <span class="keyword">end</span>
0406         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_id'</span>)
0407             modelSBML.fbc_geneProduct(i).fbc_id=model.genes{i};
0408         <span class="keyword">end</span>
0409         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_label'</span>) &amp;&amp; isfield(model,<span class="string">'geneShortNames'</span>)
0410             <span class="keyword">if</span> isempty(model.geneShortNames{i})
0411                 modelSBML.fbc_geneProduct(i).fbc_label=model.genes{i};
0412             <span class="keyword">else</span>
0413                 modelSBML.fbc_geneProduct(i).fbc_label=model.geneShortNames{i};
0414             <span class="keyword">end</span>
0415         <span class="keyword">end</span>
0416     <span class="keyword">end</span>
0417 <span class="keyword">end</span>
0418 
0419 <span class="comment">%Generate a list of unique fbc_bound names</span>
0420 totalValues=[model.lb; model.ub];
0421 totalNames=cell(size(totalValues,1),1);
0422 
0423 listUniqueValues=unique(totalValues);
0424 
0425 <span class="keyword">for</span> i=1:length(listUniqueValues)
0426     listUniqueNames{i,1}=[<span class="string">'FB'</span>,num2str(i),<span class="string">'N'</span>,num2str(abs(round(listUniqueValues(i))))]; <span class="comment">% create unique flux bound IDs.</span>
0427     ind=find(ismember(totalValues,listUniqueValues(i)));
0428     totalNames(ind)=listUniqueNames(i,1);
0429 <span class="keyword">end</span>
0430 
0431 <span class="keyword">for</span> i=1:length(listUniqueNames)
0432     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0433     <span class="keyword">if</span> i==1
0434         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'constant'</span>)
0435             modelSBML.parameter(i).constant=1;
0436         <span class="keyword">end</span>
0437         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'isSetValue'</span>)
0438             modelSBML.parameter(i).isSetValue=1;
0439         <span class="keyword">end</span>
0440     <span class="keyword">end</span>
0441     <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0442     <span class="comment">%last one</span>
0443     <span class="keyword">if</span> i&lt;numel(listUniqueNames)
0444         modelSBML.parameter(i+1)=modelSBML.parameter(i);
0445     <span class="keyword">end</span>
0446     modelSBML.parameter(i).id=listUniqueNames{i};
0447     modelSBML.parameter(i).value=listUniqueValues(i);
0448 <span class="keyword">end</span>
0449 
0450 <span class="keyword">for</span> i=1:numel(model.rxns)
0451     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0452     <span class="keyword">if</span> i==1
0453         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'sboTerm'</span>)
0454             modelSBML.reaction(i).sboTerm=176;
0455         <span class="keyword">end</span>
0456         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'isSetFast'</span>)
0457             modelSBML.reaction(i).isSetFast=1;
0458         <span class="keyword">end</span>
0459     <span class="keyword">end</span>
0460     <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0461     <span class="comment">%last one</span>
0462     <span class="keyword">if</span> i&lt;numel(model.rxns)
0463         modelSBML.reaction(i+1)=modelSBML.reaction(i);
0464     <span class="keyword">end</span>
0465     
0466     <span class="keyword">if</span> isfield(modelSBML.reaction,<span class="string">'metaid'</span>)
0467         modelSBML.reaction(i).metaid=model.rxns{i};
0468     <span class="keyword">end</span>
0469     
0470     <span class="comment">%Export notes information</span>
0471     <span class="keyword">if</span> (~isnan(model.rxnConfidenceScores(i)) || ~isempty(model.rxnReferences{i}) || ~isempty(model.rxnNotes{i}))
0472         modelSBML.reaction(i).notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;'</span>;
0473         <span class="keyword">if</span> ~isnan(model.rxnConfidenceScores(i))
0474             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;Confidence Level: '</span> num2str(model.rxnConfidenceScores(i)) <span class="string">'&lt;/p&gt;'</span>];
0475         <span class="keyword">end</span>
0476         <span class="keyword">if</span> ~isempty(model.rxnReferences{i})
0477             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;AUTHORS: '</span> model.rxnReferences{i} <span class="string">'&lt;/p&gt;'</span>];
0478         <span class="keyword">end</span>
0479         <span class="keyword">if</span> ~isempty(model.rxnNotes{i})
0480             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;NOTES: '</span> model.rxnNotes{i} <span class="string">'&lt;/p&gt;'</span>];
0481         <span class="keyword">end</span>
0482         modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;/body&gt;&lt;/notes&gt;'</span>];
0483     <span class="keyword">end</span>
0484     
0485     <span class="comment">% Export SBO terms from rxnMiriams</span>
0486     <span class="keyword">if</span> ~isempty(model.rxnMiriams{i})
0487         [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.rxnMiriams{i}.name);
0488         <span class="keyword">if</span> sbo_ind &gt; 0
0489             modelSBML.reaction(i).sboTerm=str2double(regexprep(model.rxnMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0490             <span class="comment">% remove the SBO term from rxnMiriams so the information is not</span>
0491             <span class="comment">% duplicated in the &quot;annotation&quot; field later on</span>
0492             model.rxnMiriams{i}.name(sbo_ind) = [];
0493             model.rxnMiriams{i}.value(sbo_ind) = [];
0494         <span class="keyword">end</span>
0495     <span class="keyword">end</span>
0496     
0497     <span class="comment">%Export annotation information from rxnMiriams</span>
0498     <span class="keyword">if</span> (~isempty(model.rxnMiriams{i}) &amp;&amp; isfield(modelSBML.reaction(i),<span class="string">'annotation'</span>)) || ~isempty(model.eccodes{i})
0499         modelSBML.reaction(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.rxns{i} <span class="string">'&quot;&gt;'</span>];
0500         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0501         <span class="keyword">if</span> ~isempty(model.eccodes{i})
0502             eccodes=regexp(model.eccodes{i},<span class="string">';'</span>,<span class="string">'split'</span>);
0503             <span class="keyword">for</span> j=1:numel(eccodes)
0504                 modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation  <span class="string">'&lt;rdf:li rdf:resource=&quot;https://identifiers.org/ec-code/'</span> regexprep(eccodes{j},<span class="string">'ec-code/|EC'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;'</span>];
0505             <span class="keyword">end</span>
0506         <span class="keyword">end</span>
0507         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.rxnMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0508     <span class="keyword">end</span>
0509     
0510     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'name'</span>)
0511         modelSBML.reaction(i).name=model.rxnNames{i};
0512     <span class="keyword">end</span>
0513     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'id'</span>)
0514         modelSBML.reaction(i).id=model.rxns{i};
0515     <span class="keyword">end</span>
0516     
0517     <span class="comment">%Add the information about reactants and products</span>
0518     involvedMets=<a href="#_sub3" class="code" title="subfunction [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)">addReactantsProducts</a>(model,modelSBML,i);
0519     <span class="keyword">for</span> j=1:numel(involvedMets.reactant)
0520         <span class="keyword">if</span> j&lt;numel(involvedMets.reactant)
0521             modelSBML.reaction(i).reactant(j+1)=modelSBML.reaction(i).reactant(j);
0522         <span class="keyword">end</span>
0523         modelSBML.reaction(i).reactant(j).species=involvedMets.reactant(j).species;
0524         modelSBML.reaction(i).reactant(j).stoichiometry=involvedMets.reactant(j).stoichiometry;
0525         modelSBML.reaction(i).reactant(j).isSetStoichiometry=involvedMets.reactant(j).isSetStoichiometry;
0526         modelSBML.reaction(i).reactant(j).constant=involvedMets.reactant(j).constant;
0527     <span class="keyword">end</span>
0528     <span class="keyword">if</span> numel(involvedMets.reactant)==0
0529         modelSBML.reaction(i).reactant=<span class="string">''</span>;
0530     <span class="keyword">end</span>
0531     <span class="keyword">for</span> j=1:numel(involvedMets.product)
0532         <span class="keyword">if</span> j&lt;numel(involvedMets.product)
0533             modelSBML.reaction(i).product(j+1)=modelSBML.reaction(i).product(j);
0534         <span class="keyword">end</span>
0535         modelSBML.reaction(i).product(j).species=involvedMets.product(j).species;
0536         modelSBML.reaction(i).product(j).stoichiometry=involvedMets.product(j).stoichiometry;
0537         modelSBML.reaction(i).product(j).isSetStoichiometry=involvedMets.product(j).isSetStoichiometry;
0538         modelSBML.reaction(i).product(j).constant=involvedMets.product(j).constant;
0539     <span class="keyword">end</span>
0540     <span class="keyword">if</span> numel(involvedMets.product)==0
0541         modelSBML.reaction(i).product=<span class="string">''</span>;
0542     <span class="keyword">end</span>
0543     <span class="comment">%Export reversibility information. Reactions are irreversible by</span>
0544     <span class="comment">%default</span>
0545     <span class="keyword">if</span> model.rev(i)==1
0546         modelSBML.reaction(i).reversible=1;
0547     <span class="keyword">end</span>
0548     <span class="keyword">if</span> isfield(model, <span class="string">'rxnComps'</span>)
0549         modelSBML.reaction(i).compartment=model.comps{model.rxnComps(i)};
0550     <span class="keyword">end</span>
0551     <span class="keyword">if</span> isfield(model, <span class="string">'grRules'</span>)
0552         modelSBML.reaction(i).fbc_geneProductAssociation.fbc_association.fbc_association=model.grRules{i};
0553     <span class="keyword">end</span>
0554     modelSBML.reaction(i).fbc_lowerFluxBound=totalNames{i};
0555     modelSBML.reaction(i).fbc_upperFluxBound=totalNames{length(model.lb)+i};
0556 <span class="keyword">end</span>
0557 
0558 <span class="comment">%Prepare subSystems Code taken from COBRA functions getModelSubSystems,</span>
0559 <span class="comment">%writeSBML, findRxnsFromSubSystem under GNU General Public License v3.0,</span>
0560 <span class="comment">%license file in readme/GPL.MD. Code modified for RAVEN</span>
0561 <span class="keyword">if</span> modelHasSubsystems
0562     modelSBML.groups_group.groups_kind = <span class="string">'partonomy'</span>;
0563     modelSBML.groups_group.sboTerm = 633;
0564     tmpStruct=modelSBML.groups_group;
0565 
0566     rxns=model.rxns;
0567     <span class="keyword">if</span> ~any(cellfun(@iscell,model.subSystems))
0568         <span class="keyword">if</span> ~any(~cellfun(@isempty,model.subSystems))
0569             subSystems = {};
0570         <span class="keyword">else</span>
0571             subSystems = setdiff(model.subSystems,<span class="string">''</span>);
0572         <span class="keyword">end</span>
0573     <span class="keyword">else</span>
0574         orderedSubs = cellfun(@(x) <a href="#_sub4" class="code" title="subfunction vecT = columnVector(vec)">columnVector</a>(x),model.subSystems,<span class="string">'UniformOUtput'</span>,false);
0575         subSystems = setdiff(vertcat(orderedSubs{:}),<span class="string">''</span>);
0576     <span class="keyword">end</span>
0577     <span class="keyword">if</span> isempty(subSystems)
0578         subSystems = {};
0579     <span class="keyword">end</span>
0580     <span class="keyword">if</span> ~isempty(subSystems)
0581         <span class="comment">%Build the groups for the group package</span>
0582         groupIDs = strcat(<span class="string">'group'</span>,cellfun(@num2str, num2cell(1:length(subSystems)),<span class="string">'UniformOutput'</span>,false));
0583         <span class="keyword">for</span> i = 1:length(subSystems)
0584             cgroup = tmpStruct;
0585             <span class="keyword">if</span> ~any(cellfun(@iscell,model.subSystems))
0586                 present = ismember(model.subSystems,subSystems{i});
0587             <span class="keyword">else</span>
0588                 present = cellfun(@(x) any(ismember(x,subSystems{i})),model.subSystems);
0589             <span class="keyword">end</span>
0590             groupMembers = rxns(present);
0591             <span class="keyword">for</span> j = 1:numel(groupMembers)
0592                 cMember = tmpStruct.groups_member;
0593                 cMember.groups_idRef = groupMembers{j};
0594                 <span class="keyword">if</span> j == 1
0595                     cgroup.groups_member = cMember;
0596                 <span class="keyword">else</span>
0597                     cgroup.groups_member(j) = cMember;
0598                 <span class="keyword">end</span>
0599             <span class="keyword">end</span>
0600             cgroup.groups_id = groupIDs{i};
0601             cgroup.groups_name = subSystems{i};
0602             <span class="keyword">if</span> i == 1
0603                 modelSBML.groups_group = cgroup;
0604             <span class="keyword">else</span>
0605                 modelSBML.groups_group(i) = cgroup;
0606             <span class="keyword">end</span>
0607         <span class="keyword">end</span>
0608     <span class="keyword">end</span>
0609 <span class="keyword">end</span>
0610 
0611 <span class="comment">%Prepare fbc_objective subfield</span>
0612 
0613 modelSBML.fbc_objective.fbc_type=<span class="string">'maximize'</span>;
0614 modelSBML.fbc_objective.fbc_id=<span class="string">'obj'</span>;
0615 
0616 ind=find(model.c);
0617 
0618 <span class="keyword">if</span> isempty(ind)
0619     modelSBML.fbc_objective.fbc_fluxObjective.fbc_coefficient=0;
0620 <span class="keyword">else</span>
0621     <span class="keyword">for</span> i=1:length(ind)
0622         <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0623         <span class="comment">%last one</span>
0624         <span class="keyword">if</span> i&lt;numel(ind)
0625             modelSBML.reaction(i+1)=modelSBML.reaction(i);
0626         <span class="keyword">end</span>
0627         values=model.c(model.c~=0);
0628         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_reaction=modelSBML.reaction(ind(i)).id;
0629         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_coefficient=values(i);
0630         modelSBML.fbc_objective(i).fbc_fluxObjective.isSetfbc_coefficient=1;
0631     <span class="keyword">end</span>
0632 <span class="keyword">end</span>
0633 
0634 modelSBML.fbc_activeObjective=modelSBML.fbc_objective.fbc_id;
0635 
0636 fbcStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/fbc/version'</span>,num2str(sbmlPackageVersions(1))];
0637 <span class="keyword">if</span> modelHasSubsystems
0638     groupStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/groups/version'</span>,num2str(sbmlPackageVersions(2))];
0639     modelSBML.namespaces=struct(<span class="string">'prefix'</span>,{<span class="string">''</span>,<span class="string">'fbc'</span>,<span class="string">'groups'</span>},<span class="keyword">...</span>
0640     <span class="string">'uri'</span>,{[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/core'</span>],<span class="keyword">...</span>
0641     fbcStr,groupStr});
0642 <span class="keyword">else</span>
0643     modelSBML.namespaces=struct(<span class="string">'prefix'</span>,{<span class="string">''</span>,<span class="string">'fbc'</span>},<span class="keyword">...</span>
0644     <span class="string">'uri'</span>,{[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/core'</span>],<span class="keyword">...</span>
0645     fbcStr});
0646 <span class="keyword">end</span>
0647 
0648 <span class="keyword">if</span> sbmlPackageVersions(1) == 2
0649     modelSBML.fbc_strict=1;
0650     modelSBML.isSetfbc_strict = 1;
0651 <span class="keyword">end</span>
0652 
0653 modelSBML.rule=[];
0654 modelSBML.constraint=[];
0655 
0656 [ravenDir,prevDir]=findRAVENroot();
0657 fileName=<a href="checkFileExistence.html" class="code" title="function files=checkFileExistence(files,fullOrTemp,allowSpace,checkExist)">checkFileExistence</a>(fileName,1,true,false);
0658 
0659 OutputSBML_RAVEN(modelSBML,fileName,1,0,[1,0]);
0660 <span class="keyword">end</span>
0661 
0662 
0663 <a name="_sub1" href="#_subfunctions" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)</a>
0664 <span class="comment">%Returns the blank SBML model structure by using appropriate libSBML</span>
0665 <span class="comment">%functions. This creates structure by considering three levels</span>
0666 
0667 sbmlFieldNames=getStructureFieldnames(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0668 sbmlDefaultValues=getDefaultValues(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0669 
0670 <span class="keyword">for</span> i=1:numel(sbmlFieldNames)
0671     modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0672     sbmlSubfieldNames=getStructureFieldnames(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0673     sbmlSubfieldValues=getDefaultValues(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0674     <span class="keyword">if</span> ~strcmp(sbmlFieldNames{1,i},<span class="string">'event'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'functionDefinition'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'initialAssignment'</span>)
0675         <span class="keyword">for</span> j=1:numel(sbmlSubfieldNames)
0676             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j})=sbmlSubfieldValues{1,j};
0677             sbmlSubsubfieldNames=getStructureFieldnames(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0678             sbmlSubsubfieldValues=getDefaultValues(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0679             <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'modifier'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'kineticLaw'</span>)
0680                 <span class="keyword">for</span> k=1:numel(sbmlSubsubfieldNames)
0681                     <span class="comment">%'compartment' and 'species' fields are not supposed to</span>
0682                     <span class="comment">%have their standalone structures if they are subfields</span>
0683                     <span class="comment">%or subsubfields</span>
0684                     <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'compartment'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'species'</span>)
0685                         modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k})=sbmlSubsubfieldValues{1,k};
0686                     <span class="keyword">end</span>
0687                     <span class="comment">%If it is fbc_association in the third level, we need</span>
0688                     <span class="comment">%to establish the fourth level, since libSBML requires</span>
0689                     <span class="comment">%it</span>
0690                     <span class="keyword">if</span> strcmp(sbmlSubsubfieldNames{1,k},<span class="string">'fbc_association'</span>)
0691                         fbc_associationFieldNames=getStructureFieldnames(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0692                         fbc_associationFieldValues=getDefaultValues(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0693                         <span class="keyword">for</span> l=1:numel(fbc_associationFieldNames)
0694                             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k}).(fbc_associationFieldNames{1,l})=fbc_associationFieldValues{1,l};
0695                         <span class="keyword">end</span>
0696                     <span class="keyword">end</span>
0697                 <span class="keyword">end</span>
0698             <span class="keyword">end</span>
0699         <span class="keyword">end</span>
0700     <span class="keyword">end</span>
0701     <span class="keyword">if</span> ~isstruct(modelSBML.(sbmlFieldNames{1,i}))
0702         modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0703     <span class="keyword">end</span>
0704 <span class="keyword">end</span>
0705 
0706 modelSBML.unitDefinition.id=<span class="string">'mmol_per_gDW_per_hr'</span>;
0707 
0708 unitFieldNames=getStructureFieldnames(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0709 unitDefaultValues=getDefaultValues(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0710 
0711 kinds={<span class="string">'mole'</span>,<span class="string">'gram'</span>,<span class="string">'second'</span>};
0712 exponents=[1 -1 -1];
0713 scales=[-3 0 0];
0714 multipliers=[1 1 1*60*60];
0715 
0716 <span class="keyword">for</span> i=1:numel(unitFieldNames)
0717     modelSBML.unitDefinition.unit(1).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0718     <span class="keyword">for</span> j=1:3
0719         modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0720         <span class="keyword">if</span> strcmp(unitFieldNames{1,i},<span class="string">'kind'</span>)
0721             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=kinds{j};
0722         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'exponent'</span>)
0723             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=exponents(j);
0724         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'scale'</span>)
0725             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=scales(j);
0726         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'multiplier'</span>)
0727             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=multipliers(j);
0728         <span class="keyword">end</span>
0729     <span class="keyword">end</span>
0730 <span class="keyword">end</span>
0731 <span class="keyword">end</span>
0732 
0733 <a name="_sub2" href="#_subfunctions" class="code">function miriamString=getMiriam(miriamStruct)</a>
0734 <span class="comment">%Returns a string with list elements for a miriam structure ('&lt;rdf:li</span>
0735 <span class="comment">%rdf:resource=&quot;https://identifiers.org/go/GO:0005739&quot;/&gt;' for example). This</span>
0736 <span class="comment">%is just to speed up things since this is done many times during the</span>
0737 <span class="comment">%exporting</span>
0738 
0739 miriamString=<span class="string">''</span>;
0740 <span class="keyword">if</span> isfield(miriamStruct,<span class="string">'name'</span>)
0741     <span class="keyword">for</span> i=1:numel(miriamStruct.name)
0742         miriamString=[miriamString <span class="string">'&lt;rdf:li rdf:resource=&quot;https://identifiers.org/'</span> miriamStruct.name{i} <span class="string">'/'</span> miriamStruct.value{i} <span class="string">'&quot;/&gt;'</span>];
0743     <span class="keyword">end</span>
0744 <span class="keyword">end</span>
0745 <span class="keyword">end</span>
0746 
0747 <a name="_sub3" href="#_subfunctions" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a>
0748 <span class="comment">%This function provides reactants and products for particular reaction. The</span>
0749 <span class="comment">%function was 'borrowed' from writeSBML in COBRA toolbox, lines 663-679</span>
0750 
0751 met_idx = find(model.S(:, i));
0752 tmp_Rxn.product=[];
0753 tmp_Rxn.reactant=[];
0754 <span class="keyword">for</span> j_met=1:size(met_idx,1)
0755     tmp_idx = met_idx(j_met,1);
0756     sbml_tmp_species_ref.species = sbmlModel.species(tmp_idx).id;
0757     met_stoich = model.S(tmp_idx, i);
0758     sbml_tmp_species_ref.stoichiometry = abs(met_stoich);
0759     sbml_tmp_species_ref.isSetStoichiometry=1;
0760     sbml_tmp_species_ref.constant=1;
0761     <span class="keyword">if</span> (met_stoich &gt; 0)
0762         tmp_Rxn.product = [ tmp_Rxn.product, sbml_tmp_species_ref ];
0763     <span class="keyword">else</span>
0764         tmp_Rxn.reactant = [ tmp_Rxn.reactant, sbml_tmp_species_ref];
0765     <span class="keyword">end</span>
0766 <span class="keyword">end</span>
0767 <span class="keyword">end</span>
0768 
0769 <a name="_sub4" href="#_subfunctions" class="code">function vecT = columnVector(vec)</a>
0770 <span class="comment">% Code below taken from COBRA Toolbox under GNU General Public License v3.0</span>
0771 <span class="comment">% license file in readme/GPL.MD.</span>
0772 <span class="comment">%</span>
0773 <span class="comment">% Converts a vector to a column vector</span>
0774 <span class="comment">%</span>
0775 <span class="comment">% USAGE:</span>
0776 <span class="comment">%</span>
0777 <span class="comment">%   vecT = columnVector(vec)</span>
0778 <span class="comment">%</span>
0779 <span class="comment">% INPUT:</span>
0780 <span class="comment">%   vec:     a vector</span>
0781 <span class="comment">%</span>
0782 <span class="comment">% OUTPUT:</span>
0783 <span class="comment">%   vecT:    a column vector</span>
0784 
0785 [n, m] = size(vec);
0786 
0787 <span class="keyword">if</span> n &lt; m
0788     vecT = vec';
0789 <span class="keyword">else</span>
0790     vecT = vec;
0791 <span class="keyword">end</span>
0792 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of exportModel</title>
  <meta name="keywords" content="exportModel">
  <meta name="description" content="exportModel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">io</a> &gt; exportModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for io&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>exportModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>exportModel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> exportModel
   Exports a constraint-based model to an SBML file (L3V1 FBCv2)

 Input:
   model               a model structure
   fileName            filename to export the model to. A dialog window
                       will open if no file name is specified.
   COBRAstyle          true if COBRA-style prefixes should be added to all
                       identifiers: R_ for reactions, M_ for metabolites,
                       G_ for genes and C_ for compartments. If all
                       identifiers of a particular field already have the
                       prefix, then no additional prefixes are added.
                       (optional, default false)
   supressWarnings     true if warnings should be supressed. This might
                       results in invalid SBML files, as no checks are
                       performed (optional, default false)
   sortIds             logical whether metabolites, reactions and genes
                       should be sorted alphabetically by their
                       identifiers (optional, default false)

 Usage: exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="checkFileExistence.html" class="code" title="function files=checkFileExistence(files,fullOrTemp,allowSpace,checkExist)">checkFileExistence</a>	checkFileExistence</li><li><a href="exportModel.html" class="code" title="function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)">exportModel</a>	exportModel</li><li><a href="sortIdentifiers.html" class="code" title="function newModel = sortIdentifiers(model)">sortIdentifiers</a>	exportModel</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="SBMLFromExcel.html" class="code" title="function SBMLFromExcel(fileName, outputFileName,toCOBRA,printWarnings)">SBMLFromExcel</a>	SBMLFromExcel</li><li><a href="exportForGit.html" class="code" title="function out=exportForGit(model,prefix,path,formats,mainBranchFlag,subDirs,cobraText)">exportForGit</a>	exportForGit</li><li><a href="exportModel.html" class="code" title="function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)">exportModel</a>	exportModel</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)</a></li><li><a href="#_sub2" class="code">function miriamString=getMiriam(miriamStruct)</a></li><li><a href="#_sub3" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a></li><li><a href="#_sub4" class="code">function vecT = columnVector(vec)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)</a>
0002 <span class="comment">% exportModel</span>
0003 <span class="comment">%   Exports a constraint-based model to an SBML file (L3V1 FBCv2)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%   model               a model structure</span>
0007 <span class="comment">%   fileName            filename to export the model to. A dialog window</span>
0008 <span class="comment">%                       will open if no file name is specified.</span>
0009 <span class="comment">%   COBRAstyle          true if COBRA-style prefixes should be added to all</span>
0010 <span class="comment">%                       identifiers: R_ for reactions, M_ for metabolites,</span>
0011 <span class="comment">%                       G_ for genes and C_ for compartments. If all</span>
0012 <span class="comment">%                       identifiers of a particular field already have the</span>
0013 <span class="comment">%                       prefix, then no additional prefixes are added.</span>
0014 <span class="comment">%                       (optional, default false)</span>
0015 <span class="comment">%   supressWarnings     true if warnings should be supressed. This might</span>
0016 <span class="comment">%                       results in invalid SBML files, as no checks are</span>
0017 <span class="comment">%                       performed (optional, default false)</span>
0018 <span class="comment">%   sortIds             logical whether metabolites, reactions and genes</span>
0019 <span class="comment">%                       should be sorted alphabetically by their</span>
0020 <span class="comment">%                       identifiers (optional, default false)</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% Usage: exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)</span>
0023 
0024 <span class="keyword">if</span> nargin&lt;2 || isempty(fileName)
0025     [fileName, pathName] = uiputfile({<span class="string">'*.xml;*.sbml'</span>}, <span class="string">'Select file for model export'</span>,[model.id <span class="string">'.xml'</span>]);
0026     <span class="keyword">if</span> fileName == 0
0027         error(<span class="string">'You should provide a file location'</span>)
0028     <span class="keyword">else</span>
0029         fileName = fullfile(pathName,fileName);
0030     <span class="keyword">end</span>
0031 <span class="keyword">end</span>
0032 fileName=char(fileName);
0033 <span class="keyword">if</span> nargin&lt;3
0034     COBRAstyle=false;
0035 <span class="keyword">elseif</span> ~islogical(COBRAstyle)
0036     error(&quot;COBRAstyle should be either true or false&quot;)
0037 <span class="keyword">end</span>
0038 <span class="keyword">if</span> nargin&lt;4
0039     supressWarnings=false;
0040 <span class="keyword">end</span>
0041 <span class="keyword">if</span> nargin&lt;5
0042     sortIds=false;
0043 <span class="keyword">end</span>
0044 <span class="keyword">if</span> sortIds==true
0045     model=<a href="sortIdentifiers.html" class="code" title="function newModel = sortIdentifiers(model)">sortIdentifiers</a>(model);
0046 <span class="keyword">end</span>
0047 
0048 <span class="keyword">if</span> isfield(model,<span class="string">'ec'</span>)
0049     warning(&quot;<a href="exportModel.html" class="code" title="function exportModel(model,fileName,COBRAstyle,supressWarnings,sortIds)">exportModel</a> does not store information from the <span class="string">'model.ec'</span> structure. Use <span class="string">'writeYAMLmodel(model)'</span> to export all content from a GECKO model.&quot;)
0050 <span class="keyword">end</span>
0051 
0052 <span class="comment">%If no subSystems are defined, then no need to use groups package</span>
0053 <span class="keyword">if</span> isfield(model,<span class="string">'subSystems'</span>)
0054     modelHasSubsystems=true;
0055 <span class="keyword">else</span>
0056     modelHasSubsystems=false;
0057 <span class="keyword">end</span>
0058 
0059 <span class="comment">%The default SBML format settings, which are used as input for appropriate</span>
0060 <span class="comment">%libSBML functions to generate the blank SBML model structure before using</span>
0061 <span class="comment">%exporting in with OutputSBML to xml file</span>
0062 sbmlLevel=3;
0063 sbmlVersion=1;
0064 sbmlPackages={<span class="string">'fbc'</span>};
0065 sbmlPackageVersions=2;
0066 <span class="keyword">if</span> modelHasSubsystems
0067     sbmlPackages={sbmlPackages,<span class="string">'groups'</span>};
0068     sbmlPackageVersions=[sbmlPackageVersions,1];
0069 <span class="keyword">end</span>
0070 
0071 <span class="comment">%Check if the &quot;unconstrained&quot; field is still present. This shows if</span>
0072 <span class="comment">%exchange metabolites have been removed</span>
0073 <span class="keyword">if</span> ~isfield(model,<span class="string">'unconstrained'</span>)
0074     model.unconstrained=zeros(numel(model.mets),1);
0075 <span class="keyword">end</span>
0076 
0077 <span class="comment">%If model id and name do not exist, make sure that default</span>
0078 <span class="comment">%strings are included</span>
0079 <span class="keyword">if</span> ~isfield(model,<span class="string">'id'</span>)
0080     fprintf(<span class="string">'WARNING: The model is missing the &quot;id&quot; field. Uses &quot;blankID&quot;. \n'</span>);
0081     model.id=<span class="string">'blankID'</span>;
0082 <span class="keyword">end</span>
0083 <span class="keyword">if</span> ~isfield(model,<span class="string">'name'</span>)
0084     fprintf(<span class="string">'WARNING: The model is missing the &quot;name&quot; field. Uses &quot;blankName&quot;. \n'</span>);
0085     model.name=<span class="string">'blankName'</span>;
0086 <span class="keyword">end</span>
0087 
0088 <span class="comment">% Add prefixes if desired</span>
0089 <span class="keyword">if</span> COBRAstyle
0090     <span class="keyword">if</span> isfield(model,<span class="string">'ec'</span>)
0091         error(<span class="string">'ecModels cannot be exported with COBRAstyle flag, manually correct any non-compliant identifiers if needed.'</span>)
0092     <span class="keyword">end</span>
0093     <span class="keyword">if</span> ~all(startsWith(model.rxns,<span class="string">'R_'</span>))
0094         model.rxns  = strcat(<span class="string">'R_'</span>,model.rxns);
0095     <span class="keyword">end</span>
0096     <span class="keyword">if</span> ~all(startsWith(model.mets,<span class="string">'M_'</span>))
0097         model.mets  = strcat(<span class="string">'M_'</span>,model.mets);
0098     <span class="keyword">end</span>
0099     <span class="keyword">if</span> ~all(startsWith(model.comps,<span class="string">'C_'</span>))
0100         model.comps  = strcat(<span class="string">'C_'</span>,model.comps);
0101     <span class="keyword">end</span>
0102     <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>) &amp;&amp; ~all(startsWith(model.genes,<span class="string">'G_'</span>))
0103         model.genes = strcat(<span class="string">'G_'</span>,model.genes);
0104         model.grRules = regexprep(model.grRules, <span class="string">'(\&lt;[0-9_a-zA-Z])'</span>, <span class="string">'G_$1'</span>);
0105         model.grRules = regexprep(model.grRules, <span class="string">' G_or '</span>, <span class="string">' or '</span>);
0106         model.grRules = regexprep(model.grRules, <span class="string">' G_and '</span>, <span class="string">' and '</span>);
0107     <span class="keyword">end</span>
0108 <span class="keyword">end</span>
0109 
0110 <span class="comment">%Check the model structure</span>
0111 <span class="keyword">if</span> supressWarnings==false
0112     checkModelStruct(model);
0113 <span class="keyword">end</span>
0114 
0115 <span class="comment">%Add several blank fields, if they do not exist already. This is to reduce</span>
0116 <span class="comment">%the number of conditions below</span>
0117 <span class="keyword">if</span> ~isfield(model,<span class="string">'compMiriams'</span>)
0118     model.compMiriams=cell(numel(model.comps),1);
0119 <span class="keyword">end</span>
0120 <span class="keyword">if</span> ~isfield(model,<span class="string">'inchis'</span>)
0121     model.inchis=cell(numel(model.mets),1);
0122 <span class="keyword">end</span>
0123 <span class="keyword">if</span> ~isfield(model,<span class="string">'metFormulas'</span>)
0124     model.metFormulas=cell(numel(model.mets),1);
0125 <span class="keyword">end</span>
0126 <span class="keyword">if</span> ~isfield(model,<span class="string">'metMiriams'</span>)
0127     model.metMiriams=cell(numel(model.mets),1);
0128 <span class="keyword">end</span>
0129 <span class="keyword">if</span> ~isfield(model,<span class="string">'geneMiriams'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0130     model.geneMiriams=cell(numel(model.genes),1);
0131 <span class="keyword">end</span>
0132 <span class="keyword">if</span> ~isfield(model,<span class="string">'geneShortNames'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0133     model.geneShortNames=cell(numel(model.genes),1);
0134 <span class="keyword">end</span>
0135 <span class="keyword">if</span> ~isfield(model,<span class="string">'subSystems'</span>)
0136     model.subSystems=cell(numel(model.rxns),1);
0137 <span class="keyword">end</span>
0138 <span class="keyword">if</span> ~isfield(model,<span class="string">'eccodes'</span>)
0139     model.eccodes=cell(numel(model.rxns),1);
0140 <span class="keyword">end</span>
0141 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnReferences'</span>)
0142     model.rxnReferences=cell(numel(model.rxns),1);
0143 <span class="keyword">end</span>
0144 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnConfidenceScores'</span>)
0145     model.rxnConfidenceScores=NaN(numel(model.rxns),1);
0146 <span class="keyword">end</span>
0147 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnNotes'</span>)
0148     model.rxnNotes=cell(numel(model.rxns),1);
0149 <span class="keyword">end</span>
0150 <span class="keyword">if</span> ~isfield(model,<span class="string">'rxnMiriams'</span>)
0151     model.rxnMiriams=cell(numel(model.rxns),1);
0152 <span class="keyword">end</span>
0153 
0154 <span class="keyword">if</span> sbmlLevel&lt;3
0155     <span class="comment">%Check if genes have associated compartments</span>
0156     <span class="keyword">if</span> ~isfield(model,<span class="string">'geneComps'</span>) &amp;&amp; isfield(model,<span class="string">'genes'</span>)
0157         <span class="keyword">if</span> supressWarnings==false
0158             EM=<span class="string">'There are no compartments specified for genes. All genes will be assigned to the first compartment. This is because the SBML structure requires all elements to be assigned to a compartment'</span>;
0159             dispEM(EM,false);
0160         <span class="keyword">end</span>
0161         model.geneComps=ones(numel(model.genes),1);
0162     <span class="keyword">end</span>
0163 <span class="keyword">end</span>
0164 
0165 <span class="comment">%Convert ids to SBML-convenient format. This is to avoid the data loss when</span>
0166 <span class="comment">%unsupported characters are included in ids. Here we are using part from</span>
0167 <span class="comment">%convertSBMLID, originating from the COBRA Toolbox</span>
0168 model.rxns=regexprep(model.rxns,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0169 model.mets=regexprep(model.mets,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0170 model.comps=regexprep(model.comps,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0171 <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>)
0172     problemGenes=find(~cellfun(<span class="string">'isempty'</span>,regexp(model.genes,<span class="string">'([^0-9_a-zA-Z])'</span>)));
0173     originalGenes=model.genes(problemGenes);
0174     replacedGenes=regexprep(model.genes(problemGenes),<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0175     model.genes(problemGenes)=replacedGenes;
0176     <span class="keyword">for</span> i=1:numel(problemGenes)
0177         model.grRules = regexprep(model.grRules, [<span class="string">'(^|\s|\()'</span> originalGenes{i} <span class="string">'($|\s|\))'</span>], [<span class="string">'$1'</span> replacedGenes{i} <span class="string">'$2'</span>]);
0178     <span class="keyword">end</span>
0179 <span class="keyword">end</span>
0180 
0181 <span class="comment">%Generate an empty SBML structure</span>
0182 modelSBML=<a href="#_sub1" class="code" title="subfunction modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)">getSBMLStructure</a>(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0183 modelSBML.metaid=model.id;
0184 modelSBML.id=regexprep(model.id,<span class="string">'([^0-9_a-zA-Z])'</span>,<span class="string">'__${num2str($1+0)}__'</span>);
0185 modelSBML.name=model.name;
0186 
0187 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0188     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'note'</span>)
0189         modelSBML.notes=[<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;'</span>,regexprep(model.annotation.note,<span class="string">'&lt;p&gt;|&lt;/p&gt;'</span>,<span class="string">''</span>),<span class="string">'&lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>];
0190     <span class="keyword">end</span>
0191 <span class="keyword">else</span>
0192     modelSBML.notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;p&gt;This file was generated using the exportModel function in RAVEN Toolbox 2 and OutputSBML in libSBML &lt;/p&gt;&lt;/body&gt;&lt;/notes&gt;'</span>;
0193 <span class="keyword">end</span>
0194 
0195 <span class="keyword">if</span> isfield(model,<span class="string">'annotation'</span>)
0196     nameString=<span class="string">''</span>;
0197     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'familyName'</span>)
0198         <span class="keyword">if</span> ~isempty(model.annotation.familyName)
0199             nameString=[<span class="string">'&lt;vCard:Family&gt;'</span> model.annotation.familyName <span class="string">'&lt;/vCard:Family&gt;'</span>];
0200         <span class="keyword">end</span>
0201     <span class="keyword">end</span>
0202     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'givenName'</span>)
0203         <span class="keyword">if</span> ~isempty(model.annotation.givenName)
0204             nameString=[nameString <span class="string">'&lt;vCard:Given&gt;'</span> model.annotation.givenName <span class="string">'&lt;/vCard:Given&gt;'</span>];
0205         <span class="keyword">end</span>
0206     <span class="keyword">end</span>
0207     email=<span class="string">''</span>;
0208     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'email'</span>)
0209         <span class="keyword">if</span> ~isempty(model.annotation.email)
0210             email=[<span class="string">'&lt;vCard:EMAIL&gt;'</span> model.annotation.email <span class="string">'&lt;/vCard:EMAIL&gt;'</span>];
0211         <span class="keyword">end</span>
0212     <span class="keyword">end</span>
0213     org=<span class="string">''</span>;
0214     <span class="keyword">if</span> isfield(model.annotation,<span class="string">'organization'</span>)
0215         <span class="keyword">if</span> ~isempty(model.annotation.organization)
0216             org=[<span class="string">'&lt;vCard:ORG rdf:parseType=&quot;Resource&quot;&gt;&lt;vCard:Orgname&gt;'</span> model.annotation.organization <span class="string">'&lt;/vCard:Orgname&gt;&lt;/vCard:ORG&gt;'</span>];
0217         <span class="keyword">end</span>
0218     <span class="keyword">end</span>
0219     <span class="keyword">if</span> ~isempty(nameString) || ~isempty(email) || ~isempty(org) <span class="comment">% Only fill .annotation if ownership data is provided</span>
0220         modelSBML.annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.id <span class="string">'&quot;&gt;'</span>];
0221         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dc:creator&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;'</span>];
0222         <span class="keyword">if</span> ~isempty(nameString)
0223             modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;vCard:N rdf:parseType=&quot;Resource&quot;&gt;'</span> nameString <span class="string">'&lt;/vCard:N&gt;'</span>];
0224         <span class="keyword">end</span>
0225         modelSBML.annotation=[modelSBML.annotation email org <span class="string">'&lt;/rdf:li&gt;&lt;/rdf:Bag&gt;&lt;/dc:creator&gt;'</span>];
0226         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;dcterms:created rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0227             <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;&lt;/dcterms:created&gt;&lt;dcterms:modified rdf:parseType=&quot;Resource&quot;&gt;'</span><span class="keyword">...</span>
0228             <span class="string">'&lt;dcterms:W3CDTF&gt;'</span> datestr(now,<span class="string">'yyyy-mm-ddTHH:MM:SSZ'</span>) <span class="string">'&lt;/dcterms:W3CDTF&gt;&lt;/dcterms:modified&gt;'</span>];
0229         <span class="keyword">if</span> isfield(model.annotation,<span class="string">'taxonomy'</span>)
0230             modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;&lt;rdf:li rdf:resource=&quot;https://identifiers.org/taxonomy/'</span> regexprep(model.annotation.taxonomy,<span class="string">'taxonomy/'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;'</span>];
0231         <span class="keyword">end</span>
0232         modelSBML.annotation=[modelSBML.annotation <span class="string">'&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0233     <span class="keyword">end</span>
0234 <span class="keyword">end</span>
0235 
0236 <span class="comment">%Prepare compartments</span>
0237 <span class="keyword">for</span> i=1:numel(model.comps)
0238     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0239     <span class="keyword">if</span> i==1
0240         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'sboTerm'</span>)
0241             modelSBML.compartment(i).sboTerm=290;
0242         <span class="keyword">end</span>
0243         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'spatialDimensions'</span>)
0244             modelSBML.compartment(i).spatialDimensions=3;
0245         <span class="keyword">end</span>
0246         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'size'</span>)
0247             modelSBML.compartment(i).size=1;
0248         <span class="keyword">end</span>
0249         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'constant'</span>)
0250             modelSBML.compartment(i).constant=1;
0251         <span class="keyword">end</span>
0252         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSize'</span>)
0253             modelSBML.compartment(i).isSetSize=1;
0254         <span class="keyword">end</span>
0255         <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'isSetSpatialDimensions'</span>)
0256             modelSBML.compartment(i).isSetSpatialDimensions=1;
0257         <span class="keyword">end</span>
0258     <span class="keyword">end</span>
0259     <span class="comment">%Copy the default values to the next entry as long as it is not the</span>
0260     <span class="comment">%last one</span>
0261     <span class="keyword">if</span> i&lt;numel(model.comps)
0262         modelSBML.compartment(i+1)=modelSBML.compartment(i);
0263     <span class="keyword">end</span>
0264     
0265     <span class="keyword">if</span> isfield(modelSBML.compartment,<span class="string">'metaid'</span>)
0266         modelSBML.compartment(i).metaid=model.comps{i};
0267     <span class="keyword">end</span>
0268     <span class="comment">%Prepare Miriam strings</span>
0269     <span class="keyword">if</span> ~isempty(model.compMiriams{i})
0270         [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.compMiriams{i}.name);
0271         <span class="keyword">if</span> sbo_ind &gt; 0
0272             modelSBML.compartment(i).sboTerm=str2double(regexprep(model.compMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0273             <span class="comment">% remove the SBO term from compMiriams so the information is</span>
0274             <span class="comment">% not duplicated in the &quot;annotation&quot; field later on</span>
0275             model.compMiriams{i}.name(sbo_ind) = [];
0276             model.compMiriams{i}.value(sbo_ind) = [];
0277         <span class="keyword">end</span>
0278     <span class="keyword">end</span>
0279     <span class="keyword">if</span> ~isempty(model.compMiriams{i}) &amp;&amp; isfield(modelSBML.compartment(i),<span class="string">'annotation'</span>)
0280         modelSBML.compartment(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.comps{i} <span class="string">'&quot;&gt;'</span>];
0281         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0282         modelSBML.compartment(i).annotation=[modelSBML.compartment(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.compMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0283     <span class="keyword">end</span>
0284     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'name'</span>)
0285         modelSBML.compartment(i).name=model.compNames{i};
0286     <span class="keyword">end</span>
0287     <span class="keyword">if</span> isfield(modelSBML.compartment, <span class="string">'id'</span>)
0288         modelSBML.compartment(i).id=model.comps{i};
0289     <span class="keyword">end</span>
0290     
0291 <span class="keyword">end</span>
0292 
0293 <span class="comment">%Begin writing species</span>
0294 <span class="keyword">for</span> i=1:numel(model.mets)
0295     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0296     <span class="keyword">if</span> i==1
0297         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'sboTerm'</span>)
0298             modelSBML.species(i).sboTerm=247;
0299         <span class="keyword">end</span>
0300         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialAmount'</span>)
0301             modelSBML.species(i).initialAmount=1;
0302         <span class="keyword">end</span>
0303         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'initialConcentration'</span>)
0304             modelSBML.species(i).initialConcentration=0;
0305         <span class="keyword">end</span>
0306         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialAmount'</span>)
0307             modelSBML.species(i).isSetInitialAmount=1;
0308         <span class="keyword">end</span>
0309         <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'isSetInitialConcentration'</span>)
0310             modelSBML.species(i).isSetInitialConcentration=1;
0311         <span class="keyword">end</span>
0312     <span class="keyword">end</span>
0313     <span class="comment">%Copy the default values to the next entry as long as it is not the</span>
0314     <span class="comment">%last one</span>
0315     <span class="keyword">if</span> i&lt;numel(model.mets)
0316         modelSBML.species(i+1)=modelSBML.species(i);
0317     <span class="keyword">end</span>
0318     
0319     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'metaid'</span>)
0320         modelSBML.species(i).metaid=model.mets{i};
0321     <span class="keyword">end</span>
0322     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'name'</span>)
0323         modelSBML.species(i).name=model.metNames{i};
0324     <span class="keyword">end</span>
0325     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'id'</span>)
0326         modelSBML.species(i).id=model.mets{i};
0327     <span class="keyword">end</span>
0328     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'compartment'</span>)
0329         modelSBML.species(i).compartment=model.comps{model.metComps(i)};
0330     <span class="keyword">end</span>
0331     <span class="keyword">if</span> isfield(model,<span class="string">'unconstrained'</span>)
0332         <span class="keyword">if</span> model.unconstrained(i)
0333             modelSBML.species(i).boundaryCondition=1;
0334         <span class="keyword">end</span>
0335     <span class="keyword">end</span>
0336     <span class="keyword">if</span> isfield(modelSBML.species, <span class="string">'fbc_charge'</span>) &amp;&amp; isfield(model,<span class="string">'metCharges'</span>)
0337         <span class="keyword">if</span> ~isnan(model.metCharges(i))
0338             modelSBML.species(i).fbc_charge=model.metCharges(i);
0339             modelSBML.species(i).isSetfbc_charge=1;
0340         <span class="keyword">else</span>
0341             modelSBML.species(i).isSetfbc_charge=0;
0342         <span class="keyword">end</span>
0343     <span class="keyword">end</span>
0344     <span class="keyword">if</span> ~isempty(model.metMiriams{i})
0345         [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.metMiriams{i}.name);
0346         <span class="keyword">if</span> sbo_ind &gt; 0
0347             modelSBML.species(i).sboTerm=str2double(regexprep(model.metMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0348             <span class="comment">% remove the SBO term from metMiriams so the information is</span>
0349             <span class="comment">% not duplicated in the &quot;annotation&quot; field later on</span>
0350             model.metMiriams{i}.name(sbo_ind) = [];
0351             model.metMiriams{i}.value(sbo_ind) = [];
0352         <span class="keyword">end</span>
0353     <span class="keyword">end</span>
0354     <span class="keyword">if</span> isfield(modelSBML.species,<span class="string">'annotation'</span>)
0355         <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || ~isempty(model.metFormulas{i})
0356             hasInchi=false;
0357             <span class="keyword">if</span> ~isempty(model.metFormulas{i})
0358                 <span class="comment">%Only export formula if there is no InChI. This is because</span>
0359                 <span class="comment">%the metFormulas field is populated by InChIs if available</span>
0360                 <span class="keyword">if</span> ~isempty(model.inchis{i})
0361                     hasInchi=true;
0362                 <span class="keyword">end</span>
0363                 <span class="keyword">if</span> hasInchi==false
0364                     modelSBML.species(i).fbc_chemicalFormula=model.metFormulas{i};
0365                 <span class="keyword">end</span>
0366             <span class="keyword">end</span>
0367             <span class="keyword">if</span> ~isempty(model.metMiriams{i}) || hasInchi==true
0368                 modelSBML.species(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.mets{i} <span class="string">'&quot;&gt;'</span>];
0369                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0370                 <span class="keyword">if</span> ~isempty(model.metMiriams{i})
0371                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.metMiriams{i})];
0372                 <span class="keyword">end</span>
0373                 <span class="keyword">if</span> hasInchi==true
0374                     modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;rdf:li rdf:resource=&quot;https://identifiers.org/inchi/InChI='</span> regexprep(model.inchis{i},<span class="string">'^InChI='</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;'</span>];
0375                     modelSBML.species(i).fbc_chemicalFormula=char(regexp(model.inchis{i}, <span class="string">'/(\w+)/'</span>, <span class="string">'tokens'</span>, <span class="string">'once'</span>));
0376                 <span class="keyword">end</span>
0377                 modelSBML.species(i).annotation=[modelSBML.species(i).annotation <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0378             <span class="keyword">end</span>
0379         <span class="keyword">end</span>
0380     <span class="keyword">end</span>
0381 <span class="keyword">end</span>
0382 
0383 <span class="keyword">if</span> isfield(model,<span class="string">'genes'</span>)
0384     <span class="keyword">for</span> i=1:numel(model.genes)
0385         <span class="comment">%Add the default values, as these will be the same in all entries</span>
0386         <span class="keyword">if</span> i==1
0387             <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'sboTerm'</span>)
0388                 modelSBML.fbc_geneProduct(i).sboTerm=243;
0389             <span class="keyword">end</span>
0390         <span class="keyword">end</span>
0391         <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0392         <span class="comment">%last one</span>
0393         <span class="keyword">if</span> i&lt;numel(model.genes)
0394             modelSBML.fbc_geneProduct(i+1)=modelSBML.fbc_geneProduct(i);
0395         <span class="keyword">end</span>
0396         
0397         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct,<span class="string">'metaid'</span>)
0398             modelSBML.fbc_geneProduct(i).metaid=model.genes{i};
0399         <span class="keyword">end</span>
0400         <span class="keyword">if</span> ~isempty(model.geneMiriams{i})
0401             [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.geneMiriams{i}.name);
0402             <span class="keyword">if</span> sbo_ind &gt; 0
0403                 modelSBML.fbc_geneProduct(i).sboTerm=str2double(regexprep(model.geneMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0404                 <span class="comment">% remove the SBO term from compMiriams so the information is</span>
0405                 <span class="comment">% not duplicated in the &quot;annotation&quot; field later on</span>
0406                 model.geneMiriams{i}.name(sbo_ind) = [];
0407                 model.geneMiriams{i}.value(sbo_ind) = [];
0408             <span class="keyword">end</span>
0409         <span class="keyword">end</span>
0410         <span class="keyword">if</span> ~isempty(model.geneMiriams{i}) &amp;&amp; isfield(modelSBML.fbc_geneProduct(i),<span class="string">'annotation'</span>)
0411             modelSBML.fbc_geneProduct(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.genes{i} <span class="string">'&quot;&gt;'</span>];
0412             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0413             modelSBML.fbc_geneProduct(i).annotation=[modelSBML.fbc_geneProduct(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.geneMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0414         <span class="keyword">end</span>
0415         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_id'</span>)
0416             modelSBML.fbc_geneProduct(i).fbc_id=model.genes{i};
0417         <span class="keyword">end</span>
0418         <span class="keyword">if</span> isfield(modelSBML.fbc_geneProduct, <span class="string">'fbc_label'</span>) &amp;&amp; isfield(model,<span class="string">'geneShortNames'</span>)
0419             <span class="keyword">if</span> isempty(model.geneShortNames{i})
0420                 modelSBML.fbc_geneProduct(i).fbc_label=model.genes{i};
0421             <span class="keyword">else</span>
0422                 modelSBML.fbc_geneProduct(i).fbc_label=model.geneShortNames{i};
0423             <span class="keyword">end</span>
0424         <span class="keyword">end</span>
0425     <span class="keyword">end</span>
0426 <span class="keyword">end</span>
0427 
0428 <span class="comment">%Generate a list of unique fbc_bound names</span>
0429 totalValues=[model.lb; model.ub];
0430 totalNames=cell(size(totalValues,1),1);
0431 
0432 listUniqueValues=unique(totalValues);
0433 
0434 <span class="keyword">for</span> i=1:length(listUniqueValues)
0435     listUniqueNames{i,1}=[<span class="string">'FB'</span>,num2str(i),<span class="string">'N'</span>,num2str(abs(round(listUniqueValues(i))))]; <span class="comment">% create unique flux bound IDs.</span>
0436     ind=find(ismember(totalValues,listUniqueValues(i)));
0437     totalNames(ind)=listUniqueNames(i,1);
0438 <span class="keyword">end</span>
0439 
0440 <span class="keyword">for</span> i=1:length(listUniqueNames)
0441     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0442     <span class="keyword">if</span> i==1
0443         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'constant'</span>)
0444             modelSBML.parameter(i).constant=1;
0445         <span class="keyword">end</span>
0446         <span class="keyword">if</span> isfield(modelSBML.parameter, <span class="string">'isSetValue'</span>)
0447             modelSBML.parameter(i).isSetValue=1;
0448         <span class="keyword">end</span>
0449     <span class="keyword">end</span>
0450     <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0451     <span class="comment">%last one</span>
0452     <span class="keyword">if</span> i&lt;numel(listUniqueNames)
0453         modelSBML.parameter(i+1)=modelSBML.parameter(i);
0454     <span class="keyword">end</span>
0455     modelSBML.parameter(i).id=listUniqueNames{i};
0456     modelSBML.parameter(i).value=listUniqueValues(i);
0457 <span class="keyword">end</span>
0458 
0459 <span class="keyword">for</span> i=1:numel(model.rxns)
0460     <span class="comment">%Add the default values, as these will be the same in all entries</span>
0461     <span class="keyword">if</span> i==1
0462         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'sboTerm'</span>)
0463             modelSBML.reaction(i).sboTerm=176;
0464         <span class="keyword">end</span>
0465         <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'isSetFast'</span>)
0466             modelSBML.reaction(i).isSetFast=1;
0467         <span class="keyword">end</span>
0468     <span class="keyword">end</span>
0469     <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0470     <span class="comment">%last one</span>
0471     <span class="keyword">if</span> i&lt;numel(model.rxns)
0472         modelSBML.reaction(i+1)=modelSBML.reaction(i);
0473     <span class="keyword">end</span>
0474     
0475     <span class="keyword">if</span> isfield(modelSBML.reaction,<span class="string">'metaid'</span>)
0476         modelSBML.reaction(i).metaid=model.rxns{i};
0477     <span class="keyword">end</span>
0478     
0479     <span class="comment">%Export notes information</span>
0480     <span class="keyword">if</span> (~isnan(model.rxnConfidenceScores(i)) || ~isempty(model.rxnReferences{i}) || ~isempty(model.rxnNotes{i}))
0481         modelSBML.reaction(i).notes=<span class="string">'&lt;notes&gt;&lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;'</span>;
0482         <span class="keyword">if</span> ~isnan(model.rxnConfidenceScores(i))
0483             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;Confidence Level: '</span> num2str(model.rxnConfidenceScores(i)) <span class="string">'&lt;/p&gt;'</span>];
0484         <span class="keyword">end</span>
0485         <span class="keyword">if</span> ~isempty(model.rxnReferences{i})
0486             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;AUTHORS: '</span> model.rxnReferences{i} <span class="string">'&lt;/p&gt;'</span>];
0487         <span class="keyword">end</span>
0488         <span class="keyword">if</span> ~isempty(model.rxnNotes{i})
0489             modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;p&gt;NOTES: '</span> model.rxnNotes{i} <span class="string">'&lt;/p&gt;'</span>];
0490         <span class="keyword">end</span>
0491         modelSBML.reaction(i).notes=[modelSBML.reaction(i).notes <span class="string">'&lt;/body&gt;&lt;/notes&gt;'</span>];
0492     <span class="keyword">end</span>
0493     
0494     <span class="comment">% Export SBO terms from rxnMiriams</span>
0495     <span class="keyword">if</span> ~isempty(model.rxnMiriams{i})
0496         [~,sbo_ind] = ismember(<span class="string">'sbo'</span>,model.rxnMiriams{i}.name);
0497         <span class="keyword">if</span> sbo_ind &gt; 0
0498             modelSBML.reaction(i).sboTerm=str2double(regexprep(model.rxnMiriams{i}.value{sbo_ind},<span class="string">'SBO:'</span>,<span class="string">''</span>,<span class="string">'ignorecase'</span>));
0499             <span class="comment">% remove the SBO term from rxnMiriams so the information is not</span>
0500             <span class="comment">% duplicated in the &quot;annotation&quot; field later on</span>
0501             model.rxnMiriams{i}.name(sbo_ind) = [];
0502             model.rxnMiriams{i}.value(sbo_ind) = [];
0503         <span class="keyword">end</span>
0504     <span class="keyword">end</span>
0505     
0506     <span class="comment">%Export annotation information from rxnMiriams</span>
0507     <span class="keyword">if</span> (~isempty(model.rxnMiriams{i}) &amp;&amp; isfield(modelSBML.reaction(i),<span class="string">'annotation'</span>)) || ~isempty(model.eccodes{i})
0508         modelSBML.reaction(i).annotation=[<span class="string">'&lt;annotation&gt;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot; xmlns:dc=&quot;http://purl.org/dc/elements/1.1/&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:vCard=&quot;http://www.w3.org/2001/vcard-rdf/3.0#&quot; xmlns:bqbiol=&quot;http://biomodels.net/biology-qualifiers/&quot; xmlns:bqmodel=&quot;http://biomodels.net/model-qualifiers/&quot;&gt;&lt;rdf:Description rdf:about=&quot;#meta_'</span> model.rxns{i} <span class="string">'&quot;&gt;'</span>];
0509         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <span class="string">'&lt;bqbiol:is&gt;&lt;rdf:Bag&gt;'</span>];
0510         <span class="keyword">if</span> ~isempty(model.eccodes{i})
0511             eccodes=regexp(model.eccodes{i},<span class="string">';'</span>,<span class="string">'split'</span>);
0512             <span class="keyword">for</span> j=1:numel(eccodes)
0513                 modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation  <span class="string">'&lt;rdf:li rdf:resource=&quot;https://identifiers.org/ec-code/'</span> regexprep(eccodes{j},<span class="string">'ec-code/|EC'</span>,<span class="string">''</span>) <span class="string">'&quot;/&gt;'</span>];
0514             <span class="keyword">end</span>
0515         <span class="keyword">end</span>
0516         modelSBML.reaction(i).annotation=[modelSBML.reaction(i).annotation <a href="#_sub2" class="code" title="subfunction miriamString=getMiriam(miriamStruct)">getMiriam</a>(model.rxnMiriams{i}) <span class="string">'&lt;/rdf:Bag&gt;&lt;/bqbiol:is&gt;&lt;/rdf:Description&gt;&lt;/rdf:RDF&gt;&lt;/annotation&gt;'</span>];
0517     <span class="keyword">end</span>
0518     
0519     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'name'</span>)
0520         modelSBML.reaction(i).name=model.rxnNames{i};
0521     <span class="keyword">end</span>
0522     <span class="keyword">if</span> isfield(modelSBML.reaction, <span class="string">'id'</span>)
0523         modelSBML.reaction(i).id=model.rxns{i};
0524     <span class="keyword">end</span>
0525     
0526     <span class="comment">%Add the information about reactants and products</span>
0527     involvedMets=<a href="#_sub3" class="code" title="subfunction [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)">addReactantsProducts</a>(model,modelSBML,i);
0528     <span class="keyword">for</span> j=1:numel(involvedMets.reactant)
0529         <span class="keyword">if</span> j&lt;numel(involvedMets.reactant)
0530             modelSBML.reaction(i).reactant(j+1)=modelSBML.reaction(i).reactant(j);
0531         <span class="keyword">end</span>
0532         modelSBML.reaction(i).reactant(j).species=involvedMets.reactant(j).species;
0533         modelSBML.reaction(i).reactant(j).stoichiometry=involvedMets.reactant(j).stoichiometry;
0534         modelSBML.reaction(i).reactant(j).isSetStoichiometry=involvedMets.reactant(j).isSetStoichiometry;
0535         modelSBML.reaction(i).reactant(j).constant=involvedMets.reactant(j).constant;
0536     <span class="keyword">end</span>
0537     <span class="keyword">if</span> numel(involvedMets.reactant)==0
0538         modelSBML.reaction(i).reactant=<span class="string">''</span>;
0539     <span class="keyword">end</span>
0540     <span class="keyword">for</span> j=1:numel(involvedMets.product)
0541         <span class="keyword">if</span> j&lt;numel(involvedMets.product)
0542             modelSBML.reaction(i).product(j+1)=modelSBML.reaction(i).product(j);
0543         <span class="keyword">end</span>
0544         modelSBML.reaction(i).product(j).species=involvedMets.product(j).species;
0545         modelSBML.reaction(i).product(j).stoichiometry=involvedMets.product(j).stoichiometry;
0546         modelSBML.reaction(i).product(j).isSetStoichiometry=involvedMets.product(j).isSetStoichiometry;
0547         modelSBML.reaction(i).product(j).constant=involvedMets.product(j).constant;
0548     <span class="keyword">end</span>
0549     <span class="keyword">if</span> numel(involvedMets.product)==0
0550         modelSBML.reaction(i).product=<span class="string">''</span>;
0551     <span class="keyword">end</span>
0552     <span class="comment">%Export reversibility information. Reactions are irreversible by</span>
0553     <span class="comment">%default</span>
0554     <span class="keyword">if</span> model.rev(i)==1
0555         modelSBML.reaction(i).reversible=1;
0556     <span class="keyword">end</span>
0557     <span class="keyword">if</span> isfield(model, <span class="string">'rxnComps'</span>)
0558         modelSBML.reaction(i).compartment=model.comps{model.rxnComps(i)};
0559     <span class="keyword">end</span>
0560     <span class="keyword">if</span> isfield(model, <span class="string">'grRules'</span>)
0561         modelSBML.reaction(i).fbc_geneProductAssociation.fbc_association.fbc_association=model.grRules{i};
0562     <span class="keyword">end</span>
0563     modelSBML.reaction(i).fbc_lowerFluxBound=totalNames{i};
0564     modelSBML.reaction(i).fbc_upperFluxBound=totalNames{length(model.lb)+i};
0565 <span class="keyword">end</span>
0566 
0567 <span class="comment">%Prepare subSystems Code taken from COBRA functions getModelSubSystems,</span>
0568 <span class="comment">%writeSBML, findRxnsFromSubSystem under GNU General Public License v3.0,</span>
0569 <span class="comment">%license file in readme/GPL.MD. Code modified for RAVEN</span>
0570 <span class="keyword">if</span> modelHasSubsystems
0571     modelSBML.groups_group.groups_kind = <span class="string">'partonomy'</span>;
0572     modelSBML.groups_group.sboTerm = 633;
0573     tmpStruct=modelSBML.groups_group;
0574 
0575     rxns=model.rxns;
0576     <span class="keyword">if</span> ~any(cellfun(@iscell,model.subSystems))
0577         <span class="keyword">if</span> ~any(~cellfun(@isempty,model.subSystems))
0578             subSystems = {};
0579         <span class="keyword">else</span>
0580             subSystems = setdiff(model.subSystems,<span class="string">''</span>);
0581         <span class="keyword">end</span>
0582     <span class="keyword">else</span>
0583         orderedSubs = cellfun(@(x) <a href="#_sub4" class="code" title="subfunction vecT = columnVector(vec)">columnVector</a>(x),model.subSystems,<span class="string">'UniformOUtput'</span>,false);
0584         subSystems = setdiff(vertcat(orderedSubs{:}),<span class="string">''</span>);
0585     <span class="keyword">end</span>
0586     <span class="keyword">if</span> isempty(subSystems)
0587         subSystems = {};
0588     <span class="keyword">end</span>
0589     <span class="keyword">if</span> ~isempty(subSystems)
0590         <span class="comment">%Build the groups for the group package</span>
0591         groupIDs = strcat(<span class="string">'group'</span>,cellfun(@num2str, num2cell(1:length(subSystems)),<span class="string">'UniformOutput'</span>,false));
0592         <span class="keyword">for</span> i = 1:length(subSystems)
0593             cgroup = tmpStruct;
0594             <span class="keyword">if</span> ~any(cellfun(@iscell,model.subSystems))
0595                 present = ismember(model.subSystems,subSystems{i});
0596             <span class="keyword">else</span>
0597                 present = cellfun(@(x) any(ismember(x,subSystems{i})),model.subSystems);
0598             <span class="keyword">end</span>
0599             groupMembers = rxns(present);
0600             <span class="keyword">for</span> j = 1:numel(groupMembers)
0601                 cMember = tmpStruct.groups_member;
0602                 cMember.groups_idRef = groupMembers{j};
0603                 <span class="keyword">if</span> j == 1
0604                     cgroup.groups_member = cMember;
0605                 <span class="keyword">else</span>
0606                     cgroup.groups_member(j) = cMember;
0607                 <span class="keyword">end</span>
0608             <span class="keyword">end</span>
0609             cgroup.groups_id = groupIDs{i};
0610             cgroup.groups_name = subSystems{i};
0611             <span class="keyword">if</span> i == 1
0612                 modelSBML.groups_group = cgroup;
0613             <span class="keyword">else</span>
0614                 modelSBML.groups_group(i) = cgroup;
0615             <span class="keyword">end</span>
0616         <span class="keyword">end</span>
0617     <span class="keyword">end</span>
0618 <span class="keyword">end</span>
0619 
0620 <span class="comment">%Prepare fbc_objective subfield</span>
0621 
0622 modelSBML.fbc_objective.fbc_type=<span class="string">'maximize'</span>;
0623 modelSBML.fbc_objective.fbc_id=<span class="string">'obj'</span>;
0624 
0625 ind=find(model.c);
0626 
0627 <span class="keyword">if</span> isempty(ind)
0628     modelSBML.fbc_objective.fbc_fluxObjective.fbc_coefficient=0;
0629 <span class="keyword">else</span>
0630     <span class="keyword">for</span> i=1:length(ind)
0631         <span class="comment">%Copy the default values to the next index as long as it is not the</span>
0632         <span class="comment">%last one</span>
0633         <span class="keyword">if</span> i&lt;numel(ind)
0634             modelSBML.reaction(i+1)=modelSBML.reaction(i);
0635         <span class="keyword">end</span>
0636         values=model.c(model.c~=0);
0637         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_reaction=modelSBML.reaction(ind(i)).id;
0638         modelSBML.fbc_objective(i).fbc_fluxObjective.fbc_coefficient=values(i);
0639         modelSBML.fbc_objective(i).fbc_fluxObjective.isSetfbc_coefficient=1;
0640     <span class="keyword">end</span>
0641 <span class="keyword">end</span>
0642 
0643 modelSBML.fbc_activeObjective=modelSBML.fbc_objective.fbc_id;
0644 
0645 fbcStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/fbc/version'</span>,num2str(sbmlPackageVersions(1))];
0646 <span class="keyword">if</span> modelHasSubsystems
0647     groupStr=[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/groups/version'</span>,num2str(sbmlPackageVersions(2))];
0648     modelSBML.namespaces=struct(<span class="string">'prefix'</span>,{<span class="string">''</span>,<span class="string">'fbc'</span>,<span class="string">'groups'</span>},<span class="keyword">...</span>
0649     <span class="string">'uri'</span>,{[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/core'</span>],<span class="keyword">...</span>
0650     fbcStr,groupStr});
0651 <span class="keyword">else</span>
0652     modelSBML.namespaces=struct(<span class="string">'prefix'</span>,{<span class="string">''</span>,<span class="string">'fbc'</span>},<span class="keyword">...</span>
0653     <span class="string">'uri'</span>,{[<span class="string">'http://www.sbml.org/sbml/level'</span>, num2str(sbmlLevel), <span class="string">'/version'</span>, num2str(sbmlVersion), <span class="string">'/core'</span>],<span class="keyword">...</span>
0654     fbcStr});
0655 <span class="keyword">end</span>
0656 
0657 <span class="keyword">if</span> sbmlPackageVersions(1) == 2
0658     modelSBML.fbc_strict=1;
0659     modelSBML.isSetfbc_strict = 1;
0660 <span class="keyword">end</span>
0661 
0662 modelSBML.rule=[];
0663 modelSBML.constraint=[];
0664 
0665 [ravenDir,prevDir]=findRAVENroot();
0666 fileName=<a href="checkFileExistence.html" class="code" title="function files=checkFileExistence(files,fullOrTemp,allowSpace,checkExist)">checkFileExistence</a>(fileName,1,true,false);
0667 
0668 OutputSBML_RAVEN(modelSBML,fileName,1,0,[1,0]);
0669 <span class="keyword">end</span>
0670 
0671 
0672 <a name="_sub1" href="#_subfunctions" class="code">function modelSBML=getSBMLStructure(sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions)</a>
0673 <span class="comment">%Returns the blank SBML model structure by using appropriate libSBML</span>
0674 <span class="comment">%functions. This creates structure by considering three levels</span>
0675 
0676 sbmlFieldNames=getStructureFieldnames(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0677 sbmlDefaultValues=getDefaultValues(<span class="string">'model'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0678 
0679 <span class="keyword">for</span> i=1:numel(sbmlFieldNames)
0680     modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0681     sbmlSubfieldNames=getStructureFieldnames(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0682     sbmlSubfieldValues=getDefaultValues(sbmlFieldNames{1,i},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0683     <span class="keyword">if</span> ~strcmp(sbmlFieldNames{1,i},<span class="string">'event'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'functionDefinition'</span>) &amp;&amp; ~strcmp(sbmlFieldNames{1,i},<span class="string">'initialAssignment'</span>)
0684         <span class="keyword">for</span> j=1:numel(sbmlSubfieldNames)
0685             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j})=sbmlSubfieldValues{1,j};
0686             sbmlSubsubfieldNames=getStructureFieldnames(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0687             sbmlSubsubfieldValues=getDefaultValues(sbmlSubfieldNames{1,j},sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0688             <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'modifier'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'kineticLaw'</span>)
0689                 <span class="keyword">for</span> k=1:numel(sbmlSubsubfieldNames)
0690                     <span class="comment">%'compartment' and 'species' fields are not supposed to</span>
0691                     <span class="comment">%have their standalone structures if they are subfields</span>
0692                     <span class="comment">%or subsubfields</span>
0693                     <span class="keyword">if</span> ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'compartment'</span>) &amp;&amp; ~strcmp(sbmlSubfieldNames{1,j},<span class="string">'species'</span>)
0694                         modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k})=sbmlSubsubfieldValues{1,k};
0695                     <span class="keyword">end</span>
0696                     <span class="comment">%If it is fbc_association in the third level, we need</span>
0697                     <span class="comment">%to establish the fourth level, since libSBML requires</span>
0698                     <span class="comment">%it</span>
0699                     <span class="keyword">if</span> strcmp(sbmlSubsubfieldNames{1,k},<span class="string">'fbc_association'</span>)
0700                         fbc_associationFieldNames=getStructureFieldnames(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0701                         fbc_associationFieldValues=getDefaultValues(<span class="string">'fbc_association'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0702                         <span class="keyword">for</span> l=1:numel(fbc_associationFieldNames)
0703                             modelSBML.(sbmlFieldNames{1,i}).(sbmlSubfieldNames{1,j}).(sbmlSubsubfieldNames{1,k}).(fbc_associationFieldNames{1,l})=fbc_associationFieldValues{1,l};
0704                         <span class="keyword">end</span>
0705                     <span class="keyword">end</span>
0706                 <span class="keyword">end</span>
0707             <span class="keyword">end</span>
0708         <span class="keyword">end</span>
0709     <span class="keyword">end</span>
0710     <span class="keyword">if</span> ~isstruct(modelSBML.(sbmlFieldNames{1,i}))
0711         modelSBML.(sbmlFieldNames{1,i})=sbmlDefaultValues{1,i};
0712     <span class="keyword">end</span>
0713 <span class="keyword">end</span>
0714 
0715 modelSBML.unitDefinition.id=<span class="string">'mmol_per_gDW_per_hr'</span>;
0716 
0717 unitFieldNames=getStructureFieldnames(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0718 unitDefaultValues=getDefaultValues(<span class="string">'unit'</span>,sbmlLevel,sbmlVersion,sbmlPackages,sbmlPackageVersions);
0719 
0720 kinds={<span class="string">'mole'</span>,<span class="string">'gram'</span>,<span class="string">'second'</span>};
0721 exponents=[1 -1 -1];
0722 scales=[-3 0 0];
0723 multipliers=[1 1 1*60*60];
0724 
0725 <span class="keyword">for</span> i=1:numel(unitFieldNames)
0726     modelSBML.unitDefinition.unit(1).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0727     <span class="keyword">for</span> j=1:3
0728         modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=unitDefaultValues{1,i};
0729         <span class="keyword">if</span> strcmp(unitFieldNames{1,i},<span class="string">'kind'</span>)
0730             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=kinds{j};
0731         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'exponent'</span>)
0732             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=exponents(j);
0733         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'scale'</span>)
0734             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=scales(j);
0735         <span class="keyword">elseif</span> strcmp(unitFieldNames{1,i},<span class="string">'multiplier'</span>)
0736             modelSBML.unitDefinition.unit(j).(unitFieldNames{1,i})=multipliers(j);
0737         <span class="keyword">end</span>
0738     <span class="keyword">end</span>
0739 <span class="keyword">end</span>
0740 <span class="keyword">end</span>
0741 
0742 <a name="_sub2" href="#_subfunctions" class="code">function miriamString=getMiriam(miriamStruct)</a>
0743 <span class="comment">%Returns a string with list elements for a miriam structure ('&lt;rdf:li</span>
0744 <span class="comment">%rdf:resource=&quot;https://identifiers.org/go/GO:0005739&quot;/&gt;' for example). This</span>
0745 <span class="comment">%is just to speed up things since this is done many times during the</span>
0746 <span class="comment">%exporting</span>
0747 
0748 miriamString=<span class="string">''</span>;
0749 <span class="keyword">if</span> isfield(miriamStruct,<span class="string">'name'</span>)
0750     <span class="keyword">for</span> i=1:numel(miriamStruct.name)
0751         miriamString=[miriamString <span class="string">'&lt;rdf:li rdf:resource=&quot;https://identifiers.org/'</span> miriamStruct.name{i} <span class="string">'/'</span> miriamStruct.value{i} <span class="string">'&quot;/&gt;'</span>];
0752     <span class="keyword">end</span>
0753 <span class="keyword">end</span>
0754 <span class="keyword">end</span>
0755 
0756 <a name="_sub3" href="#_subfunctions" class="code">function [tmp_Rxn]=addReactantsProducts(model,sbmlModel,i)</a>
0757 <span class="comment">%This function provides reactants and products for particular reaction. The</span>
0758 <span class="comment">%function was 'borrowed' from writeSBML in COBRA toolbox, lines 663-679</span>
0759 
0760 met_idx = find(model.S(:, i));
0761 tmp_Rxn.product=[];
0762 tmp_Rxn.reactant=[];
0763 <span class="keyword">for</span> j_met=1:size(met_idx,1)
0764     tmp_idx = met_idx(j_met,1);
0765     sbml_tmp_species_ref.species = sbmlModel.species(tmp_idx).id;
0766     met_stoich = model.S(tmp_idx, i);
0767     sbml_tmp_species_ref.stoichiometry = abs(met_stoich);
0768     sbml_tmp_species_ref.isSetStoichiometry=1;
0769     sbml_tmp_species_ref.constant=1;
0770     <span class="keyword">if</span> (met_stoich &gt; 0)
0771         tmp_Rxn.product = [ tmp_Rxn.product, sbml_tmp_species_ref ];
0772     <span class="keyword">else</span>
0773         tmp_Rxn.reactant = [ tmp_Rxn.reactant, sbml_tmp_species_ref];
0774     <span class="keyword">end</span>
0775 <span class="keyword">end</span>
0776 <span class="keyword">end</span>
0777 
0778 <a name="_sub4" href="#_subfunctions" class="code">function vecT = columnVector(vec)</a>
0779 <span class="comment">% Code below taken from COBRA Toolbox under GNU General Public License v3.0</span>
0780 <span class="comment">% license file in readme/GPL.MD.</span>
0781 <span class="comment">%</span>
0782 <span class="comment">% Converts a vector to a column vector</span>
0783 <span class="comment">%</span>
0784 <span class="comment">% USAGE:</span>
0785 <span class="comment">%</span>
0786 <span class="comment">%   vecT = columnVector(vec)</span>
0787 <span class="comment">%</span>
0788 <span class="comment">% INPUT:</span>
0789 <span class="comment">%   vec:     a vector</span>
0790 <span class="comment">%</span>
0791 <span class="comment">% OUTPUT:</span>
0792 <span class="comment">%   vecT:    a column vector</span>
0793 
0794 [n, m] = size(vec);
0795 
0796 <span class="keyword">if</span> n &lt; m
0797     vecT = vec';
0798 <span class="keyword">else</span>
0799     vecT = vec;
0800 <span class="keyword">end</span>
0801 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
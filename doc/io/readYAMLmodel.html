<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of readYAMLmodel</title>
  <meta name="keywords" content="readYAMLmodel">
  <meta name="description" content="readYAMLmodel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">io</a> &gt; readYAMLmodel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for io&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>readYAMLmodel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>readYAMLmodel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function model=readYAMLmodel(fileName, verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> readYAMLmodel
   Reads a yaml file matching (roughly) the cobrapy yaml structure

   Input:
   fileName    a model file in yaml file format. A dialog window will open
               if no file name is specified.
   verbose     set as true to monitor progress (optional, default false)

   Output:
   model       a model structure

 Usage: model = readYAMLmodel(fileName, verbose)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)</a></li><li><a href="#_sub2" class="code">function model = readFieldValue(model, fieldName, value, pos)</a></li><li><a href="#_sub3" class="code">function [miriams,miriamKey,entryNumber] = gatherAnnotation(pos,miriams,key,value,miriamKey,entryNumber)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function model=readYAMLmodel(fileName, verbose)</a>
0002 <span class="comment">% readYAMLmodel</span>
0003 <span class="comment">%   Reads a yaml file matching (roughly) the cobrapy yaml structure</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   Input:</span>
0006 <span class="comment">%   fileName    a model file in yaml file format. A dialog window will open</span>
0007 <span class="comment">%               if no file name is specified.</span>
0008 <span class="comment">%   verbose     set as true to monitor progress (optional, default false)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   Output:</span>
0011 <span class="comment">%   model       a model structure</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Usage: model = readYAMLmodel(fileName, verbose)</span>
0014 <span class="keyword">if</span> nargin&lt;1 || isempty(fileName)
0015     [fileName, pathName] = uigetfile({<span class="string">'*.yml;*.yaml'</span>}, <span class="string">'Please select the model file'</span>);
0016     <span class="keyword">if</span> fileName == 0
0017         error(<span class="string">'You should select a model file'</span>)
0018     <span class="keyword">else</span>
0019         fileName = fullfile(pathName,fileName);
0020     <span class="keyword">end</span>
0021 <span class="keyword">end</span>
0022 <span class="keyword">if</span> nargin &lt; 2
0023     verbose = false;
0024 <span class="keyword">end</span>
0025 
0026 <span class="keyword">if</span> ~isfile(fileName)
0027     error(<span class="string">'Yaml file %s cannot be found'</span>, string(fileName));
0028 <span class="keyword">end</span>
0029 
0030 <span class="keyword">if</span> verLessThan(<span class="string">'matlab'</span>,<span class="string">'9.9'</span>) <span class="comment">%readlines introduced 2020b</span>
0031     fid=fopen(fileName);
0032     line_raw=cell(1000000,1);
0033     i=1;
0034     <span class="keyword">while</span> ~feof(fid)
0035         line_raw{i}=fgetl(fid);
0036         i=i+1;
0037     <span class="keyword">end</span>
0038     line_raw(i:end)=[];
0039     line_raw=string(line_raw);
0040     fclose(fid);
0041 <span class="keyword">else</span>
0042     line_raw=readlines(fileName);
0043 <span class="keyword">end</span>
0044 <span class="comment">% If entry is broken of multiple lines, concatenate. Assumes at least 6</span>
0045 <span class="comment">% leading spaces to avoid metaData to be concatenated.</span>
0046 newLine=regexp(line_raw,<span class="string">'^ {6,}([\w\(\)].*)'</span>,<span class="string">'tokenExtents'</span>);
0047 brokenLine=find(~cellfun(<span class="string">'isempty'</span>,newLine));
0048 <span class="keyword">for</span> i=1:numel(brokenLine)
0049     extraLine = char(line_raw(brokenLine(i)));
0050     extraLine = extraLine(newLine{brokenLine(i)}{1}(1):end);
0051     line_raw{brokenLine(i)-1} = strjoin({line_raw{brokenLine(i)-1},extraLine},<span class="string">' '</span>);
0052 <span class="keyword">end</span>
0053 line_raw(brokenLine)=[];
0054 
0055 line_key = regexprep(line_raw,<span class="string">'^ *-? ([^:]+)(:)($| .*)'</span>,<span class="string">'$1'</span>);
0056 line_key = regexprep(line_key,<span class="string">'(.*!!omap)|(---)|( {4,}.*)'</span>,<span class="string">''</span>);
0057 
0058 line_value = regexprep(line_raw, <span class="string">'.*:$'</span>,<span class="string">''</span>);
0059 line_value = regexprep(line_value, <span class="string">'[^&quot;:]+: &quot;?(.+)&quot;?$'</span>,<span class="string">'$1'</span>);
0060 line_value = regexprep(line_value, <span class="string">'(&quot;)|(^ {4,}- )'</span>,<span class="string">''</span>);
0061 
0062 line_value(strcmp(line_value,line_raw)) = {<span class="string">''</span>};
0063 
0064 modelFields =   {<span class="string">'id'</span>,char();<span class="keyword">...</span>
0065                <span class="string">'name'</span>,char();<span class="keyword">...</span>
0066         <span class="string">'description'</span>,char();<span class="keyword">...</span>
0067             <span class="string">'version'</span>,char();<span class="keyword">...</span>
0068                <span class="string">'date'</span>,char();<span class="keyword">...</span>
0069          <span class="string">'annotation'</span>,struct();<span class="keyword">...</span>
0070                <span class="string">'rxns'</span>,{};<span class="keyword">...</span>
0071            <span class="string">'rxnNames'</span>,{};<span class="keyword">...</span>
0072                <span class="string">'mets'</span>,{};<span class="keyword">...</span>
0073            <span class="string">'metNames'</span>,{};<span class="keyword">...</span>
0074                   <span class="string">'S'</span>,sparse([]);<span class="keyword">...</span>
0075                  <span class="string">'lb'</span>,{};<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0076                  <span class="string">'ub'</span>,{};<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0077                 <span class="string">'rev'</span>,{};<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0078                   <span class="string">'c'</span>,[];<span class="keyword">...</span>
0079                   <span class="string">'b'</span>,cell(0,0);<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0080               <span class="string">'genes'</span>,cell(0,0);<span class="keyword">...</span>
0081             <span class="string">'grRules'</span>,cell(0,0);<span class="keyword">...</span>
0082          <span class="string">'rxnGeneMat'</span>,sparse([]);<span class="keyword">...</span>
0083            <span class="string">'rxnComps'</span>,cell(0,0);<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0084          <span class="string">'subSystems'</span>,cell(0,0);<span class="keyword">...</span>
0085             <span class="string">'eccodes'</span>,cell(0,0);<span class="keyword">...</span>
0086          <span class="string">'rxnMiriams'</span>,cell(0,0);<span class="keyword">...</span>
0087           <span class="string">'rxnDeltaG'</span>,{};<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0088            <span class="string">'rxnNotes'</span>,cell(0,0);<span class="keyword">...</span>
0089       <span class="string">'rxnReferences'</span>,cell(0,0);<span class="keyword">...</span>
0090 <span class="string">'rxnConfidenceScores'</span>,cell(0,0);<span class="keyword">...</span>
0091            <span class="string">'metComps'</span>,cell(0,0);<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0092              <span class="string">'inchis'</span>,cell(0,0);<span class="keyword">...</span>
0093           <span class="string">'metSmiles'</span>,cell(0,0);<span class="keyword">...</span>
0094         <span class="string">'metFormulas'</span>,cell(0,0);<span class="keyword">...</span>
0095          <span class="string">'metMiriams'</span>,cell(0,0);<span class="keyword">...</span>
0096           <span class="string">'metDeltaG'</span>,{};<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0097          <span class="string">'metCharges'</span>,cell(0,0);<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0098            <span class="string">'metNotes'</span>,cell(0,0);<span class="keyword">...</span>
0099               <span class="string">'comps'</span>,cell(0,0);<span class="keyword">...</span>
0100           <span class="string">'compNames'</span>,cell(0,0);<span class="keyword">...</span>
0101         <span class="string">'compOutside'</span>,cell(0,0);<span class="keyword">...</span>
0102           <span class="string">'geneComps'</span>,cell(0,0);<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0103         <span class="string">'geneMiriams'</span>,cell(0,0);<span class="keyword">...</span>
0104      <span class="string">'geneShortNames'</span>,cell(0,0);<span class="keyword">...</span>
0105        <span class="string">'proteins'</span>,cell(0,0);<span class="keyword">...</span>
0106       <span class="string">'unconstrained'</span>,cell(0,0);<span class="keyword">...</span><span class="comment"> %Changed to double in the end.</span>
0107             <span class="string">'metFrom'</span>,cell(0,0);<span class="keyword">...</span>
0108             <span class="string">'rxnFrom'</span>,cell(0,0)};
0109 <span class="keyword">for</span> i=1:size(modelFields,1)
0110     model.(modelFields{i,1})=modelFields{i,2};
0111 <span class="keyword">end</span>
0112 
0113 <span class="comment">% If GECKO model</span>
0114 <span class="keyword">if</span> any(contains(line_key,<span class="string">'geckoLight'</span>))
0115     isGECKO=true;
0116     ecFields = {<span class="string">'geckoLight'</span>, false;<span class="keyword">...</span>
0117                       <span class="string">'rxns'</span>, {};<span class="keyword">...</span>
0118                       <span class="string">'kcat'</span>, {};<span class="keyword">...</span>
0119                     <span class="string">'source'</span>, cell(0,0);<span class="keyword">...</span>
0120                      <span class="string">'notes'</span>, cell(0,0);<span class="keyword">...</span>
0121                    <span class="string">'eccodes'</span>, cell(0,0);<span class="keyword">...</span>
0122                      <span class="string">'genes'</span>, cell(0,0);<span class="keyword">...</span>
0123                    <span class="string">'enzymes'</span>, cell(0,0);<span class="keyword">...</span>
0124                         <span class="string">'mw'</span>, cell(0,0);<span class="keyword">...</span>
0125                   <span class="string">'sequence'</span>, cell(0,0);<span class="keyword">...</span>
0126                      <span class="string">'concs'</span>, cell(0,0);<span class="keyword">...</span>
0127                  <span class="string">'rxnEnzMat'</span>, []};
0128     <span class="keyword">for</span> i=1:size(ecFields,1)
0129         model.ec.(ecFields{i,1})=ecFields{i,2};
0130     <span class="keyword">end</span>
0131     ecGecko=cell(25000,2);      ecGeckoNo=1;
0132     enzStoich=cell(100000,3);   enzStoichNo=1;
0133 <span class="keyword">else</span>
0134     isGECKO=false;
0135 <span class="keyword">end</span>
0136 
0137 section = 0;
0138 metMiriams=cell(100000,3);   metMirNo=1;
0139 rxnMiriams=cell(100000,3);   rxnMirNo=1;
0140 geneMiriams=cell(100000,3);  genMirNo=1;
0141 subSystems=cell(100000,2);   subSysNo=1;
0142 eccodes=cell(100000,2);      ecCodeNo=1;
0143 equations=cell(100000,3);   equatiNo=1;
0144 
0145 <span class="keyword">for</span> i=1:numel(line_key)
0146     tline_raw = line_raw{i};
0147     tline_key = line_key{i};
0148     tline_value = line_value{i};
0149     <span class="comment">% import different sections</span>
0150     <span class="keyword">switch</span> tline_raw
0151         <span class="keyword">case</span> <span class="string">'- metaData:'</span>
0152             section = 1;
0153             <span class="keyword">if</span> verbose
0154                 fprintf(<span class="string">'\t%d\n'</span>, section);
0155             <span class="keyword">end</span>
0156             <span class="keyword">continue</span> <span class="comment">% Go to next line</span>
0157         <span class="keyword">case</span> <span class="string">'- metabolites:'</span>
0158             section = 2;
0159             <span class="keyword">if</span> verbose
0160                 fprintf(<span class="string">'\t%d\n'</span>, section);
0161             <span class="keyword">end</span>
0162             pos=0;
0163             <span class="keyword">continue</span>
0164         <span class="keyword">case</span> <span class="string">'- reactions:'</span>
0165             section = 3;
0166             <span class="keyword">if</span> verbose
0167                 fprintf(<span class="string">'\t%d\n'</span>, section);
0168             <span class="keyword">end</span>
0169             pos=0;
0170             <span class="keyword">continue</span>
0171         <span class="keyword">case</span> <span class="string">'- genes:'</span>
0172             section = 4;
0173             <span class="keyword">if</span> verbose
0174                 fprintf(<span class="string">'\t%d\n'</span>, section);
0175             <span class="keyword">end</span>
0176             pos=0;
0177             <span class="keyword">continue</span>
0178         <span class="keyword">case</span> <span class="string">'- compartments: !!omap'</span>
0179             section = 5;
0180             <span class="keyword">if</span> verbose
0181                 fprintf(<span class="string">'\t%d\n'</span>, section);
0182             <span class="keyword">end</span>
0183             pos=0;
0184             <span class="keyword">continue</span>
0185         <span class="keyword">case</span> <span class="string">'- ec-rxns:'</span>
0186             section = 6;
0187             <span class="keyword">if</span> verbose
0188                 fprintf(<span class="string">'\t%d\n'</span>, section);
0189             <span class="keyword">end</span>
0190             pos=0;
0191             <span class="keyword">continue</span>
0192         <span class="keyword">case</span> <span class="string">'- ec-enzymes:'</span>
0193             section = 7;
0194             <span class="keyword">if</span> verbose
0195                 fprintf(<span class="string">'\t%d\n'</span>, section);
0196             <span class="keyword">end</span>
0197             pos=0;
0198             <span class="keyword">continue</span>
0199     <span class="keyword">end</span>
0200 
0201     <span class="comment">% skip over empty keys</span>
0202     <span class="keyword">if</span> isempty(tline_raw) || (isempty(tline_key) &amp;&amp; contains(tline_raw,<span class="string">'!!omap'</span>))
0203         <span class="keyword">continue</span>;
0204     <span class="keyword">end</span>
0205     
0206     <span class="comment">% import metaData</span>
0207     <span class="keyword">if</span> section == 1
0208         <span class="keyword">switch</span> tline_key
0209             <span class="keyword">case</span> {<span class="string">'short_name'</span>,<span class="string">'id'</span>} <span class="comment">%short_name used by human-GEM</span>
0210                 model.id = tline_value;
0211             <span class="keyword">case</span> <span class="string">'name'</span>
0212                 model.name = tline_value;                
0213             <span class="keyword">case</span> <span class="string">'full_name'</span> <span class="comment">%used by human-GEM</span>
0214                 model.description = tline_value;
0215             <span class="keyword">case</span> <span class="string">'version'</span>
0216                 model.version = tline_value;
0217             <span class="keyword">case</span> <span class="string">'date'</span>
0218                 model.date = tline_value;                
0219             <span class="keyword">case</span> <span class="string">'taxonomy'</span>
0220                 model.annotation.taxonomy = tline_value;
0221             <span class="keyword">case</span> {<span class="string">'description'</span>,<span class="string">'note'</span>} <span class="comment">%description used by human-GEM</span>
0222                 model.annotation.note = tline_value;
0223             <span class="keyword">case</span> <span class="string">'github'</span>
0224                 model.annotation.sourceUrl = tline_value;
0225             <span class="keyword">case</span> <span class="string">'sourceUrl'</span>
0226                 model.annotation.sourceUrl = tline_value;                
0227             <span class="keyword">case</span> <span class="string">'givenName'</span>
0228                 model.annotation.givenName = tline_value;
0229             <span class="keyword">case</span> <span class="string">'familyName'</span>
0230                 model.annotation.familyName = tline_value;
0231             <span class="keyword">case</span> <span class="string">'authors'</span>
0232                 model.annotation.authorList = tline_value;
0233             <span class="keyword">case</span> <span class="string">'email'</span>
0234                 model.annotation.email = tline_value;
0235             <span class="keyword">case</span> <span class="string">'organization'</span>
0236                 model.annotation.organization = tline_value;
0237             <span class="keyword">case</span> <span class="string">'geckoLight'</span>
0238                 <span class="keyword">if</span> strcmp(tline_value,<span class="string">'true'</span>)
0239                     model.ec.geckoLight = true;
0240                 <span class="keyword">end</span>
0241         <span class="keyword">end</span>; <span class="keyword">continue</span>
0242     <span class="keyword">end</span>
0243 
0244     <span class="comment">% import metabolites:</span>
0245     <span class="keyword">if</span> section == 2
0246         <span class="keyword">switch</span> tline_key
0247             <span class="keyword">case</span> <span class="string">'id'</span>
0248                 pos = pos + 1;
0249                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'mets'</span>, tline_value,pos);
0250                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0251             <span class="keyword">case</span> <span class="string">'name'</span>
0252                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metNames'</span>, tline_value, pos);
0253                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0254             <span class="keyword">case</span> <span class="string">'compartment'</span>
0255                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metComps'</span>, tline_value, pos);
0256                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0257             <span class="keyword">case</span> <span class="string">'formula'</span>
0258                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metFormulas'</span>, tline_value, pos);
0259                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0260             <span class="keyword">case</span> <span class="string">'charge'</span>
0261                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metCharges'</span>, tline_value, pos);
0262                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0263             <span class="keyword">case</span> <span class="string">'notes'</span>
0264                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metNotes'</span>, tline_value, pos);
0265                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0266             <span class="keyword">case</span> <span class="string">'inchis'</span>
0267                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'inchis'</span>, tline_value, pos);
0268                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0269             <span class="keyword">case</span> <span class="string">'smiles'</span>
0270                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metSmiles'</span>, tline_value, pos);
0271                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;    
0272             <span class="keyword">case</span> <span class="string">'deltaG'</span>
0273                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metDeltaG'</span>, tline_value, pos);
0274                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;                                
0275             <span class="keyword">case</span> <span class="string">'metFrom'</span>
0276                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'metFrom'</span>, tline_value, pos);
0277                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0278             <span class="keyword">case</span> <span class="string">'annotation'</span>
0279                 readList = <span class="string">'annotation'</span>;
0280             <span class="keyword">otherwise</span>
0281                 <span class="keyword">switch</span> readList
0282                     <span class="keyword">case</span> <span class="string">'annotation'</span>
0283                         [metMiriams, miriamKey, metMirNo] = <a href="#_sub3" class="code" title="subfunction [miriams,miriamKey,entryNumber] = gatherAnnotation(pos,miriams,key,value,miriamKey,entryNumber)">gatherAnnotation</a>(pos,metMiriams,tline_key,tline_value,miriamKey,metMirNo);
0284                     <span class="keyword">otherwise</span>
0285                         error([<span class="string">'Unknown entry in yaml file: '</span> tline_raw])
0286                 <span class="keyword">end</span>
0287         <span class="keyword">end</span>; <span class="keyword">continue</span>
0288     <span class="keyword">end</span>
0289 
0290     <span class="comment">% import reactions:</span>
0291     <span class="keyword">if</span> section == 3
0292         <span class="keyword">switch</span> tline_key
0293             <span class="keyword">case</span> <span class="string">'id'</span>
0294                 pos = pos + 1;
0295                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxns'</span>, tline_value,pos);
0296                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0297             <span class="keyword">case</span> <span class="string">'name'</span>
0298                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxnNames'</span>, tline_value, pos);
0299                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0300             <span class="keyword">case</span> <span class="string">'lower_bound'</span>
0301                 model.lb(pos,1) = {tline_value};
0302                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0303             <span class="keyword">case</span> <span class="string">'upper_bound'</span>
0304                 model.ub(pos,1) = {tline_value};
0305                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0306             <span class="keyword">case</span> <span class="string">'rev'</span>
0307                 model.rev(pos,1) = {tline_value};
0308                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0309             <span class="keyword">case</span> <span class="string">'gene_reaction_rule'</span>
0310                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'grRules'</span>, tline_value, pos);
0311                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0312             <span class="keyword">case</span> <span class="string">'rxnNotes'</span>
0313                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxnNotes'</span>, tline_value, pos);
0314                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0315             <span class="keyword">case</span> <span class="string">'rxnFrom'</span>
0316                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxnFrom'</span>, tline_value, pos);
0317                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0318             <span class="keyword">case</span> <span class="string">'deltaG'</span>
0319                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxnDeltaG'</span>, tline_value, pos);
0320                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;                
0321             <span class="keyword">case</span> <span class="string">'objective_coefficient'</span>
0322                 model.c(pos,1) = 1;
0323                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0324             <span class="keyword">case</span> <span class="string">'references'</span>
0325                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxnReferences'</span>, tline_value, pos);
0326                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0327             <span class="keyword">case</span> <span class="string">'confidence_score'</span>
0328                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'rxnConfidenceScores'</span>, tline_value, pos);
0329                 readList=<span class="string">''</span>; miriamKey=<span class="string">''</span>;
0330             <span class="keyword">case</span> <span class="string">'eccodes'</span>
0331                 <span class="keyword">if</span> isempty(tline_value)
0332                     readList = <span class="string">'eccodes'</span>;
0333                 <span class="keyword">else</span>
0334                     eccodes(ecCodeNo,1:2)={pos,tline_value};
0335                     ecCodeNo=ecCodeNo+1;
0336                 <span class="keyword">end</span>
0337             <span class="keyword">case</span> <span class="string">'subsystem'</span>
0338                 <span class="keyword">if</span> isempty(tline_value)
0339                     readList = <span class="string">'subsystem'</span>;
0340                 <span class="keyword">else</span>
0341                     subSystems(subSysNo,1:2)={pos,tline_value};
0342                     subSysNo=subSysNo+1;
0343                 <span class="keyword">end</span>
0344             <span class="keyword">case</span> <span class="string">'metabolites'</span>
0345                 readList = <span class="string">'equation'</span>;
0346             <span class="keyword">case</span> <span class="string">'annotation'</span>
0347                 readList = <span class="string">'annotation'</span>;
0348                 
0349             <span class="keyword">otherwise</span>
0350                 <span class="keyword">switch</span> readList
0351                     <span class="keyword">case</span> <span class="string">'eccodes'</span>
0352                         eccodes(ecCodeNo,1:2)={pos,regexprep(tline_value,<span class="string">'^ +- &quot;?(.*)&quot;?$'</span>,<span class="string">'$1'</span>)};
0353                         ecCodeNo=ecCodeNo+1;
0354                     <span class="keyword">case</span> <span class="string">'subsystem'</span>
0355                         subSystems(subSysNo,1:2)={pos,regexprep(tline_value,<span class="string">'^ +- &quot;?(.*)&quot;?$'</span>,<span class="string">'$1'</span>)};
0356                         subSysNo=subSysNo+1;
0357                     <span class="keyword">case</span> <span class="string">'annotation'</span>
0358                         [rxnMiriams, miriamKey,rxnMirNo] = <a href="#_sub3" class="code" title="subfunction [miriams,miriamKey,entryNumber] = gatherAnnotation(pos,miriams,key,value,miriamKey,entryNumber)">gatherAnnotation</a>(pos,rxnMiriams,tline_key,tline_value,miriamKey,rxnMirNo);
0359                     <span class="keyword">case</span> <span class="string">'equation'</span>
0360                         coeff = sscanf(tline_value,<span class="string">'%f'</span>);
0361                         equations(equatiNo,1:3)={pos,tline_key,coeff};
0362                         equatiNo=equatiNo+1;
0363                     <span class="keyword">otherwise</span>
0364                         error([<span class="string">'Unknown entry in yaml file: '</span> tline_raw])
0365                 <span class="keyword">end</span>                
0366         <span class="keyword">end</span>; <span class="keyword">continue</span>
0367     <span class="keyword">end</span>
0368 
0369     <span class="comment">% import genes:</span>
0370     <span class="keyword">if</span> section == 4
0371         <span class="keyword">switch</span> tline_key
0372             <span class="keyword">case</span> <span class="string">'id'</span>
0373                 pos = pos + 1;
0374                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'genes'</span>, tline_value, pos);
0375                 readList = <span class="string">''</span>;
0376                 miriamKey = <span class="string">''</span>;
0377             <span class="keyword">case</span> <span class="string">'name'</span>
0378                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'geneShortNames'</span>, tline_value, pos);
0379             <span class="keyword">case</span> <span class="string">'protein'</span>
0380                 model = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model, <span class="string">'proteins'</span>, tline_value, pos);
0381             <span class="keyword">case</span> <span class="string">'annotation'</span>
0382                 readList = <span class="string">'annotation'</span>;
0383             <span class="keyword">otherwise</span>
0384                 <span class="keyword">switch</span> readList
0385                     <span class="keyword">case</span> <span class="string">'annotation'</span>
0386                         [geneMiriams, miriamKey,genMirNo] = <a href="#_sub3" class="code" title="subfunction [miriams,miriamKey,entryNumber] = gatherAnnotation(pos,miriams,key,value,miriamKey,entryNumber)">gatherAnnotation</a>(pos,geneMiriams,tline_key,tline_value,miriamKey,genMirNo);
0387                     <span class="keyword">otherwise</span>
0388                         error([<span class="string">'Unknown entry in yaml file: '</span> tline_raw])
0389                 <span class="keyword">end</span>
0390         <span class="keyword">end</span>; <span class="keyword">continue</span>
0391     <span class="keyword">end</span>
0392 
0393     <span class="comment">% import compartments:</span>
0394     <span class="keyword">if</span> section == 5
0395         model.comps(end+1,1) = {tline_key};
0396         model.compNames(end+1,1) = {tline_value};
0397     <span class="keyword">end</span>
0398 
0399     <span class="comment">% import ec reaction info</span>
0400     <span class="keyword">if</span> section == 6
0401         <span class="keyword">switch</span> tline_key
0402             <span class="keyword">case</span> <span class="string">'id'</span>
0403                 pos = pos + 1;
0404                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'rxns'</span>, tline_value, pos);
0405                 readList=<span class="string">''</span>;
0406             <span class="keyword">case</span> <span class="string">'kcat'</span>
0407                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'kcat'</span>, tline_value, pos);
0408                 readList=<span class="string">''</span>;
0409             <span class="keyword">case</span> <span class="string">'source'</span>
0410                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'source'</span>, tline_value, pos);
0411                 readList=<span class="string">''</span>;
0412             <span class="keyword">case</span> <span class="string">'notes'</span>
0413                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'notes'</span>, tline_value, pos);
0414                 readList=<span class="string">''</span>;
0415             <span class="keyword">case</span> <span class="string">'eccodes'</span>
0416                 <span class="keyword">if</span> isempty(tline_value)
0417                     readList = <span class="string">'eccodes'</span>;
0418                 <span class="keyword">else</span>
0419                     ecGecko(ecGeckoNo,1:2)={pos,tline_value};
0420                     ecGeckoNo=ecGeckoNo+1;
0421                 <span class="keyword">end</span>
0422             <span class="keyword">case</span> <span class="string">'enzymes'</span>
0423                 readList = <span class="string">'enzStoich'</span>;
0424             <span class="keyword">otherwise</span>
0425                 <span class="keyword">switch</span> readList
0426                     <span class="keyword">case</span> <span class="string">'eccodes'</span>
0427                         ecGecko(ecGeckoNo,1:2)={pos,regexprep(tline_value,<span class="string">'^ +- &quot;?(.*)&quot;?$'</span>,<span class="string">'$1'</span>)};
0428                         ecGeckoNo=ecGeckoNo+1;
0429                     <span class="keyword">case</span> <span class="string">'enzStoich'</span>
0430                         coeff = sscanf(tline_value,<span class="string">'%f'</span>);
0431                         enzStoich(enzStoichNo,1:3)={pos,tline_key,coeff};
0432                         enzStoichNo=enzStoichNo+1;
0433                     <span class="keyword">otherwise</span>
0434                         error([<span class="string">'Unknown entry in yaml file: '</span> tline_raw])
0435                 <span class="keyword">end</span>
0436         <span class="keyword">end</span>; <span class="keyword">continue</span>
0437     <span class="keyword">end</span>
0438 
0439     <span class="comment">% import ec enzyme info</span>
0440     <span class="keyword">if</span> section == 7
0441         <span class="keyword">switch</span> tline_key
0442             <span class="keyword">case</span> <span class="string">'genes'</span>
0443                 pos = pos + 1;
0444                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'genes'</span>, tline_value, pos);
0445             <span class="keyword">case</span> <span class="string">'enzymes'</span>
0446                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'enzymes'</span>, tline_value, pos);
0447             <span class="keyword">case</span> <span class="string">'mw'</span>
0448                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'mw'</span>, tline_value, pos);
0449             <span class="keyword">case</span> <span class="string">'sequence'</span>
0450                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'sequence'</span>, tline_value, pos);
0451             <span class="keyword">case</span> <span class="string">'concs'</span>
0452                 model.ec = <a href="#_sub2" class="code" title="subfunction model = readFieldValue(model, fieldName, value, pos)">readFieldValue</a>(model.ec, <span class="string">'concs'</span>, tline_value, pos);
0453             <span class="keyword">otherwise</span>
0454                 error([<span class="string">'Unknown entry in yaml file: '</span> tline_raw])
0455         <span class="keyword">end</span>; <span class="keyword">continue</span>
0456     <span class="keyword">end</span>
0457 <span class="keyword">end</span>
0458 
0459 <span class="comment">%Parse annotations</span>
0460 <span class="keyword">if</span> ~isempty(metMiriams)
0461     locs = cell2mat(metMiriams(:,1));
0462     <span class="keyword">for</span> i=unique(locs)'
0463         model.metMiriams{i,1}.name=metMiriams(locs==i,2);
0464         model.metMiriams{i,1}.value=metMiriams(locs==i,3);
0465     <span class="keyword">end</span>
0466 <span class="keyword">end</span>
0467 <span class="keyword">if</span> ~isempty(rxnMiriams)
0468     locs = cell2mat(rxnMiriams(:,1));
0469     <span class="keyword">for</span> i=unique(locs)'
0470         model.rxnMiriams{i,1}.name=rxnMiriams(locs==i,2);
0471         model.rxnMiriams{i,1}.value=rxnMiriams(locs==i,3);
0472     <span class="keyword">end</span>
0473 <span class="keyword">end</span>
0474 <span class="keyword">if</span> ~isempty(geneMiriams)
0475     locs = cell2mat(geneMiriams(:,1));
0476     <span class="keyword">for</span> i=unique(locs)'
0477         model.geneMiriams{i,1}.name=geneMiriams(locs==i,2);
0478         model.geneMiriams{i,1}.value=geneMiriams(locs==i,3);
0479     <span class="keyword">end</span>
0480 <span class="keyword">end</span>
0481 
0482 <span class="comment">%Parse subSystems</span>
0483 <span class="keyword">if</span> ~isempty(subSystems)
0484     locs = cell2mat(subSystems(:,1));
0485     <span class="keyword">for</span> i=unique(locs)'
0486         model.subSystems{i,1}=subSystems(locs==i,2);
0487     <span class="keyword">end</span>
0488 <span class="keyword">end</span>
0489 
0490 <span class="comment">%Parse ec-codes</span>
0491 <span class="keyword">if</span> ~isempty(eccodes)
0492     locs = cell2mat(eccodes(:,1));
0493     <span class="keyword">for</span> i=unique(locs)'
0494         eccodesCat=strjoin(eccodes(locs==i,2),<span class="string">';'</span>);
0495         model.eccodes{i,1}=eccodesCat;
0496     <span class="keyword">end</span>
0497     emptyEc=cellfun(<span class="string">'isempty'</span>,model.eccodes);
0498     model.eccodes(emptyEc)={<span class="string">''</span>};
0499 <span class="keyword">end</span>
0500 
0501 <span class="comment">% follow-up data processing</span>
0502 <span class="keyword">if</span> verbose
0503     fprintf(<span class="string">'\nimporting completed\nfollow-up processing...'</span>);
0504 <span class="keyword">end</span>
0505 [~, model.metComps] = ismember(model.metComps, model.comps);
0506 [~, model.geneComps] = ismember(model.geneComps, model.comps);
0507 [~, model.rxnComps] = ismember(model.rxnComps, model.comps);
0508 
0509 <span class="comment">% Fill S-matrix</span>
0510 rxnIdx = cellfun(<span class="string">'isempty'</span>, equations(:,1));
0511 equations(rxnIdx,:) = <span class="string">''</span>;
0512 rxnIdx = cell2mat(equations(:,1));
0513 [~,metIdx] = ismember(equations(:,2),model.mets);
0514 coeffs = cell2mat(equations(:,3));
0515 model.S=sparse(max(metIdx),max(rxnIdx));
0516 linearIndices = sub2ind([max(metIdx), max(rxnIdx)],metIdx,rxnIdx);
0517 model.S(linearIndices) = coeffs;
0518 
0519 <span class="comment">% Convert strings to numeric</span>
0520 model.metCharges = str2double(model.metCharges);
0521 model.lb = str2double(model.lb);
0522 model.ub = str2double(model.ub);
0523 model.rxnConfidenceScores = str2double(model.rxnConfidenceScores);
0524 model.b = zeros(length(model.mets),1);
0525 model.metDeltaG = str2double(model.metDeltaG);
0526 model.rxnDeltaG = str2double(model.rxnDeltaG);
0527 
0528 <span class="comment">% Fill some other fields</span>
0529 model.annotation.defaultLB = min(model.lb);
0530 model.annotation.defaultUB = max(model.ub);
0531 <span class="keyword">if</span> numel(model.lb)&lt;numel(model.rxns) <span class="comment">%No LB reported = min</span>
0532     model.lb(end+1:numel(model.rxns)-numel(model.lb),1) = double(model.annotation.defaultLB);
0533 <span class="keyword">end</span>
0534 <span class="keyword">if</span> numel(model.ub)&lt;numel(model.rxns) <span class="comment">%No UB reported = max</span>
0535     model.ub(end+1:numel(model.rxns)-numel(model.ub),1) = double(model.annotation.defaultUB);
0536 <span class="keyword">end</span>
0537 <span class="keyword">if</span> ~all(cellfun(<span class="string">'isempty'</span>,model.rev))
0538     model.rev = str2double(model.rev);
0539 <span class="keyword">else</span>
0540     model.rev = [];
0541 <span class="keyword">end</span>
0542 <span class="keyword">if</span> numel(model.rev)&lt;numel(model.rxns) <span class="comment">%No rev reported, assume from LB and UB</span>
0543     model.rev(end+1:numel(model.rxns)-numel(model.rev),1) = double(model.lb&lt;0 &amp; model.ub&gt;0);
0544 <span class="keyword">end</span>
0545 
0546 <span class="comment">% Remove empty fields, otherwise fill to correct length</span>
0547 <span class="comment">% Reactions</span>
0548 <span class="keyword">for</span> i={<span class="string">'rxnNames'</span>,<span class="string">'grRules'</span>,<span class="string">'eccodes'</span>,<span class="string">'rxnNotes'</span>,<span class="string">'rxnReferences'</span>,<span class="keyword">...</span>
0549        <span class="string">'rxnFrom'</span>,<span class="string">'subSystems'</span>,<span class="string">'rxnMiriams'</span>} <span class="comment">% Empty strings</span>
0550    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},{<span class="string">''</span>},<span class="string">'rxns'</span>);
0551 <span class="keyword">end</span>
0552 <span class="keyword">for</span> i={<span class="string">'c'</span>} <span class="comment">% Zeros</span>
0553    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},0,<span class="string">'rxns'</span>,true);
0554 <span class="keyword">end</span>
0555 <span class="keyword">for</span> i={<span class="string">'rxnConfidenceScores'</span>,<span class="string">'rxnDeltaG'</span>} <span class="comment">% NaNs</span>
0556    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},NaN,<span class="string">'rxns'</span>);
0557 <span class="keyword">end</span>
0558 <span class="keyword">for</span> i={<span class="string">'rxnComps'</span>} <span class="comment">% Ones, assume first compartment</span>
0559    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},1,<span class="string">'rxns'</span>);
0560 <span class="keyword">end</span>
0561 <span class="comment">% Metabolites</span>
0562 <span class="keyword">for</span> i={<span class="string">'metNames'</span>,<span class="string">'inchis'</span>,<span class="string">'metFormulas'</span>,<span class="string">'metMiriams'</span>,<span class="string">'metFrom'</span>,<span class="string">'metSmiles'</span>,<span class="string">'metNotes'</span>} <span class="comment">% Empty strings</span>
0563    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},{<span class="string">''</span>},<span class="string">'mets'</span>);
0564 <span class="keyword">end</span>
0565 <span class="keyword">for</span> i={<span class="string">'metCharges'</span>,<span class="string">'unconstrained'</span>} <span class="comment">% Zeros</span>
0566    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},0,<span class="string">'mets'</span>);
0567 <span class="keyword">end</span>
0568 <span class="keyword">for</span> i={<span class="string">'metDeltaG'</span>} <span class="comment">% % NaNs</span>
0569     model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},NaN,<span class="string">'mets'</span>);
0570  <span class="keyword">end</span>
0571 <span class="keyword">for</span> i={<span class="string">'metComps'</span>} <span class="comment">% Ones, assume first compartment</span>
0572    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},1,<span class="string">'mets'</span>);
0573 <span class="keyword">end</span>
0574 <span class="comment">% Genes</span>
0575 <span class="keyword">for</span> i={<span class="string">'geneMiriams'</span>,<span class="string">'geneShortNames'</span>,<span class="string">'proteins'</span>} <span class="comment">% Empty strings</span>
0576    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},{<span class="string">''</span>},<span class="string">'genes'</span>);
0577 <span class="keyword">end</span>
0578 <span class="keyword">for</span> i={<span class="string">'geneComps'</span>} <span class="comment">% Ones, assume first compartment</span>
0579    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},1,<span class="string">'genes'</span>);
0580 <span class="keyword">end</span>
0581 <span class="comment">% Comps</span>
0582 <span class="keyword">for</span> i={<span class="string">'compNames'</span>} <span class="comment">% Empty strings</span>
0583    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},{<span class="string">''</span>},<span class="string">'comps'</span>);
0584 <span class="keyword">end</span>
0585 <span class="keyword">for</span> i={<span class="string">'compOutside'</span>} <span class="comment">% First comp</span>
0586    model = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model,i{1},model.comps{1},<span class="string">'comps'</span>);
0587 <span class="keyword">end</span>
0588 <span class="comment">% Single fields are kept, even if empty</span>
0589 <span class="comment">% for i={'description','name','version','date','annotation'}</span>
0590 <span class="comment">%     if isempty(model.(i{1}))</span>
0591 <span class="comment">%         model = rmfield(model,i{1});</span>
0592 <span class="comment">%     end</span>
0593 <span class="comment">% end</span>
0594 
0595 <span class="comment">% Make rxnGeneMat fields and map to the existing model.genes field</span>
0596 [genes, rxnGeneMat] = getGenesFromGrRules(model.grRules);
0597 model.rxnGeneMat = sparse(numel(model.rxns),numel(model.genes));
0598 [~,geneOrder] = ismember(genes,model.genes);
0599 <span class="keyword">if</span> any(geneOrder == 0)
0600     error([<span class="string">'The grRules includes the following gene(s), that are not in '</span><span class="keyword">...</span>
0601            <span class="string">'the list of model genes: '</span>, genes{~geneOrder}])
0602 <span class="keyword">end</span>
0603 model.rxnGeneMat(:,geneOrder) = rxnGeneMat;
0604 
0605 <span class="comment">% Finalize GECKO model</span>
0606 <span class="keyword">if</span> isGECKO
0607     <span class="comment">% Fill in empty fields and empty entries</span>
0608     <span class="keyword">for</span> i={<span class="string">'kcat'</span>,<span class="string">'source'</span>,<span class="string">'notes'</span>,<span class="string">'eccodes'</span>} <span class="comment">% Even keep empty</span>
0609         model.ec = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model.ec,i{1},{<span class="string">''</span>},<span class="string">'rxns'</span>,true);
0610     <span class="keyword">end</span>
0611     <span class="keyword">for</span> i={<span class="string">'enzymes'</span>,<span class="string">'mw'</span>,<span class="string">'sequence'</span>}
0612         model.ec = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model.ec,i{1},{<span class="string">''</span>},<span class="string">'genes'</span>,true);
0613     <span class="keyword">end</span>
0614     model.ec = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model.ec,<span class="string">'concs'</span>,{<span class="string">'NaN'</span>},<span class="string">'genes'</span>,true);
0615     model.ec = <a href="#_sub1" class="code" title="subfunction model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)">emptyOrFill</a>(model.ec,<span class="string">'kcat'</span>,{<span class="string">'0'</span>},<span class="string">'genes'</span>,true);
0616     <span class="comment">% Change string to double</span>
0617     <span class="keyword">for</span> i={<span class="string">'kcat'</span>,<span class="string">'mw'</span>,<span class="string">'concs'</span>}
0618         <span class="keyword">if</span> isfield(model.ec,i{1})
0619             model.ec.(i{1}) = str2double(model.ec.(i{1}));
0620         <span class="keyword">end</span>
0621     <span class="keyword">end</span>
0622     <span class="comment">% Fill rxnEnzMat</span>
0623     rxnIdx              = cellfun(<span class="string">'isempty'</span>, enzStoich(:,1));
0624     enzStoich(rxnIdx,:) = <span class="string">''</span>;
0625     rxnIdx              = cell2mat(enzStoich(:,1));
0626     [~,enzIdx]          = ismember(enzStoich(:,2),model.ec.enzymes);
0627     coeffs              = cell2mat(enzStoich(:,3));
0628     model.ec.rxnEnzMat  = zeros(numel(model.ec.rxns), numel(model.ec.genes));
0629     linearIndices       = sub2ind([numel(model.ec.rxns), numel(model.ec.genes)], rxnIdx, enzIdx);
0630     model.ec.rxnEnzMat(linearIndices) = coeffs;
0631     <span class="comment">%Parse ec-codes</span>
0632     <span class="keyword">if</span> ~isempty(ecGecko)
0633         locs = cell2mat(ecGecko(:,1));
0634         <span class="keyword">for</span> i=unique(locs)'
0635             ecGeckoCat=strjoin(ecGecko(locs==i,2),<span class="string">';'</span>);
0636             model.ec.eccodes{i,1}=ecGeckoCat;
0637         <span class="keyword">end</span>
0638         emptyEc=cellfun(<span class="string">'isempty'</span>,model.ec.eccodes);
0639         model.ec.eccodes(emptyEc)={<span class="string">''</span>};
0640     <span class="keyword">end</span>
0641 <span class="keyword">end</span>
0642 
0643 <span class="keyword">if</span> verbose
0644     fprintf(<span class="string">' Done!\n'</span>);
0645 <span class="keyword">end</span>
0646 <span class="keyword">end</span>
0647 
0648 <a name="_sub1" href="#_subfunctions" class="code">function model = emptyOrFill(model,field,emptyEntry,type,keepEmpty)</a>
0649 <span class="keyword">if</span> nargin&lt;5
0650     keepEmpty=false;
0651 <span class="keyword">end</span>
0652 <span class="keyword">if</span> isnumeric(emptyEntry)
0653     emptyCells=isempty(model.(field));
0654 <span class="keyword">else</span>
0655     emptyCells=cellfun(<span class="string">'isempty'</span>,model.(field));
0656 <span class="keyword">end</span>
0657 <span class="keyword">if</span> all(emptyCells) &amp;&amp; ~keepEmpty
0658     model = rmfield(model, field);
0659 <span class="keyword">elseif</span> numel(model.(field))&lt;numel(model.(type))
0660     model.(field)(end+1:numel(model.(type)),1)=emptyEntry;
0661 <span class="keyword">end</span>
0662 <span class="keyword">end</span>
0663 
0664 <a name="_sub2" href="#_subfunctions" class="code">function model = readFieldValue(model, fieldName, value, pos)</a>
0665 <span class="keyword">if</span> numel(model.(fieldName))&lt;pos-1
0666     model.(fieldName)(end+1:pos,1) = {<span class="string">''</span>};
0667 <span class="keyword">end</span>
0668 model.(fieldName)(pos,1) = {value};
0669 <span class="keyword">end</span>
0670 
0671 <a name="_sub3" href="#_subfunctions" class="code">function [miriams,miriamKey,entryNumber] = gatherAnnotation(pos,miriams,key,value,miriamKey,entryNumber)</a>
0672 <span class="keyword">if</span> isempty(key)
0673     key=miriamKey;
0674 <span class="keyword">else</span>
0675     miriamKey=key;
0676 <span class="keyword">end</span>
0677 <span class="keyword">if</span> ~isempty(value)
0678     miriams(entryNumber,1:3) = {pos, key, strip(value)};
0679     entryNumber = entryNumber + 1;
0680 <span class="keyword">end</span>
0681 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
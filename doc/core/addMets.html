<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of addMets</title>
  <meta name="keywords" content="addMets">
  <meta name="description" content="addMets">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">core</a> &gt; addMets.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for core&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>addMets
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>addMets</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function newModel=addMets(model,metsToAdd,copyInfo,prefix) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> addMets
   Adds metabolites to a model

 Input:
   model       a model structure
   metsToAdd   the metabolite structure can have the following fields:
       mets            cell array with unique strings that identifies each
                       metabolite (optional, default IDs of new
                       metabolites are numbered with the prefix defined
                       below)
       metNames        cell array with the names of each metabolite
       compartments    cell array with the compartment of each
                       metabolite. Should match model.comps. If this is a
                       string rather than a cell array it is assumed that
                       all mets are in that compartment
       b               Nx1 or Nx2 matrix with equality constraints for
                       each metabolite (optional, default 0)
       unconstrained   vector describing if each metabolite is an exchange
                       metabolite (1) or not (0) (optional, default 0)
       inchis          cell array with InChI strings (optional, default '')
       metSmiles       cell array with SMILES strings (optional, default '')
       metFormulas     cell array with the formulas  (optional, default '')
       metMiriams      cell array with MIRIAM structures (optional, default [])
       metCharges      metabolite charge (optional, default NaN)
       metDeltaG       Gibbs free energy of formation at biochemical
                       standard condition in kJ/mole (optional, default NaN)
       metNotes        cell array with metabolite notes as strings
                       (optional, default '')
   copyInfo    when adding metabolites to a compartment where it
               previously did not exist, the function will copy any
               available annotation from the metabolite in another
               compartment (optional, default true)
   prefix      when metsToAdd.mets is not specified, new metabolite IDs
               are generated with the prefix specified here. If IDs with
               the prefix are already used in the model then the
               numbering will start from the highest existing integer+1
               (optional, default 'm_')

 Output:
   newModel     an updated model structure

 This function does not make extensive checks about MIRIAM formats,
 forbidden characters or such.

 If multiple metabolites are added at once, the metMiriams cell array
 should be defined as (example with ChEBI and KEGG):

 metsToAdd.metMiriams{1} = struct('name',{{'chebi';'kegg.compound'}},...
     'value',{{'CHEBI:18072';'C11821'}});
 metsToAdd.metMiriams{2} = struct('name',{{'chebi';'kegg.compound'}},...
     'value',{{'CHEBI:31132';'C12248'}});

 Usage: newModel = addMets(model, metsToAdd, copyInfo, prefix)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>	convertCharArray</li><li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="generateNewIds.html" class="code" title="function newIds=generateNewIds(model,type,prefix,quantity,numLength)">generateNewIds</a>	generateNewIds</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addRxns.html" class="code" title="function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets,allowNewGenes)">addRxns</a>	addRxns</li><li><a href="addRxnsGenesMets.html" class="code" title="function model=addRxnsGenesMets(model,sourceModel,rxns,addGene,rxnNote,confidence)">addRxnsGenesMets</a>	addRxnsGenesMets</li><li><a href="addTransport.html" class="code" title="function [model, addedRxns]=addTransport(model,fromComp,toComps,metNames,isRev,onlyToExisting,prefix)">addTransport</a>	addTransport</li><li><a href="fitTasks.html" class="code" title="function [outModel, addedRxns]=fitTasks(model,refModel,inputFile,printOutput,rxnScores,taskStructure,params)">fitTasks</a>	fitTasks</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newModel=addMets(model,metsToAdd,copyInfo,prefix)</a>
0002 <span class="comment">% addMets</span>
0003 <span class="comment">%   Adds metabolites to a model</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%   model       a model structure</span>
0007 <span class="comment">%   metsToAdd   the metabolite structure can have the following fields:</span>
0008 <span class="comment">%       mets            cell array with unique strings that identifies each</span>
0009 <span class="comment">%                       metabolite (optional, default IDs of new</span>
0010 <span class="comment">%                       metabolites are numbered with the prefix defined</span>
0011 <span class="comment">%                       below)</span>
0012 <span class="comment">%       metNames        cell array with the names of each metabolite</span>
0013 <span class="comment">%       compartments    cell array with the compartment of each</span>
0014 <span class="comment">%                       metabolite. Should match model.comps. If this is a</span>
0015 <span class="comment">%                       string rather than a cell array it is assumed that</span>
0016 <span class="comment">%                       all mets are in that compartment</span>
0017 <span class="comment">%       b               Nx1 or Nx2 matrix with equality constraints for</span>
0018 <span class="comment">%                       each metabolite (optional, default 0)</span>
0019 <span class="comment">%       unconstrained   vector describing if each metabolite is an exchange</span>
0020 <span class="comment">%                       metabolite (1) or not (0) (optional, default 0)</span>
0021 <span class="comment">%       inchis          cell array with InChI strings (optional, default '')</span>
0022 <span class="comment">%       metSmiles       cell array with SMILES strings (optional, default '')</span>
0023 <span class="comment">%       metFormulas     cell array with the formulas  (optional, default '')</span>
0024 <span class="comment">%       metMiriams      cell array with MIRIAM structures (optional, default [])</span>
0025 <span class="comment">%       metCharges      metabolite charge (optional, default NaN)</span>
0026 <span class="comment">%       metDeltaG       Gibbs free energy of formation at biochemical</span>
0027 <span class="comment">%                       standard condition in kJ/mole (optional, default NaN)</span>
0028 <span class="comment">%       metNotes        cell array with metabolite notes as strings</span>
0029 <span class="comment">%                       (optional, default '')</span>
0030 <span class="comment">%   copyInfo    when adding metabolites to a compartment where it</span>
0031 <span class="comment">%               previously did not exist, the function will copy any</span>
0032 <span class="comment">%               available annotation from the metabolite in another</span>
0033 <span class="comment">%               compartment (optional, default true)</span>
0034 <span class="comment">%   prefix      when metsToAdd.mets is not specified, new metabolite IDs</span>
0035 <span class="comment">%               are generated with the prefix specified here. If IDs with</span>
0036 <span class="comment">%               the prefix are already used in the model then the</span>
0037 <span class="comment">%               numbering will start from the highest existing integer+1</span>
0038 <span class="comment">%               (optional, default 'm_')</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% Output:</span>
0041 <span class="comment">%   newModel     an updated model structure</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% This function does not make extensive checks about MIRIAM formats,</span>
0044 <span class="comment">% forbidden characters or such.</span>
0045 <span class="comment">%</span>
0046 <span class="comment">% If multiple metabolites are added at once, the metMiriams cell array</span>
0047 <span class="comment">% should be defined as (example with ChEBI and KEGG):</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% metsToAdd.metMiriams{1} = struct('name',{{'chebi';'kegg.compound'}},...</span>
0050 <span class="comment">%     'value',{{'CHEBI:18072';'C11821'}});</span>
0051 <span class="comment">% metsToAdd.metMiriams{2} = struct('name',{{'chebi';'kegg.compound'}},...</span>
0052 <span class="comment">%     'value',{{'CHEBI:31132';'C12248'}});</span>
0053 <span class="comment">%</span>
0054 <span class="comment">% Usage: newModel = addMets(model, metsToAdd, copyInfo, prefix)</span>
0055 
0056 <span class="keyword">if</span> nargin&lt;3
0057     copyInfo=true;
0058 <span class="keyword">end</span>
0059 <span class="keyword">if</span> nargin&lt;4
0060     prefix=<span class="string">'m_'</span>;
0061 <span class="keyword">else</span>
0062     prefix=char(prefix);
0063 <span class="keyword">end</span>
0064 
0065 newModel=model;
0066 
0067 <span class="keyword">if</span> isempty(metsToAdd)
0068     <span class="keyword">return</span>;
0069 <span class="keyword">end</span>
0070 
0071 <span class="comment">%Check some stuff regarding the required fields</span>
0072 <span class="keyword">if</span> ~isfield(metsToAdd,<span class="string">'mets'</span>)
0073     metsToAdd.mets=<a href="generateNewIds.html" class="code" title="function newIds=generateNewIds(model,type,prefix,quantity,numLength)">generateNewIds</a>(newModel,<span class="string">'mets'</span>,prefix,numel(metsToAdd.metNames));
0074 <span class="keyword">else</span>
0075     metsToAdd.mets=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.mets);
0076 <span class="keyword">end</span>
0077 <span class="keyword">if</span> ~isfield(metsToAdd,<span class="string">'metNames'</span>)
0078     metsToAdd.metNames=metsToAdd.mets;
0079 <span class="keyword">else</span>
0080     metsToAdd.metNames=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.metNames);
0081 <span class="keyword">end</span>
0082 <span class="keyword">if</span> ~isfield(metsToAdd,<span class="string">'compartments'</span>)
0083     EM=<span class="string">'compartments is a required field in metsToAdd'</span>;
0084     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0085 <span class="keyword">else</span>
0086     metsToAdd.compartments=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.compartments);
0087     <span class="comment">%If only one compartment is given, assume it is for all metabolites</span>
0088     <span class="keyword">if</span> numel(metsToAdd.compartments)==1 &amp;&amp; numel(metsToAdd.mets)&gt;1
0089         temp=cell(numel(metsToAdd.mets),1);
0090         temp(:)=metsToAdd.compartments;
0091         metsToAdd.compartments=temp;
0092     <span class="keyword">end</span>
0093 <span class="keyword">end</span>
0094 
0095 <span class="comment">%Number of metabolites</span>
0096 nMets=numel(metsToAdd.mets);
0097 nOldMets=numel(model.mets);
0098 filler=cell(nMets,1);
0099 filler(:)={<span class="string">''</span>};
0100 largeFiller=cell(nOldMets,1);
0101 largeFiller(:)={<span class="string">''</span>};
0102 
0103 <span class="comment">%Check that no metabolite ids are already present in the model</span>
0104 I=ismember(metsToAdd.mets,model.mets);
0105 <span class="keyword">if</span> any(I)
0106     error(<span class="string">'One or more elements in metsToAdd.mets are already present in model.mets: %s'</span>,<span class="keyword">...</span>
0107         strjoin(metsToAdd.mets(I),<span class="string">', '</span>));
0108 <span class="keyword">else</span>
0109     newModel.mets=[newModel.mets;metsToAdd.mets(:)];
0110 <span class="keyword">end</span>
0111 
0112 <span class="comment">%Check that all the compartments could be found</span>
0113 [I, compMap]=ismember(metsToAdd.compartments,model.comps);
0114 <span class="keyword">if</span> ~all(I)
0115     EM=<span class="string">'metsToAdd.compartments must match model.comps'</span>;
0116     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0117 <span class="keyword">end</span>
0118 
0119 <span class="comment">%Check that the metabolite names aren't present in the same compartment.</span>
0120 <span class="comment">%Not the neatest way maybe..</span>
0121 t1=strcat(metsToAdd.metNames(:),<span class="string">'***'</span>,metsToAdd.compartments(:));
0122 t2=strcat(model.metNames,<span class="string">'***'</span>,model.comps(model.metComps));
0123 <span class="keyword">if</span> any(ismember(t1,t2))
0124     EM=<span class="string">'One or more elements in metsToAdd.metNames already exist in the same compartments as the one it is being added to'</span>;
0125     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0126 <span class="keyword">end</span>
0127 
0128 <span class="comment">%Some more checks and if they pass then add each field to the structure</span>
0129 <span class="keyword">if</span> numel(metsToAdd.metNames)~=nMets
0130     EM=<span class="string">'metsToAdd.metNames must have the same number of elements as metsToAdd.mets'</span>;
0131     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0132 <span class="keyword">else</span>
0133     newModel.metNames=[newModel.metNames;metsToAdd.metNames(:)];
0134 <span class="keyword">end</span>
0135 
0136 <span class="keyword">if</span> numel(compMap)~=nMets
0137     EM=<span class="string">'metsToAdd.compartments must have the same number of elements as metsToAdd.mets'</span>;
0138     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0139 <span class="keyword">else</span>
0140     newModel.metComps=[newModel.metComps;compMap(:)];
0141 <span class="keyword">end</span>
0142 
0143 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'b'</span>)
0144     <span class="keyword">if</span> size(metsToAdd.b,1)~=nMets
0145         EM=<span class="string">'metsToAdd.b must have the same number of elements as metsToAdd.mets'</span>;
0146         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0147     <span class="keyword">else</span>
0148         <span class="comment">%Add empty field if it doesn't exist</span>
0149         <span class="keyword">if</span> ~isfield(newModel,<span class="string">'b'</span>)
0150             newModel.b=zeros(nOldMets,1);
0151         <span class="keyword">end</span>
0152         
0153         <span class="comment">%If the original is only one vector</span>
0154         <span class="keyword">if</span> size(metsToAdd.b,2)&gt;size(newModel.b,2)
0155             newModel.b=[newModel.b newModel.b];
0156         <span class="keyword">end</span>
0157         <span class="comment">%Add the new ones</span>
0158         newModel.b=[newModel.b;metsToAdd.b];
0159     <span class="keyword">end</span>
0160 <span class="keyword">else</span>
0161     <span class="keyword">if</span> isfield(newModel,<span class="string">'b'</span>)
0162         <span class="comment">%Add the default</span>
0163         newModel.b=[newModel.b;zeros(nMets,size(newModel.b,2))];
0164     <span class="keyword">end</span>
0165 <span class="keyword">end</span>
0166 
0167 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'unconstrained'</span>)
0168     <span class="keyword">if</span> numel(metsToAdd.unconstrained)~=nMets
0169         EM=<span class="string">'metsToAdd.unconstrained must have the same number of elements as metsToAdd.mets'</span>;
0170         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0171     <span class="keyword">else</span>
0172         <span class="comment">%Add empty field if it doesn't exist</span>
0173         <span class="keyword">if</span> ~isfield(newModel,<span class="string">'unconstrained'</span>)
0174             newModel.unconstrained=zeros(nOldMets,1);
0175         <span class="keyword">end</span>
0176         
0177         <span class="comment">%Add the new ones</span>
0178         newModel.unconstrained=[newModel.unconstrained;metsToAdd.unconstrained(:)];
0179     <span class="keyword">end</span>
0180 <span class="keyword">else</span>
0181     <span class="keyword">if</span> isfield(newModel,<span class="string">'unconstrained'</span>)
0182         <span class="comment">%Add the default</span>
0183         newModel.unconstrained=[newModel.unconstrained;zeros(nMets,1)];
0184     <span class="keyword">end</span>
0185 <span class="keyword">end</span>
0186 
0187 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'inchis'</span>)
0188     metsToAdd.inchis=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.inchis);
0189     <span class="keyword">if</span> numel(metsToAdd.inchis)~=nMets
0190         EM=<span class="string">'metsToAdd.inchis must have the same number of elements as metsToAdd.mets'</span>;
0191         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0192     <span class="keyword">end</span>
0193     <span class="comment">%Add empty field if it doesn't exist</span>
0194     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'inchis'</span>)
0195         newModel.inchis=largeFiller;
0196     <span class="keyword">end</span>
0197     newModel.inchis=[newModel.inchis;metsToAdd.inchis(:)];
0198 <span class="keyword">else</span>
0199     <span class="comment">%Add empty strings if structure is in model</span>
0200     <span class="keyword">if</span> isfield(newModel,<span class="string">'inchis'</span>)
0201         newModel.inchis=[newModel.inchis;filler];
0202     <span class="keyword">end</span>
0203 <span class="keyword">end</span>
0204 
0205 
0206 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'metSmiles'</span>)
0207     metsToAdd.metSmiles=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.metSmiles);
0208     <span class="keyword">if</span> numel(metsToAdd.metSmiles)~=nMets
0209         EM=<span class="string">'metsToAdd.metSmiles must have the same number of elements as metsToAdd.mets'</span>;
0210         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0211     <span class="keyword">end</span>
0212     <span class="comment">%Add empty field if it doesn't exist</span>
0213     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'metSmiles'</span>)
0214         newModel.metSmiles=largeFiller;
0215     <span class="keyword">end</span>
0216     newModel.metSmiles=[newModel.metSmiles;metsToAdd.metSmiles(:)];
0217 <span class="keyword">else</span>
0218     <span class="comment">%Add empty strings if structure is in model</span>
0219     <span class="keyword">if</span> isfield(newModel,<span class="string">'metSmiles'</span>)
0220         newModel.metSmiles=[newModel.metSmiles;filler];
0221     <span class="keyword">end</span>
0222 <span class="keyword">end</span>
0223 
0224 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'metFormulas'</span>)
0225     metsToAdd.metFormulas=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.metFormulas);
0226     <span class="keyword">if</span> numel(metsToAdd.metFormulas)~=nMets
0227         EM=<span class="string">'metsToAdd.metFormulas must have the same number of elements as metsToAdd.mets'</span>;
0228         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0229     <span class="keyword">end</span>
0230     <span class="comment">%Add empty field if it doesn't exist</span>
0231     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'metFormulas'</span>)
0232         newModel.metFormulas=largeFiller;
0233     <span class="keyword">end</span>
0234     newModel.metFormulas=[newModel.metFormulas;metsToAdd.metFormulas(:)];
0235 <span class="keyword">else</span>
0236     <span class="comment">%Add default</span>
0237     <span class="keyword">if</span> isfield(newModel,<span class="string">'metFormulas'</span>)
0238         newModel.metFormulas=[newModel.metFormulas;filler];
0239     <span class="keyword">end</span>
0240 <span class="keyword">end</span>
0241 
0242 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'metCharges'</span>)
0243     <span class="keyword">if</span> numel(metsToAdd.metCharges)~=nMets
0244         EM=<span class="string">'metsToAdd.metCharges must have the same number of elements as metsToAdd.mets'</span>;
0245         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0246     <span class="keyword">end</span>
0247     <span class="keyword">if</span> ~isnumeric(metsToAdd.metCharges)
0248         EM=<span class="string">'metsToAdd.metCharges must be of type &quot;double&quot;'</span>;
0249         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0250     <span class="keyword">end</span>
0251     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'metCharges'</span>)
0252         newModel.metCharges=NaN(numel(largeFiller),1);
0253     <span class="keyword">end</span>
0254     newModel.metCharges=[newModel.metCharges;metsToAdd.metCharges(:)];
0255 <span class="keyword">else</span>
0256     <span class="comment">%Add default</span>
0257     <span class="keyword">if</span> isfield(newModel,<span class="string">'metCharges'</span>)
0258         newModel.metCharges=[newModel.metCharges;NaN(numel(filler),1)];
0259     <span class="keyword">end</span>
0260 <span class="keyword">end</span>
0261 
0262 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'metDeltaG'</span>)
0263     <span class="keyword">if</span> numel(metsToAdd.metDeltaG)~=nMets
0264         EM=<span class="string">'metsToAdd.metDeltaG must have the same number of elements as metsToAdd.mets'</span>;
0265         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0266     <span class="keyword">end</span>
0267     <span class="keyword">if</span> ~isnumeric(metsToAdd.metDeltaG)
0268         EM=<span class="string">'metsToAdd.metDeltaG must be of type &quot;double&quot;'</span>;
0269         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0270     <span class="keyword">end</span>
0271     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'metDeltaG'</span>)
0272         newModel.metDeltaG=NaN(numel(largeFiller),1);
0273     <span class="keyword">end</span>
0274     newModel.metDeltaG=[newModel.metDeltaG;metsToAdd.metDeltaG(:)];
0275 <span class="keyword">else</span>
0276     <span class="comment">%Add default</span>
0277     <span class="keyword">if</span> isfield(newModel,<span class="string">'metDeltaG'</span>)
0278         newModel.metDeltaG=[newModel.metDeltaG;NaN(numel(filler),1)];
0279     <span class="keyword">end</span>
0280 <span class="keyword">end</span>
0281 
0282 
0283 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'metNotes'</span>)
0284     metsToAdd.metNotes=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(metsToAdd.metNotes);
0285     <span class="keyword">if</span> numel(metsToAdd.metNotes)==1 &amp;&amp; numel(metsToAdd.mets)&gt;1
0286         temp=cell(numel(metsToAdd.mets),1);
0287         temp(:)=metsToAdd.metNotes;
0288         metsToAdd.metNotes=temp;
0289     <span class="keyword">end</span>
0290     <span class="keyword">if</span> numel(metsToAdd.metNotes)~=nMets
0291         EM=<span class="string">'metsToAdd.metNotes must have the same number of elements as metsToAdd.mets'</span>;
0292         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0293     <span class="keyword">end</span>
0294     <span class="comment">%Add empty field if it doesn't exist</span>
0295     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'metNotes'</span>)
0296         newModel.metNotes=largeFiller;
0297     <span class="keyword">end</span>
0298     newModel.metNotes=[newModel.metNotes;metsToAdd.metNotes(:)];
0299 <span class="keyword">else</span>
0300     <span class="comment">%Add empty strings if structure is in model</span>
0301     <span class="keyword">if</span> isfield(newModel,<span class="string">'metNotes'</span>)
0302         newModel.metNotes=[newModel.metNotes;filler];
0303     <span class="keyword">end</span>
0304 <span class="keyword">end</span>
0305 
0306 <span class="comment">%Don't check the type of metMiriams</span>
0307 <span class="keyword">if</span> isfield(metsToAdd,<span class="string">'metMiriams'</span>)
0308     <span class="keyword">if</span> numel(metsToAdd.metMiriams)==1 &amp;&amp; numel(metsToAdd.mets)&gt;1
0309         temp=cell(numel(metsToAdd.mets),1);
0310         temp(:)={metsToAdd.metMiriams};
0311         metsToAdd.metMiriams=temp;
0312     <span class="keyword">end</span>
0313     <span class="keyword">if</span> numel(metsToAdd.metMiriams)~=nMets
0314         EM=<span class="string">'metsToAdd.metMiriams must have the same number of elements as metsToAdd.mets'</span>;
0315         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0316     <span class="keyword">end</span>
0317     <span class="comment">%Add empty field if it doesn't exist</span>
0318     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'metMiriams'</span>)
0319         newModel.metMiriams=cell(nOldMets,1);
0320     <span class="keyword">end</span>
0321     newModel.metMiriams=[newModel.metMiriams;metsToAdd.metMiriams(:)];
0322 <span class="keyword">else</span>
0323     <span class="keyword">if</span> isfield(newModel,<span class="string">'metMiriams'</span>)
0324         newModel.metMiriams=[newModel.metMiriams;cell(nMets,1)];
0325     <span class="keyword">end</span>
0326 <span class="keyword">end</span>
0327 
0328 <span class="keyword">if</span> isfield(newModel,<span class="string">'metFrom'</span>)
0329     newModel.metFrom=[newModel.metFrom;filler];
0330 <span class="keyword">end</span>
0331 
0332 <span class="comment">%Expand the S matrix</span>
0333 newModel.S=[newModel.S;sparse(nMets,size(newModel.S,2))];
0334 
0335 <span class="keyword">if</span> copyInfo==true
0336     [I, J]=ismember(metsToAdd.metNames,model.metNames);
0337     J=J(I);
0338     <span class="comment">%I is the indexes of the new metabolites for which a metabolite with</span>
0339     <span class="comment">%the same name existed</span>
0340     I=find(I)+nOldMets;
0341     <span class="comment">%Go through each of the added mets and copy annotation if it doesn't</span>
0342     <span class="comment">%exist</span>
0343     <span class="keyword">for</span> i=1:numel(I)
0344         <span class="keyword">if</span> isfield(newModel,<span class="string">'inchis'</span>)
0345             <span class="keyword">if</span> isempty(newModel.inchis{I(i)})
0346                 newModel.inchis(I(i))=newModel.inchis(J(i));
0347             <span class="keyword">end</span>
0348         <span class="keyword">end</span>
0349         <span class="keyword">if</span> isfield(newModel,<span class="string">'metSmiles'</span>)
0350             <span class="keyword">if</span> isempty(newModel.metSmiles{I(i)})
0351                 newModel.metSmiles(I(i))=newModel.metSmiles(J(i));
0352             <span class="keyword">end</span>
0353         <span class="keyword">end</span>        
0354         <span class="keyword">if</span> isfield(newModel,<span class="string">'metFormulas'</span>)
0355             <span class="keyword">if</span> isempty(newModel.metFormulas{I(i)})
0356                 newModel.metFormulas(I(i))=newModel.metFormulas(J(i));
0357             <span class="keyword">end</span>
0358         <span class="keyword">end</span>
0359         <span class="keyword">if</span> isfield(newModel,<span class="string">'metMiriams'</span>)
0360             <span class="keyword">if</span> isempty(newModel.metMiriams{I(i)})
0361                 newModel.metMiriams(I(i))=newModel.metMiriams(J(i));
0362             <span class="keyword">end</span>
0363         <span class="keyword">end</span>
0364         <span class="keyword">if</span> isfield(newModel,<span class="string">'metCharges'</span>)
0365             newModel.metCharges(I(i))=newModel.metCharges(J(i));
0366         <span class="keyword">end</span>
0367         <span class="keyword">if</span> isfield(newModel,<span class="string">'metDeltaG'</span>)
0368             newModel.metDeltaG(I(i))=newModel.metDeltaG(J(i));
0369         <span class="keyword">end</span>
0370     <span class="keyword">end</span>
0371 <span class="keyword">end</span>
0372 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of addRxns</title>
  <meta name="keywords" content="addRxns">
  <meta name="description" content="addRxns">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">core</a> &gt; addRxns.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for core&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>addRxns
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>addRxns</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets,allowNewGenes) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> addRxns
   Adds reactions to a model

 Input:
   model            a model structure
   rxnsToAdd        the reaction structure can have the following fields:
       rxns                cell array with unique strings that identifies
                           each reaction
       equations           cell array with equation strings. Decimal
                           coefficients are expressed as &quot;1.2&quot;.
                           Reversibility is indicated by &quot;&lt;=&gt;&quot; or &quot;=&gt;&quot;
       mets                (alternative to equations) cell array with the
                           metabolites involved in each reaction as nested
                           arrays. E.g.: {{'met1','met2'},{'met1','met3','met4'}}
                           In the case of one single reaction added, it
                           can be a string array: {'met1','met2'}
       stoichCoeffs        (alternative to equations) cell array with the
                           corresponding stoichiometries as nested vectors
                           E.g.: {[-1,+2],[-1,-1,+1]}. In the case of one
                           single reaction added, it can be a vector: [-1,+2]
       rxnNames            cell array with the names of each reaction
                           (optional, default '')
       lb                  vector with the lower bounds (optional, default
                           model.annotations.defaultLB or -inf for
                           reversible reactions and 0 for irreversible
                           when &quot;equations&quot; is used. When &quot;mets&quot; and
                           &quot;stoichCoeffs&quot; are ,used it defaults for all
                           to model.annotations.defaultLB or -inf)
       ub                  vector with the upper bounds (optional, default
                           model.annotations.defaultUB or inf)
       c                   vector with the objective function coefficients
                           (optional, default 0)
       eccodes             cell array with the EC-numbers for each
                           reactions. Delimit several EC-numbers with &quot;;&quot;
                           (optional, default '')
       subSystems          cell array with the subsystems for each
                           reaction (optional, default '')
       grRules             cell array with the gene-reaction relationship
                           for each reaction. E.g. &quot;(A and B) or (C)&quot;
                           means that the reaction could be catalyzed by a
                           complex between A &amp; B or by C on its own. All
                           the genes have to be present in model.genes.
                           Add genes with addGenesRaven before calling
                           this function if needed (optional, default '')
       rxnMiriams          cell array with Miriam structures (optional,
                           default [])
       rxnComps            cell array with compartments (as in
                           model.comps) (optional, default {})
       rxnNotes            cell array with reaction notes (optional,
                           default '')
       rxnDeltaG           Gibbs free energy at biochemical standard
                           condition in kJ/mole (optional, default NaN)
       rxnReferences       cell array with reaction references (optional,
                           default '')
       rxnConfidenceScores vector with reaction confidence scores
                           (optional, default NaN)
   eqnType          double describing how the equation string should be
                    interpreted
                    1 - The metabolites are matched to model.mets. New
                        metabolites (if allowed) are added to
                        &quot;compartment&quot; (default)
                    2 - The metabolites are matched to model.metNames and
                        all metabolites are assigned to &quot;compartment&quot;. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are
                        already used in the model then the numbering will
                        start from the highest used integer+1
                    3 - The metabolites are written as
                        &quot;metNames[comps]&quot;. Only compartments in
                        model.comps are allowed. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are
                        already used in the model then the numbering will
                        start from the highest used integer+1
   compartment      a string with the compartment the metabolites should
                    be placed in when using eqnType=2. Must match
                    model.comps (optional when eqnType=1 or eqnType=3)
   allowNewMets     true if the function is allowed to add new
                    metabolites. Can also be a string, which will be used
                    as prefix for the new metabolite IDs. It is highly
                    recommended to first add any new metabolites with
                    addMets rather than automatically through this
                    function. addMets supports more annotation of
                    metabolites, allows for the use of exchange
                    metabolites, and using it reduces the risk of parsing
                    errors (optional, default false)
   allowNewGenes    true if the functions is allowed to add new genes
                    (optional, default false)

 Output:
   newModel         an updated model structure

   This function does not make extensive checks about formatting of
   gene-reaction rules.

   When adding metabolites to a compartment where they previously do not
   the function will copy any available information from the metabolite in
   another compartment.

 Usage: newModel = addRxns(model, rxnsToAdd, eqnType, compartment,...
                       allowNewMets, allowNewGenes)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addGenesRaven.html" class="code" title="function newModel=addGenesRaven(model,genesToAdd)">addGenesRaven</a>	addGenesRaven</li><li><a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>	addMets</li><li><a href="buildEquation.html" class="code" title="function equationString=buildEquation(mets,stoichCoeffs,isrev)">buildEquation</a>	buildEquation</li><li><a href="constructS.html" class="code" title="function [S, mets, badRxns, reversible]=constructS(equations,mets,rxns)">constructS</a>	constructS</li><li><a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>	convertCharArray</li><li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="standardizeGrRules.html" class="code" title="function [grRules,rxnGeneMat,indexes2check] = standardizeGrRules(model,embedded)">standardizeGrRules</a>	standardizeGrRules</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addRxnsGenesMets.html" class="code" title="function model=addRxnsGenesMets(model,sourceModel,rxns,addGene,rxnNote,confidence)">addRxnsGenesMets</a>	addRxnsGenesMets</li><li><a href="changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>	changeRxns</li><li><a href="checkTasks.html" class="code" title="function [taskReport, essentialRxns, taskStructure, essentialFluxes]=checkTasks(model,inputFile,printOutput,printOnlyFailed,getEssential,taskStructure)">checkTasks</a>	checkTasks</li><li><a href="fitTasks.html" class="code" title="function [outModel, addedRxns]=fitTasks(model,refModel,inputFile,printOutput,rxnScores,taskStructure,params)">fitTasks</a>	fitTasks</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets,allowNewGenes)</a>
0002 <span class="comment">% addRxns</span>
0003 <span class="comment">%   Adds reactions to a model</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Input:</span>
0006 <span class="comment">%   model            a model structure</span>
0007 <span class="comment">%   rxnsToAdd        the reaction structure can have the following fields:</span>
0008 <span class="comment">%       rxns                cell array with unique strings that identifies</span>
0009 <span class="comment">%                           each reaction</span>
0010 <span class="comment">%       equations           cell array with equation strings. Decimal</span>
0011 <span class="comment">%                           coefficients are expressed as &quot;1.2&quot;.</span>
0012 <span class="comment">%                           Reversibility is indicated by &quot;&lt;=&gt;&quot; or &quot;=&gt;&quot;</span>
0013 <span class="comment">%       mets                (alternative to equations) cell array with the</span>
0014 <span class="comment">%                           metabolites involved in each reaction as nested</span>
0015 <span class="comment">%                           arrays. E.g.: {{'met1','met2'},{'met1','met3','met4'}}</span>
0016 <span class="comment">%                           In the case of one single reaction added, it</span>
0017 <span class="comment">%                           can be a string array: {'met1','met2'}</span>
0018 <span class="comment">%       stoichCoeffs        (alternative to equations) cell array with the</span>
0019 <span class="comment">%                           corresponding stoichiometries as nested vectors</span>
0020 <span class="comment">%                           E.g.: {[-1,+2],[-1,-1,+1]}. In the case of one</span>
0021 <span class="comment">%                           single reaction added, it can be a vector: [-1,+2]</span>
0022 <span class="comment">%       rxnNames            cell array with the names of each reaction</span>
0023 <span class="comment">%                           (optional, default '')</span>
0024 <span class="comment">%       lb                  vector with the lower bounds (optional, default</span>
0025 <span class="comment">%                           model.annotations.defaultLB or -inf for</span>
0026 <span class="comment">%                           reversible reactions and 0 for irreversible</span>
0027 <span class="comment">%                           when &quot;equations&quot; is used. When &quot;mets&quot; and</span>
0028 <span class="comment">%                           &quot;stoichCoeffs&quot; are ,used it defaults for all</span>
0029 <span class="comment">%                           to model.annotations.defaultLB or -inf)</span>
0030 <span class="comment">%       ub                  vector with the upper bounds (optional, default</span>
0031 <span class="comment">%                           model.annotations.defaultUB or inf)</span>
0032 <span class="comment">%       c                   vector with the objective function coefficients</span>
0033 <span class="comment">%                           (optional, default 0)</span>
0034 <span class="comment">%       eccodes             cell array with the EC-numbers for each</span>
0035 <span class="comment">%                           reactions. Delimit several EC-numbers with &quot;;&quot;</span>
0036 <span class="comment">%                           (optional, default '')</span>
0037 <span class="comment">%       subSystems          cell array with the subsystems for each</span>
0038 <span class="comment">%                           reaction (optional, default '')</span>
0039 <span class="comment">%       grRules             cell array with the gene-reaction relationship</span>
0040 <span class="comment">%                           for each reaction. E.g. &quot;(A and B) or (C)&quot;</span>
0041 <span class="comment">%                           means that the reaction could be catalyzed by a</span>
0042 <span class="comment">%                           complex between A &amp; B or by C on its own. All</span>
0043 <span class="comment">%                           the genes have to be present in model.genes.</span>
0044 <span class="comment">%                           Add genes with addGenesRaven before calling</span>
0045 <span class="comment">%                           this function if needed (optional, default '')</span>
0046 <span class="comment">%       rxnMiriams          cell array with Miriam structures (optional,</span>
0047 <span class="comment">%                           default [])</span>
0048 <span class="comment">%       rxnComps            cell array with compartments (as in</span>
0049 <span class="comment">%                           model.comps) (optional, default {})</span>
0050 <span class="comment">%       rxnNotes            cell array with reaction notes (optional,</span>
0051 <span class="comment">%                           default '')</span>
0052 <span class="comment">%       rxnDeltaG           Gibbs free energy at biochemical standard</span>
0053 <span class="comment">%                           condition in kJ/mole (optional, default NaN)</span>
0054 <span class="comment">%       rxnReferences       cell array with reaction references (optional,</span>
0055 <span class="comment">%                           default '')</span>
0056 <span class="comment">%       rxnConfidenceScores vector with reaction confidence scores</span>
0057 <span class="comment">%                           (optional, default NaN)</span>
0058 <span class="comment">%   eqnType          double describing how the equation string should be</span>
0059 <span class="comment">%                    interpreted</span>
0060 <span class="comment">%                    1 - The metabolites are matched to model.mets. New</span>
0061 <span class="comment">%                        metabolites (if allowed) are added to</span>
0062 <span class="comment">%                        &quot;compartment&quot; (default)</span>
0063 <span class="comment">%                    2 - The metabolites are matched to model.metNames and</span>
0064 <span class="comment">%                        all metabolites are assigned to &quot;compartment&quot;. Any</span>
0065 <span class="comment">%                        new metabolites that are added will be assigned</span>
0066 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0067 <span class="comment">%                        already used in the model then the numbering will</span>
0068 <span class="comment">%                        start from the highest used integer+1</span>
0069 <span class="comment">%                    3 - The metabolites are written as</span>
0070 <span class="comment">%                        &quot;metNames[comps]&quot;. Only compartments in</span>
0071 <span class="comment">%                        model.comps are allowed. Any</span>
0072 <span class="comment">%                        new metabolites that are added will be assigned</span>
0073 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0074 <span class="comment">%                        already used in the model then the numbering will</span>
0075 <span class="comment">%                        start from the highest used integer+1</span>
0076 <span class="comment">%   compartment      a string with the compartment the metabolites should</span>
0077 <span class="comment">%                    be placed in when using eqnType=2. Must match</span>
0078 <span class="comment">%                    model.comps (optional when eqnType=1 or eqnType=3)</span>
0079 <span class="comment">%   allowNewMets     true if the function is allowed to add new</span>
0080 <span class="comment">%                    metabolites. Can also be a string, which will be used</span>
0081 <span class="comment">%                    as prefix for the new metabolite IDs. It is highly</span>
0082 <span class="comment">%                    recommended to first add any new metabolites with</span>
0083 <span class="comment">%                    addMets rather than automatically through this</span>
0084 <span class="comment">%                    function. addMets supports more annotation of</span>
0085 <span class="comment">%                    metabolites, allows for the use of exchange</span>
0086 <span class="comment">%                    metabolites, and using it reduces the risk of parsing</span>
0087 <span class="comment">%                    errors (optional, default false)</span>
0088 <span class="comment">%   allowNewGenes    true if the functions is allowed to add new genes</span>
0089 <span class="comment">%                    (optional, default false)</span>
0090 <span class="comment">%</span>
0091 <span class="comment">% Output:</span>
0092 <span class="comment">%   newModel         an updated model structure</span>
0093 <span class="comment">%</span>
0094 <span class="comment">%   This function does not make extensive checks about formatting of</span>
0095 <span class="comment">%   gene-reaction rules.</span>
0096 <span class="comment">%</span>
0097 <span class="comment">%   When adding metabolites to a compartment where they previously do not</span>
0098 <span class="comment">%   the function will copy any available information from the metabolite in</span>
0099 <span class="comment">%   another compartment.</span>
0100 <span class="comment">%</span>
0101 <span class="comment">% Usage: newModel = addRxns(model, rxnsToAdd, eqnType, compartment,...</span>
0102 <span class="comment">%                       allowNewMets, allowNewGenes)</span>
0103 
0104 <span class="keyword">if</span> nargin&lt;3
0105     eqnType=1;
0106 <span class="keyword">elseif</span> ~isnumeric(eqnType)
0107     EM=<span class="string">'eqnType must be numeric'</span>;
0108     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0109 <span class="keyword">elseif</span> ~ismember(eqnType,[1 2 3])
0110     EM=<span class="string">'eqnType must be 1, 2, or 3'</span>;
0111     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0112 <span class="keyword">end</span>    
0113 
0114 <span class="keyword">if</span> nargin&lt;4
0115     compartment=[];
0116 <span class="keyword">else</span>
0117     compartment=char(compartment);
0118 <span class="keyword">end</span>
0119 <span class="keyword">if</span> nargin&lt;5
0120     allowNewMets=false;
0121 <span class="keyword">elseif</span> ~islogical(allowNewMets)
0122     allowNewMets=char(allowNewMets);
0123 <span class="keyword">end</span>
0124 <span class="keyword">if</span> nargin&lt;6
0125     allowNewGenes=false;
0126 <span class="keyword">end</span>
0127 
0128 <span class="keyword">if</span> allowNewGenes &amp; isfield(rxnsToAdd,<span class="string">'grRules'</span>)
0129     genesToAdd.genes = strjoin(<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.grRules));
0130     genesToAdd.genes = regexp(genesToAdd.genes,<span class="string">' |)|(|and|or'</span>,<span class="string">'split'</span>); <span class="comment">% Remove all grRule punctuation</span>
0131     genesToAdd.genes = genesToAdd.genes(~cellfun(@isempty,genesToAdd.genes));  <span class="comment">% Remove spaces and empty genes</span>
0132     genesToAdd.genes = setdiff(unique(genesToAdd.genes),model.genes); <span class="comment">% Only keep new genes</span>
0133     <span class="keyword">if</span> isfield(model,<span class="string">'geneComps'</span>)
0134         genesToAdd.geneComps(1:numel(genesToAdd.genes)) = repmat(11,numel(genesToAdd.genes),1);
0135     <span class="keyword">end</span>
0136     <span class="keyword">if</span> ~isempty(genesToAdd.genes)
0137         fprintf(<span class="string">'\nNew genes added to the model:\n'</span>)
0138         fprintf([strjoin(genesToAdd.genes,<span class="string">'\n'</span>) <span class="string">'\n'</span>])
0139         newModel=<a href="addGenesRaven.html" class="code" title="function newModel=addGenesRaven(model,genesToAdd)">addGenesRaven</a>(model,genesToAdd);
0140     <span class="keyword">else</span>
0141         newModel=model;
0142     <span class="keyword">end</span>
0143 <span class="keyword">else</span>
0144     newModel=model;
0145 <span class="keyword">end</span>
0146 
0147 <span class="comment">%If no reactions should be added</span>
0148 <span class="keyword">if</span> isempty(rxnsToAdd)
0149     <span class="keyword">return</span>;
0150 <span class="keyword">end</span>
0151 
0152 <span class="keyword">if</span> eqnType==2 || (eqnType==1 &amp;&amp; allowNewMets==true)
0153     compartment=char(compartment);
0154     <span class="keyword">if</span> ~ismember(compartment,model.comps)
0155         EM=<span class="string">'compartment must match one of the compartments in model.comps'</span>;
0156         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0157     <span class="keyword">end</span>
0158 <span class="keyword">end</span>
0159 
0160 <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'rxns'</span>)
0161     EM=<span class="string">'rxns is a required field in rxnsToAdd'</span>;
0162     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0163 <span class="keyword">else</span>
0164     rxnsToAdd.rxns=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxns);
0165     <span class="comment">%To fit with some later printing</span>
0166     rxnsToAdd.rxns=rxnsToAdd.rxns(:);
0167 <span class="keyword">end</span>
0168 <span class="keyword">if</span> ~(isfield(rxnsToAdd,<span class="string">'equations'</span>) || (isfield(rxnsToAdd,<span class="string">'mets'</span>) &amp;&amp; isfield(rxnsToAdd,<span class="string">'stoichCoeffs'</span>)))
0169     EM=<span class="string">'Either &quot;equations&quot; or &quot;mets&quot;+&quot;stoichCoeffs&quot; are required fields in rxnsToAdd'</span>;
0170     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0171 <span class="keyword">end</span>
0172 
0173 <span class="keyword">if</span> any(ismember(rxnsToAdd.rxns,model.rxns))
0174     EM=<span class="string">'One or more reaction id was already present in the model. Use changeRxns or remove the existing reactions before adding new ones'</span>;
0175     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0176 <span class="keyword">end</span>
0177 
0178 <span class="comment">%Normal case: equations provided</span>
0179 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'equations'</span>)
0180     rxnsToAdd.equations=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.equations);
0181 
0182     <span class="comment">%Alternative case: mets+stoichiometry provided</span>
0183 <span class="keyword">else</span>
0184     <span class="comment">%In the case of 1 rxn added (array of strings + vector), transform to</span>
0185     <span class="comment">%cells of length=1:</span>
0186     <span class="keyword">if</span> iscellstr(rxnsToAdd.mets)
0187         rxnsToAdd.mets={rxnsToAdd.mets};
0188     <span class="keyword">end</span>
0189     <span class="keyword">if</span> isnumeric(rxnsToAdd.stoichCoeffs)
0190         rxnsToAdd.stoichCoeffs = {rxnsToAdd.stoichCoeffs};
0191     <span class="keyword">end</span>
0192     <span class="comment">%Now both rxnsToAdd.mets and rxnsToAdd.stoichCoeffs should be cell</span>
0193     <span class="comment">%arrays &amp; of the same size:</span>
0194     <span class="keyword">if</span> ~iscell(rxnsToAdd.mets) || ~iscell(rxnsToAdd.stoichCoeffs)
0195         EM=<span class="string">'rxnsToAdd.mets &amp; rxnsToAdd.stoichCoeffs must be cell arrays'</span>;
0196         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0197     <span class="keyword">elseif</span> length(rxnsToAdd.stoichCoeffs) ~= length(rxnsToAdd.mets)
0198         EM = <span class="string">'rxnsToAdd.stoichCoeffs must have the same number of elements as rxnsToAdd.mets'</span>;
0199         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0200     <span class="keyword">end</span>
0201     <span class="comment">%In this case we need lb to decide if the reaction is reversible or not:</span>
0202     <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'lb'</span>)
0203         <span class="comment">%Fill with standard if it doesn't exist</span>
0204         rxnsToAdd.lb=-inf(size(rxnsToAdd.mets));
0205     <span class="keyword">elseif</span> ~isnumeric(rxnsToAdd.lb)
0206         EM = <span class="string">'rxnsToAdd.lb must be a vector'</span>;
0207         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0208     <span class="keyword">elseif</span> length(rxnsToAdd.lb) ~= length(rxnsToAdd.mets)
0209         EM = <span class="string">'rxnsToAdd.lb must have the same number of elements as rxnsToAdd.mets'</span>;
0210         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0211     <span class="keyword">end</span>
0212     <span class="comment">%Now we construct equations, to comply with the rest of the script:</span>
0213     rxnsToAdd.equations = cell(size(rxnsToAdd.mets));
0214     <span class="keyword">for</span> i = 1:length(rxnsToAdd.mets)
0215         mets         = rxnsToAdd.mets{i};
0216         stoichCoeffs = rxnsToAdd.stoichCoeffs{i};
0217         <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'ub'</span>)
0218             isrev        = rxnsToAdd.lb(i) &lt; 0 &amp;&amp; rxnsToAdd.ub(i) &gt; 0;
0219         <span class="keyword">else</span>
0220             isrev        = rxnsToAdd.lb(i) &lt; 0;
0221         <span class="keyword">end</span>
0222         rxnsToAdd.equations{i} = <a href="buildEquation.html" class="code" title="function equationString=buildEquation(mets,stoichCoeffs,isrev)">buildEquation</a>(mets,stoichCoeffs,isrev);
0223     <span class="keyword">end</span>
0224 <span class="keyword">end</span>
0225 
0226 nRxns=numel(rxnsToAdd.rxns);
0227 nOldRxns=numel(model.rxns);
0228 filler=cell(nRxns,1);
0229 filler(:)={<span class="string">''</span>};
0230 cellfiller=cellfun(@(x) cell(0,0),filler,<span class="string">'UniformOutput'</span>,false);
0231 largeFiller=cell(nOldRxns,1);
0232 largeFiller(:)={<span class="string">''</span>};
0233 celllargefiller=cellfun(@(x) cell(0,0),largeFiller,<span class="string">'UniformOutput'</span>,false);
0234 
0235 <span class="comment">%***Add everything to the model except for the equations.</span>
0236 <span class="keyword">if</span> numel(rxnsToAdd.equations)~=nRxns
0237     EM=<span class="string">'rxnsToAdd.equations must have the same number of elements as rxnsToAdd.rxns'</span>;
0238     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0239 <span class="keyword">end</span>
0240 
0241 <span class="comment">%Parse the equations. This is done at this early stage since I need the</span>
0242 <span class="comment">%reversibility info</span>
0243 [S, mets, badRxns, reversible]=<a href="constructS.html" class="code" title="function [S, mets, badRxns, reversible]=constructS(equations,mets,rxns)">constructS</a>(rxnsToAdd.equations);
0244 EM=<span class="string">'The following equations have one or more metabolites both as substrate and product. Only the net equations will be added:'</span>;
0245 <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false,rxnsToAdd.rxns(badRxns));
0246 
0247 newModel.rev=[newModel.rev;reversible];
0248 newModel.rxns=[newModel.rxns;rxnsToAdd.rxns(:)];
0249 
0250 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNames'</span>)
0251     rxnsToAdd.rxnNames=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnNames);
0252     <span class="keyword">if</span> numel(rxnsToAdd.rxnNames)~=nRxns
0253         EM=<span class="string">'rxnsToAdd.rxnNames must have the same number of elements as rxnsToAdd.rxns'</span>;
0254         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0255     <span class="keyword">end</span>
0256     <span class="comment">%Fill with standard if it doesn't exist</span>
0257     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNames'</span>)
0258         newModel.rxnNames=largeFiller;
0259     <span class="keyword">end</span>
0260     newModel.rxnNames=[newModel.rxnNames;rxnsToAdd.rxnNames(:)];
0261 <span class="keyword">else</span>
0262     <span class="comment">%Fill with standard if it doesn't exist</span>
0263     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNames'</span>)
0264         newModel.rxnNames=[newModel.rxnNames;filler];
0265     <span class="keyword">end</span>
0266 <span class="keyword">end</span>
0267 
0268 <span class="keyword">if</span> isfield(newModel,<span class="string">'annotation'</span>) &amp; isfield(newModel.annotation,<span class="string">'defaultLB'</span>)
0269     newLb=newModel.annotation.defaultLB;
0270 <span class="keyword">else</span>
0271     newLb=-inf;
0272 <span class="keyword">end</span>
0273 
0274 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'lb'</span>)
0275     <span class="keyword">if</span> numel(rxnsToAdd.lb)~=nRxns
0276         EM=<span class="string">'rxnsToAdd.lb must have the same number of elements as rxnsToAdd.rxns'</span>;
0277         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0278     <span class="keyword">end</span>
0279     <span class="comment">%Fill with standard if it doesn't exist</span>
0280     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'lb'</span>)
0281         newModel.lb=zeros(nOldRxns,1);
0282         newModel.lb(newModel.rev~=0)=newLb;
0283     <span class="keyword">end</span>
0284     newModel.lb=[newModel.lb;rxnsToAdd.lb(:)];
0285 <span class="keyword">else</span>
0286     <span class="comment">%Fill with standard if it doesn't exist</span>
0287     <span class="keyword">if</span> isfield(newModel,<span class="string">'lb'</span>)
0288         I=zeros(nRxns,1);
0289         I(reversible~=0)=newLb;
0290         newModel.lb=[newModel.lb;I];
0291     <span class="keyword">end</span>
0292 <span class="keyword">end</span>
0293 
0294 <span class="keyword">if</span> isfield(newModel,<span class="string">'annotation'</span>) &amp; isfield(newModel.annotation,<span class="string">'defaultUB'</span>)
0295     newUb=newModel.annotation.defaultUB;
0296 <span class="keyword">else</span>
0297     newUb=inf;
0298 <span class="keyword">end</span>
0299 
0300 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'ub'</span>)
0301     <span class="keyword">if</span> numel(rxnsToAdd.ub)~=nRxns
0302         EM=<span class="string">'rxnsToAdd.ub must have the same number of elements as rxnsToAdd.rxns'</span>;
0303         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0304     <span class="keyword">end</span>
0305     <span class="comment">%Fill with standard if it doesn't exist</span>
0306     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'ub'</span>)
0307         newModel.ub=repmat(newUb,nOldRxns,1);
0308     <span class="keyword">end</span>
0309     newModel.ub=[newModel.ub;rxnsToAdd.ub(:)];
0310 <span class="keyword">else</span>
0311     <span class="comment">%Fill with standard if it doesn't exist</span>
0312     <span class="keyword">if</span> isfield(newModel,<span class="string">'ub'</span>)
0313         newModel.ub=[newModel.ub;repmat(newUb,nRxns,1)];
0314     <span class="keyword">end</span>
0315 <span class="keyword">end</span>
0316 
0317 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'c'</span>)
0318     <span class="keyword">if</span> numel(rxnsToAdd.c)~=nRxns
0319         EM=<span class="string">'rxnsToAdd.c must have the same number of elements as rxnsToAdd.rxns'</span>;
0320         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0321     <span class="keyword">end</span>
0322     <span class="comment">%Fill with standard if it doesn't exist</span>
0323     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'c'</span>)
0324         newModel.c=zeros(nOldRxns,1);
0325     <span class="keyword">end</span>
0326     newModel.c=[newModel.c;rxnsToAdd.c(:)];
0327 <span class="keyword">else</span>
0328     <span class="comment">%Fill with standard if it doesn't exist</span>
0329     <span class="keyword">if</span> isfield(newModel,<span class="string">'c'</span>)
0330         newModel.c=[newModel.c;zeros(nRxns,1)];
0331     <span class="keyword">end</span>
0332 <span class="keyword">end</span>
0333 
0334 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'eccodes'</span>)
0335     rxnsToAdd.eccodes=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.eccodes);
0336     <span class="keyword">if</span> numel(rxnsToAdd.eccodes)~=nRxns
0337         EM=<span class="string">'rxnsToAdd.eccodes must have the same number of elements as rxnsToAdd.rxns'</span>;
0338         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0339     <span class="keyword">end</span>
0340     <span class="comment">%Fill with standard if it doesn't exist</span>
0341     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'eccodes'</span>)
0342         newModel.eccodes=largeFiller;
0343     <span class="keyword">end</span>
0344     newModel.eccodes=[newModel.eccodes;rxnsToAdd.eccodes(:)];
0345 <span class="keyword">else</span>
0346     <span class="comment">%Fill with standard if it doesn't exist</span>
0347     <span class="keyword">if</span> isfield(newModel,<span class="string">'eccodes'</span>)
0348         newModel.eccodes=[newModel.eccodes;filler];
0349     <span class="keyword">end</span>
0350 <span class="keyword">end</span>
0351 
0352 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'subSystems'</span>)
0353     <span class="keyword">if</span> numel(rxnsToAdd.subSystems)~=nRxns
0354         EM=<span class="string">'rxnsToAdd.subSystems must have the same number of elements as rxnsToAdd.rxns'</span>;
0355         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0356     <span class="keyword">end</span>
0357     <span class="keyword">for</span> i=1:numel(rxnsToAdd.subSystems)
0358         <span class="keyword">if</span> ischar(rxnsToAdd.subSystems{i})
0359             rxnsToAdd.subSystems{i}=rxnsToAdd.subSystems(i);
0360         <span class="keyword">end</span>
0361     <span class="keyword">end</span>
0362     <span class="comment">%Fill with standard if it doesn't exist</span>
0363     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'subSystems'</span>)
0364         newModel.subSystems=celllargefiller;
0365     <span class="keyword">end</span>
0366     newModel.subSystems=[newModel.subSystems;rxnsToAdd.subSystems(:)];
0367 <span class="keyword">else</span>
0368     <span class="comment">%Fill with standard if it doesn't exist</span>
0369     <span class="keyword">if</span> isfield(newModel,<span class="string">'subSystems'</span>)
0370         newModel.subSystems=[newModel.subSystems;cellfiller];
0371     <span class="keyword">end</span>
0372 <span class="keyword">end</span>
0373 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnMiriams'</span>)
0374     <span class="keyword">if</span> numel(rxnsToAdd.rxnMiriams)~=nRxns
0375         EM=<span class="string">'rxnsToAdd.rxnMiriams must have the same number of elements as rxnsToAdd.rxns'</span>;
0376         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0377     <span class="keyword">end</span>
0378     <span class="comment">%Fill with standard if it doesn't exist</span>
0379     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnMiriams'</span>)
0380         newModel.rxnMiriams=cell(nOldRxns,1);
0381     <span class="keyword">end</span>
0382     newModel.rxnMiriams=[newModel.rxnMiriams;rxnsToAdd.rxnMiriams(:)];
0383 <span class="keyword">else</span>
0384     <span class="comment">%Fill with standard if it doesn't exist</span>
0385     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnMiriams'</span>)
0386         newModel.rxnMiriams=[newModel.rxnMiriams;cell(nRxns,1)];
0387     <span class="keyword">end</span>
0388 <span class="keyword">end</span>
0389 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnComps'</span>)
0390     <span class="keyword">if</span> numel(rxnsToAdd.rxnComps)~=nRxns
0391         EM=<span class="string">'rxnsToAdd.rxnComps must have the same number of elements as rxnsToAdd.rxns'</span>;
0392         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0393     <span class="keyword">end</span>
0394     <span class="comment">%Fill with standard if it doesn't exist</span>
0395     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnComps'</span>)
0396         newModel.rxnComps=ones(nOldRxns,1);
0397         EM=<span class="string">'Adding reactions with compartment information to a model without such information. All existing reactions will be assigned to the first compartment'</span>;
0398         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false);
0399     <span class="keyword">end</span>
0400     newModel.rxnComps=[newModel.rxnComps;rxnsToAdd.rxnComps(:)];
0401 <span class="keyword">else</span>
0402     <span class="comment">%Fill with standard if it doesn't exist</span>
0403     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnComps'</span>)
0404         newModel.rxnComps=[newModel.rxnComps;ones(nRxns,1)];
0405         <span class="comment">%fprintf('NOTE: The added reactions will be assigned to the first</span>
0406         <span class="comment">%compartment\n');</span>
0407     <span class="keyword">end</span>
0408 <span class="keyword">end</span>
0409 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'grRules'</span>)
0410     rxnsToAdd.grRules=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.grRules);
0411     <span class="keyword">if</span> numel(rxnsToAdd.grRules)~=nRxns
0412         EM=<span class="string">'rxnsToAdd.grRules must have the same number of elements as rxnsToAdd.rxns'</span>;
0413         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0414     <span class="keyword">end</span>
0415     <span class="comment">%Fill with standard if it doesn't exist</span>
0416     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'grRules'</span>)
0417         newModel.grRules=largeFiller;
0418     <span class="keyword">end</span>
0419     newModel.grRules=[newModel.grRules;rxnsToAdd.grRules(:)];
0420 <span class="keyword">else</span>
0421     <span class="comment">%Fill with standard if it doesn't exist</span>
0422     <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0423         newModel.grRules=[newModel.grRules;filler];
0424     <span class="keyword">end</span>
0425 <span class="keyword">end</span>
0426 
0427 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnFrom'</span>)
0428     rxnsToAdd.rxnFrom=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnFrom);
0429     <span class="keyword">if</span> numel(rxnsToAdd.rxnFrom)~=nRxns
0430         EM=<span class="string">'rxnsToAdd.rxnFrom must have the same number of elements as rxnsToAdd.rxns'</span>;
0431         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0432     <span class="keyword">end</span>
0433     <span class="comment">%Fill with standard if it doesn't exist</span>
0434     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnFrom'</span>)
0435         newModel.rxnFrom=largeFiller;
0436     <span class="keyword">end</span>
0437     newModel.rxnFrom=[newModel.rxnFrom;rxnsToAdd.rxnFrom(:)];
0438 <span class="keyword">else</span>
0439     <span class="comment">%Fill with standard if it doesn't exist</span>
0440     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnFrom'</span>)
0441         newModel.rxnFrom=[newModel.rxnFrom;filler];
0442     <span class="keyword">end</span>
0443 <span class="keyword">end</span>
0444 
0445 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNotes'</span>)
0446     rxnsToAdd.rxnNotes=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnNotes);
0447     <span class="keyword">if</span> numel(rxnsToAdd.rxnNotes)~=nRxns
0448         EM=<span class="string">'rxnsToAdd.rxnNotes must have the same number of elements as rxnsToAdd.rxns'</span>;
0449         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0450     <span class="keyword">end</span>
0451     <span class="comment">%Fill with standard if it doesn't exist</span>
0452     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNotes'</span>)
0453         newModel.rxnNotes=largeFiller;
0454     <span class="keyword">end</span>
0455     newModel.rxnNotes=[newModel.rxnNotes;rxnsToAdd.rxnNotes(:)];
0456 <span class="keyword">else</span>
0457     <span class="comment">%Fill with standard if it doesn't exist</span>
0458     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNotes'</span>)
0459         newModel.rxnNotes=[newModel.rxnNotes;filler];
0460     <span class="keyword">end</span>
0461 <span class="keyword">end</span>
0462 
0463 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnReferences'</span>)
0464     rxnsToAdd.rxnReferences=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnReferences);
0465     <span class="keyword">if</span> numel(rxnsToAdd.rxnReferences)~=nRxns
0466         EM=<span class="string">'rxnsToAdd.rxnReferences must have the same number of elements as rxnsToAdd.rxns'</span>;
0467         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0468     <span class="keyword">end</span>
0469     <span class="comment">%Fill with standard if it doesn't exist</span>
0470     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnReferences'</span>)
0471         newModel.rxnReferences=largeFiller;
0472     <span class="keyword">end</span>
0473     newModel.rxnReferences=[newModel.rxnReferences;rxnsToAdd.rxnReferences(:)];
0474 <span class="keyword">else</span>
0475     <span class="comment">%Fill with standard if it doesn't exist</span>
0476     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnReferences'</span>)
0477         newModel.rxnReferences=[newModel.rxnReferences;filler];
0478     <span class="keyword">end</span>
0479 <span class="keyword">end</span>
0480 
0481 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'pwys'</span>)
0482     rxnsToAdd.pwys=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.pwys);
0483     <span class="keyword">if</span> numel(rxnsToAdd.pwys)~=nRxns
0484         EM=<span class="string">'rxnsToAdd.pwys must have the same number of elements as rxnsToAdd.rxns'</span>;
0485         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0486     <span class="keyword">end</span>
0487     <span class="comment">%Fill with standard if it doesn't exist</span>
0488     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'pwys'</span>)
0489         newModel.pwys=largeFiller;
0490     <span class="keyword">end</span>
0491     newModel.pwys=[newModel.pwys;rxnsToAdd.pwys(:)];
0492 <span class="keyword">else</span>
0493     <span class="comment">%Fill with standard if it doesn't exist</span>
0494     <span class="keyword">if</span> isfield(newModel,<span class="string">'pwys'</span>)
0495         newModel.pwys=[newModel.pwys;filler];
0496     <span class="keyword">end</span>
0497 <span class="keyword">end</span>
0498 
0499 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnConfidenceScores'</span>)
0500     <span class="keyword">if</span> numel(rxnsToAdd.rxnConfidenceScores)~=nRxns
0501         EM=<span class="string">'rxnsToAdd.rxnConfidenceScores must have the same number of elements as rxnsToAdd.rxns'</span>;
0502         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0503     <span class="keyword">end</span>
0504     <span class="comment">%Fill with standard if it doesn't exist</span>
0505     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnConfidenceScores'</span>)
0506         newModel.rxnConfidenceScores=NaN(nOldRxns,1);
0507     <span class="keyword">end</span>
0508     newModel.rxnConfidenceScores=[newModel.rxnConfidenceScores;rxnsToAdd.rxnConfidenceScores(:)];
0509 <span class="keyword">else</span>
0510     <span class="comment">%Fill with standard if it doesn't exist</span>
0511     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnConfidenceScores'</span>)
0512         newModel.rxnConfidenceScores=[newModel.rxnConfidenceScores;NaN(nRxns,1)];
0513     <span class="keyword">end</span>
0514 <span class="keyword">end</span>
0515 
0516 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnDeltaG'</span>)
0517     <span class="keyword">if</span> numel(rxnsToAdd.rxnDeltaG)~=nRxns
0518         EM=<span class="string">'rxnsToAdd.rxnDeltaG must have the same number of elements as rxnsToAdd.rxns'</span>;
0519         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0520     <span class="keyword">end</span>
0521     <span class="comment">%Fill with standard if it doesn't exist</span>
0522     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnDeltaG'</span>)
0523         newModel.rxnDeltaG=NaN(nOldRxns,1);
0524     <span class="keyword">end</span>
0525     newModel.rxnDeltaG=[newModel.rxnDeltaG;rxnsToAdd.rxnDeltaG(:)];
0526 <span class="keyword">else</span>
0527     <span class="comment">%Fill with standard if it doesn't exist</span>
0528     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnDeltaG'</span>)
0529         newModel.rxnDeltaG=[newModel.rxnDeltaG;NaN(nRxns,1)];
0530     <span class="keyword">end</span>
0531 <span class="keyword">end</span>
0532 
0533 
0534 <span class="comment">%***Start parsing the equations and adding the info to the S matrix The</span>
0535 <span class="comment">%mets are matched to model.mets</span>
0536 <span class="keyword">if</span> eqnType==1
0537     [I, J]=ismember(mets,model.mets);
0538     <span class="keyword">if</span> ~all(I)
0539         <span class="keyword">if</span> allowNewMets==true || ischar(allowNewMets)
0540             <span class="comment">%Add the new mets</span>
0541             metsToAdd.mets=mets(~I);
0542             metsToAdd.metNames=metsToAdd.mets;
0543             metsToAdd.compartments=compartment;
0544             <span class="keyword">if</span> ischar(allowNewMets)
0545                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true,allowNewMets);
0546             <span class="keyword">else</span>
0547                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true);
0548             <span class="keyword">end</span>
0549         <span class="keyword">else</span>
0550             EM=<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function. Are you sure that eqnType=1?'</span>;
0551             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0552         <span class="keyword">end</span>
0553     <span class="keyword">end</span>
0554     <span class="comment">%Calculate the indexes of the metabolites and add the info</span>
0555     metIndexes=J;
0556     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0557 <span class="keyword">end</span>
0558 
0559 <span class="comment">%Do some stuff that is the same for eqnType=2 and eqnType=3</span>
0560 <span class="keyword">if</span> eqnType==2 || eqnType==3
0561     <span class="comment">%For later..</span>
0562     t2=strcat(model.metNames,<span class="string">'***'</span>,model.comps(model.metComps));
0563 <span class="keyword">end</span>
0564 
0565 <span class="comment">%The mets are matched to model.metNames and assigned to &quot;compartment&quot;</span>
0566 <span class="keyword">if</span> eqnType==2
0567     <span class="comment">%%Check that the metabolite names aren't present in the same</span>
0568     <span class="comment">%%compartment.</span>
0569     <span class="comment">%Not the neatest way maybe..</span>
0570     t1=strcat(mets,<span class="string">'***'</span>,compartment);
0571     [I, J]=ismember(t1,t2);
0572     
0573     <span class="keyword">if</span> ~all(I)
0574         <span class="keyword">if</span> allowNewMets==true || ischar(allowNewMets)
0575             <span class="comment">%Add the new mets</span>
0576             metsToAdd.metNames=mets(~I);
0577             metsToAdd.compartments=compartment;
0578             <span class="keyword">if</span> ischar(allowNewMets)
0579                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true,allowNewMets);
0580             <span class="keyword">else</span>
0581                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true);
0582             <span class="keyword">end</span>
0583         <span class="keyword">else</span>
0584             EM=<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0585             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0586         <span class="keyword">end</span>
0587     <span class="keyword">end</span>
0588     
0589     <span class="comment">%Calculate the indexes of the metabolites</span>
0590     metIndexes=J;
0591     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0592 <span class="keyword">end</span>
0593 
0594 <span class="comment">%The equations are on the form metNames[compName]</span>
0595 <span class="keyword">if</span> eqnType==3
0596     <span class="comment">%Parse the metabolite names</span>
0597     metNames=cell(numel(mets),1);
0598     compartments=metNames;
0599     <span class="keyword">for</span> i=1:numel(mets)
0600         starts=max(strfind(mets{i},<span class="string">'['</span>));
0601         ends=max(strfind(mets{i},<span class="string">']'</span>));
0602         
0603         <span class="comment">%Check that the formatting is correct</span>
0604         <span class="keyword">if</span> isempty(starts) || isempty(ends) || ends&lt;numel(mets{i})
0605             EM=[<span class="string">'The metabolite '</span> mets{i} <span class="string">' is not correctly formatted for eqnType=3'</span>];
0606             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0607         <span class="keyword">end</span>
0608         
0609         <span class="comment">%Check that the compartment is correct</span>
0610         compartments{i}=mets{i}(starts+1:ends-1);
0611         I=ismember(compartments(i),newModel.comps);
0612         <span class="keyword">if</span> ~I
0613             EM=[<span class="string">'The metabolite '</span> mets{i} <span class="string">' has a compartment that is not in model.comps'</span>];
0614             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0615         <span class="keyword">end</span>
0616         metNames{i}=mets{i}(1:starts-1);
0617     <span class="keyword">end</span>
0618     
0619     <span class="comment">%Check if the metabolite exists already</span>
0620     t1=strcat(metNames,<span class="string">'***'</span>,compartments);
0621     [I, J]=ismember(t1,t2);
0622     
0623     <span class="keyword">if</span> ~all(I)
0624         <span class="keyword">if</span> allowNewMets==true | ischar(allowNewMets)
0625             <span class="comment">%Add the new mets</span>
0626             metsToAdd.metNames=metNames(~I);
0627             metsToAdd.compartments=compartments(~I);
0628             <span class="keyword">if</span> ischar(allowNewMets)
0629                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true,allowNewMets);
0630             <span class="keyword">else</span>
0631                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true);
0632             <span class="keyword">end</span>
0633         <span class="keyword">else</span>
0634             EM=<span class="string">'One or more equations contain metabolites that are not in model.metNames. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0635             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0636         <span class="keyword">end</span>
0637     <span class="keyword">end</span>
0638     
0639     <span class="comment">%Calculate the indexes of the metabolites</span>
0640     metIndexes=J;
0641     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0642 <span class="keyword">end</span>
0643 
0644 <span class="comment">%Add the info to the stoichiometric matrix</span>
0645 newModel.S=[newModel.S sparse(size(newModel.S,1),nRxns)];
0646 
0647 <span class="keyword">for</span> i=1:nRxns
0648     newModel.S(metIndexes,nOldRxns+i)=S(:,i);
0649     <span class="comment">%Parse the grRules and check whether all genes in grRules appear in</span>
0650     <span class="comment">%genes</span>
0651     <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0652         rule=newModel.grRules{nOldRxns+i};
0653         rule=strrep(rule,<span class="string">'('</span>,<span class="string">''</span>);
0654         rule=strrep(rule,<span class="string">')'</span>,<span class="string">''</span>);
0655         rule=strrep(rule,<span class="string">' or '</span>,<span class="string">' '</span>);
0656         rule=strrep(rule,<span class="string">' and '</span>,<span class="string">' '</span>);
0657         genes=regexp(rule,<span class="string">' '</span>,<span class="string">'split'</span>);
0658         [I, J]=ismember(genes,newModel.genes);
0659         <span class="keyword">if</span> ~all(I) &amp;&amp; any(rule)
0660             EM=[<span class="string">'Not all genes for reaction '</span> rxnsToAdd.rxns{i} <span class="string">' were found in model.genes. If needed, add genes with addGenesRaven before calling this function, or set the ''allowNewGenes'' flag to true'</span>];
0661             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0662         <span class="keyword">end</span>
0663     <span class="keyword">end</span>
0664 <span class="keyword">end</span>
0665 
0666 <span class="comment">%Make temporary minimal model structure with only new rxns, to parse to</span>
0667 <span class="comment">%standardizeGrRules</span>
0668 newRxnsModel.genes=newModel.genes;
0669 newRxnsModel.grRules=newModel.grRules(length(model.rxns)+1:end);
0670 newRxnsModel.rxns=newModel.rxns(length(model.rxns)+1:end);
0671 
0672 <span class="comment">%Fix grRules and reconstruct rxnGeneMat</span>
0673 [grRules,rxnGeneMat] = <a href="standardizeGrRules.html" class="code" title="function [grRules,rxnGeneMat,indexes2check] = standardizeGrRules(model,embedded)">standardizeGrRules</a>(newRxnsModel,true);
0674 newModel.rxnGeneMat = [newModel.rxnGeneMat; rxnGeneMat];
0675 newModel.grRules = [newModel.grRules(1:nOldRxns); grRules];
0676 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of addRxns</title>
  <meta name="keywords" content="addRxns">
  <meta name="description" content="addRxns">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">core</a> &gt; addRxns.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for core&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>addRxns
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>addRxns</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets,allowNewGenes) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> addRxns
   Adds reactions to a model

   model            a model structure
   rxnsToAdd        the reaction structure can have the following fields:
            rxns               cell array with unique strings that
                               identifies each reaction
            equations          cell array with equation strings. Decimal
                               coefficients are expressed as &quot;1.2&quot;.
                               Reversibility is indicated by &quot;&lt;=&gt;&quot; or &quot;=&gt;&quot;
            mets               (alternative to equations) cell array with
                               the metabolites involved in each reaction
                               as nested arrays. E.g.:
                               {{'met1','met2'},{'met1','met3','met4'}}
                               In the case of one single reaction added,
                               it can be a string array: {'met1','met2'}
            stoichCoeffs       (alternative to equations) cell array with
                               the corresponding stoichiometries as nested
                               vectors. E.g.: {[-1,+2],[-1,-1,+1]}
                               In the case of one single reaction added,
                               it can be a vector: [-1,+2]
            rxnNames           cell array with the names of each reaction
                               (opt, default '')
            lb                 vector with the lower bounds (opt, default
                               to model.annotations.defaultLB or -inf for
                               reversible reactions and 0 for irreversible
                               when &quot;equations&quot; is used. When &quot;mets&quot; and
                               &quot;stoichCoeffs&quot; are used it defaults for all
                               reactions to model.annotations.defaultLB or
                               -inf)
            ub                 vector with the upper bounds (opt, default
                               to model.annotations.defaultUB or inf)
            c                  vector with the objective function
                               coefficients (opt, default 0)
            eccodes            cell array with the EC-numbers for each
                               reactions. Delimit several EC-numbers with
                               &quot;;&quot; (opt, default '')
            subSystems         cell array with the subsystems for each
                               reaction (opt, default '')
            grRules            cell array with the gene-reaction
                               relationship for each reaction. For example
                               &quot;(A and B) or (C)&quot; means that the reaction
                               could be catalyzed by a complex between
                               A &amp; B or by C on its own. All the genes
                               have to be present in model.genes. Add
                               genes with addGenesRaven before calling
                               this function if needed (opt, default '')
            rxnMiriams         cell array with Miriam structures (opt,
                               default [])
            rxnComps           cell array with compartments (as in
                               model.comps) (opt, default {})
            rxnNotes           cell array with reaction notes (opt,
                               default '')
            rxnDeltaG          Gibbs free energy at biochemical standard
                               condition in kJ/mole (opt, default NaN)
            rxnReferences      cell array with reaction references (opt,
                               default '')
            rxnConfidenceScores   vector with reaction confidence scores
                               (opt, default NaN)
   eqnType          double describing how the equation string should be
                    interpreted
                    1 - The metabolites are matched to model.mets. New
                        metabolites (if allowed) are added to
                        &quot;compartment&quot; (default)
                    2 - The metabolites are matched to model.metNames and
                        all metabolites are assigned to &quot;compartment&quot;. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are
                        already used in the model then the numbering will
                        start from the highest used integer+1
                    3 - The metabolites are written as
                        &quot;metNames[comps]&quot;. Only compartments in
                        model.comps are allowed. Any
                        new metabolites that are added will be assigned
                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are
                        already used in the model then the numbering will
                        start from the highest used integer+1
   compartment      a string with the compartment the metabolites should
                    be placed in when using eqnType=2. Must match
                    model.comps (opt when eqnType=1 or eqnType=3)
   allowNewMets     true if the function is allowed to add new
                    metabolites. Can also be a string, which will be used
                    as prefix for the new metabolite IDs. It is highly
                    recommended to first add any new metabolites with
                    addMets rather than automatically through this
                    function. addMets supports more annotation of
                    metabolites, allows for the use of exchange
                    metabolites, and using it reduces the risk of parsing
                    errors (opt, default false)
   allowNewGenes    true if the functions is allowed to add new genes
                    (opt, default false)

   newModel         an updated model structure

   NOTE: This function does not make extensive checks about formatting of
   gene-reaction rules.

   NOTE: When adding metabolites to a compartment where it previously
   doesn't exist, the function will copy any available information from
   the metabolite in another compartment.

   Usage: newModel=addRxns(model,rxnsToAdd,eqnType,compartment,...
                           allowNewMets,allowNewGenes)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addGenesRaven.html" class="code" title="function newModel=addGenesRaven(model,genesToAdd)">addGenesRaven</a>	addGenesRaven</li><li><a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>	addMets</li><li><a href="buildEquation.html" class="code" title="function equationString=buildEquation(mets,stoichCoeffs,isrev)">buildEquation</a>	buildEquation</li><li><a href="constructS.html" class="code" title="function [S, mets, badRxns, reversible]=constructS(equations,mets,rxns)">constructS</a>	constructS</li><li><a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>	convertCharArray</li><li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="standardizeGrRules.html" class="code" title="function [grRules,rxnGeneMat,indexes2check] = standardizeGrRules(model,embedded)">standardizeGrRules</a>	standardizeGrRules</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="addRxnsGenesMets.html" class="code" title="function model=addRxnsGenesMets(model,sourceModel,rxns,addGene,rxnNote,confidence)">addRxnsGenesMets</a>	addRxnsGenesMets</li><li><a href="changeRxns.html" class="code" title="function model=changeRxns(model,rxns,equations,eqnType,compartment,allowNewMets)">changeRxns</a>	changeRxns</li><li><a href="checkTasks.html" class="code" title="function [taskReport, essentialRxns, taskStructure, essentialFluxes]=checkTasks(model,inputFile,printOutput,printOnlyFailed,getEssential,taskStructure)">checkTasks</a>	checkTasks</li><li><a href="fitTasks.html" class="code" title="function [outModel, addedRxns]=fitTasks(model,refModel,inputFile,printOutput,rxnScores,taskStructure,params)">fitTasks</a>	fitTasks</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function newModel=addRxns(model,rxnsToAdd,eqnType,compartment,allowNewMets,allowNewGenes)</a>
0002 <span class="comment">% addRxns</span>
0003 <span class="comment">%   Adds reactions to a model</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   model            a model structure</span>
0006 <span class="comment">%   rxnsToAdd        the reaction structure can have the following fields:</span>
0007 <span class="comment">%            rxns               cell array with unique strings that</span>
0008 <span class="comment">%                               identifies each reaction</span>
0009 <span class="comment">%            equations          cell array with equation strings. Decimal</span>
0010 <span class="comment">%                               coefficients are expressed as &quot;1.2&quot;.</span>
0011 <span class="comment">%                               Reversibility is indicated by &quot;&lt;=&gt;&quot; or &quot;=&gt;&quot;</span>
0012 <span class="comment">%            mets               (alternative to equations) cell array with</span>
0013 <span class="comment">%                               the metabolites involved in each reaction</span>
0014 <span class="comment">%                               as nested arrays. E.g.:</span>
0015 <span class="comment">%                               {{'met1','met2'},{'met1','met3','met4'}}</span>
0016 <span class="comment">%                               In the case of one single reaction added,</span>
0017 <span class="comment">%                               it can be a string array: {'met1','met2'}</span>
0018 <span class="comment">%            stoichCoeffs       (alternative to equations) cell array with</span>
0019 <span class="comment">%                               the corresponding stoichiometries as nested</span>
0020 <span class="comment">%                               vectors. E.g.: {[-1,+2],[-1,-1,+1]}</span>
0021 <span class="comment">%                               In the case of one single reaction added,</span>
0022 <span class="comment">%                               it can be a vector: [-1,+2]</span>
0023 <span class="comment">%            rxnNames           cell array with the names of each reaction</span>
0024 <span class="comment">%                               (opt, default '')</span>
0025 <span class="comment">%            lb                 vector with the lower bounds (opt, default</span>
0026 <span class="comment">%                               to model.annotations.defaultLB or -inf for</span>
0027 <span class="comment">%                               reversible reactions and 0 for irreversible</span>
0028 <span class="comment">%                               when &quot;equations&quot; is used. When &quot;mets&quot; and</span>
0029 <span class="comment">%                               &quot;stoichCoeffs&quot; are used it defaults for all</span>
0030 <span class="comment">%                               reactions to model.annotations.defaultLB or</span>
0031 <span class="comment">%                               -inf)</span>
0032 <span class="comment">%            ub                 vector with the upper bounds (opt, default</span>
0033 <span class="comment">%                               to model.annotations.defaultUB or inf)</span>
0034 <span class="comment">%            c                  vector with the objective function</span>
0035 <span class="comment">%                               coefficients (opt, default 0)</span>
0036 <span class="comment">%            eccodes            cell array with the EC-numbers for each</span>
0037 <span class="comment">%                               reactions. Delimit several EC-numbers with</span>
0038 <span class="comment">%                               &quot;;&quot; (opt, default '')</span>
0039 <span class="comment">%            subSystems         cell array with the subsystems for each</span>
0040 <span class="comment">%                               reaction (opt, default '')</span>
0041 <span class="comment">%            grRules            cell array with the gene-reaction</span>
0042 <span class="comment">%                               relationship for each reaction. For example</span>
0043 <span class="comment">%                               &quot;(A and B) or (C)&quot; means that the reaction</span>
0044 <span class="comment">%                               could be catalyzed by a complex between</span>
0045 <span class="comment">%                               A &amp; B or by C on its own. All the genes</span>
0046 <span class="comment">%                               have to be present in model.genes. Add</span>
0047 <span class="comment">%                               genes with addGenesRaven before calling</span>
0048 <span class="comment">%                               this function if needed (opt, default '')</span>
0049 <span class="comment">%            rxnMiriams         cell array with Miriam structures (opt,</span>
0050 <span class="comment">%                               default [])</span>
0051 <span class="comment">%            rxnComps           cell array with compartments (as in</span>
0052 <span class="comment">%                               model.comps) (opt, default {})</span>
0053 <span class="comment">%            rxnNotes           cell array with reaction notes (opt,</span>
0054 <span class="comment">%                               default '')</span>
0055 <span class="comment">%            rxnDeltaG          Gibbs free energy at biochemical standard</span>
0056 <span class="comment">%                               condition in kJ/mole (opt, default NaN)</span>
0057 <span class="comment">%            rxnReferences      cell array with reaction references (opt,</span>
0058 <span class="comment">%                               default '')</span>
0059 <span class="comment">%            rxnConfidenceScores   vector with reaction confidence scores</span>
0060 <span class="comment">%                               (opt, default NaN)</span>
0061 <span class="comment">%   eqnType          double describing how the equation string should be</span>
0062 <span class="comment">%                    interpreted</span>
0063 <span class="comment">%                    1 - The metabolites are matched to model.mets. New</span>
0064 <span class="comment">%                        metabolites (if allowed) are added to</span>
0065 <span class="comment">%                        &quot;compartment&quot; (default)</span>
0066 <span class="comment">%                    2 - The metabolites are matched to model.metNames and</span>
0067 <span class="comment">%                        all metabolites are assigned to &quot;compartment&quot;. Any</span>
0068 <span class="comment">%                        new metabolites that are added will be assigned</span>
0069 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0070 <span class="comment">%                        already used in the model then the numbering will</span>
0071 <span class="comment">%                        start from the highest used integer+1</span>
0072 <span class="comment">%                    3 - The metabolites are written as</span>
0073 <span class="comment">%                        &quot;metNames[comps]&quot;. Only compartments in</span>
0074 <span class="comment">%                        model.comps are allowed. Any</span>
0075 <span class="comment">%                        new metabolites that are added will be assigned</span>
0076 <span class="comment">%                        IDs &quot;m1&quot;, &quot;m2&quot;... If IDs on the same form are</span>
0077 <span class="comment">%                        already used in the model then the numbering will</span>
0078 <span class="comment">%                        start from the highest used integer+1</span>
0079 <span class="comment">%   compartment      a string with the compartment the metabolites should</span>
0080 <span class="comment">%                    be placed in when using eqnType=2. Must match</span>
0081 <span class="comment">%                    model.comps (opt when eqnType=1 or eqnType=3)</span>
0082 <span class="comment">%   allowNewMets     true if the function is allowed to add new</span>
0083 <span class="comment">%                    metabolites. Can also be a string, which will be used</span>
0084 <span class="comment">%                    as prefix for the new metabolite IDs. It is highly</span>
0085 <span class="comment">%                    recommended to first add any new metabolites with</span>
0086 <span class="comment">%                    addMets rather than automatically through this</span>
0087 <span class="comment">%                    function. addMets supports more annotation of</span>
0088 <span class="comment">%                    metabolites, allows for the use of exchange</span>
0089 <span class="comment">%                    metabolites, and using it reduces the risk of parsing</span>
0090 <span class="comment">%                    errors (opt, default false)</span>
0091 <span class="comment">%   allowNewGenes    true if the functions is allowed to add new genes</span>
0092 <span class="comment">%                    (opt, default false)</span>
0093 <span class="comment">%</span>
0094 <span class="comment">%   newModel         an updated model structure</span>
0095 <span class="comment">%</span>
0096 <span class="comment">%   NOTE: This function does not make extensive checks about formatting of</span>
0097 <span class="comment">%   gene-reaction rules.</span>
0098 <span class="comment">%</span>
0099 <span class="comment">%   NOTE: When adding metabolites to a compartment where it previously</span>
0100 <span class="comment">%   doesn't exist, the function will copy any available information from</span>
0101 <span class="comment">%   the metabolite in another compartment.</span>
0102 <span class="comment">%</span>
0103 <span class="comment">%   Usage: newModel=addRxns(model,rxnsToAdd,eqnType,compartment,...</span>
0104 <span class="comment">%                           allowNewMets,allowNewGenes)</span>
0105 
0106 <span class="keyword">if</span> nargin&lt;3
0107     eqnType=1;
0108 <span class="keyword">elseif</span> ~isnumeric(eqnType)
0109     EM=<span class="string">'eqnType must be numeric'</span>;
0110     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0111 <span class="keyword">elseif</span> ~ismember(eqnType,[1 2 3])
0112     EM=<span class="string">'eqnType must be 1, 2, or 3'</span>;
0113     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0114 <span class="keyword">end</span>    
0115 
0116 <span class="keyword">if</span> nargin&lt;4
0117     compartment=[];
0118 <span class="keyword">else</span>
0119     compartment=char(compartment);
0120 <span class="keyword">end</span>
0121 <span class="keyword">if</span> nargin&lt;5
0122     allowNewMets=false;
0123 <span class="keyword">elseif</span> ~islogical(allowNewMets)
0124     allowNewMets=char(allowNewMets);
0125 <span class="keyword">end</span>
0126 <span class="keyword">if</span> nargin&lt;6
0127     allowNewGenes=false;
0128 <span class="keyword">end</span>
0129 
0130 <span class="keyword">if</span> allowNewGenes &amp; isfield(rxnsToAdd,<span class="string">'grRules'</span>)
0131     genesToAdd.genes = strjoin(<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.grRules));
0132     genesToAdd.genes = regexp(genesToAdd.genes,<span class="string">' |)|(|and|or'</span>,<span class="string">'split'</span>); <span class="comment">% Remove all grRule punctuation</span>
0133     genesToAdd.genes = genesToAdd.genes(~cellfun(@isempty,genesToAdd.genes));  <span class="comment">% Remove spaces and empty genes</span>
0134     genesToAdd.genes = setdiff(unique(genesToAdd.genes),model.genes); <span class="comment">% Only keep new genes</span>
0135     <span class="keyword">if</span> isfield(model,<span class="string">'geneComps'</span>)
0136         genesToAdd.geneComps(1:numel(genesToAdd.genes)) = repmat(11,numel(genesToAdd.genes),1);
0137     <span class="keyword">end</span>
0138     <span class="keyword">if</span> ~isempty(genesToAdd.genes)
0139         fprintf(<span class="string">'\nNew genes added to the model:\n'</span>)
0140         fprintf([strjoin(genesToAdd.genes,<span class="string">'\n'</span>) <span class="string">'\n'</span>])
0141         newModel=<a href="addGenesRaven.html" class="code" title="function newModel=addGenesRaven(model,genesToAdd)">addGenesRaven</a>(model,genesToAdd);
0142     <span class="keyword">else</span>
0143         newModel=model;
0144     <span class="keyword">end</span>
0145 <span class="keyword">else</span>
0146     newModel=model;
0147 <span class="keyword">end</span>
0148 
0149 <span class="comment">%If no reactions should be added</span>
0150 <span class="keyword">if</span> isempty(rxnsToAdd)
0151     <span class="keyword">return</span>;
0152 <span class="keyword">end</span>
0153 
0154 <span class="keyword">if</span> eqnType==2 || (eqnType==1 &amp;&amp; allowNewMets==true)
0155     compartment=char(compartment);
0156     <span class="keyword">if</span> ~ismember(compartment,model.comps)
0157         EM=<span class="string">'compartment must match one of the compartments in model.comps'</span>;
0158         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0159     <span class="keyword">end</span>
0160 <span class="keyword">end</span>
0161 
0162 <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'rxns'</span>)
0163     EM=<span class="string">'rxns is a required field in rxnsToAdd'</span>;
0164     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0165 <span class="keyword">else</span>
0166     rxnsToAdd.rxns=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxns);
0167     <span class="comment">%To fit with some later printing</span>
0168     rxnsToAdd.rxns=rxnsToAdd.rxns(:);
0169 <span class="keyword">end</span>
0170 <span class="keyword">if</span> ~(isfield(rxnsToAdd,<span class="string">'equations'</span>) || (isfield(rxnsToAdd,<span class="string">'mets'</span>) &amp;&amp; isfield(rxnsToAdd,<span class="string">'stoichCoeffs'</span>)))
0171     EM=<span class="string">'Either &quot;equations&quot; or &quot;mets&quot;+&quot;stoichCoeffs&quot; are required fields in rxnsToAdd'</span>;
0172     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0173 <span class="keyword">end</span>
0174 
0175 <span class="keyword">if</span> any(ismember(rxnsToAdd.rxns,model.rxns))
0176     EM=<span class="string">'One or more reaction id was already present in the model. Use changeRxns or remove the existing reactions before adding new ones'</span>;
0177     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0178 <span class="keyword">end</span>
0179 
0180 <span class="comment">%Normal case: equations provided</span>
0181 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'equations'</span>)
0182     rxnsToAdd.equations=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.equations);
0183 
0184     <span class="comment">%Alternative case: mets+stoichiometry provided</span>
0185 <span class="keyword">else</span>
0186     <span class="comment">%In the case of 1 rxn added (array of strings + vector), transform to</span>
0187     <span class="comment">%cells of length=1:</span>
0188     <span class="keyword">if</span> iscellstr(rxnsToAdd.mets)
0189         rxnsToAdd.mets={rxnsToAdd.mets};
0190     <span class="keyword">end</span>
0191     <span class="keyword">if</span> isnumeric(rxnsToAdd.stoichCoeffs)
0192         rxnsToAdd.stoichCoeffs = {rxnsToAdd.stoichCoeffs};
0193     <span class="keyword">end</span>
0194     <span class="comment">%Now both rxnsToAdd.mets and rxnsToAdd.stoichCoeffs should be cell</span>
0195     <span class="comment">%arrays &amp; of the same size:</span>
0196     <span class="keyword">if</span> ~iscell(rxnsToAdd.mets) || ~iscell(rxnsToAdd.stoichCoeffs)
0197         EM=<span class="string">'rxnsToAdd.mets &amp; rxnsToAdd.stoichCoeffs must be cell arrays'</span>;
0198         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0199     <span class="keyword">elseif</span> length(rxnsToAdd.stoichCoeffs) ~= length(rxnsToAdd.mets)
0200         EM = <span class="string">'rxnsToAdd.stoichCoeffs must have the same number of elements as rxnsToAdd.mets'</span>;
0201         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0202     <span class="keyword">end</span>
0203     <span class="comment">%In this case we need lb to decide if the reaction is reversible or not:</span>
0204     <span class="keyword">if</span> ~isfield(rxnsToAdd,<span class="string">'lb'</span>)
0205         <span class="comment">%Fill with standard if it doesn't exist</span>
0206         rxnsToAdd.lb=-inf(size(rxnsToAdd.mets));
0207     <span class="keyword">elseif</span> ~isnumeric(rxnsToAdd.lb)
0208         EM = <span class="string">'rxnsToAdd.lb must be a vector'</span>;
0209         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0210     <span class="keyword">elseif</span> length(rxnsToAdd.lb) ~= length(rxnsToAdd.mets)
0211         EM = <span class="string">'rxnsToAdd.lb must have the same number of elements as rxnsToAdd.mets'</span>;
0212         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0213     <span class="keyword">end</span>
0214     <span class="comment">%Now we construct equations, to comply with the rest of the script:</span>
0215     rxnsToAdd.equations = cell(size(rxnsToAdd.mets));
0216     <span class="keyword">for</span> i = 1:length(rxnsToAdd.mets)
0217         mets         = rxnsToAdd.mets{i};
0218         stoichCoeffs = rxnsToAdd.stoichCoeffs{i};
0219         <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'ub'</span>)
0220             isrev        = rxnsToAdd.lb(i) &lt; 0 &amp;&amp; rxnsToAdd.ub(i) &gt; 0;
0221         <span class="keyword">else</span>
0222             isrev        = rxnsToAdd.lb(i) &lt; 0;
0223         <span class="keyword">end</span>
0224         rxnsToAdd.equations{i} = <a href="buildEquation.html" class="code" title="function equationString=buildEquation(mets,stoichCoeffs,isrev)">buildEquation</a>(mets,stoichCoeffs,isrev);
0225     <span class="keyword">end</span>
0226 <span class="keyword">end</span>
0227 
0228 nRxns=numel(rxnsToAdd.rxns);
0229 nOldRxns=numel(model.rxns);
0230 filler=cell(nRxns,1);
0231 filler(:)={<span class="string">''</span>};
0232 cellfiller=cellfun(@(x) cell(0,0),filler,<span class="string">'UniformOutput'</span>,false);
0233 largeFiller=cell(nOldRxns,1);
0234 largeFiller(:)={<span class="string">''</span>};
0235 celllargefiller=cellfun(@(x) cell(0,0),largeFiller,<span class="string">'UniformOutput'</span>,false);
0236 
0237 <span class="comment">%***Add everything to the model except for the equations.</span>
0238 <span class="keyword">if</span> numel(rxnsToAdd.equations)~=nRxns
0239     EM=<span class="string">'rxnsToAdd.equations must have the same number of elements as rxnsToAdd.rxns'</span>;
0240     <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0241 <span class="keyword">end</span>
0242 
0243 <span class="comment">%Parse the equations. This is done at this early stage since I need the</span>
0244 <span class="comment">%reversibility info</span>
0245 [S, mets, badRxns, reversible]=<a href="constructS.html" class="code" title="function [S, mets, badRxns, reversible]=constructS(equations,mets,rxns)">constructS</a>(rxnsToAdd.equations);
0246 EM=<span class="string">'The following equations have one or more metabolites both as substrate and product. Only the net equations will be added:'</span>;
0247 <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false,rxnsToAdd.rxns(badRxns));
0248 
0249 newModel.rev=[newModel.rev;reversible];
0250 newModel.rxns=[newModel.rxns;rxnsToAdd.rxns(:)];
0251 
0252 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNames'</span>)
0253     rxnsToAdd.rxnNames=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnNames);
0254     <span class="keyword">if</span> numel(rxnsToAdd.rxnNames)~=nRxns
0255         EM=<span class="string">'rxnsToAdd.rxnNames must have the same number of elements as rxnsToAdd.rxns'</span>;
0256         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0257     <span class="keyword">end</span>
0258     <span class="comment">%Fill with standard if it doesn't exist</span>
0259     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNames'</span>)
0260         newModel.rxnNames=largeFiller;
0261     <span class="keyword">end</span>
0262     newModel.rxnNames=[newModel.rxnNames;rxnsToAdd.rxnNames(:)];
0263 <span class="keyword">else</span>
0264     <span class="comment">%Fill with standard if it doesn't exist</span>
0265     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNames'</span>)
0266         newModel.rxnNames=[newModel.rxnNames;filler];
0267     <span class="keyword">end</span>
0268 <span class="keyword">end</span>
0269 
0270 <span class="keyword">if</span> isfield(newModel,<span class="string">'annotation'</span>) &amp; isfield(newModel.annotation,<span class="string">'defaultLB'</span>)
0271     newLb=newModel.annotation.defaultLB;
0272 <span class="keyword">else</span>
0273     newLb=-inf;
0274 <span class="keyword">end</span>
0275 
0276 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'lb'</span>)
0277     <span class="keyword">if</span> numel(rxnsToAdd.lb)~=nRxns
0278         EM=<span class="string">'rxnsToAdd.lb must have the same number of elements as rxnsToAdd.rxns'</span>;
0279         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0280     <span class="keyword">end</span>
0281     <span class="comment">%Fill with standard if it doesn't exist</span>
0282     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'lb'</span>)
0283         newModel.lb=zeros(nOldRxns,1);
0284         newModel.lb(newModel.rev~=0)=newLb;
0285     <span class="keyword">end</span>
0286     newModel.lb=[newModel.lb;rxnsToAdd.lb(:)];
0287 <span class="keyword">else</span>
0288     <span class="comment">%Fill with standard if it doesn't exist</span>
0289     <span class="keyword">if</span> isfield(newModel,<span class="string">'lb'</span>)
0290         I=zeros(nRxns,1);
0291         I(reversible~=0)=newLb;
0292         newModel.lb=[newModel.lb;I];
0293     <span class="keyword">end</span>
0294 <span class="keyword">end</span>
0295 
0296 <span class="keyword">if</span> isfield(newModel,<span class="string">'annotation'</span>) &amp; isfield(newModel.annotation,<span class="string">'defaultUB'</span>)
0297     newUb=newModel.annotation.defaultUB;
0298 <span class="keyword">else</span>
0299     newUb=inf;
0300 <span class="keyword">end</span>
0301 
0302 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'ub'</span>)
0303     <span class="keyword">if</span> numel(rxnsToAdd.ub)~=nRxns
0304         EM=<span class="string">'rxnsToAdd.ub must have the same number of elements as rxnsToAdd.rxns'</span>;
0305         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0306     <span class="keyword">end</span>
0307     <span class="comment">%Fill with standard if it doesn't exist</span>
0308     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'ub'</span>)
0309         newModel.ub=repmat(newUb,nOldRxns,1);
0310     <span class="keyword">end</span>
0311     newModel.ub=[newModel.ub;rxnsToAdd.ub(:)];
0312 <span class="keyword">else</span>
0313     <span class="comment">%Fill with standard if it doesn't exist</span>
0314     <span class="keyword">if</span> isfield(newModel,<span class="string">'ub'</span>)
0315         newModel.ub=[newModel.ub;repmat(newUb,nRxns,1)];
0316     <span class="keyword">end</span>
0317 <span class="keyword">end</span>
0318 
0319 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'c'</span>)
0320     <span class="keyword">if</span> numel(rxnsToAdd.c)~=nRxns
0321         EM=<span class="string">'rxnsToAdd.c must have the same number of elements as rxnsToAdd.rxns'</span>;
0322         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0323     <span class="keyword">end</span>
0324     <span class="comment">%Fill with standard if it doesn't exist</span>
0325     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'c'</span>)
0326         newModel.c=zeros(nOldRxns,1);
0327     <span class="keyword">end</span>
0328     newModel.c=[newModel.c;rxnsToAdd.c(:)];
0329 <span class="keyword">else</span>
0330     <span class="comment">%Fill with standard if it doesn't exist</span>
0331     <span class="keyword">if</span> isfield(newModel,<span class="string">'c'</span>)
0332         newModel.c=[newModel.c;zeros(nRxns,1)];
0333     <span class="keyword">end</span>
0334 <span class="keyword">end</span>
0335 
0336 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'eccodes'</span>)
0337     rxnsToAdd.eccodes=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.eccodes);
0338     <span class="keyword">if</span> numel(rxnsToAdd.eccodes)~=nRxns
0339         EM=<span class="string">'rxnsToAdd.eccodes must have the same number of elements as rxnsToAdd.rxns'</span>;
0340         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0341     <span class="keyword">end</span>
0342     <span class="comment">%Fill with standard if it doesn't exist</span>
0343     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'eccodes'</span>)
0344         newModel.eccodes=largeFiller;
0345     <span class="keyword">end</span>
0346     newModel.eccodes=[newModel.eccodes;rxnsToAdd.eccodes(:)];
0347 <span class="keyword">else</span>
0348     <span class="comment">%Fill with standard if it doesn't exist</span>
0349     <span class="keyword">if</span> isfield(newModel,<span class="string">'eccodes'</span>)
0350         newModel.eccodes=[newModel.eccodes;filler];
0351     <span class="keyword">end</span>
0352 <span class="keyword">end</span>
0353 
0354 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'subSystems'</span>)
0355     <span class="keyword">if</span> numel(rxnsToAdd.subSystems)~=nRxns
0356         EM=<span class="string">'rxnsToAdd.subSystems must have the same number of elements as rxnsToAdd.rxns'</span>;
0357         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0358     <span class="keyword">end</span>
0359     <span class="keyword">for</span> i=1:numel(rxnsToAdd.subSystems)
0360         <span class="keyword">if</span> ischar(rxnsToAdd.subSystems{i})
0361             rxnsToAdd.subSystems{i}=rxnsToAdd.subSystems(i);
0362         <span class="keyword">end</span>
0363     <span class="keyword">end</span>
0364     <span class="comment">%Fill with standard if it doesn't exist</span>
0365     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'subSystems'</span>)
0366         newModel.subSystems=celllargefiller;
0367     <span class="keyword">end</span>
0368     newModel.subSystems=[newModel.subSystems;rxnsToAdd.subSystems];
0369 <span class="keyword">else</span>
0370     <span class="comment">%Fill with standard if it doesn't exist</span>
0371     <span class="keyword">if</span> isfield(newModel,<span class="string">'subSystems'</span>)
0372         newModel.subSystems=[newModel.subSystems;cellfiller];
0373     <span class="keyword">end</span>
0374 <span class="keyword">end</span>
0375 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnMiriams'</span>)
0376     <span class="keyword">if</span> numel(rxnsToAdd.rxnMiriams)~=nRxns
0377         EM=<span class="string">'rxnsToAdd.rxnMiriams must have the same number of elements as rxnsToAdd.rxns'</span>;
0378         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0379     <span class="keyword">end</span>
0380     <span class="comment">%Fill with standard if it doesn't exist</span>
0381     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnMiriams'</span>)
0382         newModel.rxnMiriams=cell(nOldRxns,1);
0383     <span class="keyword">end</span>
0384     newModel.rxnMiriams=[newModel.rxnMiriams;rxnsToAdd.rxnMiriams(:)];
0385 <span class="keyword">else</span>
0386     <span class="comment">%Fill with standard if it doesn't exist</span>
0387     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnMiriams'</span>)
0388         newModel.rxnMiriams=[newModel.rxnMiriams;cell(nRxns,1)];
0389     <span class="keyword">end</span>
0390 <span class="keyword">end</span>
0391 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnComps'</span>)
0392     <span class="keyword">if</span> numel(rxnsToAdd.rxnComps)~=nRxns
0393         EM=<span class="string">'rxnsToAdd.rxnComps must have the same number of elements as rxnsToAdd.rxns'</span>;
0394         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0395     <span class="keyword">end</span>
0396     <span class="comment">%Fill with standard if it doesn't exist</span>
0397     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnComps'</span>)
0398         newModel.rxnComps=ones(nOldRxns,1);
0399         EM=<span class="string">'Adding reactions with compartment information to a model without such information. All existing reactions will be assigned to the first compartment'</span>;
0400         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false);
0401     <span class="keyword">end</span>
0402     newModel.rxnComps=[newModel.rxnComps;rxnsToAdd.rxnComps(:)];
0403 <span class="keyword">else</span>
0404     <span class="comment">%Fill with standard if it doesn't exist</span>
0405     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnComps'</span>)
0406         newModel.rxnComps=[newModel.rxnComps;ones(nRxns,1)];
0407         <span class="comment">%fprintf('NOTE: The added reactions will be assigned to the first</span>
0408         <span class="comment">%compartment\n');</span>
0409     <span class="keyword">end</span>
0410 <span class="keyword">end</span>
0411 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'grRules'</span>)
0412     rxnsToAdd.grRules=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.grRules);
0413     <span class="keyword">if</span> numel(rxnsToAdd.grRules)~=nRxns
0414         EM=<span class="string">'rxnsToAdd.grRules must have the same number of elements as rxnsToAdd.rxns'</span>;
0415         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0416     <span class="keyword">end</span>
0417     <span class="comment">%Fill with standard if it doesn't exist</span>
0418     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'grRules'</span>)
0419         newModel.grRules=largeFiller;
0420     <span class="keyword">end</span>
0421     newModel.grRules=[newModel.grRules;rxnsToAdd.grRules(:)];
0422 <span class="keyword">else</span>
0423     <span class="comment">%Fill with standard if it doesn't exist</span>
0424     <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0425         newModel.grRules=[newModel.grRules;filler];
0426     <span class="keyword">end</span>
0427 <span class="keyword">end</span>
0428 
0429 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnFrom'</span>)
0430     rxnsToAdd.rxnFrom=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnFrom);
0431     <span class="keyword">if</span> numel(rxnsToAdd.rxnFrom)~=nRxns
0432         EM=<span class="string">'rxnsToAdd.rxnFrom must have the same number of elements as rxnsToAdd.rxns'</span>;
0433         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0434     <span class="keyword">end</span>
0435     <span class="comment">%Fill with standard if it doesn't exist</span>
0436     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnFrom'</span>)
0437         newModel.rxnFrom=largeFiller;
0438     <span class="keyword">end</span>
0439     newModel.rxnFrom=[newModel.rxnFrom;rxnsToAdd.rxnFrom(:)];
0440 <span class="keyword">else</span>
0441     <span class="comment">%Fill with standard if it doesn't exist</span>
0442     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnFrom'</span>)
0443         newModel.rxnFrom=[newModel.rxnFrom;filler];
0444     <span class="keyword">end</span>
0445 <span class="keyword">end</span>
0446 
0447 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnNotes'</span>)
0448     rxnsToAdd.rxnNotes=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnNotes);
0449     <span class="keyword">if</span> numel(rxnsToAdd.rxnNotes)~=nRxns
0450         EM=<span class="string">'rxnsToAdd.rxnNotes must have the same number of elements as rxnsToAdd.rxns'</span>;
0451         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0452     <span class="keyword">end</span>
0453     <span class="comment">%Fill with standard if it doesn't exist</span>
0454     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnNotes'</span>)
0455         newModel.rxnNotes=largeFiller;
0456     <span class="keyword">end</span>
0457     newModel.rxnNotes=[newModel.rxnNotes;rxnsToAdd.rxnNotes(:)];
0458 <span class="keyword">else</span>
0459     <span class="comment">%Fill with standard if it doesn't exist</span>
0460     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnNotes'</span>)
0461         newModel.rxnNotes=[newModel.rxnNotes;filler];
0462     <span class="keyword">end</span>
0463 <span class="keyword">end</span>
0464 
0465 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnReferences'</span>)
0466     rxnsToAdd.rxnReferences=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.rxnReferences);
0467     <span class="keyword">if</span> numel(rxnsToAdd.rxnReferences)~=nRxns
0468         EM=<span class="string">'rxnsToAdd.rxnReferences must have the same number of elements as rxnsToAdd.rxns'</span>;
0469         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0470     <span class="keyword">end</span>
0471     <span class="comment">%Fill with standard if it doesn't exist</span>
0472     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnReferences'</span>)
0473         newModel.rxnReferences=largeFiller;
0474     <span class="keyword">end</span>
0475     newModel.rxnReferences=[newModel.rxnReferences;rxnsToAdd.rxnReferences(:)];
0476 <span class="keyword">else</span>
0477     <span class="comment">%Fill with standard if it doesn't exist</span>
0478     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnReferences'</span>)
0479         newModel.rxnReferences=[newModel.rxnReferences;filler];
0480     <span class="keyword">end</span>
0481 <span class="keyword">end</span>
0482 
0483 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'pwys'</span>)
0484     rxnsToAdd.pwys=<a href="convertCharArray.html" class="code" title="function inputConverted = convertCharArray(funcInput)">convertCharArray</a>(rxnsToAdd.pwys);
0485     <span class="keyword">if</span> numel(rxnsToAdd.pwys)~=nRxns
0486         EM=<span class="string">'rxnsToAdd.pwys must have the same number of elements as rxnsToAdd.rxns'</span>;
0487         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0488     <span class="keyword">end</span>
0489     <span class="comment">%Fill with standard if it doesn't exist</span>
0490     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'pwys'</span>)
0491         newModel.pwys=largeFiller;
0492     <span class="keyword">end</span>
0493     newModel.pwys=[newModel.pwys;rxnsToAdd.pwys(:)];
0494 <span class="keyword">else</span>
0495     <span class="comment">%Fill with standard if it doesn't exist</span>
0496     <span class="keyword">if</span> isfield(newModel,<span class="string">'pwys'</span>)
0497         newModel.pwys=[newModel.pwys;filler];
0498     <span class="keyword">end</span>
0499 <span class="keyword">end</span>
0500 
0501 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnConfidenceScores'</span>)
0502     <span class="keyword">if</span> numel(rxnsToAdd.rxnConfidenceScores)~=nRxns
0503         EM=<span class="string">'rxnsToAdd.rxnConfidenceScores must have the same number of elements as rxnsToAdd.rxns'</span>;
0504         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0505     <span class="keyword">end</span>
0506     <span class="comment">%Fill with standard if it doesn't exist</span>
0507     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnConfidenceScores'</span>)
0508         newModel.rxnConfidenceScores=NaN(nOldRxns,1);
0509     <span class="keyword">end</span>
0510     newModel.rxnConfidenceScores=[newModel.rxnConfidenceScores;rxnsToAdd.rxnConfidenceScores(:)];
0511 <span class="keyword">else</span>
0512     <span class="comment">%Fill with standard if it doesn't exist</span>
0513     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnConfidenceScores'</span>)
0514         newModel.rxnConfidenceScores=[newModel.rxnConfidenceScores;NaN(nRxns,1)];
0515     <span class="keyword">end</span>
0516 <span class="keyword">end</span>
0517 
0518 <span class="keyword">if</span> isfield(rxnsToAdd,<span class="string">'rxnDeltaG'</span>)
0519     <span class="keyword">if</span> numel(rxnsToAdd.rxnDeltaG)~=nRxns
0520         EM=<span class="string">'rxnsToAdd.rxnDeltaG must have the same number of elements as rxnsToAdd.rxns'</span>;
0521         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0522     <span class="keyword">end</span>
0523     <span class="comment">%Fill with standard if it doesn't exist</span>
0524     <span class="keyword">if</span> ~isfield(newModel,<span class="string">'rxnDeltaG'</span>)
0525         newModel.rxnDeltaG=NaN(nOldRxns,1);
0526     <span class="keyword">end</span>
0527     newModel.rxnDeltaG=[newModel.rxnDeltaG;rxnsToAdd.rxnDeltaG(:)];
0528 <span class="keyword">else</span>
0529     <span class="comment">%Fill with standard if it doesn't exist</span>
0530     <span class="keyword">if</span> isfield(newModel,<span class="string">'rxnDeltaG'</span>)
0531         newModel.rxnDeltaG=[newModel.rxnDeltaG;NaN(nRxns,1)];
0532     <span class="keyword">end</span>
0533 <span class="keyword">end</span>
0534 
0535 
0536 <span class="comment">%***Start parsing the equations and adding the info to the S matrix The</span>
0537 <span class="comment">%mets are matched to model.mets</span>
0538 <span class="keyword">if</span> eqnType==1
0539     [I, J]=ismember(mets,model.mets);
0540     <span class="keyword">if</span> ~all(I)
0541         <span class="keyword">if</span> allowNewMets==true || ischar(allowNewMets)
0542             <span class="comment">%Add the new mets</span>
0543             metsToAdd.mets=mets(~I);
0544             metsToAdd.metNames=metsToAdd.mets;
0545             metsToAdd.compartments=compartment;
0546             <span class="keyword">if</span> ischar(allowNewMets)
0547                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true,allowNewMets);
0548             <span class="keyword">else</span>
0549                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true);
0550             <span class="keyword">end</span>
0551         <span class="keyword">else</span>
0552             EM=<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function. Are you sure that eqnType=1?'</span>;
0553             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0554         <span class="keyword">end</span>
0555     <span class="keyword">end</span>
0556     <span class="comment">%Calculate the indexes of the metabolites and add the info</span>
0557     metIndexes=J;
0558     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0559 <span class="keyword">end</span>
0560 
0561 <span class="comment">%Do some stuff that is the same for eqnType=2 and eqnType=3</span>
0562 <span class="keyword">if</span> eqnType==2 || eqnType==3
0563     <span class="comment">%For later..</span>
0564     t2=strcat(model.metNames,<span class="string">'***'</span>,model.comps(model.metComps));
0565 <span class="keyword">end</span>
0566 
0567 <span class="comment">%The mets are matched to model.metNames and assigned to &quot;compartment&quot;</span>
0568 <span class="keyword">if</span> eqnType==2
0569     <span class="comment">%%Check that the metabolite names aren't present in the same</span>
0570     <span class="comment">%%compartment.</span>
0571     <span class="comment">%Not the neatest way maybe..</span>
0572     t1=strcat(mets,<span class="string">'***'</span>,compartment);
0573     [I, J]=ismember(t1,t2);
0574     
0575     <span class="keyword">if</span> ~all(I)
0576         <span class="keyword">if</span> allowNewMets==true || ischar(allowNewMets)
0577             <span class="comment">%Add the new mets</span>
0578             metsToAdd.metNames=mets(~I);
0579             metsToAdd.compartments=compartment;
0580             <span class="keyword">if</span> ischar(allowNewMets)
0581                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true,allowNewMets);
0582             <span class="keyword">else</span>
0583                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true);
0584             <span class="keyword">end</span>
0585         <span class="keyword">else</span>
0586             EM=<span class="string">'One or more equations contain metabolites that are not in model.mets. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0587             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0588         <span class="keyword">end</span>
0589     <span class="keyword">end</span>
0590     
0591     <span class="comment">%Calculate the indexes of the metabolites</span>
0592     metIndexes=J;
0593     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0594 <span class="keyword">end</span>
0595 
0596 <span class="comment">%The equations are on the form metNames[compName]</span>
0597 <span class="keyword">if</span> eqnType==3
0598     <span class="comment">%Parse the metabolite names</span>
0599     metNames=cell(numel(mets),1);
0600     compartments=metNames;
0601     <span class="keyword">for</span> i=1:numel(mets)
0602         starts=max(strfind(mets{i},<span class="string">'['</span>));
0603         ends=max(strfind(mets{i},<span class="string">']'</span>));
0604         
0605         <span class="comment">%Check that the formatting is correct</span>
0606         <span class="keyword">if</span> isempty(starts) || isempty(ends) || ends&lt;numel(mets{i})
0607             EM=[<span class="string">'The metabolite '</span> mets{i} <span class="string">' is not correctly formatted for eqnType=3'</span>];
0608             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0609         <span class="keyword">end</span>
0610         
0611         <span class="comment">%Check that the compartment is correct</span>
0612         compartments{i}=mets{i}(starts+1:ends-1);
0613         I=ismember(compartments(i),newModel.comps);
0614         <span class="keyword">if</span> ~I
0615             EM=[<span class="string">'The metabolite '</span> mets{i} <span class="string">' has a compartment that is not in model.comps'</span>];
0616             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0617         <span class="keyword">end</span>
0618         metNames{i}=mets{i}(1:starts-1);
0619     <span class="keyword">end</span>
0620     
0621     <span class="comment">%Check if the metabolite exists already</span>
0622     t1=strcat(metNames,<span class="string">'***'</span>,compartments);
0623     [I, J]=ismember(t1,t2);
0624     
0625     <span class="keyword">if</span> ~all(I)
0626         <span class="keyword">if</span> allowNewMets==true | ischar(allowNewMets)
0627             <span class="comment">%Add the new mets</span>
0628             metsToAdd.metNames=metNames(~I);
0629             metsToAdd.compartments=compartments(~I);
0630             <span class="keyword">if</span> ischar(allowNewMets)
0631                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true,allowNewMets);
0632             <span class="keyword">else</span>
0633                 newModel=<a href="addMets.html" class="code" title="function newModel=addMets(model,metsToAdd,copyInfo,prefix)">addMets</a>(newModel,metsToAdd,true);
0634             <span class="keyword">end</span>
0635         <span class="keyword">else</span>
0636             EM=<span class="string">'One or more equations contain metabolites that are not in model.metNames. Set allowNewMets to true to allow this function to add metabolites or use addMets to add them before calling this function'</span>;
0637             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0638         <span class="keyword">end</span>
0639     <span class="keyword">end</span>
0640     
0641     <span class="comment">%Calculate the indexes of the metabolites</span>
0642     metIndexes=J;
0643     metIndexes(~I)=numel(newModel.mets)-sum(~I)+1:numel(newModel.mets);
0644 <span class="keyword">end</span>
0645 
0646 <span class="comment">%Add the info to the stoichiometric matrix</span>
0647 newModel.S=[newModel.S sparse(size(newModel.S,1),nRxns)];
0648 
0649 <span class="keyword">for</span> i=1:nRxns
0650     newModel.S(metIndexes,nOldRxns+i)=S(:,i);
0651     <span class="comment">%Parse the grRules and check whether all genes in grRules appear in</span>
0652     <span class="comment">%genes</span>
0653     <span class="keyword">if</span> isfield(newModel,<span class="string">'grRules'</span>)
0654         rule=newModel.grRules{nOldRxns+i};
0655         rule=strrep(rule,<span class="string">'('</span>,<span class="string">''</span>);
0656         rule=strrep(rule,<span class="string">')'</span>,<span class="string">''</span>);
0657         rule=strrep(rule,<span class="string">' or '</span>,<span class="string">' '</span>);
0658         rule=strrep(rule,<span class="string">' and '</span>,<span class="string">' '</span>);
0659         genes=regexp(rule,<span class="string">' '</span>,<span class="string">'split'</span>);
0660         [I, J]=ismember(genes,newModel.genes);
0661         <span class="keyword">if</span> ~all(I) &amp;&amp; any(rule)
0662             EM=[<span class="string">'Not all genes for reaction '</span> rxnsToAdd.rxns{i} <span class="string">' were found in model.genes. If needed, add genes with addGenesRaven before calling this function, or set the ''allowNewGenes'' flag to true'</span>];
0663             <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM);
0664         <span class="keyword">end</span>
0665     <span class="keyword">end</span>
0666 <span class="keyword">end</span>
0667 
0668 <span class="comment">%Make temporary minimal model structure with only new rxns, to parse to</span>
0669 <span class="comment">%standardizeGrRules</span>
0670 newRxnsModel.genes=newModel.genes;
0671 newRxnsModel.grRules=newModel.grRules(length(model.rxns)+1:end);
0672 newRxnsModel.rxns=newModel.rxns(length(model.rxns)+1:end);
0673 
0674 <span class="comment">%Fix grRules and reconstruct rxnGeneMat</span>
0675 [grRules,rxnGeneMat] = <a href="standardizeGrRules.html" class="code" title="function [grRules,rxnGeneMat,indexes2check] = standardizeGrRules(model,embedded)">standardizeGrRules</a>(newRxnsModel,true);
0676 newModel.rxnGeneMat = [newModel.rxnGeneMat; rxnGeneMat];
0677 newModel.grRules = [newModel.grRules(1:nOldRxns); grRules];
0678 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
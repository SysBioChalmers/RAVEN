<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of simplifyModel</title>
  <meta name="keywords" content="simplifyModel">
  <meta name="description" content="simplifyModel">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">core</a> &gt; simplifyModel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for core&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>simplifyModel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>simplifyModel</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, constrainReversible, reservedRxns, suppressWarnings) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> simplifyModel
   Simplifies a model by deleting reactions/metabolites

   model                 a model structure
   deleteUnconstrained   delete metabolites marked as unconstrained (opt, default true)
   deleteDuplicates      delete all but one of duplicate reactions (opt, default false)
   deleteZeroInterval    delete reactions that are constrained to zero flux (opt, default false)
   deleteInaccessible    delete dead end reactions (opt, default false)
   deleteMinMax          delete reactions that cannot carry a flux by trying
                         to minimize/maximize the flux through that
                         reaction. May be time consuming (opt, default false)
   groupLinear           group linearly dependent pathways (opt, default false)
   constrainReversible   check if there are reversible reactions which can
                         only carry flux in one direction, and if so
                         constrain them to be irreversible. This tends to
                         allow for more reactions grouped when using
                         groupLinear (opt, default false)
   reservedRxns          cell array with reaction IDs that are not allowed to be
                         removed (opt)
   suppressWarnings      true if warnings should be suppressed (opt,
                         default false)

   reducedModel          an updated model structure
   deletedReactions      a cell array with the IDs of all deleted reactions
   deletedMetabolites    a cell array with the IDs of all deleted
                         metabolites

   This function is for reducing the model size by removing
   reactions and associated metabolites that cannot carry flux. It can also
   be used for identifying different types of gaps.

   Usage: [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,...
           deleteUnconstrained, deleteDuplicates, deleteZeroInterval,...
           deleteInaccessible, deleteMinMax, groupLinear,...
           constrainReversible, reservedRxns, suppressWarnings)

   Rasmus Agren, 2014-05-07</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="contractModel.html" class="code" title="function [reducedModel, removedRxns, indexedDuplicateRxns]=contractModel(model,distReverse)">contractModel</a>	contractModel</li><li><a href="convertToIrrev.html" class="code" title="function irrevModel=convertToIrrev(model,rxns)">convertToIrrev</a>	convertToIrrev</li><li><a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>	dispEM</li><li><a href="getAllowedBounds.html" class="code" title="function [minFluxes, maxFluxes, exitFlags]=getAllowedBounds(model,rxns)">getAllowedBounds</a>	getAllowedBounds</li><li><a href="getIndexes.html" class="code" title="function indexes=getIndexes(model, objects, type, returnLogical)">getIndexes</a>	getIndexes</li><li><a href="haveFlux.html" class="code" title="function I=haveFlux(model,cutOff,rxns)">haveFlux</a>	haveFlux</li><li><a href="removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>	removeMets</li><li><a href="removeReactions.html" class="code" title="function reducedModel=removeReactions(model,rxnsToRemove,removeUnusedMets,removeUnusedGenes,removeUnusedComps)">removeReactions</a>	removeReactions</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="fillGaps.html" class="code" title="function [newConnected, cannotConnect, addedRxns, newModel, exitFlag]=fillGaps(model,models,allowNetProduction,useModelConstraints,supressWarnings,rxnScores,params)">fillGaps</a>	fillGaps</li><li><a href="findGeneDeletions.html" class="code" title="function [genes, fluxes, originalGenes, details]=findGeneDeletions(model,testType,analysisType,refModel,oeFactor)">findGeneDeletions</a>	findGeneDeletions</li><li><a href="gapReport.html" class="code" title="function [noFluxRxns, noFluxRxnsRelaxed, subGraphs, notProducedMets, minToConnect,neededForProductionMat, canProduceWithoutInput, canConsumeWithoutOutput,connectedFromTemplates, addedFromTemplates]=gapReport(model, templateModels)">gapReport</a>	gapReport</li><li><a href="haveFlux.html" class="code" title="function I=haveFlux(model,cutOff,rxns)">haveFlux</a>	haveFlux</li><li><a href="printModelStats.html" class="code" title="function printModelStats(model, printModelIssues, printDetails)">printModelStats</a>	printModelStats</li><li><a href="randomSampling.html" class="code" title="function solutions=randomSampling(model, nSamples, replaceBoundsWithInf,supressErrors,showProgress)">randomSampling</a>	randomSampling</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,</a><span class="keyword">...</span>
0002     deleteUnconstrained, deleteDuplicates, deleteZeroInterval, deleteInaccessible, deleteMinMax, groupLinear, constrainReversible, reservedRxns, suppressWarnings)
0003 <span class="comment">% simplifyModel</span>
0004 <span class="comment">%   Simplifies a model by deleting reactions/metabolites</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   model                 a model structure</span>
0007 <span class="comment">%   deleteUnconstrained   delete metabolites marked as unconstrained (opt, default true)</span>
0008 <span class="comment">%   deleteDuplicates      delete all but one of duplicate reactions (opt, default false)</span>
0009 <span class="comment">%   deleteZeroInterval    delete reactions that are constrained to zero flux (opt, default false)</span>
0010 <span class="comment">%   deleteInaccessible    delete dead end reactions (opt, default false)</span>
0011 <span class="comment">%   deleteMinMax          delete reactions that cannot carry a flux by trying</span>
0012 <span class="comment">%                         to minimize/maximize the flux through that</span>
0013 <span class="comment">%                         reaction. May be time consuming (opt, default false)</span>
0014 <span class="comment">%   groupLinear           group linearly dependent pathways (opt, default false)</span>
0015 <span class="comment">%   constrainReversible   check if there are reversible reactions which can</span>
0016 <span class="comment">%                         only carry flux in one direction, and if so</span>
0017 <span class="comment">%                         constrain them to be irreversible. This tends to</span>
0018 <span class="comment">%                         allow for more reactions grouped when using</span>
0019 <span class="comment">%                         groupLinear (opt, default false)</span>
0020 <span class="comment">%   reservedRxns          cell array with reaction IDs that are not allowed to be</span>
0021 <span class="comment">%                         removed (opt)</span>
0022 <span class="comment">%   suppressWarnings      true if warnings should be suppressed (opt,</span>
0023 <span class="comment">%                         default false)</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%   reducedModel          an updated model structure</span>
0026 <span class="comment">%   deletedReactions      a cell array with the IDs of all deleted reactions</span>
0027 <span class="comment">%   deletedMetabolites    a cell array with the IDs of all deleted</span>
0028 <span class="comment">%                         metabolites</span>
0029 <span class="comment">%</span>
0030 <span class="comment">%   This function is for reducing the model size by removing</span>
0031 <span class="comment">%   reactions and associated metabolites that cannot carry flux. It can also</span>
0032 <span class="comment">%   be used for identifying different types of gaps.</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%   Usage: [reducedModel, deletedReactions, deletedMetabolites]=simplifyModel(model,...</span>
0035 <span class="comment">%           deleteUnconstrained, deleteDuplicates, deleteZeroInterval,...</span>
0036 <span class="comment">%           deleteInaccessible, deleteMinMax, groupLinear,...</span>
0037 <span class="comment">%           constrainReversible, reservedRxns, suppressWarnings)</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   Rasmus Agren, 2014-05-07</span>
0040 <span class="comment">%</span>
0041 
0042 <span class="keyword">if</span> nargin&lt;2
0043     deleteUnconstrained=true;
0044 <span class="keyword">end</span>
0045 <span class="keyword">if</span> nargin&lt;3
0046     deleteDuplicates=false;
0047 <span class="keyword">end</span>
0048 <span class="keyword">if</span> nargin&lt;4
0049     deleteZeroInterval=false;
0050 <span class="keyword">end</span>
0051 <span class="keyword">if</span> nargin&lt;5
0052     deleteInaccessible=false;
0053 <span class="keyword">end</span>
0054 <span class="keyword">if</span> nargin&lt;6
0055     deleteMinMax=false;
0056 <span class="keyword">end</span>
0057 <span class="keyword">if</span> nargin&lt;7
0058     groupLinear=false;
0059 <span class="keyword">end</span>
0060 <span class="keyword">if</span> nargin&lt;8
0061     constrainReversible=false;
0062 <span class="keyword">end</span>
0063 <span class="keyword">if</span> nargin&lt;9
0064     reservedRxns=[];
0065 <span class="keyword">end</span>
0066 <span class="keyword">if</span> nargin&lt;10
0067     suppressWarnings=false;
0068 <span class="keyword">end</span>
0069 
0070 reducedModel=model;
0071 deletedReactions={};
0072 deletedMetabolites={};
0073 
0074 <span class="keyword">if</span> deleteUnconstrained==true
0075     <span class="keyword">if</span> isfield(reducedModel,<span class="string">'unconstrained'</span>)
0076         <span class="comment">%Remove unbalanced metabolites</span>
0077         deletedMetabolites=reducedModel.mets(reducedModel.unconstrained~=0);
0078         reducedModel=<a href="removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(reducedModel,reducedModel.unconstrained~=0);
0079         reducedModel=rmfield(reducedModel,<span class="string">'unconstrained'</span>);
0080     <span class="keyword">end</span>
0081 <span class="keyword">end</span>
0082 
0083 <span class="keyword">if</span> deleteDuplicates==true
0084     <span class="comment">%Delete all but the last occurrence of duplicate reactions. The</span>
0085     <span class="comment">%reactions must have the same bounds, reversibility, and objective</span>
0086     <span class="comment">%coefficient to be regarded as duplicate</span>
0087     [reducedModel, rxnsToDelete, ~]=<a href="contractModel.html" class="code" title="function [reducedModel, removedRxns, indexedDuplicateRxns]=contractModel(model,distReverse)">contractModel</a>(reducedModel);
0088     deletedReactions=[deletedReactions; rxnsToDelete];
0089 <span class="keyword">end</span>
0090 
0091 <span class="keyword">if</span> deleteZeroInterval==true
0092     <span class="comment">%Find all reactions where both LB and UB are 0</span>
0093     zeroIntervalReactions=and(reducedModel.lb==0,reducedModel.ub==0);
0094     
0095     rxnsToDelete=setdiff(reducedModel.rxns(zeroIntervalReactions),reservedRxns);
0096     deletedReactions=[deletedReactions; rxnsToDelete];
0097     
0098     <span class="comment">%Remove reactions</span>
0099     reducedModel=<a href="removeReactions.html" class="code" title="function reducedModel=removeReactions(model,rxnsToRemove,removeUnusedMets,removeUnusedGenes,removeUnusedComps)">removeReactions</a>(reducedModel,rxnsToDelete);
0100     
0101     <span class="comment">%Find metabolites that no longer are used and delete them</span>
0102     notInUse=sum(reducedModel.S~=0,2)==0;
0103     deletedMetabolites=[deletedMetabolites;reducedModel.mets(notInUse)];
0104     
0105     <span class="comment">%Remove metabolites</span>
0106     reducedModel=<a href="removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(reducedModel,notInUse);
0107 <span class="keyword">end</span>
0108 
0109 <span class="keyword">if</span> deleteInaccessible==true
0110     <span class="comment">%Print a warning if exchange metabolites haven't been deleted yet. This</span>
0111     <span class="comment">%often means that the only allowed products are the metabolites that</span>
0112     <span class="comment">%are taken up be the system</span>
0113     <span class="keyword">if</span> isfield(reducedModel,<span class="string">'unconstrained'</span>) &amp;&amp; suppressWarnings==false
0114         EM=<span class="string">'Removing dead-end reactions before removing exchange metabolites'</span>;
0115         <a href="dispEM.html" class="code" title="function dispEM(string,throwErrors,toList,trimWarnings)">dispEM</a>(EM,false);
0116     <span class="keyword">end</span>
0117     
0118     <span class="keyword">while</span> true
0119         <span class="comment">%Find all metabolites that are only reactants or only products.</span>
0120         <span class="comment">%Delete those metabolites and reactions. This is done until no more</span>
0121         <span class="comment">%such reactions are found</span>
0122         
0123         <span class="comment">%Construct a stoichiometric matrix where all reactions are written</span>
0124         <span class="comment">%as reversible</span>
0125         
0126         <span class="comment">%Add fake exchange reactions if model.b~=0</span>
0127         in=any(reducedModel.b&lt;0,2);
0128         out=any(reducedModel.b&gt;0,2);
0129         I=speye(numel(reducedModel.mets));
0130         revS=[reducedModel.S,reducedModel.S(:,reducedModel.rev~=0)*-1 I(:,in) I(:,out)*-1];
0131         
0132         metUsage=sum(abs(revS')&gt;0);
0133         onlyProducts=sum(revS'&gt;0) == metUsage;
0134         onlyReactants=sum(revS'&lt;0) == metUsage;
0135         
0136         <span class="comment">%Also remove metabolites that only participate in one reversible</span>
0137         <span class="comment">%reaction Don't remove the ones in one reversible reaction if is</span>
0138         <span class="comment">%also has a non-zero coefficient in model.b</span>
0139         notInUse=onlyProducts | onlyReactants | (sum(abs(reducedModel.S')&gt;0)&lt;=1 &amp; (~in &amp; ~out)');
0140         deletedRxn=false;
0141         <span class="keyword">if</span> any(notInUse)
0142             <span class="comment">%Find their corresponding reactions</span>
0143             rxnsNotInUse=sum(abs(reducedModel.S(notInUse,:))&gt;0,1)&gt;0;
0144             rxnsToDelete=setdiff(reducedModel.rxns(rxnsNotInUse),reservedRxns);
0145             deletedReactions=[deletedReactions; rxnsToDelete];
0146             
0147             <span class="comment">%Remove reactions</span>
0148             reducedModel=<a href="removeReactions.html" class="code" title="function reducedModel=removeReactions(model,rxnsToRemove,removeUnusedMets,removeUnusedGenes,removeUnusedComps)">removeReactions</a>(reducedModel,rxnsToDelete);
0149             
0150             <span class="comment">%Remove metabolites. Recalculate since it could be that some</span>
0151             <span class="comment">%cannot be deleted due to reserved rxns</span>
0152             notInUse=sum(reducedModel.S~=0,2)==0;
0153             deletedMetabolites=[deletedMetabolites; reducedModel.mets(notInUse)];
0154             reducedModel=<a href="removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(reducedModel,notInUse);
0155             
0156             <span class="comment">%It could happen that it just finds reserved reactions and gets</span>
0157             <span class="comment">%stuck</span>
0158             <span class="keyword">if</span> ~isempty(rxnsToDelete)
0159                 deletedRxn=true;
0160             <span class="keyword">end</span>
0161         <span class="keyword">else</span>
0162             <span class="keyword">break</span>;
0163         <span class="keyword">end</span>
0164         <span class="keyword">if</span> deletedRxn==false
0165             <span class="keyword">break</span>;
0166         <span class="keyword">end</span>
0167     <span class="keyword">end</span>
0168 <span class="keyword">end</span>
0169 
0170 <span class="keyword">if</span> deleteMinMax==true
0171     <span class="comment">%Get reactions that can't carry fluxes. This should be done</span>
0172     <span class="comment">%algebraically if possible</span>
0173     I=~<a href="haveFlux.html" class="code" title="function I=haveFlux(model,cutOff,rxns)">haveFlux</a>(reducedModel);
0174     
0175     <span class="comment">%Remove reactions</span>
0176     rxnsToDelete=setdiff(reducedModel.rxns(I),reservedRxns);
0177     deletedReactions=[deletedReactions; rxnsToDelete];
0178     reducedModel=<a href="removeReactions.html" class="code" title="function reducedModel=removeReactions(model,rxnsToRemove,removeUnusedMets,removeUnusedGenes,removeUnusedComps)">removeReactions</a>(reducedModel,rxnsToDelete);
0179     
0180     <span class="comment">%Remove metabolites</span>
0181     notInUse=sum(reducedModel.S~=0,2)==0;
0182     deletedMetabolites=[deletedMetabolites; reducedModel.mets(notInUse)];
0183     reducedModel=<a href="removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(reducedModel,notInUse);
0184 <span class="keyword">end</span>
0185 
0186 <span class="keyword">if</span> constrainReversible==true
0187     revs=find(reducedModel.rev);
0188     [I,J]=<a href="getAllowedBounds.html" class="code" title="function [minFluxes, maxFluxes, exitFlags]=getAllowedBounds(model,rxns)">getAllowedBounds</a>(reducedModel,revs);
0189     
0190     I=abs(I);
0191     J=abs(J);
0192     
0193     <span class="comment">%Get the &quot;small&quot; values</span>
0194     K=I&lt;10^-10;
0195     L=J&lt;10^-10;
0196     
0197     <span class="comment">%Keep the values where only one direction is zero (small)</span>
0198     I(K==L)=[];
0199     J(K==L)=[];
0200     revs(K==L)=[];
0201     
0202     <span class="comment">%Change the reversibility of the remaining reactions</span>
0203     reducedModel.rev(revs(J&gt;10^-10))=0; <span class="comment">%Ignore reverse direction</span>
0204     reducedModel.lb(revs(J&gt;10^-10))=0;
0205     
0206     toSwitch=revs(I&gt;10^-10);
0207     reducedModel.rev(toSwitch)=0; <span class="comment">%Change directionality</span>
0208     reducedModel.ub(toSwitch)=reducedModel.lb(toSwitch)*-1;
0209     reducedModel.lb(toSwitch)=0;
0210     reducedModel.S(:,toSwitch)=reducedModel.S(:,toSwitch).*-1;
0211     reducedModel.c(toSwitch)=reducedModel.c(toSwitch)*-1;
0212 <span class="keyword">end</span>
0213 <span class="keyword">if</span> groupLinear==true
0214     <span class="keyword">if</span>  suppressWarnings==false
0215         fprintf(<span class="string">'NOTE: You have chosen to group linear reactions. This option does not keep track of gene/reaction associations when reactions are merged. Deleting all gene information\n'</span>);
0216     <span class="keyword">end</span>
0217     
0218     reducedModel.genes={};
0219     reducedModel.rxnGeneMat=sparse(numel(reducedModel.rxns),0);
0220     reducedModel.grRules(:)={<span class="string">''</span>};
0221     
0222     <span class="keyword">if</span> isfield(reducedModel,<span class="string">'geneShortNames'</span>)
0223         reducedModel.geneShortNames={};
0224     <span class="keyword">end</span>
0225     <span class="keyword">if</span> isfield(reducedModel,<span class="string">'geneMiriams'</span>)
0226         reducedModel.geneMiriams={};
0227     <span class="keyword">end</span>
0228     <span class="keyword">if</span> isfield(reducedModel,<span class="string">'geneComps'</span>)
0229         reducedModel.geneComps=[];
0230     <span class="keyword">end</span>
0231     
0232     <span class="comment">%Convert the model to irreversible</span>
0233     irrevModel=<a href="convertToIrrev.html" class="code" title="function irrevModel=convertToIrrev(model,rxns)">convertToIrrev</a>(reducedModel);
0234     
0235     <span class="comment">%Loop through and iteratively group linear reactions</span>
0236     <span class="keyword">while</span> 1
0237         <span class="comment">%Get the banned reaction indexes. Note that the indexes will change</span>
0238         <span class="comment">%in each iteration, but the names will not as they won't be merged</span>
0239         <span class="comment">%with any other reaction</span>
0240         bannedIndexes=<a href="getIndexes.html" class="code" title="function indexes=getIndexes(model, objects, type, returnLogical)">getIndexes</a>(irrevModel,reservedRxns,<span class="string">'rxns'</span>);
0241         
0242         <span class="comment">%Select all metabolites that are only present as reactants/products</span>
0243         <span class="comment">%in one reaction</span>
0244         singleNegative=find(sum(irrevModel.S'&lt;0)==1);
0245         singlePositive=find(sum(irrevModel.S'&gt;0)==1);
0246         
0247         <span class="comment">%Retrieve the common metabolites</span>
0248         common=intersect(singleNegative,singlePositive);
0249         
0250         mergedSome=false;
0251         
0252         <span class="comment">%Loop through each of them and see if the reactions should be</span>
0253         <span class="comment">%merged</span>
0254         <span class="keyword">for</span> i=1:numel(common)
0255             involvedRxns=find(irrevModel.S(common(i),:));
0256             
0257             <span class="comment">%Check so that one or both of the reactions haven't been merged</span>
0258             <span class="comment">%already</span>
0259             <span class="keyword">if</span> numel(involvedRxns)==2 &amp;&amp; isempty(intersect(bannedIndexes,involvedRxns))
0260                 <span class="comment">%Calculate how many times the second reaction has to be</span>
0261                 <span class="comment">%multiplied before being merged with the first</span>
0262                 stoichRatio=abs(irrevModel.S(common(i),involvedRxns(1))/irrevModel.S(common(i),involvedRxns(2)));
0263                 
0264                 <span class="comment">%Add the second to the first</span>
0265                 irrevModel.S(:,involvedRxns(1))=irrevModel.S(:,involvedRxns(1))+irrevModel.S(:,involvedRxns(2))*stoichRatio;
0266                 
0267                 <span class="comment">%Clear the second reaction</span>
0268                 irrevModel.S(:,involvedRxns(2))=0;
0269                 
0270                 <span class="comment">%This is to prevent numerical issues. It should be 0</span>
0271                 <span class="comment">%already</span>
0272                 irrevModel.S(common(i),involvedRxns(1))=0;
0273                 
0274                 <span class="comment">%At this point the second reaction is certain to be deleted</span>
0275                 <span class="comment">%in a later step and can therefore be ignored</span>
0276                 
0277                 <span class="comment">%Recalculate the bounds for the new reaction. This can be</span>
0278                 <span class="comment">%problematic since the scale of the bounds may change</span>
0279                 <span class="comment">%dramatically. Let the most constraining reaction determine</span>
0280                 <span class="comment">%the new bound</span>
0281                 lb1=irrevModel.lb(involvedRxns(1));
0282                 lb2=irrevModel.lb(involvedRxns(2));
0283                 ub1=irrevModel.ub(involvedRxns(1));
0284                 ub2=irrevModel.ub(involvedRxns(2));
0285                 
0286                 <span class="keyword">if</span> lb2~=-inf
0287                     irrevModel.lb(involvedRxns(1))=max(lb1,lb2/stoichRatio);
0288                 <span class="keyword">end</span>
0289                 <span class="keyword">if</span> ub2~=inf
0290                     irrevModel.ub(involvedRxns(1))=min(ub1,ub2/stoichRatio);
0291                 <span class="keyword">end</span>
0292                 
0293                 <span class="comment">%Then recalculate the objective coefficient. The resulting</span>
0294                 <span class="comment">%coefficient is the weighted sum of the previous</span>
0295                 irrevModel.c(involvedRxns(1))=irrevModel.c(involvedRxns(1))+irrevModel.c(involvedRxns(2))*stoichRatio;
0296                 
0297                 <span class="comment">%Iterate again</span>
0298                 mergedSome=true;
0299             <span class="keyword">end</span>
0300         <span class="keyword">end</span>
0301         
0302         <span class="comment">%All possible reactions merged</span>
0303         <span class="keyword">if</span> mergedSome==false
0304             <span class="keyword">break</span>;
0305         <span class="keyword">end</span>
0306         
0307         <span class="comment">%Now delete all reactions that involve no metabolites</span>
0308         I=find(sum(irrevModel.S~=0)==0);
0309         
0310         <span class="comment">%Remove reactions</span>
0311         irrevModel=<a href="removeReactions.html" class="code" title="function reducedModel=removeReactions(model,rxnsToRemove,removeUnusedMets,removeUnusedGenes,removeUnusedComps)">removeReactions</a>(irrevModel,I);
0312         
0313         <span class="comment">%Remove metabolites</span>
0314         notInUse=sum(irrevModel.S~=0,2)==0;
0315         irrevModel=<a href="removeMets.html" class="code" title="function reducedModel=removeMets(model,metsToRemove,isNames,removeUnusedRxns,removeUnusedGenes,removeUnusedComps)">removeMets</a>(irrevModel,notInUse);
0316     <span class="keyword">end</span>
0317     
0318     reducedModel=irrevModel;
0319 <span class="keyword">end</span>
0320 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 16-Oct-2018 13:07:34 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
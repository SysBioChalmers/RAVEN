<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of tinitTests</title>
  <meta name="keywords" content="tinitTests">
  <meta name="description" content="run this test case with the command">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">testing</a> &gt; <a href="index.html">unit_tests</a> &gt; tinitTests.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for testing\unit_tests&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>tinitTests
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>run this test case with the command</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function tests = tinitTests </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">run this test case with the command
results = runtests('tinitTests.m')</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function testparsexpTask1List(testCase)</a></li><li><a href="#_sub2" class="code">function testModel = getTstModel()</a></li><li><a href="#_sub3" class="code">function testModelRxnScores = getTstModelRxnScores()</a></li><li><a href="#_sub4" class="code">function testModelTasks = getTstModelTasks()</a></li><li><a href="#_sub5" class="code">function testModel2 = getTstModel2()</a></li><li><a href="#_sub6" class="code">function testModel4 = getTstModel4()</a></li><li><a href="#_sub7" class="code">function testModel4RxnScores = getTstModel4RxnScores()</a></li><li><a href="#_sub8" class="code">function testModel5 = getTstModel5()</a></li><li><a href="#_sub9" class="code">function testModel5RxnScores = getTstModel5RxnScores()</a></li><li><a href="#_sub10" class="code">function testftINIT_T0001(testCase)</a></li><li><a href="#_sub11" class="code">function testftINIT_T0002(testCase)</a></li><li><a href="#_sub12" class="code">function testftINIT_T0003(testCase)</a></li><li><a href="#_sub13" class="code">function testftINIT_T0004(testCase)</a></li><li><a href="#_sub14" class="code">function testftINIT_T0006(testCase)</a></li><li><a href="#_sub15" class="code">function testftINIT_T0007(testCase)</a></li><li><a href="#_sub16" class="code">function testftINIT_T0008(testCase)</a></li><li><a href="#_sub17" class="code">function testftINIT_T0009(testCase)</a></li><li><a href="#_sub18" class="code">function testModelL = getTstModelL()</a></li><li><a href="#_sub19" class="code">function testModelLGeneScores = getTstModelLGeneScores()</a></li><li><a href="#_sub20" class="code">function testftINIT_T0050(testCase)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%run this test case with the command</span>
0002 <span class="comment">%results = runtests('tinitTests.m')</span>
0003 <a name="_sub0" href="#_subfunctions" class="code">function tests = tinitTests</a>
0004 tests = functiontests(localfunctions);
0005 solverExist = [exist(<span class="string">'gurobi'</span>,<span class="string">'file'</span>), exist(<span class="string">'scip'</span>,<span class="string">'file'</span>)] ==3;
0006 <span class="keyword">if</span> all(~solverExist)
0007     disp(<span class="string">'No suitable solve (gurobi or scip) was found, ftINIT tests skipped.'</span>)
0008     skipTests = contains({tests.Name},<span class="string">'ftinit'</span>,<span class="string">'IgnoreCase'</span>,true);
0009     tests(skipTests) = [];
0010 <span class="keyword">elseif</span> solverExist(1)
0011     setRavenSolver(<span class="string">'gurobi'</span>);
0012 <span class="keyword">else</span>
0013     setRavenSolver(<span class="string">'soplex'</span>);
0014 <span class="keyword">end</span>
0015 <span class="keyword">end</span>
0016 
0017 <a name="_sub1" href="#_subfunctions" class="code">function testparsexpTask1List(testCase)</a>
0018     sourceDir = fileparts(which(mfilename));
0019     taskStruct = parseTaskList(strcat(sourceDir, <span class="string">'/test_data/test_tasks.txt'</span>));
0020     taskStructExcel = parseTaskList(strcat(sourceDir, <span class="string">'/test_data/test_tasks.xls'</span>));
0021     <span class="comment">%check that all fields in the first line are what we expect</span>
0022     
0023     expTask1.id=<span class="string">'ER'</span>;
0024     expTask1.description=<span class="string">'Aerobic rephosphorylation of ATP from glucose'</span>;
0025     expTask1.shouldFail=true;
0026     expTask1.printFluxes=true;
0027     expTask1.comments=<span class="string">'Messed up reaction'</span>;
0028     expTask1.inputs={<span class="string">'O2[s]'</span>;<span class="string">'glucose[s]'</span>};
0029     expTask1.LBin=[23.6;23.6];
0030     expTask1.UBin=[23.8;23.8];
0031     expTask1.outputs={<span class="string">'H2O[s]'</span>;<span class="string">'CO2[s]'</span>};
0032     expTask1.LBout=[26.1;26.1];
0033     expTask1.UBout=[26.2;26.2];
0034     expTask1.equations={<span class="string">'ATP[c] + H2O[c] =&gt; ADP[c] + Pi[c] + H+[c]'</span>};
0035     expTask1.LBequ=30.2;
0036     expTask1.UBequ=30.6;
0037     expTask1.changed={<span class="string">'ATP[a] + H2O[a] =&gt; ADP[a] + Pi[a] + H+[a]'</span>};
0038     expTask1.LBrxn=56.2;
0039     <span class="comment">%check that the check works as expected</span>
0040     verifyNotEqual(testCase,taskStruct(1),expTask1)
0041     expTask1.UBrxn=60;<span class="comment">%now add the last</span>
0042 
0043     
0044     verifyEqual(testCase,taskStruct(1),expTask1)
0045     verifyEqual(testCase,taskStructExcel(1),expTask1)
0046     
0047     <span class="comment">%check that we have 2 tasks in total</span>
0048     verifyEqual(testCase,length(taskStruct),2)
0049     verifyEqual(testCase,length(taskStructExcel),2)
0050 
0051     expTask2.id=<span class="string">'BS'</span>;
0052     expTask2.description=<span class="string">'ATP de novo synthesis'</span>;
0053     expTask2.shouldFail=false;
0054     expTask2.printFluxes=false;
0055     expTask2.comments=<span class="string">''</span>;
0056     expTask2.inputs={<span class="string">'O2[s]'</span>;<span class="string">'glucose[s]'</span>;<span class="string">'NH3[s]'</span>;<span class="string">'Pi[s]'</span>};
0057     expTask2.LBin=[0;0;0;0];
0058     expTask2.UBin=[1000;1000;1000;1000];
0059     expTask2.outputs={<span class="string">'H2O[s]'</span>;<span class="string">'CO2[s]'</span>;<span class="string">'ATP[c]'</span>};
0060     expTask2.LBout=[0;0;1];
0061     expTask2.UBout=[1.1;1.1;1.3];
0062     expTask2.equations={<span class="string">'ATP[c] + H2O[c] &lt;=&gt; ADP[c] + Pi[c] + H+[c]'</span>};
0063     expTask2.LBequ=-1000;
0064     expTask2.UBequ=1000;
0065     expTask2.changed={};
0066     expTask2.LBrxn=[];
0067     expTask2.UBrxn=[];
0068 
0069     verifyEqual(testCase,taskStruct(2),expTask2)
0070     verifyEqual(testCase,taskStructExcel(2),expTask2)
0071 
0072     <span class="comment">%and, check that the two formats produce the same</span>
0073     verifyEqual(testCase,taskStruct,taskStructExcel)
0074 <span class="keyword">end</span>
0075 
0076 
0077 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0078 <span class="comment">% testModel</span>
0079 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0080 
0081 <a name="_sub2" href="#_subfunctions" class="code">function testModel = getTstModel()</a>
0082     testModel = struct();
0083     testModel.id = <span class="string">'testModel'</span>;
0084     testModel.rxns = {};
0085     testModel.S=[];
0086     testModel.rev=[];
0087     testModel.mets = {<span class="string">'as'</span>;<span class="string">'ac'</span>;<span class="string">'bc'</span>;<span class="string">'cc'</span>;<span class="string">'dc'</span>;<span class="string">'ec'</span>;<span class="string">'es'</span>;<span class="string">'fc'</span>};
0088     testModel.metNames = {<span class="string">'a'</span>;<span class="string">'a'</span>;<span class="string">'b'</span>;<span class="string">'c'</span>;<span class="string">'d'</span>;<span class="string">'e'</span>;<span class="string">'e'</span>;<span class="string">'f'</span>};
0089     testModel.comps = {<span class="string">'s'</span>;<span class="string">'c'</span>};
0090     testModel.compNames = testModel.comps;
0091     testModel.metComps = [1;2;2;2;2;2;1;2];
0092     testModel.genes = {<span class="string">'G1'</span>;<span class="string">'G2'</span>;<span class="string">'G3'</span>;<span class="string">'G4'</span>;<span class="string">'G5'</span>;<span class="string">'G6'</span>;<span class="string">'G7'</span>;<span class="string">'G8'</span>;<span class="string">'G9'</span>;<span class="string">'G10'</span>};
0093     testModel.grRules = {};
0094     testModel.rxnGeneMat = [];
0095 
0096     rxnsToAdd = struct();
0097     rxnsToAdd.rxns = {<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>};
0098     rxnsToAdd.equations = {<span class="string">'=&gt; a[s]'</span>;<span class="keyword">...</span>
0099                            <span class="string">'a[s] &lt;=&gt; a[c]'</span>;<span class="keyword">...</span>
0100                            <span class="string">'a[c] &lt;=&gt; b[c] + c[c]'</span>;<span class="keyword">...</span>
0101                            <span class="string">'a[c] &lt;=&gt; 2 d[c]'</span>;<span class="keyword">...</span>
0102                            <span class="string">'b[c] + c[c] =&gt; e[c]'</span>;<span class="keyword">...</span>
0103                            <span class="string">'2 d[c] =&gt; e[c]'</span>;<span class="keyword">...</span>
0104                            <span class="string">'e[c] =&gt; e[s]'</span>;<span class="keyword">...</span>
0105                            <span class="string">'e[s] =&gt;'</span>;<span class="keyword">...</span>
0106                            <span class="string">'a[c] &lt;=&gt; f[c]'</span>;<span class="keyword">...</span>
0107                            <span class="string">'f[c] &lt;=&gt; e[c]'</span>};
0108     rxnsToAdd.grRules = {<span class="string">''</span>;<span class="string">''</span>;<span class="string">'G3'</span>;<span class="string">'G4'</span>;<span class="string">'G5'</span>;<span class="string">'G6'</span>;<span class="string">'G7'</span>;<span class="string">''</span>;<span class="string">'G9'</span>;<span class="string">'G10'</span>};
0109     testModel = addRxns(testModel,rxnsToAdd, 3);
0110     testModel.c = [0;0;0;0;0;0;0;1;0;0];<span class="comment">%optimize for output flux, if this is used, not sure</span>
0111     testModel.ub = repmat(1000,10,1);
0112     testModel.lb = [0;-1000;-1000;-1000;0;0;0;0;-1000;-1000];
0113     testModel.rxnNames = testModel.rxns;
0114     testModel.b = repmat(0,8,1);
0115 <span class="keyword">end</span>
0116 
0117 <a name="_sub3" href="#_subfunctions" class="code">function testModelRxnScores = getTstModelRxnScores()</a>
0118     testModelRxnScores = [-2;-2;-1;7;0.5;0.5;-1;-2;-3;3.5];
0119 <span class="keyword">end</span>
0120 
0121 <a name="_sub4" href="#_subfunctions" class="code">function testModelTasks = getTstModelTasks()</a>
0122     testModelTasks = struct();
0123     testModelTasks.id = <span class="string">'Gen e[s] from a[s]'</span>;
0124     testModelTasks.description = <span class="string">'Gen e[s] from a[s]'</span>;
0125     testModelTasks.shouldFail = false;
0126     testModelTasks.printFluxes = false;
0127     testModelTasks.comments = <span class="string">''</span>;
0128     testModelTasks.inputs = {<span class="string">'a[s]'</span>};
0129     testModelTasks.LBin = 0;
0130     testModelTasks.UBin = inf;
0131     testModelTasks.outputs = {<span class="string">'e[s]'</span>};
0132     testModelTasks.LBout = 1;
0133     testModelTasks.UBout = 1;
0134     testModelTasks.equations = {};
0135     testModelTasks.LBequ = [];
0136     testModelTasks.UBequ = [];
0137     testModelTasks.changed = {};
0138     testModelTasks.LBrxn = {};
0139     testModelTasks.UBrxn = {};
0140 <span class="keyword">end</span>
0141 
0142 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0143 <span class="comment">% testModel2 - not used directly for now, but indirectly</span>
0144 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0145 
0146 <a name="_sub5" href="#_subfunctions" class="code">function testModel2 = getTstModel2()</a>
0147     testModel2 = struct();
0148     testModel2.id = <span class="string">'testModel2'</span>;
0149     testModel2.rxns = {};
0150     testModel2.S=[];
0151     testModel2.rev=[];
0152     testModel2.mets = {<span class="string">'a'</span>;<span class="string">'b'</span>};
0153     testModel2.metNames = {<span class="string">'a'</span>;<span class="string">'b'</span>};
0154     testModel2.comps = {<span class="string">'s'</span>};
0155     testModel2.compNames = testModel2.comps;
0156     testModel2.metComps = [1;1];
0157     testModel2.genes = {<span class="string">'G1'</span>;<span class="string">'G2'</span>;<span class="string">'G3'</span>;<span class="string">'G4'</span>};
0158     testModel2.grRules = {};
0159     testModel2.rxnGeneMat = [];
0160 
0161     rxnsToAdd = struct();
0162     rxnsToAdd.rxns = {<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>};
0163     rxnsToAdd.equations = {<span class="string">'a[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0164                            <span class="string">'a[s] =&gt; b[s]'</span>;<span class="keyword">...</span>
0165                            <span class="string">'a[s] &lt;=&gt; b[s]'</span>;<span class="keyword">...</span>
0166                            <span class="string">'b[s] =&gt;'</span>};
0167     rxnsToAdd.grRules = testModel2.genes;
0168     testModel2 = addRxns(testModel2,rxnsToAdd,3,<span class="string">''</span>,true,true);
0169     testModel2.c = [0;0;0;1];<span class="comment">%optimize for output flux, if this is used, not sure</span>
0170     testModel2.ub = repmat(1000,4,1);
0171     testModel2.lb = [-1000;0;-1000;0];
0172     testModel2.rxnNames = testModel2.rxns;
0173     testModel2.b = zeros(2,1);
0174 <span class="keyword">end</span>
0175 
0176 <span class="comment">%    testRxnScores2 = [-1.1;-1;8;-1];</span>
0177 <span class="comment">%    testRxnScores2b = [-1.1;8;-1;-1];</span>
0178 
0179 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0180 <span class="comment">% testModel4</span>
0181 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0182 
0183 <a name="_sub6" href="#_subfunctions" class="code">function testModel4 = getTstModel4()</a>
0184     testModel2 = <a href="#_sub5" class="code" title="subfunction testModel2 = getTstModel2()">getTstModel2</a>();
0185     testModel4 = testModel2;
0186 
0187     rxnsToAdd = struct();
0188     rxnsToAdd.rxns = {<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>;<span class="string">'R11'</span>};
0189     rxnsToAdd.equations = {<span class="string">'5 a[s] &lt;=&gt; 5 d[s]'</span>;<span class="keyword">...</span>
0190                            <span class="string">'e[s] &lt;=&gt; d[s]'</span>;
0191                            <span class="string">'f[s] + g[s] &lt;=&gt; e[s]'</span>;
0192                            <span class="string">'b[s] &lt;=&gt; f[s]'</span>;
0193                            <span class="string">'h[s] &lt;=&gt; g[s]'</span>;
0194                            <span class="string">'h[s] =&gt;'</span>;
0195                            <span class="string">'e[s] =&gt; g[s]'</span>};
0196     rxnsToAdd.grRules = {<span class="string">'G5'</span>;<span class="string">'G6'</span>;<span class="string">'G7'</span>;<span class="string">'G8'</span>;<span class="string">'G9'</span>;<span class="string">'G10'</span>;<span class="string">'G11'</span>};
0197     [~,testModel4] = evalc(&quot;addRxns(testModel4,rxnsToAdd, 3, [], true, true);&quot;);
0198 <span class="keyword">end</span>
0199 
0200 <a name="_sub7" href="#_subfunctions" class="code">function testModel4RxnScores = getTstModel4RxnScores()</a>
0201     testModel4RxnScores = [-1;-1;2;-1;0.5;-2;1;1.3;-0.5;-0.4;8];
0202 <span class="keyword">end</span>
0203 
0204 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0205 <span class="comment">% testModel5</span>
0206 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0207 
0208 <a name="_sub8" href="#_subfunctions" class="code">function testModel5 = getTstModel5()</a>
0209     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0210 
0211     rxnsToAdd = struct();
0212     rxnsToAdd.rxns = {<span class="string">'R11'</span>;<span class="string">'R12'</span>;<span class="string">'R13'</span>;<span class="string">'R14'</span>};
0213     rxnsToAdd.equations = {<span class="string">'a[c] &lt;=&gt; g[c]'</span>;<span class="keyword">...</span>
0214                            <span class="string">'a[c] &lt;=&gt; g[c]'</span>;<span class="keyword">...</span>
0215                            <span class="string">'g[c] &lt;=&gt; e[c]'</span>;<span class="keyword">...</span>
0216                            <span class="string">'g[c] &lt;=&gt; e[c]'</span>};
0217     rxnsToAdd.grRules = {<span class="string">'G11'</span>;<span class="string">'G12'</span>;<span class="string">'G13'</span>;<span class="string">'G14'</span>};
0218     [~,testModel5] = evalc(&quot;addRxns(testModel,rxnsToAdd, 3, [], true, true);&quot;);
0219 <span class="keyword">end</span>
0220 
0221 <a name="_sub9" href="#_subfunctions" class="code">function testModel5RxnScores = getTstModel5RxnScores()</a>
0222     testModel5RxnScores = [<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();-1;-1.5;-1;-1.5];
0223 <span class="keyword">end</span>
0224 
0225 
0226 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0227 <span class="comment">%T0001: testModel without tasks</span>
0228 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0229 <a name="_sub10" href="#_subfunctions" class="code">function testftINIT_T0001(testCase)</a>
0230 <span class="comment">%    detectedMets = {};</span>
0231     testParams = struct();
0232 
0233 <span class="comment">%    params.TimeLimit = 10;</span>
0234 
0235     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0236     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {}, false, {}, ''s'');'</span>);
0237     <span class="comment">%check some things in the prepData</span>
0238     <span class="comment">%1. We expect 3 rxns in origRxnsToZero:</span>
0239     verifyTrue(testCase, all(strcmp(prepDataTest1.refModel.rxns(prepDataTest1.toIgnoreExch) , {<span class="string">'R1'</span>;<span class="string">'R8'</span>})))
0240     <span class="comment">%note that R7 should not be there, since it has a GPR.</span>
0241 
0242     arrayData1.genes = testModel.genes;
0243     arrayData1.tissues = {<span class="string">'a'</span>};
0244     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0245     arrayData1.threshold = 1;
0246     
0247     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0248 
0249     <span class="comment">%We expect R1 and R8 to be added since they have no GPRs and are exch rxns. The transport rxn R2 without GPR will however be removed,</span>
0250     <span class="comment">%since we in the standard setting run the third step with [1;0;0;0;1;0;0], meaning that such reactions will be removed</span>
0251     <span class="comment">%R7 however will not be added since it has a GPR</span>
0252     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0253 
0254     <span class="comment">%also test spontaneous</span>
0255     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {''R7'';''R10''}, false, {}, ''s'');'</span>);
0256     verifyTrue(testCase, all(strcmp(prepDataTest1.refModel.rxns(prepDataTest1.toIgnoreExch | prepDataTest1.toIgnoreSpont), {<span class="string">'R1'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R10'</span>})))
0257     arrayData1.genes = testModel.genes;
0258     arrayData1.tissues = {<span class="string">'a'</span>};
0259     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0260     arrayData1.threshold = 1;
0261     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0262     <span class="comment">%the model should now change to include the &quot;correct&quot; path (including 'R2') and</span>
0263     <span class="comment">%skip R9/R10:</span>
0264     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})), 1)
0265 <span class="keyword">end</span>
0266 
0267 
0268 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0269 <span class="comment">%T0002: Create a task that wants to generate e[s] from a[s] for testModel</span>
0270 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0271 <a name="_sub11" href="#_subfunctions" class="code">function testftINIT_T0002(testCase)</a>
0272     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0273     testModelTasks = <a href="#_sub4" class="code" title="subfunction testModelTasks = getTstModelTasks()">getTstModelTasks</a>();
0274     testRxnScores = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0275     testParams = struct();
0276     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, testModelTasks, {}, false, {}, ''s'');'</span>);
0277     <span class="comment">%We now expect to R2 and R7 to be essential. Note that R1 and R8 are not essential,</span>
0278     <span class="comment">%the exchange rxns are not used when checking tasks.</span>
0279     <span class="comment">%This is a bit complicated to check, because the essential rxns are expressed</span>
0280     <span class="comment">%as rxn ids of the linearly merged model. We expect those to be called R1 and R7:</span>
0281     verifyTrue(testCase, all(strcmp(prepDataTest1.essentialRxns,{<span class="string">'R1'</span>;<span class="string">'R7'</span>})))
0282 
0283     arrayData1.genes = testModel.genes;
0284     arrayData1.tissues = {<span class="string">'a'</span>};
0285     arrayData1.levels = getExprForRxnScore(testRxnScores);
0286     arrayData1.threshold = 1;
0287     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0288     <span class="comment">%Since both R2 and R7 are now essential, we expect all rxns to be on except R3 and</span>
0289     <span class="comment">%R5 (which have a negative total score and are not needed for the task)</span>
0290     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0291 <span class="keyword">end</span>
0292 
0293 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0294 <span class="comment">%T0003: The second step - gapfilling</span>
0295 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0296 <a name="_sub12" href="#_subfunctions" class="code">function testftINIT_T0003(testCase)</a>
0297     <span class="comment">%First generate a model with gaps. We can use testModel. First we add</span>
0298     <span class="comment">%boundary mets. Then we remove the exchange reactions</span>
0299     <span class="comment">%(which is required for filling gaps) and create a gap by removing the R7 reaction.</span>
0300     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0301     testModelTasks = <a href="#_sub4" class="code" title="subfunction testModelTasks = getTstModelTasks()">getTstModelTasks</a>();
0302     testRxnScores = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0303 
0304     mTempRef = closeModel(testModel);
0305     mTempRef = removeReactions(mTempRef, {<span class="string">'R1'</span>;<span class="string">'R8'</span>});
0306     mTemp = removeReactions(mTempRef, {<span class="string">'R7'</span>});
0307     mTemp.id = <span class="string">'tmp'</span>;
0308     tmpRxnScores = testRxnScores([2;3;4;5;6;7;9;10]);
0309     <span class="comment">%now check that R7 is added back</span>
0310     [~,outModel,addedRxnMat] = evalc(<span class="string">'ftINITFillGapsForAllTasks(mTemp,mTempRef,[],false,min(tmpRxnScores,-0.1),testModelTasks);'</span>);
0311     verifyTrue(testCase, all(strcmp(mTempRef.rxns(addedRxnMat),<span class="string">'R7'</span>)))<span class="comment">%ok</span>
0312 <span class="keyword">end</span>
0313 
0314 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0315 <span class="comment">%T0004: MergeLinear and groupRxnScores</span>
0316 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0317 <a name="_sub13" href="#_subfunctions" class="code">function testftINIT_T0004(testCase)</a>
0318     <span class="comment">%first testModel</span>
0319     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0320     testRxnScores = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0321     [reducedModel,origRxnIds,groupIds,reversedRxns]=mergeLinear(testModel, {});
0322     <span class="comment">%We expect mergeLinear to merge {R1,R2}, {R3,R5}, {R4,R6}, {R7,R8}, {R9,R10}</span>
0323     verifyTrue(testCase, all(groupIds == [1;1;2;3;2;3;4;4;5;5]))
0324     <span class="comment">%we expect R1, R3, R4, R7 to be irreversible, R9 to be reversible</span>
0325     verifyTrue(testCase, all(reducedModel.rev == [0;0;0;0;1]))
0326     verifyTrue(testCase, all(reducedModel.lb == [0;0;0;0;-1000]))
0327 
0328     newRxnScores=groupRxnScores(reducedModel, testRxnScores, origRxnIds, groupIds, ismember(origRxnIds, {<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R8'</span>}));
0329     verifyTrue(testCase, all(newRxnScores == [0;-0.5;7.5;-1;0.5]))
0330 
0331     <span class="comment">%then testModel4</span>
0332     testModel4 = <a href="#_sub6" class="code" title="subfunction testModel4 = getTstModel4()">getTstModel4</a>();
0333     [reducedModel,origRxnIds,groupIds,reversedRxns]=mergeLinear(testModel4, {});
0334     <span class="comment">%we expect {R5,R6},{R7,R8}, and{R9,R10} to be merged</span>
0335     verifyTrue(testCase, all(groupIds == [0;0;0;0;1;1;2;2;3;3;0]))
0336     <span class="comment">%check reversibility</span>
0337     verifyTrue(testCase, all(reducedModel.rev == [1;0;1;0;1;1;0;0]))
0338     <span class="comment">%check that some reactions have flipped direction when turned to irrev</span>
0339     verifyTrue(testCase, strcmp(constructEquations(reducedModel, <span class="string">'R9'</span>),<span class="string">'g[s] =&gt; '</span>))
0340     verifyTrue(testCase, all(find(reversedRxns) == [6;9]))
0341     <span class="comment">%constructEquations(testModel4)</span>
0342     <span class="comment">%constructEquations(reducedModel)</span>
0343 <span class="keyword">end</span>
0344 
0345 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0346 <span class="comment">%T0006: reverseRxns</span>
0347 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0348 
0349 <a name="_sub14" href="#_subfunctions" class="code">function testftINIT_T0006(testCase)</a>
0350     <span class="comment">%R1 = '=&gt; a[s]';...</span>
0351     <span class="comment">%R3 = 'a[c] &lt;=&gt; b[c] + c[c]';...</span>
0352     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0353 
0354     tmpModel = reverseRxns(testModel, {<span class="string">'R1'</span>;<span class="string">'R3'</span>});
0355     res = constructEquations(tmpModel, {<span class="string">'R1'</span>;<span class="string">'R3'</span>});
0356     expRes = {<span class="string">'a[s] =&gt; '</span>;<span class="string">'b[c] + c[c] &lt;=&gt; a[c]'</span>};
0357     verifyTrue(testCase, all(strcmp(res,expRes)))
0358 <span class="keyword">end</span>
0359 
0360 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0361 <span class="comment">%T0007: rescaleModelForINIT</span>
0362 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0363 <a name="_sub15" href="#_subfunctions" class="code">function testftINIT_T0007(testCase)</a>
0364     miniModel = struct();
0365     miniModel.S = [1,1000;-1,-40];
0366     miniModel.rxns = {<span class="string">'1'</span>;<span class="string">'2'</span>};
0367     miniModel.mets = {<span class="string">'1'</span>;<span class="string">'2'</span>};
0368     res = rescaleModelForINIT(miniModel,10);
0369     verifyTrue(testCase, abs(res.S(1,2) - res.S(2,2)*-10) &lt; 10^-6)
0370     verifyTrue(testCase, abs((abs(res.S(1,2)) + abs(res.S(2,2)))/2) - 1 &lt; 10^-6)
0371 <span class="keyword">end</span>
0372 
0373 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0374 <span class="comment">%T0008: testModel with metabolomics</span>
0375 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0376 <a name="_sub16" href="#_subfunctions" class="code">function testftINIT_T0008(testCase)</a>
0377     testParams = struct();
0378 
0379     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0380     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {}, false, {}, ''s'');'</span>);
0381 
0382     arrayData1.genes = testModel.genes;
0383     arrayData1.tissues = {<span class="string">'a'</span>};
0384     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0385     arrayData1.threshold = 1;
0386     
0387     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0388 
0389     <span class="comment">%First the same as in T0001 (we keep them here to make the test case understandable):</span>
0390     <span class="comment">%We expect R1 and R8 to be added since they have no GPRs and are exch rxns. The transport rxn R2 without GPR will however be removed,</span>
0391     <span class="comment">%since we in the standard setting run the third step with [1;0;0;0;1;0;0], meaning that such reactions will be removed</span>
0392     <span class="comment">%R7 however will not be added since it has a GPR</span>
0393     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0394 
0395     <span class="comment">%make R7 and R10 spontaneous (also same as in T0001)</span>
0396     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {''R7'';''R10''}, false, {}, ''s'');'</span>);
0397     verifyTrue(testCase, all(strcmp(prepDataTest1.refModel.rxns(prepDataTest1.toIgnoreExch | prepDataTest1.toIgnoreSpont), {<span class="string">'R1'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R10'</span>})))
0398     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0399     <span class="comment">%the model should now change to include the &quot;correct&quot; path (including 'R2') and</span>
0400     <span class="comment">%skip R9/R10:</span>
0401     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})))
0402     <span class="comment">%now, test to add the metabolite f - this should turn back the favor to R9/R10:</span>
0403     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,{''f''},getINITSteps(),true,true,testParams,false);'</span>);
0404     <span class="comment">%R9 should now be included, the presence of R2 is random</span>
0405     <span class="keyword">if</span> length(tst1ResModel1.rxns) == 7
0406         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0407     <span class="keyword">else</span>
0408         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0409     <span class="keyword">end</span>
0410     <span class="comment">%now, test to add the metabolite a, e, f - this should give the same result:</span>
0411     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,{''f'';''a'';''e''},getINITSteps(),true,true,testParams,false);'</span>);
0412     <span class="comment">%Should be the same as above (R2 is random)</span>
0413     <span class="keyword">if</span> length(tst1ResModel1.rxns) == 7
0414         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0415     <span class="keyword">else</span>
0416         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0417     <span class="keyword">end</span>
0418     
0419     <span class="comment">%now, test to add the metabolite b - this should turn on R2 and R3/R5 and turn off R9:</span>
0420     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,{''b''},getINITSteps(),true,true,testParams,false);'</span>);
0421     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})))
0422 
0423     <span class="comment">%now on model 5 to test reactions that are not linearly merged (testModel has only merged rxns)</span>
0424     testModel5 = <a href="#_sub8" class="code" title="subfunction testModel5 = getTstModel5()">getTstModel5</a>();
0425     arrayData1.genes = testModel5.genes;
0426     arrayData1.tissues = {<span class="string">'a'</span>};
0427     arrayData1.levels = getExprForRxnScore(<a href="#_sub9" class="code" title="subfunction testModel5RxnScores = getTstModel5RxnScores()">getTstModel5RxnScores</a>());
0428     arrayData1.threshold = 1;
0429     
0430     [~, prepDataTest5] = evalc(<span class="string">'prepINITModel(testModel5, {}, {''R7'';''R10''}, false, {}, ''s'');'</span>);
0431     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest5,arrayData1.tissues{1},[],[],arrayData1,{},getINITSteps(),true,true,testParams,false);'</span>);
0432     <span class="comment">%We expect the 'true' path, i.e. through R2, not R9/R10 or R11-R14</span>
0433     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})), 1)
0434 
0435     <span class="comment">%now add metabolite g</span>
0436     <span class="comment">%modify the scores a bit</span>
0437     [~, prepDataTest5] = evalc(<span class="string">'prepINITModel(testModel5, {}, {''R10''}, false, {}, ''s'');'</span>);
0438     arrayData1.levels(7) = getExprForRxnScore(-1.1); <span class="comment">%modify to avoid randomness</span>
0439     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest5,arrayData1.tissues{1},[],[],arrayData1,{''g''},getINITSteps(),true,true,testParams,false);'</span>);
0440     <span class="comment">%We expect R2 to be replaced with R11 and R13</span>
0441     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R8'</span>;<span class="string">'R11'</span>;<span class="string">'R13'</span>})), 1)
0442 <span class="keyword">end</span>
0443 
0444 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0445 <span class="comment">%T0009: getExprFromRxnScore</span>
0446 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0447 <a name="_sub17" href="#_subfunctions" class="code">function testftINIT_T0009(testCase)</a>
0448     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0449     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {}, false, {}, ''s'');'</span>);
0450 
0451     arrayData1.genes = testModel.genes;
0452     arrayData1.tissues = {<span class="string">'a'</span>};
0453     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0454     arrayData1.threshold = 1;
0455     
0456     rxnScores = scoreComplexModel(prepDataTest1.refModel,[],arrayData1,arrayData1.tissues{1},[]);
0457     expRes = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0458     verifyTrue(testCase, all(abs(rxnScores - expRes) &lt; 10^-10)) <span class="comment">%ok</span>
0459 <span class="keyword">end</span>
0460 
0461 <a name="_sub18" href="#_subfunctions" class="code">function testModelL = getTstModelL()</a>
0462 
0463     testModelL = struct();
0464     testModelL.id = <span class="string">'testModel'</span>;
0465     testModelL.rxns = {};
0466     testModelL.S=[];
0467     testModelL.rev=[];
0468     testModelL.metNames = {<span class="string">'e1'</span>;<span class="string">'e2'</span>;<span class="string">'e3'</span>;<span class="string">'e4'</span>;<span class="string">'e5'</span>;<span class="string">'e6'</span>;<span class="string">'e7'</span>;<span class="string">'e8'</span>;<span class="string">'e9'</span>;<span class="string">'e1'</span>;<span class="string">'e2'</span>;<span class="string">'e3'</span>;<span class="string">'e4'</span>;<span class="string">'e5'</span>;<span class="string">'e6'</span>;<span class="string">'e7'</span>;<span class="string">'e8'</span>;<span class="string">'e9'</span>;<span class="string">'x1'</span>;<span class="string">'x2'</span>;<span class="string">'x3'</span>;<span class="string">'x4'</span>;<span class="string">'x5'</span>;<span class="string">'x6'</span>;<span class="string">'x7'</span>;<span class="string">'x8'</span>;<span class="string">'x9'</span>;<span class="string">'x10'</span>;<span class="string">'x11'</span>};
0469     testModelL.comps = {<span class="string">'s'</span>;<span class="string">'c'</span>};
0470     testModelL.compNames = testModelL.comps;
0471     testModelL.metComps = [1;1;1;1;1;1;1;1;1;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2];
0472     testModelL.mets = strcat(testModelL.metNames, testModelL.comps(testModelL.metComps));
0473 
0474 
0475     testModelL.grRules = {};
0476     testModelL.rxnGeneMat = [];
0477 
0478     testModelL.genes = {<span class="string">'Ge1'</span>;<span class="string">'Ge2'</span>;<span class="string">'Ge4'</span>;<span class="string">'Ge5'</span>;<span class="string">'Ge7'</span>;<span class="string">'Ge9'</span>; <span class="string">'Gr1'</span>;<span class="string">'Gr2'</span>;<span class="string">'Gr3'</span>;<span class="string">'Gr5'</span>;<span class="string">'Gr6'</span>;<span class="string">'Gr7'</span>;<span class="string">'Gr8'</span>;<span class="string">'Gr9'</span>;<span class="string">'Gr10'</span>;<span class="string">'Gr11'</span>;<span class="string">'Gr12'</span>;<span class="string">'Gr14'</span>;<span class="string">'Gr15'</span>};
0479 
0480 
0481     testModelL.ub = [];
0482     testModelL.lb = [];
0483 
0484     rxnsToAdd = struct();
0485     rxnsToAdd.rxns = {  <span class="string">'S1'</span>;<span class="string">'S2'</span>;<span class="string">'S3'</span>;<span class="string">'S4'</span>;<span class="string">'S5'</span>;<span class="string">'S6'</span>;<span class="string">'S7'</span>;<span class="string">'S8'</span>;<span class="string">'S9'</span>;<span class="string">'E1'</span>;<span class="string">'E2'</span>;<span class="string">'E2b'</span>;<span class="string">'E3'</span>;<span class="string">'E4'</span>;<span class="string">'E5'</span>;<span class="string">'E6'</span>;<span class="string">'E7'</span>;<span class="string">'E8'</span>;<span class="string">'E9'</span>;<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>;<span class="string">'R11'</span>;<span class="string">'R12'</span>;<span class="string">'R13'</span>;<span class="string">'R14'</span>;<span class="string">'R15'</span>};
0486     rxnsToAdd.grRules = {<span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>; <span class="string">'Ge1'</span>;<span class="string">'Ge2'</span>;<span class="string">''</span>;<span class="string">''</span>;<span class="string">'Ge4'</span>;<span class="string">'Ge5'</span>;<span class="string">''</span>;<span class="string">'Ge7'</span>;<span class="string">''</span>;<span class="string">'Ge9'</span>; <span class="string">'Gr1'</span>;<span class="string">'Gr2'</span>;<span class="string">'Gr3'</span>;<span class="string">''</span>;<span class="string">'Gr5'</span>;<span class="string">'Gr6'</span>;<span class="string">'Gr7'</span>;<span class="string">'Gr8'</span>;<span class="string">'Gr9'</span>;<span class="string">'Gr10'</span>;<span class="string">'Gr11'</span>;<span class="string">'Gr12'</span>;<span class="string">''</span>;<span class="string">'Gr14'</span>;<span class="string">'Gr15'</span>};
0487     rxnsToAdd.equations = {<span class="string">'e1[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0488                            <span class="string">'e2[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0489                            <span class="string">'e3[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0490                            <span class="string">'e4[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0491                            <span class="string">'e5[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0492                            <span class="string">'e6[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0493                            <span class="string">'e7[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0494                            <span class="string">'e8[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0495                            <span class="string">'e9[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0496                            <span class="string">'e1[s] &lt;=&gt; e1[c]'</span>;<span class="keyword">...</span>
0497                            <span class="string">'e2[s] &lt;=&gt; e2[c]'</span>;<span class="keyword">...</span>
0498                            <span class="string">'e2[s] &lt;=&gt; e2[c]'</span>;<span class="keyword">...</span><span class="comment"> %b variant</span>
0499                            <span class="string">'e3[s] &lt;=&gt; e3[c]'</span>;<span class="keyword">...</span>
0500                            <span class="string">'e4[s] &lt;=&gt; e4[c]'</span>;<span class="keyword">...</span>
0501                            <span class="string">'e5[s] &lt;=&gt; e5[c]'</span>;<span class="keyword">...</span>
0502                            <span class="string">'e6[s] &lt;=&gt; e6[c]'</span>;<span class="keyword">...</span>
0503                            <span class="string">'e7[s] &lt;=&gt; e7[c]'</span>;<span class="keyword">...</span>
0504                            <span class="string">'e8[s] &lt;=&gt; e8[c]'</span>;<span class="keyword">...</span>
0505                            <span class="string">'e9[s] &lt;=&gt; e9[c]'</span>;<span class="keyword">...</span>
0506                            <span class="string">'e1[c] + e2[c] &lt;=&gt; x1[c]'</span>;<span class="keyword">...</span><span class="comment"> %R1</span>
0507                            <span class="string">'e1[c] + e3[c] =&gt; x2[c] + x3[c]'</span>;<span class="keyword">...</span><span class="comment"> %R2</span>
0508                            <span class="string">'e4[c] + x3[c] =&gt; x4[c] + x5[c]'</span>;<span class="keyword">...</span><span class="comment"> %R3</span>
0509                            <span class="string">'e5[c] + e6[c] + x4[c] =&gt; 2 x2[c] + x6[c]'</span>;<span class="keyword">...</span><span class="comment"> %R4</span>
0510                            <span class="string">'x1[c] + x2[c] &lt;=&gt; x7[c] + 2 x8[c]'</span>;<span class="keyword">...</span><span class="comment"> %R5</span>
0511                            <span class="string">'x2[c] + x8[c] =&gt; x3[c] + x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R6</span>
0512                            <span class="string">'x4[c] &lt;=&gt; x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R7</span>
0513                            <span class="string">'x5[c] &lt;=&gt; x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R8</span>
0514                            <span class="string">'x6[c] &lt;=&gt; x10[c]'</span>;<span class="keyword">...</span><span class="comment"> %R9</span>
0515                            <span class="string">'x6[c] &lt;=&gt; x11[c]'</span>;<span class="keyword">...</span><span class="comment"> %R10</span>
0516                            <span class="string">'x10[c] + 2 x11[c] =&gt; e7[c]'</span>;<span class="keyword">...</span><span class="comment"> %R11</span>
0517                            <span class="string">'x9[c] + x10[c] &lt;=&gt; e8[c]'</span>;<span class="keyword">...</span><span class="comment"> %R12</span>
0518                            <span class="string">'x7[c] + x8[c] + x9[c] =&gt; e9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R13</span>
0519                            <span class="string">'x6[c] =&gt; x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R14</span>
0520                            <span class="string">'x3[c] =&gt; x9[c]'</span><span class="keyword">...</span><span class="comment"> %R15</span>
0521                            };
0522     testModelL = addRxns(testModelL,rxnsToAdd, 3);
0523     testModelL.c = [0;0;0;0;0;0;0;1;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];<span class="comment">%optimize for output flux, if this is used, not sure</span>
0524     testModelL.rxnNames = testModelL.rxns;
0525     testModelL.b = repmat(0,length(testModelL.mets),1);
0526 <span class="keyword">end</span>
0527 
0528 <a name="_sub19" href="#_subfunctions" class="code">function testModelLGeneScores = getTstModelLGeneScores()</a>
0529     <span class="comment">%testModelL.genes = {'Ge1';'Ge2';'Ge4';'Ge5';'Ge7';'Ge9'; 'Gr1';'Gr2';'Gr3';'Gr5';'Gr6';'Gr7';'Gr8';'Gr9';'Gr10';'Gr11';'Gr12';'Gr14';'Gr15'};</span>
0530     testModelLGeneScores = [3; -1;   8;    6;    -5;    5;     4;    5;    2;    3;    6;    1;    3;    1;    -3;    1;     3;      1;    2];
0531 <span class="keyword">end</span>
0532 
0533 
0534 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0535 <span class="comment">%T0050: Test ftINIT on a slightly larger and more complex model</span>
0536 <span class="comment">%       Specifically tests if the three-step variant and the &quot;full&quot;</span>
0537 <span class="comment">%       variant gives similar results</span>
0538 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0539 <a name="_sub20" href="#_subfunctions" class="code">function testftINIT_T0050(testCase)</a>
0540     testModelL = <a href="#_sub18" class="code" title="subfunction testModelL = getTstModelL()">getTstModelL</a>();
0541     testModelLGeneScores = <a href="#_sub19" class="code" title="subfunction testModelLGeneScores = getTstModelLGeneScores()">getTstModelLGeneScores</a>();
0542     testParams = struct();
0543    
0544     arrayDataL = struct();
0545     arrayDataL.genes = testModelL.genes;
0546     arrayDataL.tissues = {<span class="string">'t1'</span>};
0547     arrayDataL.levels = getExprForRxnScore(testModelLGeneScores,1);
0548     arrayDataL.threshold = 1;
0549 
0550     <span class="comment">%Run prep data</span>
0551     [~, prepDataL] = evalc(<span class="string">'prepINITModel(testModelL, [], {}, false, {}, ''s'');'</span>);
0552 
0553     [~,mres] = evalc(<span class="string">'ftINIT(prepDataL,arrayDataL.tissues{1},[],[],arrayDataL,[],getINITSteps(),true,true,testParams,false);'</span>);
0554     [~,mres2] = evalc(<span class="string">'ftINIT(prepDataL,arrayDataL.tissues{1},[],[],arrayDataL,[],getINITSteps([], ''full''),true,true,testParams,false);'</span>);
0555     
0556     expResult = {  <span class="string">'S1'</span>;<span class="string">'S2'</span>;<span class="string">'S3'</span>;<span class="string">'S4'</span>;<span class="string">'S5'</span>;<span class="string">'S6'</span>;<span class="string">'S7'</span>;<span class="string">'S8'</span>;<span class="string">'S9'</span>;<span class="string">'E1'</span>;<span class="string">'E2'</span>;<span class="string">'E3'</span>;<span class="string">'E4'</span>;<span class="string">'E5'</span>;<span class="string">'E6'</span>;<span class="string">'E8'</span>;<span class="string">'E9'</span>;<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R12'</span>;<span class="string">'R13'</span>;<span class="string">'R14'</span>;<span class="string">'R15'</span>};
0557     
0558     verifyTrue(testCase, all(contains(mres.rxns,expResult)))
0559     verifyTrue(testCase, all(contains(mres2.rxns,expResult)))
0560 
0561     <span class="comment">%run the old tINIT version (in Human-GEM)</span>
0562     <span class="comment">%this is just to show that they become different, not really part of the test case</span>
0563     <span class="comment">%paramsL2 = struct();</span>
0564     <span class="comment">%paramsL2.TimeLimit = 1000;</span>
0565     <span class="comment">%testModelL2 = closeModel(testModelL);</span>
0566     <span class="comment">%init_modelOrig = getINITModel2(testModelL2,arrayDataL.tissues{1},[],[],arrayDataL,[],true,[],true,true,[],paramsL2);</span>
0567 
0568     <span class="comment">%in this call, I have modified the code - the possibility to turn off met secretion + don't allow flux in both directions is not possible.</span>
0569     <span class="comment">%The following line, around line 337, is changed</span>
0570     <span class="comment">%from:</span>
0571     <span class="comment">%[~, deletedRxnsInINIT, metProduction] = runINIT(simplifyModel(cModel),rxnScores,metabolomicsData,essentialRxnsForTasks,0,true,false,params);</span>
0572     <span class="comment">%to:</span>
0573     <span class="comment">%[~, deletedRxnsInINIT, metProduction] = runINIT(simplifyModel(cModel),rxnScores,metabolomicsData,essentialRxnsForTasks,0,false,true,params);</span>
0574     <span class="comment">%init_modelOrigNoSecrOneDirOnly = getINITModel2(testModelL2,arrayDataL.tissues{1},[],[],arrayDataL,[],true,[],true,true,[],paramsL2);</span>
0575 
0576     <span class="comment">%The models init_modelOrigNoSecrOneDirOnly and mres2 are very similar, (only one exch rxn differ, which is expected)</span>
0577     <span class="comment">%init_modelOrig is quite different, with a lot of gaps, and worse. So, the conclusion is that the new version does a pretty good job.</span>
0578 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of tinitTests</title>
  <meta name="keywords" content="tinitTests">
  <meta name="description" content="run this test case with the command">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">testing</a> &gt; <a href="index.html">unit_tests</a> &gt; tinitTests.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for testing\unit_tests&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>tinitTests
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>run this test case with the command</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function tests = tinitTests </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">run this test case with the command
results = runtests('tinitTests.m')</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function testparsexpTask1List(testCase)</a></li><li><a href="#_sub2" class="code">function testModel = getTstModel()</a></li><li><a href="#_sub3" class="code">function testModelRxnScores = getTstModelRxnScores()</a></li><li><a href="#_sub4" class="code">function testModelTasks = getTstModelTasks()</a></li><li><a href="#_sub5" class="code">function testModel2 = getTstModel2()</a></li><li><a href="#_sub6" class="code">function testModel4 = getTstModel4()</a></li><li><a href="#_sub7" class="code">function testModel4RxnScores = getTstModel4RxnScores()</a></li><li><a href="#_sub8" class="code">function testModel5 = getTstModel5()</a></li><li><a href="#_sub9" class="code">function testModel5RxnScores = getTstModel5RxnScores()</a></li><li><a href="#_sub10" class="code">function testftINIT_T0001(testCase)</a></li><li><a href="#_sub11" class="code">function testftINIT_T0002(testCase)</a></li><li><a href="#_sub12" class="code">function testftINIT_T0003(testCase)</a></li><li><a href="#_sub13" class="code">function testftINIT_T0004(testCase)</a></li><li><a href="#_sub14" class="code">function testftINIT_T0006(testCase)</a></li><li><a href="#_sub15" class="code">function testftINIT_T0007(testCase)</a></li><li><a href="#_sub16" class="code">function testftINIT_T0008(testCase)</a></li><li><a href="#_sub17" class="code">function testftINIT_T0009(testCase)</a></li><li><a href="#_sub18" class="code">function testModelL = getTstModelL()</a></li><li><a href="#_sub19" class="code">function testModelLGeneScores = getTstModelLGeneScores()</a></li><li><a href="#_sub20" class="code">function testftINIT_T0050(testCase)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%run this test case with the command</span>
0002 <span class="comment">%results = runtests('tinitTests.m')</span>
0003 <a name="_sub0" href="#_subfunctions" class="code">function tests = tinitTests</a>
0004     tests = functiontests(localfunctions);
0005 <span class="keyword">end</span>
0006 
0007 <a name="_sub1" href="#_subfunctions" class="code">function testparsexpTask1List(testCase)</a>
0008     sourceDir = fileparts(which(mfilename));
0009     taskStruct = parseTaskList(strcat(sourceDir, <span class="string">'/test_data/test_tasks.txt'</span>));
0010     taskStructExcel = parseTaskList(strcat(sourceDir, <span class="string">'/test_data/test_tasks.xls'</span>));
0011     <span class="comment">%check that all fields in the first line are what we expect</span>
0012     
0013     expTask1.id=<span class="string">'ER'</span>;
0014     expTask1.description=<span class="string">'Aerobic rephosphorylation of ATP from glucose'</span>;
0015     expTask1.shouldFail=true;
0016     expTask1.printFluxes=true;
0017     expTask1.comments=<span class="string">'Messed up reaction'</span>;
0018     expTask1.inputs={<span class="string">'O2[s]'</span>;<span class="string">'glucose[s]'</span>};
0019     expTask1.LBin=[23.6;23.6];
0020     expTask1.UBin=[23.8;23.8];
0021     expTask1.outputs={<span class="string">'H2O[s]'</span>;<span class="string">'CO2[s]'</span>};
0022     expTask1.LBout=[26.1;26.1];
0023     expTask1.UBout=[26.2;26.2];
0024     expTask1.equations={<span class="string">'ATP[c] + H2O[c] =&gt; ADP[c] + Pi[c] + H+[c]'</span>};
0025     expTask1.LBequ=30.2;
0026     expTask1.UBequ=30.6;
0027     expTask1.changed={<span class="string">'ATP[a] + H2O[a] =&gt; ADP[a] + Pi[a] + H+[a]'</span>};
0028     expTask1.LBrxn=56.2;
0029     <span class="comment">%check that the check works as expected</span>
0030     verifyNotEqual(testCase,taskStruct(1),expTask1)
0031     expTask1.UBrxn=60;<span class="comment">%now add the last</span>
0032 
0033     
0034     verifyEqual(testCase,taskStruct(1),expTask1)
0035     verifyEqual(testCase,taskStructExcel(1),expTask1)
0036     
0037     <span class="comment">%check that we have 2 tasks in total</span>
0038     verifyEqual(testCase,length(taskStruct),2)
0039     verifyEqual(testCase,length(taskStructExcel),2)
0040 
0041     expTask2.id=<span class="string">'BS'</span>;
0042     expTask2.description=<span class="string">'ATP de novo synthesis'</span>;
0043     expTask2.shouldFail=false;
0044     expTask2.printFluxes=false;
0045     expTask2.comments=<span class="string">''</span>;
0046     expTask2.inputs={<span class="string">'O2[s]'</span>;<span class="string">'glucose[s]'</span>;<span class="string">'NH3[s]'</span>;<span class="string">'Pi[s]'</span>};
0047     expTask2.LBin=[0;0;0;0];
0048     expTask2.UBin=[1000;1000;1000;1000];
0049     expTask2.outputs={<span class="string">'H2O[s]'</span>;<span class="string">'CO2[s]'</span>;<span class="string">'ATP[c]'</span>};
0050     expTask2.LBout=[0;0;1];
0051     expTask2.UBout=[1.1;1.1;1.3];
0052     expTask2.equations={<span class="string">'ATP[c] + H2O[c] &lt;=&gt; ADP[c] + Pi[c] + H+[c]'</span>};
0053     expTask2.LBequ=-1000;
0054     expTask2.UBequ=1000;
0055     expTask2.changed={};
0056     expTask2.LBrxn=[];
0057     expTask2.UBrxn=[];
0058 
0059     verifyEqual(testCase,taskStruct(2),expTask2)
0060     verifyEqual(testCase,taskStructExcel(2),expTask2)
0061 
0062     <span class="comment">%and, check that the two formats produce the same</span>
0063     verifyEqual(testCase,taskStruct,taskStructExcel)
0064 <span class="keyword">end</span>
0065 
0066 
0067 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0068 <span class="comment">% testModel</span>
0069 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0070 
0071 <a name="_sub2" href="#_subfunctions" class="code">function testModel = getTstModel()</a>
0072     testModel = struct();
0073     testModel.id = <span class="string">'testModel'</span>;
0074     testModel.rxns = {};
0075     testModel.S=[];
0076     testModel.rev=[];
0077     testModel.mets = {<span class="string">'as'</span>;<span class="string">'ac'</span>;<span class="string">'bc'</span>;<span class="string">'cc'</span>;<span class="string">'dc'</span>;<span class="string">'ec'</span>;<span class="string">'es'</span>;<span class="string">'fc'</span>};
0078     testModel.metNames = {<span class="string">'a'</span>;<span class="string">'a'</span>;<span class="string">'b'</span>;<span class="string">'c'</span>;<span class="string">'d'</span>;<span class="string">'e'</span>;<span class="string">'e'</span>;<span class="string">'f'</span>};
0079     testModel.comps = {<span class="string">'s'</span>;<span class="string">'c'</span>};
0080     testModel.compNames = testModel.comps;
0081     testModel.metComps = [1;2;2;2;2;2;1;2];
0082     testModel.genes = {<span class="string">'G1'</span>;<span class="string">'G2'</span>;<span class="string">'G3'</span>;<span class="string">'G4'</span>;<span class="string">'G5'</span>;<span class="string">'G6'</span>;<span class="string">'G7'</span>;<span class="string">'G8'</span>;<span class="string">'G9'</span>;<span class="string">'G10'</span>};
0083     testModel.grRules = {};
0084     testModel.rxnGeneMat = [];
0085 
0086     rxnsToAdd = struct();
0087     rxnsToAdd.rxns = {<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>};
0088     rxnsToAdd.equations = {<span class="string">'=&gt; a[s]'</span>;<span class="keyword">...</span>
0089                            <span class="string">'a[s] &lt;=&gt; a[c]'</span>;<span class="keyword">...</span>
0090                            <span class="string">'a[c] &lt;=&gt; b[c] + c[c]'</span>;<span class="keyword">...</span>
0091                            <span class="string">'a[c] &lt;=&gt; 2 d[c]'</span>;<span class="keyword">...</span>
0092                            <span class="string">'b[c] + c[c] =&gt; e[c]'</span>;<span class="keyword">...</span>
0093                            <span class="string">'2 d[c] =&gt; e[c]'</span>;<span class="keyword">...</span>
0094                            <span class="string">'e[c] =&gt; e[s]'</span>;<span class="keyword">...</span>
0095                            <span class="string">'e[s] =&gt;'</span>;<span class="keyword">...</span>
0096                            <span class="string">'a[c] &lt;=&gt; f[c]'</span>;<span class="keyword">...</span>
0097                            <span class="string">'f[c] &lt;=&gt; e[c]'</span>};
0098     rxnsToAdd.grRules = {<span class="string">''</span>;<span class="string">''</span>;<span class="string">'G3'</span>;<span class="string">'G4'</span>;<span class="string">'G5'</span>;<span class="string">'G6'</span>;<span class="string">'G7'</span>;<span class="string">''</span>;<span class="string">'G9'</span>;<span class="string">'G10'</span>};
0099     testModel = addRxns(testModel,rxnsToAdd, 3);
0100     testModel.c = [0;0;0;0;0;0;0;1;0;0];<span class="comment">%optimize for output flux, if this is used, not sure</span>
0101     testModel.ub = repmat(1000,10,1);
0102     testModel.lb = [0;-1000;-1000;-1000;0;0;0;0;-1000;-1000];
0103     testModel.rxnNames = testModel.rxns;
0104     testModel.b = repmat(0,8,1);
0105 <span class="keyword">end</span>
0106 
0107 <a name="_sub3" href="#_subfunctions" class="code">function testModelRxnScores = getTstModelRxnScores()</a>
0108     testModelRxnScores = [-2;-2;-1;7;0.5;0.5;-1;-2;-3;3.5];
0109 <span class="keyword">end</span>
0110 
0111 <a name="_sub4" href="#_subfunctions" class="code">function testModelTasks = getTstModelTasks()</a>
0112     testModelTasks = struct();
0113     testModelTasks.id = <span class="string">'Gen e[s] from a[s]'</span>;
0114     testModelTasks.description = <span class="string">'Gen e[s] from a[s]'</span>;
0115     testModelTasks.shouldFail = false;
0116     testModelTasks.printFluxes = false;
0117     testModelTasks.comments = <span class="string">''</span>;
0118     testModelTasks.inputs = {<span class="string">'a[s]'</span>};
0119     testModelTasks.LBin = 0;
0120     testModelTasks.UBin = inf;
0121     testModelTasks.outputs = {<span class="string">'e[s]'</span>};
0122     testModelTasks.LBout = 1;
0123     testModelTasks.UBout = 1;
0124     testModelTasks.equations = {};
0125     testModelTasks.LBequ = [];
0126     testModelTasks.UBequ = [];
0127     testModelTasks.changed = {};
0128     testModelTasks.LBrxn = {};
0129     testModelTasks.UBrxn = {};
0130 <span class="keyword">end</span>
0131 
0132 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0133 <span class="comment">% testModel2 - not used directly for now, but indirectly</span>
0134 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0135 
0136 <a name="_sub5" href="#_subfunctions" class="code">function testModel2 = getTstModel2()</a>
0137     testModel2 = struct();
0138     testModel2.id = <span class="string">'testModel2'</span>;
0139     testModel2.rxns = {};
0140     testModel2.S=[];
0141     testModel2.rev=[];
0142     testModel2.mets = {<span class="string">'a'</span>;<span class="string">'b'</span>};
0143     testModel2.metNames = {<span class="string">'a'</span>;<span class="string">'b'</span>};
0144     testModel2.comps = {<span class="string">'s'</span>};
0145     testModel2.compNames = testModel2.comps;
0146     testModel2.metComps = [1;1];
0147     testModel2.genes = {<span class="string">'G1'</span>;<span class="string">'G2'</span>;<span class="string">'G3'</span>;<span class="string">'G4'</span>};
0148     testModel2.grRules = {};
0149     testModel2.rxnGeneMat = [];
0150 
0151     rxnsToAdd = struct();
0152     rxnsToAdd.rxns = {<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>};
0153     rxnsToAdd.equations = {<span class="string">'a[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0154                            <span class="string">'a[s] =&gt; b[s]'</span>;<span class="keyword">...</span>
0155                            <span class="string">'a[s] &lt;=&gt; b[s]'</span>;<span class="keyword">...</span>
0156                            <span class="string">'b[s] =&gt;'</span>};
0157     rxnsToAdd.grRules = testModel2.genes;
0158     testModel2 = addRxns(testModel2,rxnsToAdd,3,<span class="string">''</span>,true,true);
0159     testModel2.c = [0;0;0;1];<span class="comment">%optimize for output flux, if this is used, not sure</span>
0160     testModel2.ub = repmat(1000,4,1);
0161     testModel2.lb = [-1000;0;-1000;0];
0162     testModel2.rxnNames = testModel2.rxns;
0163     testModel2.b = zeros(2,1);
0164 <span class="keyword">end</span>
0165 
0166 <span class="comment">%    testRxnScores2 = [-1.1;-1;8;-1];</span>
0167 <span class="comment">%    testRxnScores2b = [-1.1;8;-1;-1];</span>
0168 
0169 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0170 <span class="comment">% testModel4</span>
0171 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0172 
0173 <a name="_sub6" href="#_subfunctions" class="code">function testModel4 = getTstModel4()</a>
0174     testModel2 = <a href="#_sub5" class="code" title="subfunction testModel2 = getTstModel2()">getTstModel2</a>();
0175     testModel4 = testModel2;
0176 
0177     rxnsToAdd = struct();
0178     rxnsToAdd.rxns = {<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>;<span class="string">'R11'</span>};
0179     rxnsToAdd.equations = {<span class="string">'5 a[s] &lt;=&gt; 5 d[s]'</span>;<span class="keyword">...</span>
0180                            <span class="string">'e[s] &lt;=&gt; d[s]'</span>;
0181                            <span class="string">'f[s] + g[s] &lt;=&gt; e[s]'</span>;
0182                            <span class="string">'b[s] &lt;=&gt; f[s]'</span>;
0183                            <span class="string">'h[s] &lt;=&gt; g[s]'</span>;
0184                            <span class="string">'h[s] =&gt;'</span>;
0185                            <span class="string">'e[s] =&gt; g[s]'</span>};
0186     rxnsToAdd.grRules = {<span class="string">'G5'</span>;<span class="string">'G6'</span>;<span class="string">'G7'</span>;<span class="string">'G8'</span>;<span class="string">'G9'</span>;<span class="string">'G10'</span>;<span class="string">'G11'</span>};
0187     [~,testModel4] = evalc(&quot;addRxns(testModel4,rxnsToAdd, 3, [], true, true);&quot;);
0188 <span class="keyword">end</span>
0189 
0190 <a name="_sub7" href="#_subfunctions" class="code">function testModel4RxnScores = getTstModel4RxnScores()</a>
0191     testModel4RxnScores = [-1;-1;2;-1;0.5;-2;1;1.3;-0.5;-0.4;8];
0192 <span class="keyword">end</span>
0193 
0194 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0195 <span class="comment">% testModel5</span>
0196 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0197 
0198 <a name="_sub8" href="#_subfunctions" class="code">function testModel5 = getTstModel5()</a>
0199     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0200 
0201     rxnsToAdd = struct();
0202     rxnsToAdd.rxns = {<span class="string">'R11'</span>;<span class="string">'R12'</span>;<span class="string">'R13'</span>;<span class="string">'R14'</span>};
0203     rxnsToAdd.equations = {<span class="string">'a[c] &lt;=&gt; g[c]'</span>;<span class="keyword">...</span>
0204                            <span class="string">'a[c] &lt;=&gt; g[c]'</span>;<span class="keyword">...</span>
0205                            <span class="string">'g[c] &lt;=&gt; e[c]'</span>;<span class="keyword">...</span>
0206                            <span class="string">'g[c] &lt;=&gt; e[c]'</span>};
0207     rxnsToAdd.grRules = {<span class="string">'G11'</span>;<span class="string">'G12'</span>;<span class="string">'G13'</span>;<span class="string">'G14'</span>};
0208     [~,testModel5] = evalc(&quot;addRxns(testModel,rxnsToAdd, 3, [], true, true);&quot;);
0209 <span class="keyword">end</span>
0210 
0211 <a name="_sub9" href="#_subfunctions" class="code">function testModel5RxnScores = getTstModel5RxnScores()</a>
0212     testModel5RxnScores = [<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();-1;-1.5;-1;-1.5];
0213 <span class="keyword">end</span>
0214 
0215 
0216 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0217 <span class="comment">%T0001: testModel without tasks</span>
0218 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0219 <a name="_sub10" href="#_subfunctions" class="code">function testftINIT_T0001(testCase)</a>
0220 <span class="comment">%    detectedMets = {};</span>
0221     testParams = struct();
0222 
0223 <span class="comment">%    params.TimeLimit = 10;</span>
0224 
0225     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0226     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {}, false, {}, ''s'');'</span>);
0227     <span class="comment">%check some things in the prepData</span>
0228     <span class="comment">%1. We expect 3 rxns in origRxnsToZero:</span>
0229     verifyTrue(testCase, all(strcmp(prepDataTest1.refModel.rxns(prepDataTest1.toIgnoreExch) , {<span class="string">'R1'</span>;<span class="string">'R8'</span>})))
0230     <span class="comment">%note that R7 should not be there, since it has a GPR.</span>
0231 
0232     arrayData1.genes = testModel.genes;
0233     arrayData1.tissues = {<span class="string">'a'</span>};
0234     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0235     arrayData1.threshold = 1;
0236     
0237     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0238 
0239     <span class="comment">%We expect R1 and R8 to be added since they have no GPRs and are exch rxns. The transport rxn R2 without GPR will however be removed,</span>
0240     <span class="comment">%since we in the standard setting run the third step with [1;0;0;0;1;0;0], meaning that such reactions will be removed</span>
0241     <span class="comment">%R7 however will not be added since it has a GPR</span>
0242     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0243 
0244     <span class="comment">%also test spontaneous</span>
0245     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {''R7'';''R10''}, false, {}, ''s'');'</span>);
0246     verifyTrue(testCase, all(strcmp(prepDataTest1.refModel.rxns(prepDataTest1.toIgnoreExch | prepDataTest1.toIgnoreSpont), {<span class="string">'R1'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R10'</span>})))
0247     arrayData1.genes = testModel.genes;
0248     arrayData1.tissues = {<span class="string">'a'</span>};
0249     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0250     arrayData1.threshold = 1;
0251     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0252     <span class="comment">%the model should now change to include the &quot;correct&quot; path (including 'R2') and</span>
0253     <span class="comment">%skip R9/R10:</span>
0254     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})), 1)
0255 <span class="keyword">end</span>
0256 
0257 
0258 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0259 <span class="comment">%T0002: Create a task that wants to generate e[s] from a[s] for testModel</span>
0260 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0261 <a name="_sub11" href="#_subfunctions" class="code">function testftINIT_T0002(testCase)</a>
0262     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0263     testModelTasks = <a href="#_sub4" class="code" title="subfunction testModelTasks = getTstModelTasks()">getTstModelTasks</a>();
0264     testRxnScores = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0265     testParams = struct();
0266     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, testModelTasks, {}, false, {}, ''s'');'</span>);
0267     <span class="comment">%We now expect to R2 and R7 to be essential. Note that R1 and R8 are not essential,</span>
0268     <span class="comment">%the exchange rxns are not used when checking tasks.</span>
0269     <span class="comment">%This is a bit complicated to check, because the essential rxns are expressed</span>
0270     <span class="comment">%as rxn ids of the linearly merged model. We expect those to be called R1 and R7:</span>
0271     verifyTrue(testCase, all(strcmp(prepDataTest1.essentialRxns,{<span class="string">'R1'</span>;<span class="string">'R7'</span>})))
0272 
0273     arrayData1.genes = testModel.genes;
0274     arrayData1.tissues = {<span class="string">'a'</span>};
0275     arrayData1.levels = getExprForRxnScore(testRxnScores);
0276     arrayData1.threshold = 1;
0277     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0278     <span class="comment">%Since both R2 and R7 are now essential, we expect all rxns to be on except R3 and</span>
0279     <span class="comment">%R5 (which have a negative total score and are not needed for the task)</span>
0280     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0281 <span class="keyword">end</span>
0282 
0283 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0284 <span class="comment">%T0003: The second step - gapfilling</span>
0285 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0286 <a name="_sub12" href="#_subfunctions" class="code">function testftINIT_T0003(testCase)</a>
0287     <span class="comment">%First generate a model with gaps. We can use testModel. First we add</span>
0288     <span class="comment">%boundary mets. Then we remove the exchange reactions</span>
0289     <span class="comment">%(which is required for filling gaps) and create a gap by removing the R7 reaction.</span>
0290     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0291     testModelTasks = <a href="#_sub4" class="code" title="subfunction testModelTasks = getTstModelTasks()">getTstModelTasks</a>();
0292     testRxnScores = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0293 
0294     mTempRef = closeModel(testModel);
0295     mTempRef = removeReactions(mTempRef, {<span class="string">'R1'</span>;<span class="string">'R8'</span>});
0296     mTemp = removeReactions(mTempRef, {<span class="string">'R7'</span>});
0297     mTemp.id = <span class="string">'tmp'</span>;
0298     tmpRxnScores = testRxnScores([2;3;4;5;6;7;9;10]);
0299     <span class="comment">%now check that R7 is added back</span>
0300     [~,outModel,addedRxnMat] = evalc(<span class="string">'ftINITFillGapsForAllTasks(mTemp,mTempRef,[],false,min(tmpRxnScores,-0.1),testModelTasks);'</span>);
0301     verifyTrue(testCase, all(strcmp(mTempRef.rxns(addedRxnMat),<span class="string">'R7'</span>)))<span class="comment">%ok</span>
0302 <span class="keyword">end</span>
0303 
0304 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0305 <span class="comment">%T0004: MergeLinear and groupRxnScores</span>
0306 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0307 <a name="_sub13" href="#_subfunctions" class="code">function testftINIT_T0004(testCase)</a>
0308     <span class="comment">%first testModel</span>
0309     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0310     testRxnScores = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0311     [reducedModel,origRxnIds,groupIds,reversedRxns]=mergeLinear(testModel, {});
0312     <span class="comment">%We expect mergeLinear to merge {R1,R2}, {R3,R5}, {R4,R6}, {R7,R8}, {R9,R10}</span>
0313     verifyTrue(testCase, all(groupIds == [1;1;2;3;2;3;4;4;5;5]))
0314     <span class="comment">%we expect R1, R3, R4, R7 to be irreversible, R9 to be reversible</span>
0315     verifyTrue(testCase, all(reducedModel.rev == [0;0;0;0;1]))
0316     verifyTrue(testCase, all(reducedModel.lb == [0;0;0;0;-1000]))
0317 
0318     newRxnScores=groupRxnScores(reducedModel, testRxnScores, origRxnIds, groupIds, ismember(origRxnIds, {<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R8'</span>}));
0319     verifyTrue(testCase, all(newRxnScores == [0;-0.5;7.5;-1;0.5]))
0320 
0321     <span class="comment">%then testModel4</span>
0322     testModel4 = <a href="#_sub6" class="code" title="subfunction testModel4 = getTstModel4()">getTstModel4</a>();
0323     [reducedModel,origRxnIds,groupIds,reversedRxns]=mergeLinear(testModel4, {});
0324     <span class="comment">%we expect {R5,R6},{R7,R8}, and{R9,R10} to be merged</span>
0325     verifyTrue(testCase, all(groupIds == [0;0;0;0;1;1;2;2;3;3;0]))
0326     <span class="comment">%check reversibility</span>
0327     verifyTrue(testCase, all(reducedModel.rev == [1;0;1;0;1;1;0;0]))
0328     <span class="comment">%check that some reactions have flipped direction when turned to irrev</span>
0329     verifyTrue(testCase, strcmp(constructEquations(reducedModel, <span class="string">'R9'</span>),<span class="string">'g[s] =&gt; '</span>))
0330     verifyTrue(testCase, all(find(reversedRxns) == [6;9]))
0331     <span class="comment">%constructEquations(testModel4)</span>
0332     <span class="comment">%constructEquations(reducedModel)</span>
0333 <span class="keyword">end</span>
0334 
0335 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0336 <span class="comment">%T0006: reverseRxns</span>
0337 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0338 
0339 <a name="_sub14" href="#_subfunctions" class="code">function testftINIT_T0006(testCase)</a>
0340     <span class="comment">%R1 = '=&gt; a[s]';...</span>
0341     <span class="comment">%R3 = 'a[c] &lt;=&gt; b[c] + c[c]';...</span>
0342     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0343 
0344     tmpModel = reverseRxns(testModel, {<span class="string">'R1'</span>;<span class="string">'R3'</span>});
0345     res = constructEquations(tmpModel, {<span class="string">'R1'</span>;<span class="string">'R3'</span>});
0346     expRes = {<span class="string">'a[s] =&gt; '</span>;<span class="string">'b[c] + c[c] &lt;=&gt; a[c]'</span>};
0347     verifyTrue(testCase, all(strcmp(res,expRes)))
0348 <span class="keyword">end</span>
0349 
0350 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0351 <span class="comment">%T0007: rescaleModelForINIT</span>
0352 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0353 <a name="_sub15" href="#_subfunctions" class="code">function testftINIT_T0007(testCase)</a>
0354     miniModel = struct();
0355     miniModel.S = [1,1000;-1,-40];
0356     miniModel.rxns = {<span class="string">'1'</span>;<span class="string">'2'</span>};
0357     miniModel.mets = {<span class="string">'1'</span>;<span class="string">'2'</span>};
0358     res = rescaleModelForINIT(miniModel,10);
0359     verifyTrue(testCase, abs(res.S(1,2) - res.S(2,2)*-10) &lt; 10^-6)
0360     verifyTrue(testCase, abs((abs(res.S(1,2)) + abs(res.S(2,2)))/2) - 1 &lt; 10^-6)
0361 <span class="keyword">end</span>
0362 
0363 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0364 <span class="comment">%T0008: testModel with metabolomics</span>
0365 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0366 <a name="_sub16" href="#_subfunctions" class="code">function testftINIT_T0008(testCase)</a>
0367     testParams = struct();
0368 
0369     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0370     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {}, false, {}, ''s'');'</span>);
0371 
0372     arrayData1.genes = testModel.genes;
0373     arrayData1.tissues = {<span class="string">'a'</span>};
0374     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0375     arrayData1.threshold = 1;
0376     
0377     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0378 
0379     <span class="comment">%First the same as in T0001 (we keep them here to make the test case understandable):</span>
0380     <span class="comment">%We expect R1 and R8 to be added since they have no GPRs and are exch rxns. The transport rxn R2 without GPR will however be removed,</span>
0381     <span class="comment">%since we in the standard setting run the third step with [1;0;0;0;1;0;0], meaning that such reactions will be removed</span>
0382     <span class="comment">%R7 however will not be added since it has a GPR</span>
0383     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0384 
0385     <span class="comment">%make R7 and R10 spontaneous (also same as in T0001)</span>
0386     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {''R7'';''R10''}, false, {}, ''s'');'</span>);
0387     verifyTrue(testCase, all(strcmp(prepDataTest1.refModel.rxns(prepDataTest1.toIgnoreExch | prepDataTest1.toIgnoreSpont), {<span class="string">'R1'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R10'</span>})))
0388     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,[],getINITSteps(),true,true,testParams,false);'</span>);
0389     <span class="comment">%the model should now change to include the &quot;correct&quot; path (including 'R2') and</span>
0390     <span class="comment">%skip R9/R10:</span>
0391     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})))
0392     <span class="comment">%now, test to add the metabolite f - this should turn back the favor to R9/R10:</span>
0393     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,{''f''},getINITSteps(),true,true,testParams,false);'</span>);
0394     <span class="comment">%R9 should now be included, the presence of R2 is random</span>
0395     <span class="keyword">if</span> length(tst1ResModel1.rxns) == 7
0396         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0397     <span class="keyword">else</span>
0398         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0399     <span class="keyword">end</span>
0400     <span class="comment">%now, test to add the metabolite a, e, f - this should give the same result:</span>
0401     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,{''f'';''a'';''e''},getINITSteps(),true,true,testParams,false);'</span>);
0402     <span class="comment">%Should be the same as above (R2 is random)</span>
0403     <span class="keyword">if</span> length(tst1ResModel1.rxns) == 7
0404         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0405     <span class="keyword">else</span>
0406         verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>})))
0407     <span class="keyword">end</span>
0408     
0409     <span class="comment">%now, test to add the metabolite b - this should turn on R2 and R3/R5 and turn off R9:</span>
0410     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest1,arrayData1.tissues{1},[],[],arrayData1,{''b''},getINITSteps(),true,true,testParams,false);'</span>);
0411     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})))
0412 
0413     <span class="comment">%now on model 5 to test reactions that are not linearly merged (testModel has only merged rxns)</span>
0414     testModel5 = <a href="#_sub8" class="code" title="subfunction testModel5 = getTstModel5()">getTstModel5</a>();
0415     arrayData1.genes = testModel5.genes;
0416     arrayData1.tissues = {<span class="string">'a'</span>};
0417     arrayData1.levels = getExprForRxnScore(<a href="#_sub9" class="code" title="subfunction testModel5RxnScores = getTstModel5RxnScores()">getTstModel5RxnScores</a>());
0418     arrayData1.threshold = 1;
0419     
0420     [~, prepDataTest5] = evalc(<span class="string">'prepINITModel(testModel5, {}, {''R7'';''R10''}, false, {}, ''s'');'</span>);
0421     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest5,arrayData1.tissues{1},[],[],arrayData1,{},getINITSteps(),true,true,testParams,false);'</span>);
0422     <span class="comment">%We expect the 'true' path, i.e. through R2, not R9/R10 or R11-R14</span>
0423     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>})), 1)
0424 
0425     <span class="comment">%now add metabolite g</span>
0426     <span class="comment">%modify the scores a bit</span>
0427     [~, prepDataTest5] = evalc(<span class="string">'prepINITModel(testModel5, {}, {''R10''}, false, {}, ''s'');'</span>);
0428     arrayData1.levels(7) = getExprForRxnScore(-1.1); <span class="comment">%modify to avoid randomness</span>
0429     [~,tst1ResModel1] = evalc(<span class="string">'ftINIT(prepDataTest5,arrayData1.tissues{1},[],[],arrayData1,{''g''},getINITSteps(),true,true,testParams,false);'</span>);
0430     <span class="comment">%We expect R2 to be replaced with R11 and R13</span>
0431     verifyTrue(testCase, all(strcmp(tst1ResModel1.rxns,{<span class="string">'R1'</span>;<span class="string">'R4'</span>;<span class="string">'R6'</span>;<span class="string">'R8'</span>;<span class="string">'R11'</span>;<span class="string">'R13'</span>})), 1)
0432 <span class="keyword">end</span>
0433 
0434 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0435 <span class="comment">%T0009: getExprFromRxnScore</span>
0436 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0437 <a name="_sub17" href="#_subfunctions" class="code">function testftINIT_T0009(testCase)</a>
0438     testModel = <a href="#_sub2" class="code" title="subfunction testModel = getTstModel()">getTstModel</a>();
0439     [~, prepDataTest1] = evalc(<span class="string">'prepINITModel(testModel, {}, {}, false, {}, ''s'');'</span>);
0440 
0441     arrayData1.genes = testModel.genes;
0442     arrayData1.tissues = {<span class="string">'a'</span>};
0443     arrayData1.levels = getExprForRxnScore(<a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>());
0444     arrayData1.threshold = 1;
0445     
0446     rxnScores = scoreComplexModel(prepDataTest1.refModel,[],arrayData1,arrayData1.tissues{1},[]);
0447     expRes = <a href="#_sub3" class="code" title="subfunction testModelRxnScores = getTstModelRxnScores()">getTstModelRxnScores</a>();
0448     verifyTrue(testCase, all(abs(rxnScores - expRes) &lt; 10^-10)) <span class="comment">%ok</span>
0449 <span class="keyword">end</span>
0450 
0451 <a name="_sub18" href="#_subfunctions" class="code">function testModelL = getTstModelL()</a>
0452 
0453     testModelL = struct();
0454     testModelL.id = <span class="string">'testModel'</span>;
0455     testModelL.rxns = {};
0456     testModelL.S=[];
0457     testModelL.rev=[];
0458     testModelL.metNames = {<span class="string">'e1'</span>;<span class="string">'e2'</span>;<span class="string">'e3'</span>;<span class="string">'e4'</span>;<span class="string">'e5'</span>;<span class="string">'e6'</span>;<span class="string">'e7'</span>;<span class="string">'e8'</span>;<span class="string">'e9'</span>;<span class="string">'e1'</span>;<span class="string">'e2'</span>;<span class="string">'e3'</span>;<span class="string">'e4'</span>;<span class="string">'e5'</span>;<span class="string">'e6'</span>;<span class="string">'e7'</span>;<span class="string">'e8'</span>;<span class="string">'e9'</span>;<span class="string">'x1'</span>;<span class="string">'x2'</span>;<span class="string">'x3'</span>;<span class="string">'x4'</span>;<span class="string">'x5'</span>;<span class="string">'x6'</span>;<span class="string">'x7'</span>;<span class="string">'x8'</span>;<span class="string">'x9'</span>;<span class="string">'x10'</span>;<span class="string">'x11'</span>};
0459     testModelL.comps = {<span class="string">'s'</span>;<span class="string">'c'</span>};
0460     testModelL.compNames = testModelL.comps;
0461     testModelL.metComps = [1;1;1;1;1;1;1;1;1;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2;2];
0462     testModelL.mets = strcat(testModelL.metNames, testModelL.comps(testModelL.metComps));
0463 
0464 
0465     testModelL.grRules = {};
0466     testModelL.rxnGeneMat = [];
0467 
0468     testModelL.genes = {<span class="string">'Ge1'</span>;<span class="string">'Ge2'</span>;<span class="string">'Ge4'</span>;<span class="string">'Ge5'</span>;<span class="string">'Ge7'</span>;<span class="string">'Ge9'</span>; <span class="string">'Gr1'</span>;<span class="string">'Gr2'</span>;<span class="string">'Gr3'</span>;<span class="string">'Gr5'</span>;<span class="string">'Gr6'</span>;<span class="string">'Gr7'</span>;<span class="string">'Gr8'</span>;<span class="string">'Gr9'</span>;<span class="string">'Gr10'</span>;<span class="string">'Gr11'</span>;<span class="string">'Gr12'</span>;<span class="string">'Gr14'</span>;<span class="string">'Gr15'</span>};
0469 
0470 
0471     testModelL.ub = [];
0472     testModelL.lb = [];
0473 
0474     rxnsToAdd = struct();
0475     rxnsToAdd.rxns = {  <span class="string">'S1'</span>;<span class="string">'S2'</span>;<span class="string">'S3'</span>;<span class="string">'S4'</span>;<span class="string">'S5'</span>;<span class="string">'S6'</span>;<span class="string">'S7'</span>;<span class="string">'S8'</span>;<span class="string">'S9'</span>;<span class="string">'E1'</span>;<span class="string">'E2'</span>;<span class="string">'E2b'</span>;<span class="string">'E3'</span>;<span class="string">'E4'</span>;<span class="string">'E5'</span>;<span class="string">'E6'</span>;<span class="string">'E7'</span>;<span class="string">'E8'</span>;<span class="string">'E9'</span>;<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R10'</span>;<span class="string">'R11'</span>;<span class="string">'R12'</span>;<span class="string">'R13'</span>;<span class="string">'R14'</span>;<span class="string">'R15'</span>};
0476     rxnsToAdd.grRules = {<span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>;  <span class="string">''</span>; <span class="string">'Ge1'</span>;<span class="string">'Ge2'</span>;<span class="string">''</span>;<span class="string">''</span>;<span class="string">'Ge4'</span>;<span class="string">'Ge5'</span>;<span class="string">''</span>;<span class="string">'Ge7'</span>;<span class="string">''</span>;<span class="string">'Ge9'</span>; <span class="string">'Gr1'</span>;<span class="string">'Gr2'</span>;<span class="string">'Gr3'</span>;<span class="string">''</span>;<span class="string">'Gr5'</span>;<span class="string">'Gr6'</span>;<span class="string">'Gr7'</span>;<span class="string">'Gr8'</span>;<span class="string">'Gr9'</span>;<span class="string">'Gr10'</span>;<span class="string">'Gr11'</span>;<span class="string">'Gr12'</span>;<span class="string">''</span>;<span class="string">'Gr14'</span>;<span class="string">'Gr15'</span>};
0477     rxnsToAdd.equations = {<span class="string">'e1[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0478                            <span class="string">'e2[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0479                            <span class="string">'e3[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0480                            <span class="string">'e4[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0481                            <span class="string">'e5[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0482                            <span class="string">'e6[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0483                            <span class="string">'e7[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0484                            <span class="string">'e8[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0485                            <span class="string">'e9[s] &lt;=&gt;'</span>;<span class="keyword">...</span>
0486                            <span class="string">'e1[s] &lt;=&gt; e1[c]'</span>;<span class="keyword">...</span>
0487                            <span class="string">'e2[s] &lt;=&gt; e2[c]'</span>;<span class="keyword">...</span>
0488                            <span class="string">'e2[s] &lt;=&gt; e2[c]'</span>;<span class="keyword">...</span><span class="comment"> %b variant</span>
0489                            <span class="string">'e3[s] &lt;=&gt; e3[c]'</span>;<span class="keyword">...</span>
0490                            <span class="string">'e4[s] &lt;=&gt; e4[c]'</span>;<span class="keyword">...</span>
0491                            <span class="string">'e5[s] &lt;=&gt; e5[c]'</span>;<span class="keyword">...</span>
0492                            <span class="string">'e6[s] &lt;=&gt; e6[c]'</span>;<span class="keyword">...</span>
0493                            <span class="string">'e7[s] &lt;=&gt; e7[c]'</span>;<span class="keyword">...</span>
0494                            <span class="string">'e8[s] &lt;=&gt; e8[c]'</span>;<span class="keyword">...</span>
0495                            <span class="string">'e9[s] &lt;=&gt; e9[c]'</span>;<span class="keyword">...</span>
0496                            <span class="string">'e1[c] + e2[c] &lt;=&gt; x1[c]'</span>;<span class="keyword">...</span><span class="comment"> %R1</span>
0497                            <span class="string">'e1[c] + e3[c] =&gt; x2[c] + x3[c]'</span>;<span class="keyword">...</span><span class="comment"> %R2</span>
0498                            <span class="string">'e4[c] + x3[c] =&gt; x4[c] + x5[c]'</span>;<span class="keyword">...</span><span class="comment"> %R3</span>
0499                            <span class="string">'e5[c] + e6[c] + x4[c] =&gt; 2 x2[c] + x6[c]'</span>;<span class="keyword">...</span><span class="comment"> %R4</span>
0500                            <span class="string">'x1[c] + x2[c] &lt;=&gt; x7[c] + 2 x8[c]'</span>;<span class="keyword">...</span><span class="comment"> %R5</span>
0501                            <span class="string">'x2[c] + x8[c] =&gt; x3[c] + x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R6</span>
0502                            <span class="string">'x4[c] &lt;=&gt; x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R7</span>
0503                            <span class="string">'x5[c] &lt;=&gt; x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R8</span>
0504                            <span class="string">'x6[c] &lt;=&gt; x10[c]'</span>;<span class="keyword">...</span><span class="comment"> %R9</span>
0505                            <span class="string">'x6[c] &lt;=&gt; x11[c]'</span>;<span class="keyword">...</span><span class="comment"> %R10</span>
0506                            <span class="string">'x10[c] + 2 x11[c] =&gt; e7[c]'</span>;<span class="keyword">...</span><span class="comment"> %R11</span>
0507                            <span class="string">'x9[c] + x10[c] &lt;=&gt; e8[c]'</span>;<span class="keyword">...</span><span class="comment"> %R12</span>
0508                            <span class="string">'x7[c] + x8[c] + x9[c] =&gt; e9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R13</span>
0509                            <span class="string">'x6[c] =&gt; x9[c]'</span>;<span class="keyword">...</span><span class="comment"> %R14</span>
0510                            <span class="string">'x3[c] =&gt; x9[c]'</span><span class="keyword">...</span><span class="comment"> %R15</span>
0511                            };
0512     testModelL = addRxns(testModelL,rxnsToAdd, 3);
0513     testModelL.c = [0;0;0;0;0;0;0;1;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];<span class="comment">%optimize for output flux, if this is used, not sure</span>
0514     testModelL.rxnNames = testModelL.rxns;
0515     testModelL.b = repmat(0,length(testModelL.mets),1);
0516 <span class="keyword">end</span>
0517 
0518 <a name="_sub19" href="#_subfunctions" class="code">function testModelLGeneScores = getTstModelLGeneScores()</a>
0519     <span class="comment">%testModelL.genes = {'Ge1';'Ge2';'Ge4';'Ge5';'Ge7';'Ge9'; 'Gr1';'Gr2';'Gr3';'Gr5';'Gr6';'Gr7';'Gr8';'Gr9';'Gr10';'Gr11';'Gr12';'Gr14';'Gr15'};</span>
0520     testModelLGeneScores = [3; -1;   8;    6;    -5;    5;     4;    5;    2;    3;    6;    1;    3;    1;    -3;    1;     3;      1;    2];
0521 <span class="keyword">end</span>
0522 
0523 
0524 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0525 <span class="comment">%T0050: Test ftINIT on a slightly larger and more complex model</span>
0526 <span class="comment">%       Specifically tests if the three-step variant and the &quot;full&quot;</span>
0527 <span class="comment">%       variant gives similar results</span>
0528 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0529 <a name="_sub20" href="#_subfunctions" class="code">function testftINIT_T0050(testCase)</a>
0530     testModelL = <a href="#_sub18" class="code" title="subfunction testModelL = getTstModelL()">getTstModelL</a>();
0531     testModelLGeneScores = <a href="#_sub19" class="code" title="subfunction testModelLGeneScores = getTstModelLGeneScores()">getTstModelLGeneScores</a>();
0532     testParams = struct();
0533    
0534     arrayDataL = struct();
0535     arrayDataL.genes = testModelL.genes;
0536     arrayDataL.tissues = {<span class="string">'t1'</span>};
0537     arrayDataL.levels = getExprForRxnScore(testModelLGeneScores,1);
0538     arrayDataL.threshold = 1;
0539 
0540     <span class="comment">%Run prep data</span>
0541     [~, prepDataL] = evalc(<span class="string">'prepINITModel(testModelL, [], {}, false, {}, ''s'');'</span>);
0542 
0543     [~,mres] = evalc(<span class="string">'ftINIT(prepDataL,arrayDataL.tissues{1},[],[],arrayDataL,[],getINITSteps(),true,true,testParams,false);'</span>);
0544     [~,mres2] = evalc(<span class="string">'ftINIT(prepDataL,arrayDataL.tissues{1},[],[],arrayDataL,[],getINITSteps([], ''full''),true,true,testParams,false);'</span>);
0545     
0546     expResult = {  <span class="string">'S1'</span>;<span class="string">'S2'</span>;<span class="string">'S3'</span>;<span class="string">'S4'</span>;<span class="string">'S5'</span>;<span class="string">'S6'</span>;<span class="string">'S7'</span>;<span class="string">'S8'</span>;<span class="string">'S9'</span>;<span class="string">'E1'</span>;<span class="string">'E2'</span>;<span class="string">'E3'</span>;<span class="string">'E4'</span>;<span class="string">'E5'</span>;<span class="string">'E6'</span>;<span class="string">'E8'</span>;<span class="string">'E9'</span>;<span class="string">'R1'</span>;<span class="string">'R2'</span>;<span class="string">'R3'</span>;<span class="string">'R4'</span>;<span class="string">'R5'</span>;<span class="string">'R6'</span>;<span class="string">'R7'</span>;<span class="string">'R8'</span>;<span class="string">'R9'</span>;<span class="string">'R12'</span>;<span class="string">'R13'</span>;<span class="string">'R14'</span>;<span class="string">'R15'</span>};
0547     
0548     verifyTrue(testCase, all(strcmp(mres.rxns,expResult)))
0549     verifyTrue(testCase, all(strcmp(mres2.rxns,expResult)))
0550 
0551     <span class="comment">%run the old tINIT version (in Human-GEM)</span>
0552     <span class="comment">%this is just to show that they become different, not really part of the test case</span>
0553     <span class="comment">%paramsL2 = struct();</span>
0554     <span class="comment">%paramsL2.TimeLimit = 1000;</span>
0555     <span class="comment">%testModelL2 = closeModel(testModelL);</span>
0556     <span class="comment">%init_modelOrig = getINITModel2(testModelL2,arrayDataL.tissues{1},[],[],arrayDataL,[],true,[],true,true,[],paramsL2);</span>
0557 
0558     <span class="comment">%in this call, I have modified the code - the possibility to turn off met secretion + don't allow flux in both directions is not possible.</span>
0559     <span class="comment">%The following line, around line 337, is changed</span>
0560     <span class="comment">%from:</span>
0561     <span class="comment">%[~, deletedRxnsInINIT, metProduction] = runINIT(simplifyModel(cModel),rxnScores,metabolomicsData,essentialRxnsForTasks,0,true,false,params);</span>
0562     <span class="comment">%to:</span>
0563     <span class="comment">%[~, deletedRxnsInINIT, metProduction] = runINIT(simplifyModel(cModel),rxnScores,metabolomicsData,essentialRxnsForTasks,0,false,true,params);</span>
0564     <span class="comment">%init_modelOrigNoSecrOneDirOnly = getINITModel2(testModelL2,arrayDataL.tissues{1},[],[],arrayDataL,[],true,[],true,true,[],paramsL2);</span>
0565 
0566     <span class="comment">%The models init_modelOrigNoSecrOneDirOnly and mres2 are very similar, (only one exch rxn differ, which is expected)</span>
0567     <span class="comment">%init_modelOrig is quite different, with a lot of gaps, and worse. So, the conclusion is that the new version does a pretty good job.</span>
0568 <span class="keyword">end</span>
0569 
0570</pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
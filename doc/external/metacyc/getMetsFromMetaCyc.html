<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getMetsFromMetaCyc</title>
  <meta name="keywords" content="getMetsFromMetaCyc">
  <meta name="description" content="getMetsFromMetaCyc">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">external</a> &gt; <a href="index.html">metacyc</a> &gt; getMetsFromMetaCyc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for external\metacyc&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getMetsFromMetaCyc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>getMetsFromMetaCyc</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function metaCycMets=getMetsFromMetaCyc(metacycPath) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> getMetsFromMetaCyc
   Retrieves information of all metabolites in MetaCyc database

   metacycPath  if metacycMets.mat is not in the RAVEN\external\metacyc directory,
                this function will attempt to read data from a local dump
                of the MetaCyc database. metacycPath is the path to the root of
                this database

   model        a model structure generated from the database. The following
                fields are filled
                id:             'MetaCyc'
                description:    'Automatically generated from MetaCyc database'
                mets:           MetaCyc compound ids
                metNames:       Compound name. Reuse compound id here if
                                there is no name provided
                metFormulas:    The chemical composition of the metabolite.
                inchis:         InChI string for the metabolite
                metCharges:     Compound charge state
                metMiriams:     If there is a CHEBI id available, then that
                                will be saved here
                keggid:         The corresponding KEGG compound id if available

   If the file metaCycMets.mat is in the RAVEN\external\metacyc directory
   it will be directly loaded. Otherwise, it will be generated by parsing
   the MetaCyc database files. In general, this metaCycMets.mat file should
   be removed and rebuilt when a newer version of MetaCyc is released.
               
   Usage: model=getMetsFromMetaCyc(metacycPath)

   Hao Wang, 2017-11-15</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="getMetaCycModelForOrganism.html" class="code" title="function model=getMetaCycModelForOrganism(organismID,fastaFile,keepTransportRxns,keepUnbalanced,keepUndetermined,minScore,minPositives)">getMetaCycModelForOrganism</a>	getMetaCycModelForOrganism</li><li><a href="getModelFromMetaCyc.html" class="code" title="function metaCycModel=getModelFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)">getModelFromMetaCyc</a>	getModelFromMetaCyc</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function metaCycMets=getMetsFromMetaCyc(metacycPath)</a>
0002 <span class="comment">% getMetsFromMetaCyc</span>
0003 <span class="comment">%   Retrieves information of all metabolites in MetaCyc database</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   metacycPath  if metacycMets.mat is not in the RAVEN\external\metacyc directory,</span>
0006 <span class="comment">%                this function will attempt to read data from a local dump</span>
0007 <span class="comment">%                of the MetaCyc database. metacycPath is the path to the root of</span>
0008 <span class="comment">%                this database</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   model        a model structure generated from the database. The following</span>
0011 <span class="comment">%                fields are filled</span>
0012 <span class="comment">%                id:             'MetaCyc'</span>
0013 <span class="comment">%                description:    'Automatically generated from MetaCyc database'</span>
0014 <span class="comment">%                mets:           MetaCyc compound ids</span>
0015 <span class="comment">%                metNames:       Compound name. Reuse compound id here if</span>
0016 <span class="comment">%                                there is no name provided</span>
0017 <span class="comment">%                metFormulas:    The chemical composition of the metabolite.</span>
0018 <span class="comment">%                inchis:         InChI string for the metabolite</span>
0019 <span class="comment">%                metCharges:     Compound charge state</span>
0020 <span class="comment">%                metMiriams:     If there is a CHEBI id available, then that</span>
0021 <span class="comment">%                                will be saved here</span>
0022 <span class="comment">%                keggid:         The corresponding KEGG compound id if available</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%   If the file metaCycMets.mat is in the RAVEN\external\metacyc directory</span>
0025 <span class="comment">%   it will be directly loaded. Otherwise, it will be generated by parsing</span>
0026 <span class="comment">%   the MetaCyc database files. In general, this metaCycMets.mat file should</span>
0027 <span class="comment">%   be removed and rebuilt when a newer version of MetaCyc is released.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%   Usage: model=getMetsFromMetaCyc(metacycPath)</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   Hao Wang, 2017-11-15</span>
0032 <span class="comment">%</span>
0033 
0034 <span class="comment">% NOTE: This is how one entry looks in the file</span>
0035 
0036 <span class="comment">% //</span>
0037 <span class="comment">% UNIQUE-ID - CPD-18846</span>
0038 <span class="comment">% TYPES - CPD-18866</span>
0039 <span class="comment">% COMMON-NAME - 12-ethyl-8-propyl-bacteriochlorophyllide &lt;i&gt;d&lt;/i&gt;</span>
0040 <span class="comment">% ATOM-CHARGES - (43 -1)</span>
0041 <span class="comment">% ATOM-CHARGES - (12 -1)</span>
0042 <span class="comment">% CHEMICAL-FORMULA - (C 35)</span>
0043 <span class="comment">% CHEMICAL-FORMULA - (H 36)</span>
0044 <span class="comment">% CHEMICAL-FORMULA - (N 4)</span>
0045 <span class="comment">% CHEMICAL-FORMULA - (O 4)</span>
0046 <span class="comment">% CHEMICAL-FORMULA - (MG 1)</span>
0047 <span class="comment">% CITATIONS - 26331578</span>
0048 <span class="comment">% CITATIONS - 2350541</span>
0049 <span class="comment">% CREDITS - SRI</span>
0050 <span class="comment">% CREDITS - caspi</span>
0051 <span class="comment">% MOLECULAR-WEIGHT - 600.999</span>
0052 <span class="comment">% MONOISOTOPIC-MW - 602.274347629</span>
0053 <span class="comment">% NON-STANDARD-INCHI - InChI=1S/C35H39N4O4.Mg/c1-7-9-21-16(3)24-14-29-32(19(6)40)18(5)26(37-29)13-25-17(4)22(10-11-31(42)43)34(38-25)23-12-30(41)33-20(8-2)27(39-35(23)33)15-28(21)36-24;/h12-15,17,19,22,40H,7-11H2,1-6H3,(H3,36,37,38,39,41,42,43);/q-1;+2/p-3/t17-,19?,22-;/m0./s1</span>
0054 <span class="comment">% SMILES - CCCC5(=C(C)C9(N6([Mg]27(N1(C(C(C)C(CCC(=O)[O-])C=1C4([C-]C(=O)C3(=C(CC)C(N2C3=4)=CC5=6)))=CC8(=C(C)C(C(O)C)=C(N78)C=9))))))</span>
0055 
0056 <span class="comment">% A line that contains only '//' separates each object.</span>
0057 
0058 <span class="comment">% Check if the metabolites have been parsed before and saved. If so, load</span>
0059 <span class="comment">% the model.</span>
0060 [ST, I]=dbstack(<span class="string">'-completenames'</span>);
0061 ravenPath=fileparts(fileparts(fileparts(ST(I).file)));
0062 metsFile=fullfile(ravenPath,<span class="string">'external'</span>,<span class="string">'metacyc'</span>,<span class="string">'metaCycMets.mat'</span>);
0063 metaCycMetFile=<span class="string">'compounds.dat'</span>;
0064 
0065 <span class="keyword">if</span> exist(metsFile, <span class="string">'file'</span>)
0066     fprintf([<span class="string">'NOTE: Importing MetaCyc metabolites from '</span> strrep(metsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'.\n'</span>]);
0067     load(metsFile);
0068 <span class="keyword">else</span>
0069     fprintf([<span class="string">'Cannot locate '</span> strrep(metsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">' and will try to generate it from the local MetaCyc database files.\n'</span>]);
0070     <span class="keyword">if</span> ~exist(fullfile(metacycPath,metaCycMetFile),<span class="string">'file'</span>)
0071         EM=fprintf([<span class="string">'The file of metabolites cannot be located, and should be downloaded from MetaCyc.\n'</span>]);
0072         dispEM(EM);
0073     <span class="keyword">else</span>
0074         <span class="comment">%Add new functionality in the order specified in models</span>
0075         metaCycMets.id=<span class="string">'MetaCyc'</span>;
0076         metaCycMets.description=<span class="string">'Automatically generated from MetaCyc database'</span>;
0077         
0078         <span class="comment">%Preallocate memory for 50000 metabolites</span>
0079         metaCycMets.mets=cell(50000,1);
0080         metaCycMets.metNames=cell(50000,1);
0081         metaCycMets.metFormulas=cell(50000,1);
0082         metaCycMets.inchis=cell(50000,1);
0083         metaCycMets.metCharges=zeros(50000,1);
0084         metaCycMets.metMiriams=cell(50000,1);
0085         metaCycMets.keggid=cell(50000,1);
0086         
0087         <span class="comment">%First load information on metabolite ID, name, formula, and others</span>
0088         fid = fopen(fullfile(metacycPath,metaCycMetFile), <span class="string">'r'</span>);
0089         
0090         <span class="comment">%Keeps track of how many metabolites that have been added</span>
0091         metCounter=0;
0092         
0093         <span class="comment">%Loop through the file</span>
0094         <span class="keyword">while</span> 1
0095             <span class="comment">%Get the next line</span>
0096             tline = fgetl(fid);
0097             <span class="comment">%disp(tline);</span>
0098             
0099             <span class="comment">% Abort at end of file</span>
0100             <span class="keyword">if</span> ~ischar(tline)
0101                 <span class="keyword">break</span>;
0102             <span class="keyword">end</span>
0103             
0104             <span class="comment">%Check if it is a new entry</span>
0105             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'UNIQUE-ID - '</span>)
0106                 metCounter=metCounter+1;
0107                 
0108                 <span class="comment">%Add empty strings as initial values</span>
0109                 metaCycMets.metNames{metCounter}=<span class="string">''</span>;
0110                 metaCycMets.metFormulas{metCounter}=<span class="string">''</span>;
0111                 metaCycMets.inchis{metCounter}=<span class="string">''</span>;
0112                 <span class="comment">%metaCycMets.smiles{metCounter}='';</span>
0113                 <span class="comment">%metaCycMets.pubchem{metCounter}='';</span>
0114                 metaCycMets.keggid{metCounter}=<span class="string">''</span>;
0115                 nonStandardInchis = <span class="string">''</span>;
0116                 
0117                 <span class="comment">%Add compound ID</span>
0118                 metaCycMets.mets{metCounter}=tline(13:end);
0119             <span class="keyword">end</span>
0120             
0121             
0122             <span class="comment">%Add name</span>
0123             <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp;    strcmp(tline(1:14),<span class="string">'COMMON-NAME - '</span>)
0124                 metaCycMets.metNames{metCounter}=tline(15:end);
0125                 
0126                 <span class="comment">%Romve HTML symbols</span>
0127                 metaCycMets.metNames{metCounter}=regexprep(metaCycMets.metNames{metCounter},<span class="string">'&lt;(\w+)&gt;'</span>,<span class="string">''</span>);
0128                 metaCycMets.metNames{metCounter}=regexprep(metaCycMets.metNames{metCounter},<span class="string">'&lt;/(\w+)&gt;'</span>,<span class="string">''</span>);
0129                 metaCycMets.metNames{metCounter}=regexprep(metaCycMets.metNames{metCounter},<span class="string">'[&amp;;]'</span>,<span class="string">''</span>);
0130             <span class="keyword">end</span>
0131             
0132             <span class="comment">%Add charge</span>
0133             <span class="keyword">if</span> numel(tline)&gt;16 &amp;&amp;    strcmp(tline(1:16),<span class="string">'ATOM-CHARGES - ('</span>)
0134                 atomCharge=tline(17:end-1);
0135                 
0136                 s=strfind(atomCharge,<span class="string">' '</span>);
0137                 <span class="keyword">if</span> any(s)
0138                     atomCharge=atomCharge(s+1:end);
0139                     metaCycMets.metCharges(metCounter,1)=metaCycMets.metCharges(metCounter,1)+str2num(atomCharge);
0140                 <span class="keyword">end</span>
0141             <span class="keyword">end</span>
0142             
0143             <span class="comment">%Add inchis</span>
0144             <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp; strcmp(tline(1:14),<span class="string">'INCHI - InChI='</span>)
0145                 metaCycMets.inchis{metCounter}=tline(15:end);
0146             <span class="keyword">end</span>
0147             
0148             <span class="comment">%Add non-standard inchis</span>
0149             <span class="keyword">if</span> numel(tline)&gt;27 &amp;&amp; strcmp(tline(1:27),<span class="string">'NON-STANDARD-INCHI - InChI='</span>)
0150                 nonStandardInchis=tline(28:end);
0151             <span class="keyword">end</span>
0152             
0153             <span class="comment">%Add SMILES</span>
0154             <span class="keyword">if</span> numel(tline)&gt;9 &amp;&amp; strcmp(tline(1:9),<span class="string">'SMILES - '</span>)
0155                 
0156                 <span class="keyword">if</span> isstruct(metaCycMets.metMiriams{metCounter})
0157                     addToIndex=numel(metaCycMets.metMiriams{metCounter}.name)+1;
0158                 <span class="keyword">else</span>
0159                     addToIndex=1;
0160                 <span class="keyword">end</span>
0161                 tempStruct=metaCycMets.metMiriams{metCounter};
0162                 tempStruct.name{addToIndex,1}=<span class="string">'SMILES'</span>;
0163                 tempStruct.value{addToIndex,1}=tline(10:end);
0164                 metaCycMets.metMiriams{metCounter}=tempStruct;
0165             <span class="keyword">end</span>
0166             
0167             <span class="comment">%Add formula</span>
0168             <span class="keyword">if</span> numel(tline)&gt;20 &amp;&amp; strcmp(tline(1:20),<span class="string">'CHEMICAL-FORMULA - ('</span>)
0169                 metaCycMets.metFormulas{metCounter}=strcat(metaCycMets.metFormulas{metCounter},tline(21:end-1));
0170                 metaCycMets.metFormulas{metCounter}(isspace(metaCycMets.metFormulas{metCounter})) = [];
0171             <span class="keyword">end</span>
0172             
0173             <span class="comment">%Add KEGG id</span>
0174             <span class="keyword">if</span> numel(tline)&gt;23 &amp;&amp; strcmp(tline(1:23),<span class="string">'DBLINKS - (LIGAND-CPD &quot;'</span>)
0175                 keggid=tline(24:end);
0176                 
0177                 s=strfind(keggid,<span class="string">'&quot;'</span>);
0178                 <span class="keyword">if</span> any(s)
0179                     keggid=keggid(1:s-1);
0180                 <span class="keyword">end</span>
0181                 
0182                 metaCycMets.keggid{metCounter}=keggid;
0183             <span class="keyword">end</span>
0184             
0185             <span class="comment">%Add CHEBI id</span>
0186             <span class="keyword">if</span> numel(tline)&gt;18 &amp;&amp; strcmp(tline(1:18),<span class="string">'DBLINKS - (CHEBI &quot;'</span>)
0187                 chebiID=tline(20:end); <span class="comment">%This is because there is sometimes more than one CHEBI index</span>
0188                 
0189                 s=strfind(chebiID,<span class="string">'&quot;'</span>);
0190                 <span class="keyword">if</span> any(s)
0191                     chebiID=chebiID(1:s-1);
0192                 <span class="keyword">end</span>
0193                 
0194                 <span class="keyword">if</span> isstruct(metaCycMets.metMiriams{metCounter})
0195                     addToIndex=numel(metaCycMets.metMiriams{metCounter}.name)+1;
0196                 <span class="keyword">else</span>
0197                     addToIndex=1;
0198                 <span class="keyword">end</span>
0199                 tempStruct=metaCycMets.metMiriams{metCounter};
0200                 tempStruct.name{addToIndex,1}=<span class="string">'chebi'</span>;
0201                 tempStruct.value{addToIndex,1}=strcat(<span class="string">'CHEBI:'</span>,chebiID);
0202                 metaCycMets.metMiriams{metCounter}=tempStruct;
0203             <span class="keyword">end</span>
0204             
0205             <span class="comment">%Add PubChem</span>
0206             <span class="keyword">if</span> numel(tline)&gt;20 &amp;&amp; strcmp(tline(1:20),<span class="string">'DBLINKS - (PUBCHEM &quot;'</span>)
0207                 pubchemID=tline(21:end);
0208                 
0209                 s=strfind(pubchemID,<span class="string">'&quot;'</span>);
0210                 <span class="keyword">if</span> any(s)
0211                     pubchemID=pubchemID(1:s-1);
0212                 <span class="keyword">end</span>
0213                 
0214                 <span class="keyword">if</span> isstruct(metaCycMets.metMiriams{metCounter})
0215                     addToIndex=numel(metaCycMets.metMiriams{metCounter}.name)+1;
0216                 <span class="keyword">else</span>
0217                     addToIndex=1;
0218                 <span class="keyword">end</span>
0219                 tempStruct=metaCycMets.metMiriams{metCounter};
0220                 tempStruct.name{addToIndex,1}=<span class="string">'pubchem.compound'</span>;
0221                 tempStruct.value{addToIndex,1}=pubchemID;
0222                 metaCycMets.metMiriams{metCounter}=tempStruct;
0223             <span class="keyword">end</span>
0224             
0225             <span class="comment">%Add non-standard inchis when standard one is unavailable</span>
0226             <span class="keyword">if</span> strcmp(tline,<span class="string">'//'</span>) &amp;&amp; strcmp(metaCycMets.inchis{metCounter},<span class="string">''</span>)
0227                 metaCycMets.inchis{metCounter}=nonStandardInchis;
0228                 nonStandardInchis = <span class="string">''</span>;
0229                 
0230                 <span class="comment">%Refine formula from inchis</span>
0231                 s=strfind(metaCycMets.inchis{metCounter},<span class="string">'/'</span>);
0232                 <span class="keyword">if</span> any(s)
0233                     inchiFormula=metaCycMets.inchis{metCounter}(s(1)+1:s(2)-1);
0234                     
0235                     <span class="comment">%And remove dot characters</span>
0236                     inchiFormula(regexp(inchiFormula,<span class="string">'[.]'</span>))=[];
0237                     <span class="keyword">if</span> ~strcmp(metaCycMets.metFormulas{metCounter},inchiFormula)
0238                         metaCycMets.metFormulas{metCounter}=inchiFormula;
0239                     <span class="keyword">end</span>
0240                 <span class="keyword">end</span>
0241                 
0242             <span class="keyword">end</span>
0243             
0244         <span class="keyword">end</span>
0245         
0246         <span class="comment">%Close the file</span>
0247         fclose(fid);
0248         
0249         <span class="comment">%If too much space was allocated, shrink the model</span>
0250         metaCycMets.mets=metaCycMets.mets(1:metCounter);
0251         metaCycMets.metNames=metaCycMets.metNames(1:metCounter);
0252         metaCycMets.metFormulas=metaCycMets.metFormulas(1:metCounter);
0253         metaCycMets.metMiriams=metaCycMets.metMiriams(1:metCounter);
0254         metaCycMets.inchis=metaCycMets.inchis(1:metCounter);
0255         metaCycMets.metCharges=metaCycMets.metCharges(1:metCounter,:);
0256         <span class="comment">%metaCycMets.smiles=metaCycMets.smiles(1:metCounter);</span>
0257         <span class="comment">%metaCycMets.pubchem=metaCycMets.pubchem(1:metCounter);</span>
0258         metaCycMets.keggid=metaCycMets.keggid(1:metCounter);
0259         
0260         <span class="comment">%If the metMiriams structure is empty, use MetaCyc id as metMiriams</span>
0261         <span class="keyword">for</span> i=1:numel(metaCycMets.mets)
0262             <span class="keyword">if</span> ~isstruct(metaCycMets.metMiriams{i})
0263                 miriamStruct.name{1}=<span class="string">'metacyc.compound'</span>;
0264                 miriamStruct.value{1}=metaCycMets.mets{i};
0265                 metaCycMets.metMiriams{i}=miriamStruct;
0266             <span class="keyword">end</span>
0267         <span class="keyword">end</span>
0268         
0269         <span class="comment">%Saves the model</span>
0270         save(<span class="string">'metaCycMets.mat'</span>,<span class="string">'metaCycMets'</span>);
0271     <span class="keyword">end</span>
0272 <span class="keyword">end</span>
0273 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 23-Apr-2018 15:56:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
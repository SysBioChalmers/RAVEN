<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getMetsFromMetaCyc</title>
  <meta name="keywords" content="getMetsFromMetaCyc">
  <meta name="description" content="getMetsFromMetaCyc">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">external</a> &gt; <a href="index.html">metacyc</a> &gt; getMetsFromMetaCyc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for external\metacyc&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getMetsFromMetaCyc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>getMetsFromMetaCyc</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function metaCycMets=getMetsFromMetaCyc(metacycPath) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> getMetsFromMetaCyc
   Retrieves information of all metabolites in MetaCyc database

   metacycPath  if metacycMets.mat is not in the RAVEN\external\metacyc directory,
                this function will attempt to read data from a local dump
                of the MetaCyc database. metacycPath is the path to the root of
                this database

   model        a model structure generated from the database. The following
                fields are filled
                id:             'MetaCyc'
                description:    'Automatically generated from MetaCyc database'
                mets:           MetaCyc compound ids
                metNames:       Compound name. Reuse compound id here if
                                there is no name provided
                metFormulas:    The chemical composition of the metabolite.
                inchis:         InChI string for the metabolite
                metCharges:     Compound charge state
                metMiriams:     If there is a CHEBI id available, then that
                                will be saved here
                keggid:         The corresponding KEGG compound id if available

   If the file metaCycMets.mat is in the RAVEN\external\metacyc directory
   it will be directly loaded. Otherwise, it will be generated by parsing
   the MetaCyc database files. In general, this metaCycMets.mat file should
   be removed and rebuilt when a newer version of MetaCyc is released.
               
   Usage: model=getMetsFromMetaCyc(metacycPath)

   Hao Wang, 2017-11-15</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="getMetaCycModelForOrganism.html" class="code" title="function model=getMetaCycModelForOrganism(organismID,fastaFile,keepTransportRxns,keepUnbalanced,keepUndetermined,minScore,minPositives)">getMetaCycModelForOrganism</a>	getMetaCycModelForOrganism</li><li><a href="getModelFromMetaCyc.html" class="code" title="function metaCycModel=getModelFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)">getModelFromMetaCyc</a>	getModelFromMetaCyc</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function metaCycMets=getMetsFromMetaCyc(metacycPath)</a>
0002 <span class="comment">% getMetsFromMetaCyc</span>
0003 <span class="comment">%   Retrieves information of all metabolites in MetaCyc database</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   metacycPath  if metacycMets.mat is not in the RAVEN\external\metacyc directory,</span>
0006 <span class="comment">%                this function will attempt to read data from a local dump</span>
0007 <span class="comment">%                of the MetaCyc database. metacycPath is the path to the root of</span>
0008 <span class="comment">%                this database</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   model        a model structure generated from the database. The following</span>
0011 <span class="comment">%                fields are filled</span>
0012 <span class="comment">%                id:             'MetaCyc'</span>
0013 <span class="comment">%                description:    'Automatically generated from MetaCyc database'</span>
0014 <span class="comment">%                mets:           MetaCyc compound ids</span>
0015 <span class="comment">%                metNames:       Compound name. Reuse compound id here if</span>
0016 <span class="comment">%                                there is no name provided</span>
0017 <span class="comment">%                metFormulas:    The chemical composition of the metabolite.</span>
0018 <span class="comment">%                inchis:         InChI string for the metabolite</span>
0019 <span class="comment">%                metCharges:     Compound charge state</span>
0020 <span class="comment">%                metMiriams:     If there is a CHEBI id available, then that</span>
0021 <span class="comment">%                                will be saved here</span>
0022 <span class="comment">%                keggid:         The corresponding KEGG compound id if available</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%   If the file metaCycMets.mat is in the RAVEN\external\metacyc directory</span>
0025 <span class="comment">%   it will be directly loaded. Otherwise, it will be generated by parsing</span>
0026 <span class="comment">%   the MetaCyc database files. In general, this metaCycMets.mat file should</span>
0027 <span class="comment">%   be removed and rebuilt when a newer version of MetaCyc is released.</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%   Usage: model=getMetsFromMetaCyc(metacycPath)</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   Hao Wang, 2017-11-15</span>
0032 <span class="comment">%</span>
0033 
0034 <span class="comment">% NOTE: This is how one entry looks in the file</span>
0035 
0036 <span class="comment">% //</span>
0037 <span class="comment">% UNIQUE-ID - CPD-18846</span>
0038 <span class="comment">% TYPES - CPD-18866</span>
0039 <span class="comment">% COMMON-NAME - 12-ethyl-8-propyl-bacteriochlorophyllide &lt;i&gt;d&lt;/i&gt;</span>
0040 <span class="comment">% ATOM-CHARGES - (43 -1)</span>
0041 <span class="comment">% ATOM-CHARGES - (12 -1)</span>
0042 <span class="comment">% CHEMICAL-FORMULA - (C 35)</span>
0043 <span class="comment">% CHEMICAL-FORMULA - (H 36)</span>
0044 <span class="comment">% CHEMICAL-FORMULA - (N 4)</span>
0045 <span class="comment">% CHEMICAL-FORMULA - (O 4)</span>
0046 <span class="comment">% CHEMICAL-FORMULA - (MG 1)</span>
0047 <span class="comment">% CITATIONS - 26331578</span>
0048 <span class="comment">% CITATIONS - 2350541</span>
0049 <span class="comment">% CREDITS - SRI</span>
0050 <span class="comment">% CREDITS - caspi</span>
0051 <span class="comment">% MOLECULAR-WEIGHT - 600.999</span>
0052 <span class="comment">% MONOISOTOPIC-MW - 602.274347629</span>
0053 <span class="comment">% NON-STANDARD-INCHI - InChI=1S/C35H39N4O4.Mg/c1-7-9-21-16(3)24-14-29-32(19(6)40)18(5)26(37-29)13-25-17(4)22(10-11-31(42)43)34(38-25)23-12-30(41)33-20(8-2)27(39-35(23)33)15-28(21)36-24;/h12-15,17,19,22,40H,7-11H2,1-6H3,(H3,36,37,38,39,41,42,43);/q-1;+2/p-3/t17-,19?,22-;/m0./s1</span>
0054 <span class="comment">% SMILES - CCCC5(=C(C)C9(N6([Mg]27(N1(C(C(C)C(CCC(=O)[O-])C=1C4([C-]C(=O)C3(=C(CC)C(N2C3=4)=CC5=6)))=CC8(=C(C)C(C(O)C)=C(N78)C=9))))))</span>
0055 
0056 <span class="comment">% A line that contains only '//' separates each object.</span>
0057 
0058 <span class="comment">% Check if the metabolites have been parsed before and saved. If so, load the model.</span>
0059 [ST, I]=dbstack(<span class="string">'-completenames'</span>);
0060 ravenPath=fileparts(fileparts(fileparts(ST(I).file)));
0061 metsFile=fullfile(ravenPath,<span class="string">'external'</span>,<span class="string">'metacyc'</span>,<span class="string">'metaCycMets.mat'</span>);
0062 metaCycMetFile=<span class="string">'compounds.dat'</span>;
0063 
0064 <span class="keyword">if</span> exist(metsFile, <span class="string">'file'</span>)
0065    fprintf([<span class="string">'NOTE: Importing MetaCyc metabolites from '</span> strrep(metsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'.\n'</span>]);
0066    load(metsFile);
0067 <span class="keyword">else</span>
0068    fprintf([<span class="string">'Cannot locate '</span> strrep(metsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">' and will try to generate it from the local MetaCyc database files.\n'</span>]);
0069    <span class="keyword">if</span> ~exist(fullfile(metacycPath,metaCycMetFile),<span class="string">'file'</span>)
0070        EM=fprintf([<span class="string">'The file of metabolites cannot be located, and should be downloaded from MetaCyc.\n'</span>]);
0071        dispEM(EM);
0072    <span class="keyword">else</span>
0073        <span class="comment">%Add new functionality in the order specified in models</span>
0074        metaCycMets.id=<span class="string">'MetaCyc'</span>;
0075        metaCycMets.description=<span class="string">'Automatically generated from MetaCyc database'</span>;
0076     
0077        <span class="comment">%Preallocate memory for 50000 metabolites</span>
0078        metaCycMets.mets=cell(50000,1);
0079        metaCycMets.metNames=cell(50000,1);
0080        metaCycMets.metFormulas=cell(50000,1);
0081        metaCycMets.inchis=cell(50000,1);
0082        metaCycMets.metCharges=zeros(50000,1);
0083        metaCycMets.metMiriams=cell(50000,1);
0084        metaCycMets.keggid=cell(50000,1);
0085     
0086        <span class="comment">%First load information on metabolite ID, name, formula, and others</span>
0087        fid = fopen(fullfile(metacycPath,metaCycMetFile), <span class="string">'r'</span>);
0088     
0089        <span class="comment">%Keeps track of how many metabolites that have been added</span>
0090        metCounter=0;
0091     
0092        <span class="comment">%Loop through the file</span>
0093        <span class="keyword">while</span> 1
0094           <span class="comment">%Get the next line</span>
0095           tline = fgetl(fid);
0096                 <span class="comment">%disp(tline);</span>
0097                 
0098           <span class="comment">% Abort at end of file</span>
0099           <span class="keyword">if</span> ~ischar(tline)
0100               <span class="keyword">break</span>;
0101           <span class="keyword">end</span>
0102     
0103           <span class="comment">%Check if it is a new entry</span>
0104           <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'UNIQUE-ID - '</span>)
0105               metCounter=metCounter+1;
0106                     
0107               <span class="comment">%Add empty strings as initial values</span>
0108               metaCycMets.metNames{metCounter}=<span class="string">''</span>;
0109               metaCycMets.metFormulas{metCounter}=<span class="string">''</span>;
0110               metaCycMets.inchis{metCounter}=<span class="string">''</span>;
0111               <span class="comment">%metaCycMets.smiles{metCounter}='';</span>
0112               <span class="comment">%metaCycMets.pubchem{metCounter}='';</span>
0113               metaCycMets.keggid{metCounter}=<span class="string">''</span>;
0114               nonStandardInchis = <span class="string">''</span>;
0115               
0116               <span class="comment">%Add compound ID</span>
0117               metaCycMets.mets{metCounter}=tline(13:end);
0118           <span class="keyword">end</span>
0119             
0120     
0121           <span class="comment">%Add name</span>
0122           <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp;    strcmp(tline(1:14),<span class="string">'COMMON-NAME - '</span>)
0123               metaCycMets.metNames{metCounter}=tline(15:end);
0124 
0125             <span class="comment">%Romve HTML symbols</span>
0126             metaCycMets.metNames{metCounter}=regexprep(metaCycMets.metNames{metCounter},<span class="string">'&lt;(\w+)&gt;'</span>,<span class="string">''</span>);
0127             metaCycMets.metNames{metCounter}=regexprep(metaCycMets.metNames{metCounter},<span class="string">'&lt;/(\w+)&gt;'</span>,<span class="string">''</span>);
0128             metaCycMets.metNames{metCounter}=regexprep(metaCycMets.metNames{metCounter},<span class="string">'[&amp;;]'</span>,<span class="string">''</span>);
0129                     <span class="keyword">end</span>
0130                     
0131           <span class="comment">%Add charge</span>
0132           <span class="keyword">if</span> numel(tline)&gt;16 &amp;&amp;    strcmp(tline(1:16),<span class="string">'ATOM-CHARGES - ('</span>)
0133               atomCharge=tline(17:end-1);
0134 
0135             s=strfind(atomCharge,<span class="string">' '</span>);
0136             <span class="keyword">if</span> any(s)
0137                 atomCharge=atomCharge(s+1:end);
0138                 metaCycMets.metCharges(metCounter,1)=metaCycMets.metCharges(metCounter,1)+str2num(atomCharge);
0139             <span class="keyword">end</span>
0140                     <span class="keyword">end</span>
0141 
0142           <span class="comment">%Add inchis</span>
0143           <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp; strcmp(tline(1:14),<span class="string">'INCHI - InChI='</span>)
0144               metaCycMets.inchis{metCounter}=tline(15:end);
0145           <span class="keyword">end</span>
0146 
0147           <span class="comment">%Add non-standard inchis</span>
0148           <span class="keyword">if</span> numel(tline)&gt;27 &amp;&amp; strcmp(tline(1:27),<span class="string">'NON-STANDARD-INCHI - InChI='</span>)
0149                 nonStandardInchis=tline(28:end);
0150           <span class="keyword">end</span>
0151 
0152           <span class="comment">%Add SMILES</span>
0153           <span class="keyword">if</span> numel(tline)&gt;9 &amp;&amp; strcmp(tline(1:9),<span class="string">'SMILES - '</span>)
0154                 
0155               <span class="keyword">if</span> isstruct(metaCycMets.metMiriams{metCounter})
0156                   addToIndex=numel(metaCycMets.metMiriams{metCounter}.name)+1;
0157               <span class="keyword">else</span>
0158                   addToIndex=1;
0159               <span class="keyword">end</span>    
0160               tempStruct=metaCycMets.metMiriams{metCounter};
0161               tempStruct.name{addToIndex,1}=<span class="string">'SMILES'</span>;
0162               tempStruct.value{addToIndex,1}=tline(10:end);
0163               metaCycMets.metMiriams{metCounter}=tempStruct;
0164           <span class="keyword">end</span>
0165     
0166           <span class="comment">%Add formula</span>
0167           <span class="keyword">if</span> numel(tline)&gt;20 &amp;&amp; strcmp(tline(1:20),<span class="string">'CHEMICAL-FORMULA - ('</span>)
0168               metaCycMets.metFormulas{metCounter}=strcat(metaCycMets.metFormulas{metCounter},tline(21:end-1));
0169             metaCycMets.metFormulas{metCounter}(isspace(metaCycMets.metFormulas{metCounter})) = [];
0170           <span class="keyword">end</span>
0171 
0172           <span class="comment">%Add KEGG id</span>
0173           <span class="keyword">if</span> numel(tline)&gt;23 &amp;&amp; strcmp(tline(1:23),<span class="string">'DBLINKS - (LIGAND-CPD &quot;'</span>)
0174               keggid=tline(24:end);
0175     
0176               s=strfind(keggid,<span class="string">'&quot;'</span>);
0177               <span class="keyword">if</span> any(s)
0178                  keggid=keggid(1:s-1);
0179               <span class="keyword">end</span>
0180                 
0181               metaCycMets.keggid{metCounter}=keggid;
0182           <span class="keyword">end</span>
0183     
0184           <span class="comment">%Add CHEBI id</span>
0185           <span class="keyword">if</span> numel(tline)&gt;18 &amp;&amp; strcmp(tline(1:18),<span class="string">'DBLINKS - (CHEBI &quot;'</span>)
0186               chebiID=tline(20:end); <span class="comment">%This is because there is sometimes more than one CHEBI index</span>
0187     
0188               s=strfind(chebiID,<span class="string">'&quot;'</span>);
0189               <span class="keyword">if</span> any(s)
0190                  chebiID=chebiID(1:s-1);
0191               <span class="keyword">end</span>
0192                 
0193               <span class="keyword">if</span> isstruct(metaCycMets.metMiriams{metCounter})
0194                   addToIndex=numel(metaCycMets.metMiriams{metCounter}.name)+1;
0195               <span class="keyword">else</span>
0196                   addToIndex=1;
0197               <span class="keyword">end</span>    
0198               tempStruct=metaCycMets.metMiriams{metCounter};
0199               tempStruct.name{addToIndex,1}=<span class="string">'chebi'</span>;
0200               tempStruct.value{addToIndex,1}=strcat(<span class="string">'CHEBI:'</span>,chebiID);
0201               metaCycMets.metMiriams{metCounter}=tempStruct;
0202           <span class="keyword">end</span>
0203 
0204           <span class="comment">%Add PubChem</span>
0205           <span class="keyword">if</span> numel(tline)&gt;20 &amp;&amp; strcmp(tline(1:20),<span class="string">'DBLINKS - (PUBCHEM &quot;'</span>)
0206                   pubchemID=tline(21:end);
0207 
0208               s=strfind(pubchemID,<span class="string">'&quot;'</span>);
0209               <span class="keyword">if</span> any(s)
0210                  pubchemID=pubchemID(1:s-1);
0211               <span class="keyword">end</span>
0212 
0213               <span class="keyword">if</span> isstruct(metaCycMets.metMiriams{metCounter})
0214                   addToIndex=numel(metaCycMets.metMiriams{metCounter}.name)+1;
0215               <span class="keyword">else</span>
0216                   addToIndex=1;
0217               <span class="keyword">end</span>    
0218               tempStruct=metaCycMets.metMiriams{metCounter};
0219               tempStruct.name{addToIndex,1}=<span class="string">'pubchem.compound'</span>;
0220               tempStruct.value{addToIndex,1}=pubchemID;
0221               metaCycMets.metMiriams{metCounter}=tempStruct;
0222           <span class="keyword">end</span>
0223          
0224           <span class="comment">%Add non-standard inchis when standard one is unavailable</span>
0225           <span class="keyword">if</span> strcmp(tline,<span class="string">'//'</span>) &amp;&amp; strcmp(metaCycMets.inchis{metCounter},<span class="string">''</span>)
0226               metaCycMets.inchis{metCounter}=nonStandardInchis;
0227               nonStandardInchis = <span class="string">''</span>;
0228               
0229               <span class="comment">%Refine formula from inchis</span>
0230               s=strfind(metaCycMets.inchis{metCounter},<span class="string">'/'</span>);
0231               <span class="keyword">if</span> any(s)
0232                   inchiFormula=metaCycMets.inchis{metCounter}(s(1)+1:s(2)-1);
0233                   
0234                   <span class="comment">%And remove dot characters</span>
0235                   inchiFormula(regexp(inchiFormula,<span class="string">'[.]'</span>))=[];
0236                   <span class="keyword">if</span> ~strcmp(metaCycMets.metFormulas{metCounter},inchiFormula)
0237                       metaCycMets.metFormulas{metCounter}=inchiFormula;
0238                   <span class="keyword">end</span>
0239               <span class="keyword">end</span>
0240               
0241           <span class="keyword">end</span>
0242 
0243         <span class="keyword">end</span>
0244     
0245         <span class="comment">%Close the file</span>
0246         fclose(fid);
0247     
0248         <span class="comment">%If too much space was allocated, shrink the model</span>
0249         metaCycMets.mets=metaCycMets.mets(1:metCounter);
0250         metaCycMets.metNames=metaCycMets.metNames(1:metCounter);
0251         metaCycMets.metFormulas=metaCycMets.metFormulas(1:metCounter);
0252         metaCycMets.metMiriams=metaCycMets.metMiriams(1:metCounter);
0253         metaCycMets.inchis=metaCycMets.inchis(1:metCounter);
0254         metaCycMets.metCharges=metaCycMets.metCharges(1:metCounter,:);
0255         <span class="comment">%metaCycMets.smiles=metaCycMets.smiles(1:metCounter);</span>
0256         <span class="comment">%metaCycMets.pubchem=metaCycMets.pubchem(1:metCounter);</span>
0257         metaCycMets.keggid=metaCycMets.keggid(1:metCounter);
0258     
0259         <span class="comment">%If the metMiriams structure is empty, use MetaCyc id as metMiriams</span>
0260         <span class="keyword">for</span> i=1:numel(metaCycMets.mets)
0261             <span class="keyword">if</span> ~isstruct(metaCycMets.metMiriams{i})
0262                 miriamStruct.name{1}=<span class="string">'metacyc.compound'</span>;
0263                 miriamStruct.value{1}=metaCycMets.mets{i};
0264                 metaCycMets.metMiriams{i}=miriamStruct;
0265             <span class="keyword">end</span>
0266         <span class="keyword">end</span>
0267         
0268         <span class="comment">%Saves the model</span>
0269         save(<span class="string">'metaCycMets.mat'</span>,<span class="string">'metaCycMets'</span>);
0270      <span class="keyword">end</span>
0271 <span class="keyword">end</span>
0272 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 14-Mar-2018 21:08:28 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>
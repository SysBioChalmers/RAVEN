<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getRxnsFromMetaCyc</title>
  <meta name="keywords" content="getRxnsFromMetaCyc">
  <meta name="description" content="getRxnsFromMetaCyc">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">external</a> &gt; <a href="index.html">metacyc</a> &gt; getRxnsFromMetaCyc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for external\metacyc&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getRxnsFromMetaCyc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>getRxnsFromMetaCyc</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> getRxnsFromMetaCyc
   Retrieves reactions information from MetaCyc database

   metacycPath         if metaCycRxns.mat is not in the RAVEN\external\metacyc
                       directory, this function will attempt to read data
                       from a local dump of the metacyc database. metacycPath
                       is the path to the root of this database
   keepTransportRxns   include transportation reactions, which often have identical
                       reactants and products that turn to be all-zero columns in
                       the S matrix (opt, default false)
   keepUnbalanced      include reactions cannot be unbalanced reactions, usually
                       because they are polymeric reactions or because of a
                       specific difficulty in balancing class structures
                       (opt, default false)
   keepUndetermined    include reactions that have substrates lack chemical
                       structures or with non-numerical coefficients (e.g. n+1)
                       (opt, default false)

   model     a model structure generated from the database. The following
             fields are filled
             id:             'MetaCyc'
             description:    'Automatically generated from MetaCyc database'
             rxns:           MetaCyc reaction ids
             rxnNames:       Name for each reaction entry
             mets:           MetaCyc compound ids. If the equations use
                             stoichiometry such as ID(n+1) then the whole
                             expression is saved as the id
             pwys:           MetaCyc pathway id
             eccodes:        Corresponding ec-number if available
             rxnMiriams:     Contains reaction specific information such as
                             associated RHEA and KEGG reaction ids
             S:              Stoichiometric matrix
             lb:             -1000 for all reactions
             ub:             1000 for all reactions
             rev:            1 for reversible and 0 for irreversible. For
                             reactions present in pathway maps the reversibility
                             is taken from there
             b:              0 for all metabolites

   If the file metaCycRxns.mat is in the RAVEN/external/metacyc directory, it
   will be directly loaded instead of parsing the MetaCyc flat files and
   pre-prepared lists of MetaCyc transport and undetermined reactions.

   Usage: model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)

   Simonas Marcisauskas, 2018-03-19</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="getModelFromMetaCyc.html" class="code" title="function metaCycModel=getModelFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)">getModelFromMetaCyc</a>	getModelFromMetaCyc</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function newString=removeHTMLcodes(string)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</a>
0002 <span class="comment">% getRxnsFromMetaCyc</span>
0003 <span class="comment">%   Retrieves reactions information from MetaCyc database</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   metacycPath         if metaCycRxns.mat is not in the RAVEN\external\metacyc</span>
0006 <span class="comment">%                       directory, this function will attempt to read data</span>
0007 <span class="comment">%                       from a local dump of the metacyc database. metacycPath</span>
0008 <span class="comment">%                       is the path to the root of this database</span>
0009 <span class="comment">%   keepTransportRxns   include transportation reactions, which often have identical</span>
0010 <span class="comment">%                       reactants and products that turn to be all-zero columns in</span>
0011 <span class="comment">%                       the S matrix (opt, default false)</span>
0012 <span class="comment">%   keepUnbalanced      include reactions cannot be unbalanced reactions, usually</span>
0013 <span class="comment">%                       because they are polymeric reactions or because of a</span>
0014 <span class="comment">%                       specific difficulty in balancing class structures</span>
0015 <span class="comment">%                       (opt, default false)</span>
0016 <span class="comment">%   keepUndetermined    include reactions that have substrates lack chemical</span>
0017 <span class="comment">%                       structures or with non-numerical coefficients (e.g. n+1)</span>
0018 <span class="comment">%                       (opt, default false)</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%   model     a model structure generated from the database. The following</span>
0021 <span class="comment">%             fields are filled</span>
0022 <span class="comment">%             id:             'MetaCyc'</span>
0023 <span class="comment">%             description:    'Automatically generated from MetaCyc database'</span>
0024 <span class="comment">%             rxns:           MetaCyc reaction ids</span>
0025 <span class="comment">%             rxnNames:       Name for each reaction entry</span>
0026 <span class="comment">%             mets:           MetaCyc compound ids. If the equations use</span>
0027 <span class="comment">%                             stoichiometry such as ID(n+1) then the whole</span>
0028 <span class="comment">%                             expression is saved as the id</span>
0029 <span class="comment">%             pwys:           MetaCyc pathway id</span>
0030 <span class="comment">%             eccodes:        Corresponding ec-number if available</span>
0031 <span class="comment">%             rxnMiriams:     Contains reaction specific information such as</span>
0032 <span class="comment">%                             associated RHEA and KEGG reaction ids</span>
0033 <span class="comment">%             S:              Stoichiometric matrix</span>
0034 <span class="comment">%             lb:             -1000 for all reactions</span>
0035 <span class="comment">%             ub:             1000 for all reactions</span>
0036 <span class="comment">%             rev:            1 for reversible and 0 for irreversible. For</span>
0037 <span class="comment">%                             reactions present in pathway maps the reversibility</span>
0038 <span class="comment">%                             is taken from there</span>
0039 <span class="comment">%             b:              0 for all metabolites</span>
0040 <span class="comment">%</span>
0041 <span class="comment">%   If the file metaCycRxns.mat is in the RAVEN/external/metacyc directory, it</span>
0042 <span class="comment">%   will be directly loaded instead of parsing the MetaCyc flat files and</span>
0043 <span class="comment">%   pre-prepared lists of MetaCyc transport and undetermined reactions.</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%   Usage: model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</span>
0046 <span class="comment">%</span>
0047 <span class="comment">%   Simonas Marcisauskas, 2018-03-19</span>
0048 <span class="comment">%</span>
0049 
0050 <span class="comment">%NOTE: This is how one entry looks in the file</span>
0051 
0052 <span class="comment">% UNIQUE-ID - 4-HYDROXY-2-KETOPIMELATE-LYSIS-RXN</span>
0053 <span class="comment">% TYPES - Small-Molecule-Reactions</span>
0054 <span class="comment">% TYPES - Chemical-Reactions</span>
0055 <span class="comment">% ATOM-MAPPINGS - (:NO-HYDROGEN-ENCODING (6 7 0 8 1 9 2 10 3 12 11 5 4) (((PYRUVATE 0 5) (SUCC-S-ALD 6 12)) ((CPD-804 0 12))))</span>
0056 <span class="comment">% DBLINKS - (LIGAND-RXN &quot;R01647&quot; NIL |kr| 3650824949 NIL NIL)</span>
0057 <span class="comment">% DBLINKS - (LIGAND-RXN &quot;R01645&quot; NIL |taltman| 3459474590 NIL NIL)</span>
0058 <span class="comment">% EC-NUMBER - EC-4.1.2.52</span>
0059 <span class="comment">% ^OFFICIAL? - T</span>
0060 <span class="comment">% ENZYMATIC-REACTION - ENZRXN-3009</span>
0061 <span class="comment">% IN-PATHWAY - 3-HYDROXYPHENYLACETATE-DEGRADATION-PWY</span>
0062 <span class="comment">% LEFT - CPD-804</span>
0063 <span class="comment">% ORPHAN? - :NO</span>
0064 <span class="comment">% PHYSIOLOGICALLY-RELEVANT? - T</span>
0065 <span class="comment">% REACTION-DIRECTION - LEFT-TO-RIGHT</span>
0066 <span class="comment">% RIGHT - SUCC-S-ALD</span>
0067 <span class="comment">% RIGHT - PYRUVATE</span>
0068 <span class="comment">% //</span>
0069 
0070 <span class="comment">% A line that contains only '//' separates each object.</span>
0071 
0072 <span class="keyword">if</span> nargin&lt;2
0073     keepTransportRxns=false;
0074 <span class="keyword">end</span>
0075 <span class="keyword">if</span> nargin&lt;3
0076     keepUnbalanced=false;
0077 <span class="keyword">end</span>
0078 <span class="keyword">if</span> nargin&lt;4
0079     keepUndetermined=false;
0080 <span class="keyword">end</span>
0081 
0082 <span class="comment">%Check if the reactions have been parsed before and saved. Directly load</span>
0083 <span class="comment">%the model if so.</span>
0084 [ST, I]=dbstack(<span class="string">'-completenames'</span>);
0085 ravenPath=fileparts(fileparts(fileparts(ST(I).file)));
0086 rxnsFile=fullfile(ravenPath,<span class="string">'external'</span>,<span class="string">'metacyc'</span>,<span class="string">'metaCycRxns.mat'</span>);
0087 metaCycRxnFile=<span class="string">'reactions.dat'</span>;
0088 metaCycPwyFile=<span class="string">'pathway-links.dat'</span>;
0089 
0090 <span class="keyword">if</span> exist(rxnsFile, <span class="string">'file'</span>)
0091     fprintf([<span class="string">'NOTE: Importing MetaCyc reactions from '</span> strrep(rxnsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'.\n'</span>]);
0092     load(rxnsFile);
0093 <span class="keyword">else</span>
0094     fprintf([<span class="string">'Cannot locate '</span> strrep(rxnsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">' and will try to generate it from the local MetaCyc database files.\n'</span>]);
0095     <span class="keyword">if</span> ~exist(fullfile(metacycPath,metaCycRxnFile),<span class="string">'file'</span>) || ~exist(fullfile(metacycPath,metaCycPwyFile),<span class="string">'file'</span>)
0096         EM=fprintf([<span class="string">'The files of reactions or pathways cannot be located, and should be downloaded from MetaCyc.\n'</span>]);
0097         dispEM(EM);
0098     <span class="keyword">else</span>
0099         metaCycRxns.id=<span class="string">'MetaCyc'</span>;
0100         metaCycRxns.description=<span class="string">'Automatically generated from MetaCyc database'</span>;
0101         
0102         <span class="comment">%Get pathway names and add them to the field of subSystems</span>
0103         fid = fopen(fullfile(metacycPath,metaCycPwyFile), <span class="string">'r'</span>);
0104         
0105         <span class="comment">%Keeps track of how many pathways that have been added</span>
0106         pwyCounter=0;
0107         pwys=cell(10000,1);
0108         pwyNames=cell(10000,1);
0109         
0110         <span class="comment">%Loop through the file</span>
0111         <span class="keyword">while</span> 1
0112             <span class="comment">%Get the next line</span>
0113             tline = fgetl(fid);
0114             
0115             <span class="comment">%Abort at end of file</span>
0116             <span class="keyword">if</span> ~ischar(tline)
0117                 <span class="keyword">break</span>;
0118             <span class="keyword">end</span>
0119             
0120             <span class="comment">%Read in pathway ids and names</span>
0121             <span class="keyword">if</span> ~strcmp(tline(1),<span class="string">'#'</span>)
0122                 pwyCounter=pwyCounter+1;
0123                 vars = regexp(tline, <span class="string">'\t'</span>, <span class="string">'split'</span>);
0124                 pwys{pwyCounter}=vars{1};
0125                 pwyNames{pwyCounter}=vars{2};
0126                 
0127                 <span class="comment">%Romve HTML symbols</span>
0128                 pwyNames{pwyCounter}=<a href="#_sub1" class="code" title="subfunction newString=removeHTMLcodes(string)">removeHTMLcodes</a>(pwyNames{pwyCounter});
0129                 
0130             <span class="keyword">end</span>
0131         <span class="keyword">end</span>
0132         fclose(fid);
0133         pwys=pwys(1:pwyCounter);
0134         pwyNames=pwyNames(1:pwyCounter);
0135         
0136         <span class="comment">%Preallocate memory for 50000 reactions</span>
0137         metaCycRxns.rxns=cell(50000,1);
0138         metaCycRxns.rxnNames=cell(50000,1);
0139         metaCycRxns.eccodes=cell(50000,1);
0140         metaCycRxns.subSystems=cell(50000,1);
0141         metaCycRxns.pwys=cell(50000,1);
0142         metaCycRxns.rxnMiriams=cell(50000,1);
0143         metaCycRxns.rxnReferences=cell(50000,1);
0144         metaCycRxns.rev=ones(50000,1); <span class="comment">%reversibility;</span>
0145         
0146         rxnLinks.metacyc=cell(10000,1);
0147         rxnLinks.kegg=cell(10000,1);
0148         rxnLinks.check=cell(10000,1);
0149         isSpontaneous=false(10000,1); <span class="comment">%spontaneous;</span>
0150         UNBALANCED=false(10000,1);
0151         UNDETERMINED=cell(10000,1);
0152         TRANSPORT=cell(10000,1);
0153         
0154         <span class="comment">%Transport reactions were organzied into a file</span>
0155         fid = fopen(fullfile(metacycPath,<span class="string">'transportRxns.txt'</span>), <span class="string">'r'</span>);
0156         transportCounter=0;
0157         <span class="comment">%Loop through the file</span>
0158         <span class="keyword">while</span> 1
0159             <span class="comment">%Get the next line</span>
0160             tline = fgetl(fid);
0161             
0162             <span class="comment">%Abort at end of file</span>
0163             <span class="keyword">if</span> ~ischar(tline)
0164                 <span class="keyword">break</span>;
0165             <span class="keyword">end</span>
0166             
0167             <span class="comment">%disp(tline);</span>
0168             transportCounter=transportCounter+1;
0169             TRANSPORT{transportCounter}=tline;
0170         <span class="keyword">end</span>
0171         <span class="comment">%Close the file</span>
0172         fclose(fid);
0173         TRANSPORT=TRANSPORT(1:transportCounter);
0174         
0175         <span class="comment">%Undetermined reactions were organzied into a file</span>
0176         fid = fopen(fullfile(metacycPath,<span class="string">'undeterminedRxns.txt'</span>), <span class="string">'r'</span>);
0177         undetermCounter=0;
0178         <span class="comment">%Loop through the file</span>
0179         <span class="keyword">while</span> 1
0180             <span class="comment">%Get the next line</span>
0181             tline = fgetl(fid);
0182             
0183             <span class="comment">%Abort at end of file</span>
0184             <span class="keyword">if</span> ~ischar(tline)
0185                 <span class="keyword">break</span>;
0186             <span class="keyword">end</span>
0187             
0188             <span class="comment">%disp(tline);</span>
0189             undetermCounter=undetermCounter+1;
0190             s=strfind(tline,<span class="string">': '</span>);
0191             <span class="keyword">if</span> s
0192                 UNDETERMINED{undetermCounter}=tline(1:s-1);
0193             <span class="keyword">end</span>
0194         <span class="keyword">end</span>
0195         <span class="comment">%Close the file</span>
0196         fclose(fid);
0197         UNDETERMINED=UNDETERMINED(1:undetermCounter);
0198         
0199         metaCycRxns.equations=cell(50000,1); <span class="comment">%reaction equations</span>
0200         left=cell(50000,1); <span class="comment">%Temporarily stores the equations</span>
0201         right=cell(50000,1); <span class="comment">%Temporarily stores the equations</span>
0202         
0203         <span class="comment">%First load information on reaction ID, reaction name,, pathway,</span>
0204         <span class="comment">%and ec-number</span>
0205         fid = fopen(fullfile(metacycPath,metaCycRxnFile), <span class="string">'r'</span>);
0206         
0207         <span class="comment">%Keeps track of how many reactions that have been added</span>
0208         rxnCounter=0;
0209         addSpont=false;
0210         dbLinkCounter=0;
0211         
0212         <span class="comment">%Loop through the file</span>
0213         <span class="keyword">while</span> 1
0214             <span class="comment">%Get the next line</span>
0215             tline = fgetl(fid);
0216             
0217             <span class="comment">%Abort at end of file</span>
0218             <span class="keyword">if</span> ~ischar(tline)
0219                 <span class="keyword">break</span>;
0220             <span class="keyword">end</span>
0221             
0222             <span class="comment">%Check if it is a new reaction</span>
0223             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'UNIQUE-ID - '</span>)
0224                 rxnCounter=rxnCounter+1;
0225                 nPwys=0;
0226                 
0227                 <span class="comment">%Add empty strings where there should be such</span>
0228                 metaCycRxns.rxnNames{rxnCounter}=<span class="string">''</span>;
0229                 metaCycRxns.eccodes{rxnCounter}=<span class="string">''</span>;
0230                 metaCycRxns.subSystems{rxnCounter}=<span class="string">''</span>;
0231                 metaCycRxns.pwys{rxnCounter}=<span class="string">''</span>;
0232                 metaCycRxns.equations{rxnCounter}=<span class="string">''</span>;
0233                 metaCycRxns.rxnReferences{rxnCounter}=<span class="string">''</span>;
0234                 reverse=0;   <span class="comment">%Value for reversing the equation when necessary</span>
0235                 
0236                 <span class="comment">% A complex evaluation system for generating the equations</span>
0237                 left{rxnCounter}=<span class="string">''</span>;
0238                 right{rxnCounter}=<span class="string">''</span>;
0239                 coefficient=<span class="string">''</span>;
0240                 templeft=<span class="string">''</span>;
0241                 tempright=<span class="string">''</span>;
0242                 <span class="comment">% might be simplified with a better algorithem</span>
0243                 
0244                 <span class="comment">%Add reaction ID</span>
0245                 metaCycRxns.rxns{rxnCounter}=tline(13:end);
0246                 
0247             <span class="keyword">end</span>
0248             
0249             <span class="comment">%Add name</span>
0250             <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp; strcmp(tline(1:14),<span class="string">'COMMON-NAME - '</span>)
0251                 metaCycRxns.rxnNames{rxnCounter}=tline(15:end);
0252                 
0253                 <span class="comment">%Romve HTML symbols</span>
0254                 metaCycRxns.rxnNames{rxnCounter}=<a href="#_sub1" class="code" title="subfunction newString=removeHTMLcodes(string)">removeHTMLcodes</a>(metaCycRxns.rxnNames{rxnCounter});
0255             <span class="keyword">end</span>
0256             
0257             <span class="comment">%Add eccodes</span>
0258             <span class="keyword">if</span> numel(tline)&gt;15 &amp;&amp; strcmp(tline(1:15),<span class="string">'EC-NUMBER - EC-'</span>)
0259                 <span class="keyword">if</span> isempty(metaCycRxns.eccodes{rxnCounter})
0260                     metaCycRxns.eccodes{rxnCounter}=strcat(<span class="string">'ec-code/'</span>,tline(16:end));
0261                 <span class="keyword">else</span>
0262                     metaCycRxns.eccodes{rxnCounter}=strcat(metaCycRxns.eccodes{rxnCounter},<span class="string">';ec-code/'</span>,tline(16:end));
0263                 <span class="keyword">end</span>
0264             <span class="keyword">end</span>
0265             <span class="keyword">if</span> numel(tline)&gt;16 &amp;&amp; strcmp(tline(1:16),<span class="string">'EC-NUMBER - |EC-'</span>)
0266                 <span class="keyword">if</span> isempty(metaCycRxns.eccodes{rxnCounter})
0267                     metaCycRxns.eccodes{rxnCounter}=strcat(<span class="string">'ec-code/'</span>,tline(17:end-1));
0268                 <span class="keyword">else</span>
0269                     metaCycRxns.eccodes{rxnCounter}=strcat(metaCycRxns.eccodes{rxnCounter},<span class="string">';ec-code/'</span>,tline(17:end-1));
0270                 <span class="keyword">end</span>
0271             <span class="keyword">end</span>
0272             
0273             <span class="comment">%Add pathway id and assign pathway name to subSystem field</span>
0274             <span class="keyword">if</span> numel(tline)&gt;13 &amp;&amp; strcmp(tline(1:13),<span class="string">'IN-PATHWAY - '</span>)
0275                 <span class="keyword">if</span> isempty(metaCycRxns.pwys{rxnCounter})
0276                     metaCycRxns.pwys{rxnCounter}=tline(14:end);
0277                 <span class="keyword">else</span>
0278                     metaCycRxns.pwys{rxnCounter}=strcat(metaCycRxns.pwys{rxnCounter},<span class="string">';'</span>,tline(14:end));
0279                 <span class="keyword">end</span>
0280                 
0281                 [x, y]=ismember(tline(14:end),pwys);
0282                 <span class="keyword">if</span> x
0283                     metaCycRxns.subSystems{rxnCounter,1}{1,numel(metaCycRxns.subSystems{rxnCounter,1})+1}=pwyNames{y};
0284                 <span class="keyword">end</span>
0285             <span class="keyword">end</span>
0286             
0287             <span class="comment">%Add references (pubmed ids)</span>
0288             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'CITATIONS - '</span>)
0289                 <span class="keyword">if</span> isempty(metaCycRxns.rxnReferences{rxnCounter})
0290                     metaCycRxns.rxnReferences{rxnCounter}=strcat(<span class="string">'pubmed/'</span>,tline(13:end));
0291                 <span class="keyword">else</span>
0292                     metaCycRxns.rxnReferences{rxnCounter}=strcat(metaCycRxns.rxnReferences{rxnCounter},<span class="string">';pubmed/'</span>,tline(13:end));
0293                 <span class="keyword">end</span>
0294             <span class="keyword">end</span>
0295             
0296             <span class="comment">%Add Miriam info (cross-links other database)</span>
0297             <span class="keyword">if</span> numel(tline)&gt;11 &amp;&amp; strcmp(tline(1:11),<span class="string">'DBLINKS - ('</span>)
0298                 dblink=tline(12:end);
0299                 <span class="comment">%KEGG reaction id</span>
0300                 <span class="keyword">if</span> strcmp(dblink(1:12),<span class="string">'LIGAND-RXN &quot;'</span>)
0301                     dblink=dblink(13:end);
0302                     s=strfind(dblink,<span class="string">'&quot;'</span>);
0303                     <span class="keyword">if</span> any(s)
0304                         dblink=dblink(1:s-1);
0305                     <span class="keyword">end</span>
0306                     
0307                     <span class="keyword">if</span> isstruct(metaCycRxns.rxnMiriams{rxnCounter})
0308                         addToIndex=numel(metaCycRxns.rxnMiriams{rxnCounter}.name)+1;
0309                     <span class="keyword">else</span>
0310                         addToIndex=1;
0311                     <span class="keyword">end</span>
0312                     tempStruct=metaCycRxns.rxnMiriams{rxnCounter};
0313                     tempStruct.name{addToIndex,1}=<span class="string">'kegg.reaction'</span>;
0314                     tempStruct.value{addToIndex,1}=dblink;
0315                     metaCycRxns.rxnMiriams{rxnCounter}=tempStruct;
0316                     
0317                     <span class="comment">%For generating the rxnLinks structure</span>
0318                     dbLinkCounter=dbLinkCounter+1;
0319                     rxnLinks.metacyc{dbLinkCounter}=metaCycRxns.rxns{rxnCounter};
0320                     rxnLinks.kegg{dbLinkCounter}=dblink;
0321                     rxnLinks.check{dbLinkCounter}=strcat(metaCycRxns.rxns{rxnCounter},dblink);
0322                 <span class="keyword">end</span>
0323                 
0324                 <span class="comment">%RHEA reaction id</span>
0325                 <span class="keyword">if</span> strcmp(dblink(1:6),<span class="string">'RHEA &quot;'</span>)
0326                     dblink=dblink(7:end);
0327                     s=strfind(dblink,<span class="string">'&quot;'</span>);
0328                     <span class="keyword">if</span> any(s)
0329                         dblink=dblink(1:s-1);
0330                     <span class="keyword">end</span>
0331                     
0332                     <span class="keyword">if</span> isstruct(metaCycRxns.rxnMiriams{rxnCounter})
0333                         addToIndex=numel(metaCycRxns.rxnMiriams{rxnCounter}.name)+1;
0334                     <span class="keyword">else</span>
0335                         addToIndex=1;
0336                     <span class="keyword">end</span>
0337                     tempStruct=metaCycRxns.rxnMiriams{rxnCounter};
0338                     tempStruct.name{addToIndex,1}=<span class="string">'rhea'</span>;
0339                     tempStruct.value{addToIndex,1}=dblink;
0340                     metaCycRxns.rxnMiriams{rxnCounter}=tempStruct;
0341                 <span class="keyword">end</span>
0342             <span class="keyword">end</span>
0343             
0344             <span class="keyword">if</span> numel(tline)&gt;21 &amp;&amp; strcmp(tline(1:21),<span class="string">'REACTION-DIRECTION - '</span>)
0345                 rxnDirection=tline(22:end);
0346                 <span class="keyword">switch</span>(rxnDirection)
0347                     <span class="keyword">case</span> <span class="string">'IRREVERSIBLE-LEFT-TO-RIGHT'</span>
0348                         metaCycRxns.rev(rxnCounter,1)=0;
0349                     <span class="keyword">case</span> <span class="string">'LEFT-TO-RIGHT'</span>
0350                         metaCycRxns.rev(rxnCounter,1)=0;
0351                     <span class="keyword">case</span> <span class="string">'PHYSIOL-LEFT-TO-RIGHT'</span>
0352                         metaCycRxns.rev(rxnCounter,1)=0;
0353                     <span class="keyword">case</span> <span class="string">'IRREVERSIBLE-RIGHT-TO-LEFT'</span>
0354                         metaCycRxns.rev(rxnCounter,1)=0;
0355                         reverse=1;
0356                     <span class="keyword">case</span> <span class="string">'RIGHT-TO-LEFT'</span>
0357                         metaCycRxns.rev(rxnCounter,1)=0;
0358                         reverse=1;
0359                     <span class="keyword">case</span> <span class="string">'PHYSIOL-RIGHT-TO-LEFT'</span>
0360                         metaCycRxns.rev(rxnCounter,1)=0;
0361                         reverse=1;
0362                 <span class="keyword">end</span>
0363             <span class="keyword">end</span>
0364             
0365             <span class="comment">%Add spontaneous</span>
0366             <span class="keyword">if</span> strcmp(tline,<span class="string">'SPONTANEOUS? - T'</span>)
0367                 <span class="comment">%metaCycRxns.spontaneous(rxnCounter,1)=1;</span>
0368                 isSpontaneous(rxnCounter)=true;
0369             <span class="keyword">end</span>
0370             
0371             <span class="comment">%Add mass-balance information</span>
0372             <span class="keyword">if</span> strcmp(tline,<span class="string">'CANNOT-BALANCE? - T'</span>)
0373                 UNBALANCED(rxnCounter)=true;
0374             <span class="keyword">end</span>
0375             
0376             <span class="comment">%Add left side equation</span>
0377             <span class="keyword">if</span> numel(tline)&gt;7 &amp;&amp; strcmp(tline(1:7),<span class="string">'LEFT - '</span>)
0378                 <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0379                     <span class="keyword">if</span> strcmp(templeft,<span class="string">''</span>)
0380                         templeft=tline(8:end); <span class="comment">% this is the real first, save to a temp variable</span>
0381                     <span class="keyword">else</span> <span class="comment">% count in the coefficient here</span>
0382                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0383                             left{rxnCounter}=templeft;
0384                         <span class="keyword">else</span>
0385                             left{rxnCounter}=strcat(coefficient,32,templeft);
0386                             coefficient=<span class="string">''</span>;
0387                         <span class="keyword">end</span>
0388                         templeft=tline(8:end);
0389                     <span class="keyword">end</span>
0390                 <span class="keyword">else</span>
0391                     <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0392                         left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,templeft);
0393                     <span class="keyword">else</span>
0394                         left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,templeft);
0395                         coefficient=<span class="string">''</span>;
0396                     <span class="keyword">end</span>
0397                     templeft=tline(8:end);
0398                 <span class="keyword">end</span>
0399             <span class="keyword">end</span>
0400             
0401             <span class="comment">%Add right side equation</span>
0402             <span class="keyword">if</span> numel(tline)&gt;8 &amp;&amp; strcmp(tline(1:8),<span class="string">'RIGHT - '</span>)
0403                 <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0404                     <span class="keyword">if</span> strcmp(tempright,<span class="string">''</span>)
0405                         
0406                         <span class="comment">% a complicated process for the last left</span>
0407                         <span class="comment">% metabolite</span>
0408                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0409                             <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0410                                 left{rxnCounter}=templeft;
0411                             <span class="keyword">else</span>
0412                                 left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,templeft);
0413                             <span class="keyword">end</span>
0414                             
0415                         <span class="keyword">else</span>
0416                             <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0417                                 left{rxnCounter}=strcat(coefficient,32,templeft);
0418                             <span class="keyword">else</span>
0419                                 left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,templeft);
0420                             <span class="keyword">end</span>
0421                             coefficient=<span class="string">''</span>;
0422                         <span class="keyword">end</span>
0423                         <span class="comment">% process end</span>
0424                         
0425                         tempright=tline(9:end); <span class="comment">% this is the real first, save to a temp variable</span>
0426                     <span class="keyword">else</span>
0427                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0428                             right{rxnCounter}=tempright;
0429                         <span class="keyword">else</span>
0430                             right{rxnCounter}=strcat(coefficient,32,tempright);
0431                             coefficient=<span class="string">''</span>;
0432                         <span class="keyword">end</span>
0433                         tempright=tline(9:end);
0434                     <span class="keyword">end</span>
0435                 <span class="keyword">else</span>
0436                     <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0437                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,tempright);
0438                     <span class="keyword">else</span>
0439                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,tempright);
0440                         coefficient=<span class="string">''</span>;
0441                     <span class="keyword">end</span>
0442                     tempright=tline(9:end);
0443                 <span class="keyword">end</span>
0444                 
0445             <span class="keyword">end</span>
0446             
0447             <span class="keyword">if</span> numel(tline)&gt;15 &amp;&amp; strcmp(tline(1:15),<span class="string">'^COEFFICIENT - '</span>)
0448                 coefficient=tline(16:end);
0449             <span class="keyword">end</span>
0450             
0451             <span class="comment">%Generate equation at the end of each object section</span>
0452             <span class="keyword">if</span> strcmp(tline,<span class="string">'//'</span>)
0453                 
0454                 <span class="comment">% a complicated process for the last right metabolite,</span>
0455                 <span class="comment">% sub-function is needed here</span>
0456                 <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0457                     <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0458                         right{rxnCounter}=tempright;
0459                     <span class="keyword">else</span>
0460                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,tempright);
0461                     <span class="keyword">end</span>
0462                     
0463                 <span class="keyword">else</span>
0464                     <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0465                         right{rxnCounter}=strcat(coefficient,32,tempright);
0466                     <span class="keyword">else</span>
0467                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,tempright);
0468                     <span class="keyword">end</span>
0469                     coefficient=<span class="string">''</span>;
0470                 <span class="keyword">end</span>
0471                 <span class="comment">% process end</span>
0472                 
0473                 <span class="comment">%get the right direction symbol</span>
0474                 <span class="keyword">if</span> metaCycRxns.rev(rxnCounter,1)
0475                     symbol = <span class="string">' &lt;=&gt;'</span>;
0476                 <span class="keyword">else</span>
0477                     symbol = <span class="string">' =&gt;'</span>;
0478                 <span class="keyword">end</span>
0479                 
0480                 <span class="keyword">if</span> reverse
0481                     metaCycRxns.equations{rxnCounter}=strcat(right{rxnCounter},symbol,32,left{rxnCounter});
0482                 <span class="keyword">else</span>
0483                     metaCycRxns.equations{rxnCounter}=strcat(left{rxnCounter},symbol,32,right{rxnCounter});
0484                 <span class="keyword">end</span>
0485                 
0486                 <span class="comment">%Final equation check</span>
0487                 <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>) || strcmp(right{rxnCounter},<span class="string">''</span>)
0488                     rxnCounter=rxnCounter-1;
0489                     
0490                 <span class="keyword">end</span>
0491                 
0492             <span class="keyword">end</span>
0493             
0494         <span class="keyword">end</span>
0495         <span class="comment">%Close the file</span>
0496         fclose(fid);
0497         
0498         <span class="comment">%===</span>
0499         UNBALANCED=metaCycRxns.rxns(UNBALANCED);
0500         isSpontaneous=metaCycRxns.rxns(isSpontaneous);
0501         
0502         <span class="comment">%If too much space was allocated, shrink the model</span>
0503         metaCycRxns.rxns=metaCycRxns.rxns(1:rxnCounter);
0504         metaCycRxns.rxnNames=metaCycRxns.rxnNames(1:rxnCounter);
0505         metaCycRxns.eccodes=metaCycRxns.eccodes(1:rxnCounter);
0506         metaCycRxns.equations=metaCycRxns.equations(1:rxnCounter);
0507         metaCycRxns.rxnMiriams=metaCycRxns.rxnMiriams(1:rxnCounter);
0508         metaCycRxns.rxnReferences=metaCycRxns.rxnReferences(1:rxnCounter);
0509         metaCycRxns.subSystems=metaCycRxns.subSystems(1:rxnCounter);
0510         metaCycRxns.pwys=metaCycRxns.pwys(1:rxnCounter);
0511         metaCycRxns.rev=metaCycRxns.rev(1:rxnCounter,:);
0512         
0513         rxnLinks.kegg=rxnLinks.kegg(1:dbLinkCounter);
0514         rxnLinks.metacyc=rxnLinks.metacyc(1:dbLinkCounter);
0515         rxnLinks.check=rxnLinks.check(1:dbLinkCounter);
0516         [~,index]=unique(rxnLinks.check);
0517         rxnLinks.kegg=rxnLinks.kegg(index);
0518         rxnLinks.metacyc=rxnLinks.metacyc(index);
0519         rxnLinks=rmfield(rxnLinks,<span class="string">'check'</span>);
0520         
0521         <span class="comment">%Construct the S matrix and list of metabolites</span>
0522         [S, mets, badRxns]=constructS(metaCycRxns.equations);
0523         metaCycRxns.S=S;
0524         metaCycRxns.mets=mets;
0525         
0526         <span class="comment">%Add some stuff to get a correct model structure</span>
0527         metaCycRxns.ub=ones(rxnCounter,1)*1000;
0528         metaCycRxns.lb=metaCycRxns.rev*-1000;
0529         metaCycRxns.c=zeros(rxnCounter,1);
0530         metaCycRxns.b=zeros(numel(metaCycRxns.mets),1);
0531         
0532         <span class="comment">%Save the model structure</span>
0533         save(rxnsFile,<span class="string">'metaCycRxns'</span>,<span class="string">'rxnLinks'</span>,<span class="string">'TRANSPORT'</span>,<span class="string">'UNBALANCED'</span>,<span class="string">'UNDETERMINED'</span>,<span class="string">'isSpontaneous'</span>);
0534     <span class="keyword">end</span>
0535 <span class="keyword">end</span>
0536 
0537 <span class="comment">%Deal with reactions that are labeled as &quot;TRANSPORT&quot;, &quot;UNBALANCED&quot;, or</span>
0538 <span class="comment">%&quot;UNDETERMINED&quot; (depending on settings).</span>
0539 model=metaCycRxns;
0540 <span class="keyword">if</span> keepTransportRxns==false
0541     model=removeReactions(model,intersect(TRANSPORT,model.rxns),true,true);
0542 <span class="keyword">end</span>
0543 <span class="keyword">if</span> keepUnbalanced==false
0544     model=removeReactions(model,intersect(UNBALANCED,model.rxns),true,true);
0545 <span class="keyword">end</span>
0546 <span class="keyword">if</span> keepUndetermined==false
0547     model=removeReactions(model,intersect(UNDETERMINED,model.rxns),true,true);
0548 <span class="keyword">end</span>
0549 <span class="keyword">end</span>
0550 
0551 <span class="comment">%Sub function for romving HTML symbols from the names of reaction and</span>
0552 <span class="comment">%pathway</span>
0553 <a name="_sub1" href="#_subfunctions" class="code">function newString=removeHTMLcodes(string)</a>
0554 string=regexprep(string,<span class="string">'&lt;(\w+)&gt;'</span>,<span class="string">''</span>);
0555 string=regexprep(string,<span class="string">'&lt;/(\w+)&gt;'</span>,<span class="string">''</span>);
0556 string=regexprep(string,<span class="string">'[&amp;;]'</span>,<span class="string">''</span>);
0557 newString=string;
0558 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 22-Aug-2018 16:19:49 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>